<!DOCTYPE html>
<html lang="en" dir="ltr">

<head prefix="og: http://ogp.me/ns#">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>interview â€“ VictorHong&#39;s Blog</title>
    

  
  
    
    <script defer src="/js/custom.min.47326d238d3078544d08f93ec80c13c0ba3051dd5434d455e866ce5ff917db54.js"></script>
  




  
  <script defer src="/js/fuse.min.32195737929df2c8096e855a5789cbb3f1331224d9169e8705493e7008f47df8.js"></script>



<script src="/js/enquire.min.dfb99dee1e029d51d6cfb672d847929890b1585402de17f5ed092edd72a688b4.js"></script>

<script defer src="/js/lazysizes.min.fb649fcae62177dfe63e67081ddceb830b5ce1f05a4184e9bbb7d87ac4b8f4e5.js"></script>

<script defer src="/js/helper/getParents.min.086022fb02d7a1517e33c2670bffb976b3e80bcacd9caeee0c6a586064f20e42.js"></script>

<script defer src="/js/helper/fadeinout.min.3ce954c8aea3b69cc5e6f734d8273ba4cd48d3a7987dbdca145849bc4b8fc296.js"></script>

<script defer src="/js/helper/closest.min.js"></script>
  
<script>
  "use strict";

  
  
  if (window.NodeList && !NodeList.prototype.forEach) {
    NodeList.prototype.forEach = Array.prototype.forEach;
  }

  
  if (!String.prototype.includes) {
    String.prototype.includes = function (search, start) {
      'use strict';

      if (search instanceof RegExp) {
        throw TypeError('first argument must not be a RegExp');
      }
      if (start === undefined) { start = 0; }
      return this.indexOf(search, start) !== -1;
    };
  }

  
  Document.prototype.append = Element.prototype.append = function append() {
    this.appendChild(_mutation(arguments));
  };
  function _mutation(nodes) {
    if (!nodes.length) {
      throw new Error('DOM Exception 8');
    } else if (nodes.length === 1) {
      return typeof nodes[0] === 'string' ? document.createTextNode(nodes[0]) : nodes[0];
    } else {
      var
      fragment = document.createDocumentFragment(),
      length = nodes.length,
      index = -1,
      node;

      while (++index < length) {
        node = nodes[index];

        fragment.appendChild(typeof node === 'string' ? document.createTextNode(node) : node);
      }

      return fragment;
    }
  }

  
  if (!String.prototype.startsWith) {
    String.prototype.startsWith = function (searchString, position) {
      position = position || 0;
      return this.indexOf(searchString, position) === position;
    };
  }
  


  document.addEventListener('DOMContentLoaded', function () {
    
    var navCollapseBtn = document.querySelector('.navbar__burger');
    navCollapseBtn ? navCollapseBtn.addEventListener('click', function (e) {
      var navCollapse = document.querySelector('.navbarm__collapse');

      if (navCollapse) {
        var dataOpen = navCollapse.getAttribute('data-open');

        if (dataOpen === 'true') {
          navCollapse.setAttribute('data-open', 'false');
          navCollapse.style.maxHeight = 0;
          navCollapseBtn.classList.remove('is-active');
        } else {
          navCollapse.setAttribute('data-open', 'true');
          navCollapse.style.maxHeight = navCollapse.scrollHeight + "px";
          navCollapseBtn.classList.add('is-active');
        }
      }
    }) : null;
    


    
    var tables = document.querySelectorAll('.single__contents > table');
    for (let i = 0; i < tables.length; i++) {
      var table = tables[i];
      var wrapper = document.createElement('div');
      wrapper.className = 'table-wrapper';
      table.parentElement.replaceChild(wrapper, table);
      wrapper.appendChild(table);
    }
    


    
    var footNoteRefs = document.querySelectorAll('.footnote-ref');
    var footNoteBackRefs = document.querySelectorAll('.footnote-backref');

    footNoteRefs ? 
    footNoteRefs.forEach(function(elem, idx) {
      elem.onmouseenter = function () {
        if (navbar.classList.contains('scrolling')) {
          navbar.classList.remove('scrolling');
        }
      }

      elem.onmouseleave = function () {
        if (!navbar.classList.contains('scrolling')) {
          setTimeout(function () {
            navbar.classList.add('scrolling');
          }, 100);
        }
      }

      elem.onclick = function () {
        if (!navbar.classList.contains('scrolling')) {
          navbar.classList.remove('navbar--show');
          navbar.classList.remove('navbar--hide');
          navbar.classList.add('navbar--hide');
        }
      }
    }) : null;

    footNoteBackRefs ? 
    footNoteBackRefs.forEach(function(elem, idx) {
      elem.onmouseenter = function () {
        if (navbar.classList.contains('scrolling')) {
          navbar.classList.remove('scrolling');
        }
      }

      elem.onmouseleave = function () {
        if (!navbar.classList.contains('scrolling')) {
          setTimeout(function() {
            navbar.classList.add('scrolling');
          }, 100);
        }
      }

      elem.onclick = function () {
        if (!navbar.classList.contains('scrolling')) {
          navbar.classList.remove('navbar--show');
          navbar.classList.remove('navbar--hide');
          navbar.classList.add('navbar--hide');
        }
      }
    }) : null;
    


    
    var summaryContainer = document.querySelector('.summary__container');
    var searchResult = document.querySelector('.search-result');
    var searchResultCloseBtn = document.querySelector('.search-result__close');
    searchResultCloseBtn ? searchResultCloseBtn.addEventListener('click', function (e) {
      searchResult.setAttribute('data-display', 'none');
      summaryContainer.setAttribute('data-display', 'block');
    }) : null;
    


    
    document.querySelectorAll('.tab') ? 
    document.querySelectorAll('.tab').forEach(function(elem, idx) {
      var containerId = elem.getAttribute('id');
      var containerElem = elem;
      var tabLinks = elem.querySelectorAll('.tab__link');
      var tabContents = elem.querySelectorAll('.tab__content');
      var ids = [];

      tabLinks && tabLinks.length > 0 ?
      tabLinks.forEach(function(link, index, self) {
        link.onclick = function(e) {
          for (var i = 0; i < self.length; i++) {
            if (index === parseInt(i, 10)) {
              if (!self[i].classList.contains('active')) {
                self[i].classList.add('active');
                tabContents[i].style.display = 'block';
              }
            } else {
              self[i].classList.remove('active');
              tabContents[i].style.display = 'none';
            }
          }
        }
      }) : null;
    }) : null;
    


    
    document.querySelectorAll('.codetab') ? 
    document.querySelectorAll('.codetab').forEach(function(elem, idx) {
      var containerId = elem.getAttribute('id');
      var containerElem = elem;
      var codetabLinks = elem.querySelectorAll('.codetab__link');
      var codetabContents = elem.querySelectorAll('.codetab__content');
      var ids = [];

      codetabLinks && codetabLinks.length > 0 ?
      codetabLinks.forEach(function(link, index, self) {
        link.onclick = function(e) {
          for (var i = 0; i < self.length; i++) {
            if (index === parseInt(i, 10)) {
              if (!self[i].classList.contains('active')) {
                self[i].classList.add('active');
                codetabContents[i].style.display = 'block';
              }
            } else {
              self[i].classList.remove('active');
              codetabContents[i].style.display = 'none';
            }
          }
        }
      }) : null;
    }) : null;
    


    
    var gttBtn = document.getElementById("gtt");
    gttBtn.style.display = "none";
    gttBtn.addEventListener('click', function () {
      if (window.document.documentMode) {
        document.documentElement.scrollTop = 0;
      } else {
        scrollToTop(250);
      }
    });

    function scrollToTop(scrollDuration) {
      var scrollStep = -window.scrollY / (scrollDuration / 15);
      var scrollInterval = setInterval(function () {
        if (window.scrollY != 0) {
          window.scrollBy(0, scrollStep);
        }
        else clearInterval(scrollInterval);
      }, 15);
    }

    var scrollFunction = function () {
      if (document.body.scrollTop > 250 || document.documentElement.scrollTop > 250) {
        gttBtn.style.display = "block";
      } else {
        gttBtn.style.display = "none";
      }
    }
    


    
    var expandBtn = document.querySelectorAll('.expand__button');

    for (let i = 0; i < expandBtn.length; i++) {
      expandBtn[i].addEventListener("click", function () {
        var content = this.nextElementSibling;
        if (content.style.maxHeight) {
          content.style.maxHeight = null;
          this.querySelector('svg').classList.add('expand-icon__right');
          this.querySelector('svg').classList.remove('expand-icon__down');
        } else {
          content.style.maxHeight = content.scrollHeight + "px";
          this.querySelector('svg').classList.remove('expand-icon__right');
          this.querySelector('svg').classList.add('expand-icon__down');
        }
      });
    }
    


    
    var lastScrollTop = window.pageYOffset || document.documentElement.scrollTop;
    var tocElem = document.querySelector('.toc');
    var tableOfContentsElem = tocElem ? tocElem.querySelector('#TableOfContents') : null;
    var toggleTocElem = document.getElementById('toggle-toc');
    var singleContentsElem = document.querySelector('.single__contents');
    var navbar = document.querySelector('.navbar');
    var tocFlexbox = document.querySelector('.toc__flexbox');
    var tocFlexboxOuter = document.querySelector('.toc__flexbox--outer');
    var expandContents = document.querySelectorAll('.expand__content');
    var boxContents = document.querySelectorAll('.box');
    var notAllowedTitleIds = null;

    
    var tocFolding = JSON.parse("true");
    
    var tocLevels = JSON.parse("[\"h2\",\"h3\",\"h4\"]");
    
    if (tocLevels) {
      tocLevels = tocLevels.toString();
    } else {
      tocLevels = "h1, h2, h3, h4, h5, h6";
    }

    
    singleContentsElem && singleContentsElem.querySelectorAll(".tab") ?
    singleContentsElem.querySelectorAll(".tab").forEach(function (elem) {
      elem.querySelectorAll(tocLevels).forEach(function (element) {
        notAllowedTitleIds = Array.isArray(notAllowedTitleIds) ?
          notAllowedTitleIds.concat(element.getAttribute('id')) :
          [element.getAttribute('id')];
      });
    }) : null;

    
    expandContents ? expandContents.forEach(function(elem) {
      elem.querySelectorAll(tocLevels).forEach(function (element) {
        notAllowedTitleIds = Array.isArray(notAllowedTitleIds) ?
          notAllowedTitleIds.concat(element.getAttribute('id')) :
          [element.getAttribute('id')];
      });
    }) : null;

    
    boxContents ? boxContents.forEach(function(elem) {
      elem.querySelectorAll(tocLevels).forEach(function (element) {
        notAllowedTitleIds = Array.isArray(notAllowedTitleIds) ?
          notAllowedTitleIds.concat(element.getAttribute('id')) :
          [element.getAttribute('id')];
      });
    }) : null;

    
    window.onscroll = function () {
      scrollFunction();
      
      var st = window.pageYOffset || document.documentElement.scrollTop;
      if (st > lastScrollTop) { 
        if (st < 250) {
          gttBtn.style.display = "none";
        } else {
          gttBtn.style.display = "block";
        }

        if (st < 45) {
          return null;
        }

        if (navbar.classList.contains('scrolling')) {
          if (!navbar.classList.contains('navbar--hide')) {
            navbar.classList.add('navbar--hide');
          } else if (navbar.classList.contains('navbar--show')) {
            navbar.classList.remove('navbar--show');
          }
        }

        if (singleContentsElem) {
          if (singleContentsElem.querySelectorAll(tocLevels).length > 0) {
            singleContentsElem.querySelectorAll(tocLevels).forEach(function (elem) {
              if (toggleTocElem && !toggleTocElem.checked) {
                return null;
              }

              if (notAllowedTitleIds && notAllowedTitleIds.includes(elem.getAttribute('id'))) {
                return null;
              }
              
              if (document.documentElement.scrollTop >= elem.offsetTop) {
                if (tableOfContentsElem) {
                  var id = elem.getAttribute('id');
                  tocElem.querySelectorAll('a').forEach(function (elem) {
                    elem.classList.remove('active');
                  });
                  tocElem.querySelector('a[href="#' + id + '"]') ?
                    tocElem.querySelector('a[href="#' + id + '"]').classList.add('active') : null;

                  if (false === tocFolding) {
                    
                  } else {
                    tableOfContentsElem.querySelectorAll('ul') ?
                      tableOfContentsElem.querySelectorAll('ul').forEach(function (rootUl) {
                        rootUl.querySelectorAll('li').forEach(function (liElem) {
                          liElem.querySelectorAll('ul').forEach(function (ulElem) {
                            ulElem.style.display = 'none';
                          });
                        });
                      }) : null;
                  }

                  var curElem = tableOfContentsElem.querySelector("[href='#" + id + "']");
                  if (curElem && curElem.nextElementSibling) {
                    curElem.nextElementSibling.style.display = 'block';
                  }
                  getParents(curElem, 'ul') ?
                    getParents(curElem, 'ul').forEach(function (elem) {
                      elem.style.display = 'block';
                    }) : null;
                }
              }
            });
          } else {
            if (tocFlexbox) {
              tocFlexbox.setAttribute('data-position', '');
              if (!tocFlexbox.classList.contains('hide')) {
                tocFlexbox.classList.add('hide');
              }
            }
            if (tocFlexboxOuter) {
              tocFlexboxOuter.setAttribute('data-position', '');
              if (!tocFlexboxOuter.classList.contains('hide')) {
                tocFlexboxOuter.classList.add('hide');
              }
            }
          }
        }
      } else { 
        if (st < 250) {
          gttBtn.style.display = "none";
        }

        if (navbar.classList.contains('scrolling')) {
          if (navbar.classList.contains('navbar--hide')) {
            navbar.classList.remove('navbar--hide');
          } else if (!navbar.classList.contains('navbar--show')) {
            navbar.classList.add('navbar--show');
          }
        }

        if (singleContentsElem) {
          if (singleContentsElem.querySelectorAll(tocLevels).length > 0) {
            singleContentsElem.querySelectorAll(tocLevels).forEach(function (elem) {
              if (toggleTocElem && !toggleTocElem.checked) {
                return null;
              }
              
              if (notAllowedTitleIds && notAllowedTitleIds.includes(elem.getAttribute('id'))) {
                return null;
              }

              if (document.documentElement.scrollTop >= elem.offsetTop) {
                if (tableOfContentsElem) {
                  var id = elem.getAttribute('id');
                  tocElem.querySelectorAll('a').forEach(function (elem) {
                    elem.classList.remove('active');
                  });
                  tocElem.querySelector('a[href="#' + id + '"]') ?
                    tocElem.querySelector('a[href="#' + id + '"]').classList.add('active') : null;

                  if (false === tocFolding) {
                    
                  } else {
                    tableOfContentsElem.querySelectorAll('ul') ?
                      tableOfContentsElem.querySelectorAll('ul').forEach(function (rootUl) {
                        rootUl.querySelectorAll('li').forEach(function (liElem) {
                          liElem.querySelectorAll('ul').forEach(function (ulElem) {
                            ulElem.style.display = 'none';
                          });
                        });
                      }) : null;
                  }

                  var curElem = tableOfContentsElem.querySelector("[href='#" + id + "']");
                  if (curElem && curElem.nextElementSibling) {
                    curElem.nextElementSibling.style.display = 'block';
                  }
                  getParents(curElem, 'ul') ?
                    getParents(curElem, 'ul').forEach(function (elem) {
                      elem.style.display = 'block';
                    }) : null;
                }
              }
            });
          } else {
            if (tocFlexbox && !tocFlexbox.classList.contains('hide')) {
              tocFlexbox.classList.add('hide');
            }
            if (tocFlexboxOuter && !tocFlexboxOuter.classList.contains('hide')) {
              tocFlexboxOuter.classList.add('hide');
            }
          }
          
        }

        if (tableOfContentsElem && document.documentElement.scrollTop < 250) {
          if (false === tocFolding) {

          } else {
            tableOfContentsElem.querySelector('ul') ?
              tableOfContentsElem.querySelector('ul').querySelectorAll('li').forEach(function (liElem) {
                liElem.querySelectorAll('ul').forEach(function (ulElem) {
                  ulElem.style.display = 'none';
                });
              }) : null;
          }
        }
      }
      lastScrollTop = st <= 0 ? 0 : st;
    };
  


  
    var localTheme = localStorage.getItem('theme');
    var rootEleme = document.getElementById('root');
    var selectThemeElem = document.querySelectorAll('.select-theme');
    var selectThemeItemElem = document.querySelectorAll('.select-theme__item');
    
    
    var skinDarkCode = JSON.parse("\"dark\"");
    
    var skinLightCode = JSON.parse("\"light\"");
    
    var skinHackerCode = JSON.parse("\"hacker\"");
    
    var skinSolarizedCode = JSON.parse("\"solarized\"");
    
    var skinKimbieCode = JSON.parse("\"kimbie\"");

    var setMetaColor = function(themeColor) {
      var metaMsapplicationTileColor = document.getElementsByName('msapplication-TileColor')[0];
      var metaThemeColor = document.getElementsByName('theme-color')[0];
      var metaMsapplicationNavbuttonColor = document.getElementsByName('msapplication-navbutton-color')[0];
      var metaAppleMobileWebAappStatusBarStyle = document.getElementsByName('apple-mobile-web-app-status-bar-style')[0];

      if (themeColor.includes('dark')) {
        metaMsapplicationTileColor.setAttribute('content', '#fcfcfa');
        metaThemeColor.setAttribute('content', '#403E41');
        metaMsapplicationNavbuttonColor.setAttribute('content', '#403E41');
        metaAppleMobileWebAappStatusBarStyle.setAttribute('content', '#403E41');
      } else if (themeColor.includes('light')) {
        metaMsapplicationTileColor.setAttribute('content', '#555');
        metaThemeColor.setAttribute('content', '#eee');
        metaMsapplicationNavbuttonColor.setAttribute('content', '#eee');
        metaAppleMobileWebAappStatusBarStyle.setAttribute('content', '#eee');
      } else if (themeColor.includes('hacker')) {
        metaMsapplicationTileColor.setAttribute('content', '#e3cd26');
        metaThemeColor.setAttribute('content', '#252526');
        metaMsapplicationNavbuttonColor.setAttribute('content', '#252526');
        metaAppleMobileWebAappStatusBarStyle.setAttribute('content', '#252526');
      } else if (themeColor.includes('solarized')) {
        metaMsapplicationTileColor.setAttribute('content', '#d3af86');
        metaThemeColor.setAttribute('content', '#51412c');
        metaMsapplicationNavbuttonColor.setAttribute('content', '#51412c');
        metaAppleMobileWebAappStatusBarStyle.setAttribute('content', '#51412c');
      } else if (themeColor.includes('kimbie')) {
        metaMsapplicationTileColor.setAttribute('content', '#586e75');
        metaThemeColor.setAttribute('content', '#eee8d5');
        metaMsapplicationNavbuttonColor.setAttribute('content', '#eee8d5');
        metaAppleMobileWebAappStatusBarStyle.setAttribute('content', '#eee8d5');
      }
    }

    var parseSkinCode = function(themeText) {
      if (themeText === skinDarkCode) {
        return 'dark';
      } else if (themeText === skinLightCode) {
        return 'light';
      } else if (themeText === skinHackerCode) {
        return 'hacker';
      } else if (themeText === skinSolarizedCode) {
        return 'solarized';
      } else if (themeText === skinKimbieCode) {
        return 'kimbie';
      }
    }
    
    if (localTheme) {
      selectThemeItemElem ? 
      selectThemeItemElem.forEach(function (elem) {
        if (elem.text.trim() === localTheme) {
          elem.classList.add('is-active');
        } else {
          elem.classList.remove('is-active');
        }
      }) : null;

      setMetaColor(localTheme);
    } else {
      setMetaColor(rootEleme.className);
    }

    selectThemeItemElem ? 
    selectThemeItemElem.forEach(function (v, i) {
      v.addEventListener('click', function (e) {
        var selectedThemeVariant = parseSkinCode(e.target.text.trim());
        localStorage.setItem('theme', selectedThemeVariant);
        setMetaColor(selectedThemeVariant);

        rootEleme.removeAttribute('class');
        rootEleme.classList.add('theme__' + selectedThemeVariant);
        selectThemeElem.forEach(function(rootElem) {
          rootElem.querySelectorAll('a').forEach(function (elem) {
            if (elem.classList) {
              if (elem.text.trim() === selectedThemeVariant) {
                if (!elem.classList.contains('is-active')) {
                  elem.classList.add('is-active');
                }
              } else {
                if (elem.classList.contains('is-active')) {
                  elem.classList.remove('is-active');
                }
              }
            }
          });
        });

        if (window.mermaid) {
          if (selectedThemeVariant === "dark" || selectedThemeVariant === "hacker") {
            mermaid.initialize({ theme: 'dark' });
            location.reload();
          } else {
            mermaid.initialize({ theme: 'default' });
            location.reload();
          }
        }

        var utterances = document.getElementById('utterances');
        if (utterances) {
          utterances.querySelector('iframe').contentWindow.postMessage({
            type: 'set-theme',
            theme: selectedThemeVariant === "dark" || selectedThemeVariant === "hacker" ? 'photon-dark' : selectedThemeVariant === 'kimbie' ? 'github-dark-orange' : 'github-light',
          }, 'https://utteranc.es');
        }

        var twitterCards = document.querySelectorAll('.twitter-timeline');
        if (twitterCards) {
          window.postMessage({
            type: 'set-twitter-theme',
            theme: selectedThemeVariant === 'light' || selectedThemeVariant === 'solarized' ? 'light' : 'dark',
          });
        }
      });
    }) : null;
  


  
    
    var baseurl = JSON.parse("\"https://hugo.jiahongw.com\"");
    
    var permalink = JSON.parse("\"https://hugo.jiahongw.com/en/zh/talks/interview/\"");
    
    var langprefix = JSON.parse("\"/en\"");
    var searchResults = null;
    var searchMenu = null;
    var searchText = null;
    
    
    var enableSearch = JSON.parse("true");
    
    var searchDistance = JSON.parse("null");
    
    var searchThreshold = JSON.parse("null");
    
    var searchContent = JSON.parse("null");
    
    var enableSearchHighlight = JSON.parse("true");
    
    var searchResultPosition = JSON.parse("\"main\"");
    
    var sectionType = JSON.parse("\"zh\"");
    
    var kind = JSON.parse("\"page\"");
    
    var fuse = null;

    if (enableSearch) {
      (function initFuse() {
        var xhr = new XMLHttpRequest();
        if (sectionType === "publication" && kind !== "page") {
          xhr.open('GET', permalink + "index.json");
        } else {
          xhr.open('GET', baseurl + langprefix + "/index.json");
        }
        
        xhr.setRequestHeader('Content-Type', 'application/json; charset=utf-8');
        xhr.onload = function () {
          if (xhr.status === 200) {
            fuse = new Fuse(JSON.parse(xhr.response.toString('utf-8')), {
              keys: sectionType.includes('publication') ? ['title', 'abstract'] : 
                searchContent ? ['title', 'description', 'content'] : ['title', 'description'],
              includeMatches: enableSearchHighlight,
              shouldSort: true, 
              threshold: searchThreshold ? searchThreshold : 0.4, 
              location: 0, 
              distance: searchDistance ? searchDistance : 100, 
              maxPatternLength: 32,
              minMatchCharLength: 1,
              isCaseSensitive: false, 
              findAllMatches: false, 
              useExtendedSearch: false, 
            });
            window.fuse = fuse;
          }
          else {
            console.error('[' + xhr.status + ']Error:', xhr.statusText);
          }
        };
        xhr.send();
      })();
    }

    function makeLi(ulElem, obj) {
      var li = document.createElement('li');
      li.className = 'search-result__item';
      
      var a = document.createElement('a');
      a.innerHTML = obj.item.title;
      a.setAttribute('class', 'search-result__item--title');
      a.setAttribute('href', obj.item.uri);

      var descDiv = document.createElement('div');
      descDiv.setAttribute('class', 'search-result__item--desc');
      if (obj.item.description) {
        descDiv.innerHTML = obj.item.description;
      } else if (obj.item.content) {
        descDiv.innerHTML = obj.item.content.substring(0, 225);
      }
      
      li.appendChild(a);
      li.appendChild(descDiv);
      ulElem.appendChild(li);
    }

    function makeHighlightLi(ulElem, obj) {
      var li = document.createElement('li');
      li.className = 'search-result__item';
      var descDiv = null;

      var a = document.createElement('a');
      a.innerHTML = obj.item.title;
      a.setAttribute('class', 'search-result__item--title');
      a.setAttribute('href', obj.item.uri);

      if (obj.matches && obj.matches.length) {
        for (var i = 0; i < obj.matches.length; i++) {
          if ('title' === obj.matches[i].key) {
            a = document.createElement('a');
            a.innerHTML = generateHighlightedText(obj.matches[i].value, obj.matches[i].indices);
            a.setAttribute('class', 'search-result__item--title');
            a.setAttribute('href', obj.item.uri);
          }
          
          if ('description' === obj.matches[i].key) {
            descDiv = document.createElement('div');
            descDiv.setAttribute('class', 'search-result__item--desc');
            descDiv.innerHTML = generateHighlightedText(obj.item.description, obj.matches[i].indices);
          } else if ('content' === obj.matches[i].key) {
            if (!descDiv) {
              descDiv = document.createElement('div');
              descDiv.setAttribute('class', 'search-result__item--desc');
              descDiv.innerHTML = generateHighlightedText(obj.item.content.substring(0, 150), obj.matches[i].indices);
            }
          } else {
            if (obj.item.description) {
              descDiv = document.createElement('div');
              descDiv.setAttribute('class', 'search-result__item--desc');
              descDiv.innerHTML = obj.item.description;
            } else {
              descDiv = document.createElement('div');
              descDiv.setAttribute('class', 'search-result__item--desc');
              descDiv.innerHTML = obj.item.content.substring(0, 150);
            }
          }
        }

        li.appendChild(a);
        if (descDiv) {
          li.appendChild(descDiv);
        }
        if (li) {
          ulElem.appendChild(li);
        }
      }
    }

    function renderSearchResultsSide(searchText, results) {
      searchResults = document.getElementById('search-results');
      searchMenu = document.getElementById('search-menu');
      searchResults.setAttribute('class', 'dropdown is-active');
      
      var ul = document.createElement('ul');
      ul.setAttribute('class', 'dropdown-content search-content');

      if (results.length) {
        results.forEach(function (result) {
          var li = document.createElement('li');
          var a = document.createElement('a');
          a.setAttribute('href', result.uri);
          a.setAttribute('class', 'dropdown-item');
          a.appendChild(li);

          var titleDiv = document.createElement('div');
          titleDiv.innerHTML = result.title;
          titleDiv.setAttribute('class', 'menu-item__title');

          var descDiv = document.createElement('div');
          descDiv.setAttribute('class', 'menu-item__desc');
          if (result.description) {
            descDiv.innerHTML = result.description;
          } else if (result.content) {
            descDiv.innerHTML = result.content.substring(0, 150);
          }

          li.appendChild(titleDiv);
          li.appendChild(descDiv);
          ul.appendChild(a);
        });
      } else {
        var li = document.createElement('li');
        li.setAttribute('class', 'dropdown-item');
        li.innerText = 'No results found';
        ul.appendChild(li);
      }

      while (searchMenu.hasChildNodes()) {
        searchMenu.removeChild(
          searchMenu.lastChild
        );
      }
      
      searchMenu.appendChild(ul);
    }

    function renderSearchHighlightResultsSide(searchText, results) {
      searchResults = document.getElementById('search-results');
      searchMenu = document.getElementById('search-menu');
      searchResults.setAttribute('class', 'dropdown is-active');

      var ul = document.createElement('ul');
      ul.setAttribute('class', 'dropdown-content search-content');

      if (results.length) {
        results.forEach(function (result) {
          var li = document.createElement('li');
          var a = document.createElement('a');
          var descDiv = null;

          a.setAttribute('href', result.item.uri);
          a.setAttribute('class', 'dropdown-item');
          a.appendChild(li);

          var titleDiv = document.createElement('div');
          titleDiv.innerHTML = result.item.title;
          titleDiv.setAttribute('class', 'menu-item__title');
          
          if (result.matches && result.matches.length) {
            for (var i = 0; i < result.matches.length; i++) {
              if ('title' === result.matches[i].key) {
                titleDiv.innerHTML = generateHighlightedText(result.matches[i].value, result.matches[i].indices);
              }

              if ('description' === result.matches[i].key) {
                descDiv = document.createElement('div');
                descDiv.setAttribute('class', 'menu-item__desc');
                descDiv.innerHTML = generateHighlightedText(result.item.description, result.matches[i].indices);
              } else if ('content' === result.matches[i].key) {
                if (!descDiv) {
                  descDiv = document.createElement('div');
                  descDiv.setAttribute('class', 'menu-item__desc');
                  descDiv.innerHTML = generateHighlightedText(result.item.content.substring(0, 150), result.matches[i].indices);
                }
              } else {
                if (result.item.description) {
                  descDiv = document.createElement('div');
                  descDiv.setAttribute('class', 'menu-item__desc');
                  descDiv.innerHTML = result.item.description;
                } else {
                  descDiv = document.createElement('div');
                  descDiv.setAttribute('class', 'menu-item__desc');
                  descDiv.innerHTML = result.item.content.substring(0, 150);
                }
              }
            }
            
            li.appendChild(titleDiv);
            if (descDiv) {
              li.appendChild(descDiv);
            }
            ul.appendChild(a);
          }
        });
      } else {
        var li = document.createElement('li');
        li.setAttribute('class', 'dropdown-item');
        li.innerText = 'No results found';
        ul.appendChild(li);
      }

      while (searchMenu.hasChildNodes()) {
        searchMenu.removeChild(
          searchMenu.lastChild
        );
      }
      searchMenu.appendChild(ul);
    }

    function renderSearchResultsMobile(searchText, results) {
      searchResults = document.getElementById('search-mobile-results');

      var content = document.createElement('div');
      content.setAttribute('class', 'mobile-search__content');

      if (results.length > 0) {
        results.forEach(function (result) {
          var item = document.createElement('a');
          item.setAttribute('href', result.uri);
          item.innerHTML = '<div class="mobile-search__item"><div class="mobile-search__item--title">ðŸ“„ ' + result.title + '</div><div class="mobile-search__item--desc">' + (result.description ? result.description : result.content) + '</div></div>';
          content.appendChild(item);
        });
      } else {
        var item = document.createElement('span');
        content.appendChild(item);
      }

      let wrap = document.getElementById('search-mobile-results');
      while (wrap.firstChild) {
        wrap.removeChild(wrap.firstChild)
      }
      searchResults.appendChild(content);      
    }

    function renderSearchHighlightResultsMobile(searchText, results) {
      searchResults = document.getElementById('search-mobile-results');

      var ul = document.createElement('div');
      ul.setAttribute('class', 'mobile-search__content');

      if (results.length) {
        results.forEach(function (result) {
          var li = document.createElement('li');
          var a = document.createElement('a');
          var descDiv = null;

          a.setAttribute('href', result.item.uri);
          a.appendChild(li);
          li.setAttribute('class', 'mobile-search__item');

          var titleDiv = document.createElement('div');
          titleDiv.innerHTML = result.item.title;
          titleDiv.setAttribute('class', 'mobile-search__item--title');
          
          if (result.matches && result.matches.length) {
            for (var i = 0; i < result.matches.length; i++) {
              if ('title' === result.matches[i].key) {
                titleDiv.innerHTML = generateHighlightedText(result.matches[i].value, result.matches[i].indices);
              }

              if ('description' === result.matches[i].key) {
                descDiv = document.createElement('div');
                descDiv.setAttribute('class', 'mobile-search__item--desc');
                descDiv.innerHTML = generateHighlightedText(result.item.description, result.matches[i].indices);
              } else if ('content' === result.matches[i].key) {
                if (!descDiv) {
                  descDiv = document.createElement('div');
                  descDiv.setAttribute('class', 'mobile-search__item--desc');
                  descDiv.innerHTML = generateHighlightedText(result.item.content.substring(0, 150), result.matches[i].indices);
                }
              } else {
                if (result.item.description) {
                  descDiv = document.createElement('div');
                  descDiv.setAttribute('class', 'mobile-search__item--desc');
                  descDiv.innerHTML = result.item.description;
                } else {
                  descDiv = document.createElement('div');
                  descDiv.setAttribute('class', 'mobile-search__item--desc');
                  descDiv.innerHTML = result.item.content.substring(0, 150);
                }
              }
            }
            
            li.appendChild(titleDiv);
            if (descDiv) {
              li.appendChild(descDiv);
            }
            ul.appendChild(a);
          }
        });
      } else {
        var item = document.createElement('span');
        ul.appendChild(item);
      }

      let wrap = document.getElementById('search-mobile-results');
      while (wrap.firstChild) {
        wrap.removeChild(wrap.firstChild)
      }
      searchResults.appendChild(ul);
    }

    function generateHighlightedText(text, regions) {
      if (!regions) {
        return text;
      }

      var content = '', nextUnhighlightedRegionStartingIndex = 0;

      regions.forEach(function(region) {
        if (region[0] === region[1]) {
          return null;
        }
        
        content += '' +
          text.substring(nextUnhighlightedRegionStartingIndex, region[0]) +
          '<span class="search__highlight">' +
            text.substring(region[0], region[1] + 1) +
          '</span>' +
        '';
        nextUnhighlightedRegionStartingIndex = region[1] + 1;
      });

      content += text.substring(nextUnhighlightedRegionStartingIndex);

      return content;
    };

    var searchElem = document.getElementById('search');
    var searchMobile = document.getElementById('search-mobile');
    var searchResultsContainer = document.getElementById('search-results');

    searchElem ?
    searchElem.addEventListener('input', function(e) {
      if (!e.target.value | window.innerWidth < 770) {
        searchResultsContainer ? searchResultsContainer.setAttribute('class', 'dropdown') : null;
        searchResult ? searchResult.setAttribute('data-display', 'none') : null;
        summaryContainer ? summaryContainer.setAttribute('data-display', 'block') : null;
        return null;
      }

      searchText = e.target.value;
      var results = fuse.search(e.target.value);
      
      if (searchResultPosition === "main") {
        if (enableSearchHighlight) {
          renderSearchHighlightResultsMain(searchText, results);
        } else {
          renderSearchResultsMain(searchText, results);
        }
      } else {
        if (enableSearchHighlight) {
          renderSearchHighlightResultsSide(searchText, results);
        } else {
          renderSearchResultsSide(searchText, results);
        }
        
        var dropdownItems = searchResultsContainer.querySelectorAll('.dropdown-item');
        dropdownItems ? dropdownItems.forEach(function(item) {
          item.addEventListener('mousedown', function(e) {
            e.target.click();
          });
        }) : null;
      }
    }) : null;

    searchElem ? 
    searchElem.addEventListener('blur', function() {
      if (window.innerWidth < 770) {
        return null;
      }
      searchResultsContainer ? searchResultsContainer.setAttribute('class', 'dropdown') : null;
    }) : null;

    searchElem ? 
    searchElem.addEventListener('click', function(e) {
      if (window.innerWidth < 770) {
        return null;
      }
      if (!e.target.value) {
        searchResultsContainer ? searchResultsContainer.setAttribute('class', 'dropdown') : null;
        return null;
      }

      searchText = e.target.value;
      var results = fuse.search(e.target.value);

      if (searchResultPosition === "main") {
        if (enableSearchHighlight) {
          renderSearchHighlightResultsMain(searchText, results);
        } else {
          renderSearchResultsMain(searchText, results);
        }
      } else{
        if (enableSearchHighlight) {
          renderSearchHighlightResultsSide(searchText, results);
        } else {
          renderSearchResultsSide(searchText, results);
        }

        var dropdownItems = searchResultsContainer.querySelectorAll('.dropdown-item');
        dropdownItems ? dropdownItems.forEach(function (item) {
          item.addEventListener('mousedown', function (e) {
            e.target.click();
          });
        }) : null;
      }
    }) : null;

    var searchMenuElem = document.getElementById("search-menu");
    var activeItem = document.querySelector('#search-menu .dropdown-item.is-active');
    var activeIndex = null;
    var items = null;
    var searchContainerMaxHeight = 350;

    searchElem ? 
    searchElem.addEventListener('keydown', function(e) {
      if (window.innerWidth < 770) {
        return null;
      }

      if (e.key === 'Escape') {
        searchResult ? searchResult.setAttribute('data-display', 'none') : null;
        summaryContainer ? summaryContainer.setAttribute('data-display', 'block') : null;
      }

      var items = document.querySelectorAll('#search-menu .dropdown-item');
      var keyCode = e.which || e.keyCode;

      if (!items || !items.length) {
        return null;
      }
      
      if (e.key === 'ArrowDown' || keyCode === 40) {
        if (activeIndex === null) {
          activeIndex = 0;
          items[activeIndex].classList.remove('is-active');
        } else {
          items[activeIndex].classList.remove('is-active');
          activeIndex = activeIndex === items.length - 1 ? 0 : activeIndex + 1;
        }
        items[activeIndex].classList.add('is-active');

        let overflowedPixel = items[activeIndex].offsetTop + items[activeIndex].clientHeight - searchContainerMaxHeight;
        if (overflowedPixel > 0) {
          document.querySelector(".search-content").scrollTop += items[activeIndex].getBoundingClientRect().height;
        } else if (activeIndex === 0) {
          document.querySelector(".search-content").scrollTop = 0;
        }
      } else if (e.key === 'ArrowUp' || keyCode === 38) {
        if (activeIndex === null) {
          activeIndex = items.length - 1;
          items[activeIndex].classList.remove('is-active');
        } else {
          items[activeIndex].classList.remove('is-active');
          activeIndex = activeIndex === 0 ? items.length - 1 : activeIndex - 1;
        }
        items[activeIndex].classList.add('is-active');
        
        let overflowedPixel = items[activeIndex].offsetTop + items[activeIndex].clientHeight - searchContainerMaxHeight;
        if (overflowedPixel < 0) {
          document.querySelector(".search-content").scrollTop -= items[activeIndex].getBoundingClientRect().height;
        } else {
          document.querySelector(".search-content").scrollTop = overflowedPixel + items[activeIndex].getBoundingClientRect().height;
        }
      } else if (e.key === 'Enter' || keyCode === 13) {
        if (items[activeIndex] && items[activeIndex].getAttribute('href')) {
          location.href = items[activeIndex].getAttribute('href');
        }
      } else if (e.key === 'Escape' || keyCode === 27) {
        e.target.value = null;
        if (searchResults) {
          searchResults.classList.remove('is-active');
        }
      }
    }) : null;

    searchMobile ? 
    searchMobile.addEventListener('input', function(e) {
      if (!e.target.value) {
        let wrap = document.getElementById('search-mobile-results');
        while (wrap.firstChild) {
          wrap.removeChild(wrap.firstChild);
        }
        return null;
      }

      searchText = e.target.value;
      var results = fuse.search(e.target.value);
      renderSearchResultsMobile(searchText, results);
      if (enableSearchHighlight) {
        renderSearchHighlightResultsMobile(searchText, results);
      } else {
        renderSearchResultsMobile(searchText, results);
      }
    }) : null;
  


  
    var mobileSearchInputElem = document.querySelector('#search-mobile');
    var mobileSearchClassElem = document.querySelector('.mobile-search');
    var mobileSearchBtnElems = document.querySelectorAll('.navbar-search');
    var mobileSearchCloseBtnElem = document.querySelector('#search-mobile-close');
    var mobileSearchContainer = document.querySelector('#search-mobile-container');
    var mobileSearchResultsElem = document.querySelector('#search-mobile-results');
    var htmlElem = document.querySelector('html');

    if (mobileSearchClassElem) {
      mobileSearchClassElem.style.display = 'none';
    }

    mobileSearchBtnElems ? 
    mobileSearchBtnElems.forEach(function (elem, idx) {
      elem.addEventListener('click', function () {
        if (mobileSearchContainer) {
          mobileSearchContainer.style.display = 'block';
        }

        if (mobileSearchInputElem) {
          mobileSearchInputElem.focus();
        }

        if (htmlElem) {
          htmlElem.style.overflowY = 'hidden';
        }
      });
    }) : null;

    mobileSearchCloseBtnElem ? 
    mobileSearchCloseBtnElem.addEventListener('click', function() {
      if (mobileSearchContainer) {
        mobileSearchContainer.style.display = 'none';
      }

      if (mobileSearchInputElem) {
        mobileSearchInputElem.value = '';
      }
      
      if (mobileSearchResultsElem) {
        while (mobileSearchResultsElem.firstChild) {
          mobileSearchResultsElem.removeChild(mobileSearchResultsElem.firstChild);
        }
      }

      if (htmlElem) {
        htmlElem.style.overflowY = 'visible';
      }
    }) : null;

    mobileSearchInputElem ?
    mobileSearchInputElem.addEventListener('keydown', function(e) {
      var keyCode = e.which || e.keyCode;
      if (e.key === 'Escape' || keyCode === 27) {
        if (mobileSearchContainer) {
          mobileSearchContainer.style.display = 'none';
        }
        
        if (mobileSearchInputElem) {
          mobileSearchInputElem.value = '';
        }

        if (mobileSearchResultsElem) {
          while (mobileSearchResultsElem.firstChild) {
            mobileSearchResultsElem.removeChild(mobileSearchResultsElem.firstChild);
          }
        }
        if (htmlElem) {
          htmlElem.style.overflowY = 'visible';
        }
      }
    }) : null;
  


  
    function renderSearchResultsMain(searchText, results) {
      var searchBody = document.querySelector('.search-result__body');
      var originUl = searchBody.querySelector('ul');
      var ul = document.createElement('ul');
      
      if (!searchText) {
        searchResult ? searchResult.setAttribute('data-display', 'none') : null;
        summaryContainer ? summaryContainer.setAttribute('data-display', 'block') : null;
      } else if (results) {
        if (results && results.length) {
          results.forEach(function (result) {
            makeLi(ul, result);
          });

          searchResult ? searchResult.setAttribute('data-display', 'block') : null;
          summaryContainer ? summaryContainer.setAttribute('data-display', 'none') : null;
        }
      }

      originUl.parentNode.replaceChild(ul, originUl);
    }

    function renderSearchHighlightResultsMain(searchText, results) {
      var searchBody = document.querySelector('.search-result__body');
      var originUl = searchBody.querySelector('ul');
      var ul = document.createElement('ul');

      if (!searchText) {
        searchResult ? searchResult.setAttribute('data-display', 'none') : null;
        summaryContainer ? summaryContainer.setAttribute('data-display', 'block') : null;
      } else if (results) {
        if (results && results.length) {
          results.forEach(function (result) {
            makeHighlightLi(ul, result);
          });

          searchResult ? searchResult.setAttribute('data-display', 'block') : null;
          summaryContainer ? summaryContainer.setAttribute('data-display', 'none') : null;
        }
      }

      originUl.parentNode.replaceChild(ul, originUl);
    }
  
  });
</script>
    
    


<link rel="stylesheet" href="/css/main.min.css">


    
<meta name="description" content="" />


<meta name="keywords" content="">

<meta name="created" content="2020-07-28T00:04:50&#43;0900">
<meta name="modified" content="2023-02-19T01:04:10&#43;0800">
<meta property="article:published_time" content="2020-07-28T00:04:50&#43;0900">

<meta name="author" content="VictorHong">


<meta property="og:site_name" content="VictorHong&#39;s Blog">
<meta property="og:title" content="interview">
<meta property="og:url" content="https://hugo.jiahongw.com/en/zh/talks/interview/">
<meta property="og:type" content="article">
<meta property="og:description" content="">

  
    <meta property="og:image" content="https://hugo.jiahongw.com/images/header/hh.jpg">
    <meta property="og:image:url" content="https://hugo.jiahongw.com/images/header/hh.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:app:name:iphone" content="VictorHong&#39;s Blog">
    <meta property="twitter:title" content="interview">
    <meta property="twitter:description" content="">
  

<meta name="generator" content="Hugo 0.110.0">
<meta name="msapplication-TileColor" content="#fff">

<meta name="theme-color" content="#fff">

<meta name="msapplication-navbutton-color" content="#fff">

<meta name="apple-mobile-web-app-status-bar-style" content="#fff">

<link rel="canonical" href="https://hugo.jiahongw.com/en/zh/talks/interview/">

<link rel="manifest" href="/manifest.json">

  <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon/android-icon-512x512.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">


    <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "headline": "interview",
    "datePublished": "2020-07-28T00:04:50+09:00",
    "dateModified": "2023-02-19T01:04:10+08:00",
    "url" : "https://hugo.jiahongw.com/en/zh/talks/interview/",
    "description": "C/C++ â­•é¢å‘å¯¹è±¡ä¸Žé¢å‘è¿‡ç¨‹ Leetcodeå¯¹é¢å‘å¯¹è±¡çš„ç†è§£ï¼šé¢å‘å¯¹è±¡çš„ç¼–ç¨‹æ–¹å¼ä½¿å¾—æ¯ä¸€ä¸ªç±»éƒ½åªåšä¸€ä»¶äº‹ã€‚é¢å‘è¿‡ç¨‹ä¼šè®©ä¸€ä¸ªç±»è¶Šæ¥è¶Šå…¨èƒ½ï¼Œå°±åƒä¸€ä¸ªç®¡",
    "keywords": [null],
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://hugo.jiahongw.com"
    },
    "publisher": {
      "@type": "Organization",
      "name": "VictorHong's Blog",
      "url": "https://hugo.jiahongw.com"
    }
  }
</script>

    
  
  






  <script>
    
    var baiduAnalyticsId = JSON.parse("\"8ac34c9d30985a71517efff22def1592\"");

    var _hmt = _hmt || [];
    (function () {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?" + baiduAnalyticsId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    
</head>

<body id="root" class="theme__dark">
    <script>
        var localTheme = localStorage.getItem('theme');
        if (localTheme) {
            document.getElementById('root').className = 'theme__' + localTheme;
        }
    </script>
    <div id="container">
        





        <div class="wrapper" data-type="zh" data-kind="page">
            <nav class="navbar scrolling" role="navigation" aria-label="main navigation" data-dir="ltr">
  <div class="navbar__brand">
    
    <a href="/en/" title="Home" rel="home" class="navbar__logo-link">
      <img src="/logo.png" alt="Home" class="navbar__logo">
    </a>
    
    
      <a href="/en/" title="Home" rel="home" class="navbar__title-link">
        <h6 class="navbar__title">VictorHong</h6>
      </a>
    
  </div>

  
<div class="theme theme-mobile" data-ani="true">
  <div class="dropdown">
    <button class="dropdown-trigger navbar__slide-down" aria-label="Select Theme Button" style="" data-ani="true">
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="none" d="M24 0H0v24h24V0z"/><path fill="currentColor" d="M6.34 7.93c-3.12 3.12-3.12 8.19 0 11.31C7.9 20.8 9.95 21.58 12 21.58s4.1-.78 5.66-2.34c3.12-3.12 3.12-8.19 0-11.31l-4.95-4.95c-.39-.39-1.02-.39-1.41 0L6.34 7.93zM12 19.59c-1.6 0-3.11-.62-4.24-1.76C6.62 16.69 6 15.19 6 13.59s.62-3.11 1.76-4.24L12 5.1v14.49z"/></svg>      
    </button>
    <div class="dropdown-content select-theme">
      
        
        <a href="#" class="dropdown-item select-theme__item is-active">
          dark
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          light
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          hacker
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          solarized
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          kimbie
        </a>
        
      
    </div>
  </div>
</div>


<div class="mobile-search__btn navbar-search" data-ani="true">
  <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.79 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59 2.03.34 3.94-.28 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
</div>

<div id="search-mobile-container" class="mobile-search hide" data-dir="ltr">
  <div class="mobile-search__top">
    <input id="search-mobile" type="text" aria-label="Mobile Search" placeholder="Search" class="mobile-search__top--input"/>
    <div id="search-mobile-close" class="mobile-search__top--icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path opacity=".87" fill="none" d="M0 0h24v24H0V0z"/><path fill="currentColor" d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"/></svg>
    </div>
  </div>
  <div id="search-mobile-results" class="mobile-search__body">
    
  </div>
</div>


<a role="button" class="navbar__burger" aria-label="menu" aria-expanded="false"
  data-ani="true">
  <span aria-hidden="true"></span>
  <span aria-hidden="true"></span>
  <span aria-hidden="true"></span>
</a>
<div class="navbarm__collapse" data-open="false">
  <ul dir="ltr">
    
    
      
      
      
      

      
        <li class="navbarm__menu--item ">
          <a href="/en/about">About</a>
        </li>
      
      
    
      
      
      
      

      
        <li class="navbarm__menu--item ">
          <a href="/en/archive">Archive</a>
        </li>
      
      
    
      
      
      
      

      
        <li class="navbarm__menu--item ">
          <a href="/en/posts">Posts</a>
        </li>
      
      
    
      
      
      
      

      
        <li class="navbarm__menu--item ">
          <a href="/en/showcase">Showcase</a>
        </li>
      
      
    

    
      <li class="navbarm__menu--item ">
        <a href="/en/tags" class="navbarm__menu--term" data-index="0">
          Tags
        </a>
      </li>
    
      <li class="navbarm__menu--item ">
        <a href="/en/categories" class="navbarm__menu--term" data-index="1">
          Categories
        </a>
      </li>
    
      <li class="navbarm__menu--item ">
        <a href="/en/series" class="navbarm__menu--term" data-index="2">
          Series
        </a>
      </li>
    
  </ul>
</div>
  <div class="navbar__menu">
  
    <div class="theme">
  <div class="dropdown">
    <button class="dropdown-trigger navbar__slide-down navbar-search" aria-label="Search Button" data-ani="true">
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.79 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59 2.03.34 3.94-.28 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
    </button>
    <div class="dropdown-content">
    </div>
  </div>
</div>
  
  
  
<div class="theme" data-ani="true">
  <div class="dropdown">
    <button class="dropdown-trigger navbar__slide-down" aria-label="Select Theme Button" data-ani="true">
      <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><path fill="none" d="M24 0H0v24h24V0z"/><path fill="currentColor" d="M6.34 7.93c-3.12 3.12-3.12 8.19 0 11.31C7.9 20.8 9.95 21.58 12 21.58s4.1-.78 5.66-2.34c3.12-3.12 3.12-8.19 0-11.31l-4.95-4.95c-.39-.39-1.02-.39-1.41 0L6.34 7.93zM12 19.59c-1.6 0-3.11-.62-4.24-1.76C6.62 16.69 6 15.19 6 13.59s.62-3.11 1.76-4.24L12 5.1v14.49z"/></svg>      
    </button>
    <div class="dropdown-content select-theme">
      
        
        <a href="#" class="dropdown-item select-theme__item is-active">
          dark
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          light
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          hacker
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          solarized
        </a>
        
        <a href="#" class="dropdown-item select-theme__item ">
          kimbie
        </a>
        
      
    </div>
  </div>
</div>

  
  
  
  
  
  
  
  <a href="/en/about" class="navbar__menu-item navbar__slide-down " dir="ltr" data-ani="true">About</a>
  
  
  
  
  
  
  
  <a href="/en/archive" class="navbar__menu-item navbar__slide-down " dir="ltr" data-ani="true">Archive</a>
  
  
  
  
  
  
  
  <a href="/en/posts" class="navbar__menu-item navbar__slide-down " dir="ltr" data-ani="true">Posts</a>
  
  
  
  
  
  
  
  <a href="/en/showcase" class="navbar__menu-item navbar__slide-down " dir="ltr" data-ani="true">Showcase</a>
  
  
</div>
</nav>
            
            

<main class="single__main main-main">
  
    <nav class="breadcrumb hide" aria-label="breadcrumbs">
  <script>document.querySelector('.breadcrumb').classList.remove('hide')</script>
  <ol>
    
  
  
  
  
  
  
  
  <li >
    
      <a href="https://hugo.jiahongw.com/en/" class="capitalize">VictorHong&#39;s Blog</a>
    
  </li>
  
  
  <li >
    
      <a href="https://hugo.jiahongw.com/en/zh/" class="capitalize">Zhs</a>
    
  </li>
  
  
  <li >
    
      <a href="https://hugo.jiahongw.com/en/zh/talks/" class="capitalize">Talks</a>
    
  </li>
  
  
  <li  class="is-active" >
    
      <span>interview</span>
    
  </li>
  
  </ol>
  
</nav>
  
  
  <div class="single ">
    <div class="single__nojs">This page looks best with JavaScript enabled</div>
    <script>document.querySelector('.single').classList.remove('hide'); document.querySelector('.single__nojs').classList.add('hide');</script>
    <h2 class="single__title" data-ani="true">interview</h2>
    <h3 class="single__subtitle"></h3>
    <div class="single__meta">
      
<div class="single__infos">
  <time class="single__info" title="Written At">ðŸ“…&nbsp;Jul 28, 2020 </time>
  
  &nbsp;&middot;&nbsp; <time class="single__info" title="Modified At"> ðŸ“&nbsp;Feb 19, 2023 </time>
  
  &nbsp;&middot;&nbsp; <span class="single__info" title="Reading Time"> â˜•&nbsp;162&nbsp;min read </span>
  
  <span class="single__info">
     &middot; ðŸ‘€<span id="busuanzi_value_page_pv">...</span> views
  </span>
</div>

      
<ul class="single__tags caption">
  
  ðŸ·ï¸
  

</ul>

    </div>
    <article class="single__contents" data-dir="ltr" data-ani="true">
      
      <h1 id="cc">C/C++</h1>
<h3 id="é¢å‘å¯¹è±¡ä¸Žé¢å‘è¿‡ç¨‹">â­•é¢å‘å¯¹è±¡ä¸Žé¢å‘è¿‡ç¨‹</h3>
<p><code>Leetcode</code>å¯¹é¢å‘å¯¹è±¡çš„ç†è§£ï¼š<strong>é¢å‘å¯¹è±¡çš„ç¼–ç¨‹æ–¹å¼ä½¿å¾—æ¯ä¸€ä¸ªç±»éƒ½åªåšä¸€ä»¶äº‹</strong>ã€‚<strong>é¢å‘è¿‡ç¨‹ä¼šè®©ä¸€ä¸ªç±»è¶Šæ¥è¶Šå…¨èƒ½ï¼Œå°±åƒä¸€ä¸ªç®¡å®¶ä¸€æ ·åšäº†æ‰€æœ‰çš„äº‹</strong>ã€‚è€Œé¢å‘å¯¹è±¡åƒæ˜¯é›‡ä½£äº†ä¸€ç¾¤èŒå‘˜ï¼Œæ¯ä¸ªäººåšä¸€ä»¶å°äº‹ï¼Œå„å¸å…¶èŒï¼Œæœ€ç»ˆåˆä½œå…±èµ¢ï¼</p>
<p>é¢å‘å¯¹è±¡çš„ç‰¹ç‚¹æ˜¯<strong>å¯ç»´æŠ¤</strong>ã€<strong>å¯å¤ç”¨</strong>ã€<strong>å¯æ‰©å±•</strong>ã€<strong>çµæ´»æ€§å¥½</strong>ï¼Œå®ƒçœŸæ­£å¼ºå¤§çš„åœ°æ–¹åœ¨äºŽï¼šéšç€ä¸šåŠ¡å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œé¢å‘å¯¹è±¡ä¾ç„¶èƒ½å¤Ÿä½¿å¾—ç¨‹åºç»“æž„è‰¯å¥½ï¼Œè€Œé¢å‘è¿‡ç¨‹å´ä¼šå¯¼è‡´ç¨‹åºè¶Šæ¥è¶Šè‡ƒè‚¿ã€‚</p>
<p>è®©é¢å‘å¯¹è±¡ä¿æŒç»“æž„è‰¯å¥½çš„ç§˜è¯€å°±æ˜¯ <strong>è®¾è®¡æ¨¡å¼ã€‚</strong></p>
<h3 id="cç¨‹åºè®¾è®¡æ¨¡åž‹">âž•C++ç¨‹åºè®¾è®¡æ¨¡åž‹</h3>
<p><strong>ç¨‹åºæ¨¡åž‹(procedural model)</strong></p>
<p><strong>æŠ½è±¡æ•°æ®æ¨¡åž‹(abstract data type model)</strong></p>
<p>ä¾‹å¦‚<code>std::string</code></p>
<p><strong>é¢å‘å¯¹è±¡æ¨¡åž‹(object-oriented model)</strong></p>
<h3 id="å¤šæ€">âœ–ï¸å¤šæ€</h3>
<p><strong>å¤šæ€å¦‚ä½•å®žçŽ°ï¼Ÿ</strong></p>
<p>è¦å®žçŽ°C++ä¸­<code>OO</code>ç¨‹åºè®¾è®¡çš„å¤šæ€æ€§è´¨ï¼Œåªæœ‰é€šè¿‡<code>point</code>æˆ–è€…<code>reference</code>çš„é—´æŽ¥å¤„ç†ã€‚</p>
<p><strong>å¤šæ€ç”¨é€”ï¼Ÿ</strong></p>
<p>ç»ç”±ä¸€ä¸ªå…±åŒçš„æŽ¥å£æ¥å½±å“ç±»åž‹çš„å°è£…ï¼Œè¿™ä¸ªæŽ¥å£é€šå¸¸è¢«å®šä¹‰åœ¨ä¸€ä¸ªæŠ½è±¡çš„<code>base class</code>ä¸­ã€‚</p>
<p><strong>è™šå‡½æ•°ä¸Žçº¯è™šå‡½æ•°</strong></p>
<p>å¼•å…¥è™šå‡½æ•°æ˜¯ä¸ºäº†<strong>åŠ¨æ€ç»‘å®š</strong>,å¼•å…¥è™šå‡½æ•°æ˜¯ä¸ºäº†åŠ¨æ€ç»‘å®šã€‚</p>
<p><strong>åŸºç±»éœ€è¦è™šæžæž„å‡½æ•°çš„åŽŸå› </strong></p>
<p>å½“derived classç»ç”±ä¸€ä¸ªbase classæŒ‡é’ˆè¢«åˆ é™¤è€Œè¯¥base classçš„æžæž„å‡½æ•°ä¸ºnon-virtualæ—¶ï¼Œå°†å‘ç”Ÿæœªå®šä¹‰è¡Œä¸ºã€‚é€šå¸¸å°†å‘ç”Ÿèµ„æºæ³„æ¼ã€‚<br />
è§£å†³æ–¹æ³•å³ä¸ºï¼šä¸ºå¤šæ€åŸºç±»å£°æ˜Žä¸€ä¸ªvirtual æžæž„å‡½æ•°ã€‚</p>
<h3 id="-c11æ–°ç‰¹æ€§">ðŸ–ï¸ C++11æ–°ç‰¹æ€§</h3>
<p><img src="https://i.loli.net/2020/10/20/SD17qsQ8IBo34NL.jpg" alt="c++11æ–°ç‰¹æ€§è¯¦è§£" /></p>
<ol>
<li>è‡ªåŠ¨ç±»åž‹æŽ¨æ–­ auto</li>
<li>åŒ¿åå‡½æ•° Lambda</li>
<li>æ™ºèƒ½æŒ‡é’ˆ</li>
<li>æ˜¾ç¤ºé‡å†™(è¦†ç›–)overrideå’Œfinal</li>
</ol>
<h3 id="const">ðŸ“‡const</h3>
<p>å…³é”®å­—<code>const</code>å‡ºçŽ°åœ¨æ˜Ÿå·å·¦è¾¹ï¼Œè¡¨ç¤ºè¢«æŒ‡ç‰©æ˜¯å¸¸é‡ï¼›å¦‚æžœå‡ºçŽ°åœ¨æ˜Ÿå·å³è¾¹ï¼Œè¡¨ç¤ºæŒ‡é’ˆæœ¬èº«æ˜¯å¸¸é‡ï¼›å¦‚æžœå‡ºçŽ°åœ¨ä¸¤è¾¹ï¼Œè¡¨ç¤ºè¢«æŒ‡ç‰©å’ŒæŒ‡é’ˆéƒ½æ˜¯å¸¸é‡ã€‚</p>
<p>ä½œç”¨ï¼š</p>
<ol>
<li>ä¿®é¥°å˜é‡ï¼Œè¯´æ˜Žè¯¥å˜é‡ä¸å¯ä»¥è¢«æ”¹å˜ï¼›</li>
<li>ä¿®é¥°æŒ‡é’ˆï¼Œåˆ†ä¸ºæŒ‡å‘å¸¸é‡çš„æŒ‡é’ˆï¼ˆpointer to constï¼‰å’Œè‡ªèº«æ˜¯å¸¸é‡çš„æŒ‡é’ˆï¼ˆå¸¸é‡æŒ‡é’ˆï¼Œconst pointerï¼‰ï¼›</li>
<li>ä¿®é¥°å¼•ç”¨ï¼ŒæŒ‡å‘å¸¸é‡çš„å¼•ç”¨ï¼ˆreference to constï¼‰ï¼Œç”¨äºŽå½¢å‚ç±»åž‹ï¼Œå³é¿å…äº†æ‹·è´ï¼Œåˆé¿å…äº†å‡½æ•°å¯¹å€¼çš„ä¿®æ”¹ï¼›</li>
<li><strong>ä¿®é¥°æˆå‘˜å‡½æ•°ï¼Œè¯´æ˜Žè¯¥æˆå‘˜å‡½æ•°å†…ä¸èƒ½ä¿®æ”¹æˆå‘˜å˜é‡ã€‚</strong></li>
</ol>
<h3 id="static">ðŸ—½Static</h3>
<ul>
<li>
<p>é™æ€å¸¸é‡æ•´æ•°æˆå‘˜å¯ä»¥åœ¨ç±»å†…è¿›è¡Œåˆå§‹åŒ–ï¼Œå…¶ä»–éœ€è¦åœ¨ç±»å¤–é¢è¿›è¡Œåˆå§‹åŒ–</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">static</span> <span class="kt">int</span> <span class="n">GG</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">A</span><span class="o">::</span><span class="n">GG</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>  
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">A</span><span class="o">::</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">A</span><span class="o">::</span><span class="n">GG</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>5
6
</code></pre></li>
</ul>
<p><strong>C++æ”¯æŒé‡è½½ï¼ŒCä¸æ”¯æŒé‡è½½</strong></p>
<h3 id="-extern-cä½œç”¨">ðŸ“¤ extern &ldquo;C&quot;ä½œç”¨</h3>
<p>extern &ldquo;C&quot;çš„ä¸»è¦ä½œç”¨å°±æ˜¯<strong>ä¸ºäº†èƒ½å¤Ÿæ­£ç¡®å®žçŽ°C++ä»£ç è°ƒç”¨å…¶ä»–Cè¯­è¨€ä»£ç </strong>ã€‚åŠ ä¸Šextern &ldquo;C&quot;åŽï¼Œä¼šæŒ‡ç¤ºç¼–è¯‘å™¨è¿™éƒ¨åˆ†ä»£ç æŒ‰Cè¯­è¨€ï¼ˆè€Œä¸æ˜¯C++ï¼‰çš„æ–¹å¼è¿›è¡Œç¼–è¯‘ã€‚ç”±äºŽC++æ”¯æŒå‡½æ•°é‡è½½ï¼Œå› æ­¤ç¼–è¯‘å™¨ç¼–è¯‘å‡½æ•°çš„è¿‡ç¨‹ä¸­ä¼šå°†å‡½æ•°çš„å‚æ•°ç±»åž‹ä¹ŸåŠ åˆ°ç¼–è¯‘åŽçš„ä»£ç ä¸­ï¼Œè€Œä¸ä»…ä»…æ˜¯å‡½æ•°åï¼›è€ŒCè¯­è¨€å¹¶ä¸æ”¯æŒå‡½æ•°é‡è½½ï¼Œå› æ­¤ç¼–è¯‘Cè¯­è¨€ä»£ç çš„å‡½æ•°æ—¶ä¸ä¼šå¸¦ä¸Šå‡½æ•°çš„å‚æ•°ç±»åž‹ï¼Œä¸€èˆ¬åªåŒ…æ‹¬å‡½æ•°åã€‚</p>
<p>è¿™ä¸ªåŠŸèƒ½ååˆ†æœ‰ç”¨å¤„ï¼Œå› ä¸ºåœ¨C++å‡ºçŽ°ä»¥å‰ï¼Œå¾ˆå¤šä»£ç éƒ½æ˜¯Cè¯­è¨€å†™çš„ï¼Œè€Œä¸”å¾ˆåº•å±‚çš„åº“ä¹Ÿæ˜¯Cè¯­è¨€å†™çš„ï¼Œ<strong>ä¸ºäº†æ›´å¥½çš„æ”¯æŒåŽŸæ¥çš„Cä»£ç å’Œå·²ç»å†™å¥½çš„Cè¯­è¨€åº“ï¼Œéœ€è¦åœ¨C++ä¸­å°½å¯èƒ½çš„æ”¯æŒCï¼Œè€Œextern &ldquo;C&quot;å°±æ˜¯å…¶ä¸­çš„ä¸€ä¸ªç­–ç•¥ã€‚</strong></p>
<ul>
<li>å¦‚æžœC++è°ƒç”¨ä¸€ä¸ªCè¯­è¨€ç¼–å†™çš„<code>.DLL</code>æ—¶ï¼Œå½“åŒ…æ‹¬<code>.DLL</code>çš„å¤´æ–‡ä»¶æˆ–å£°æ˜ŽæŽ¥å£å‡½æ•°æ—¶ï¼Œåº”åŠ extern &ldquo;C&rdquo; {ã€€}ã€‚</li>
</ul>
<h3 id="inlineå†…è”å‡½æ•°-staticé™æ€å‡½æ•°-æ™®é€šå‡½æ•°åŒºåˆ«">ðŸ“Œinlineå†…è”å‡½æ•° staticé™æ€å‡½æ•° æ™®é€šå‡½æ•°åŒºåˆ«</h3>
<p>é¢è¯•æ—¶å€™ä¸€èˆ¬åªä¼šé—®ä½ åŒºåˆ«ï¼Œæ‰€æœ‰æœ¬æ–‡åªè¯´åŒºåˆ«ã€‚</p>
<p><strong>å†…è”å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„åŒºåˆ«</strong>ï¼š</p>
<p>å†…è”å‡½æ•°å’Œæ™®é€šå‡½æ•°æœ€å¤§çš„åŒºåˆ«åœ¨äºŽå†…éƒ¨çš„å®žçŽ°æ–¹é¢ï¼Œå½“æ™®é€šå‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶ï¼Œç³»ç»Ÿé¦–å…ˆè·³è·ƒåˆ°è¯¥å‡½æ•°çš„å…¥å£åœ°å€ï¼Œæ‰§è¡Œå‡½æ•°ä½“ï¼Œæ‰§è¡Œå®ŒæˆåŽï¼Œå†è¿”å›žåˆ°å‡½æ•°è°ƒç”¨çš„åœ°æ–¹ï¼Œ<strong>å‡½æ•°å§‹ç»ˆåªæœ‰ä¸€ä¸ªæ‹·è´</strong>ï¼› <strong>è€Œå†…è”å‡½æ•°åˆ™ä¸éœ€è¦è¿›è¡Œä¸€ä¸ªå¯»å€çš„è¿‡ç¨‹ï¼Œå½“æ‰§è¡Œåˆ°å†…è”å‡½æ•°æ—¶ï¼Œæ­¤å‡½æ•°å±•å¼€ï¼ˆå¾ˆç±»ä¼¼å®çš„ä½¿ç”¨ï¼‰</strong>ï¼Œå¦‚æžœåœ¨ Nå¤„è°ƒç”¨äº†æ­¤å†…è”å‡½æ•°ï¼Œåˆ™æ­¤å‡½æ•°å°±ä¼šæœ‰Nä¸ªä»£ç æ®µçš„æ‹·è´ã€‚</p>
<p><strong>é™æ€å‡½æ•°å’Œæ™®é€šå‡½æ•°çš„åŒºåˆ«</strong>ï¼š</p>
<p>staticå‡½æ•°å’Œæ™®é€šå‡½æ•°çš„æœ€å¤§çš„åŒºåˆ«åœ¨äºŽä½œç”¨åŸŸæ–¹é¢ï¼Œstaticå‡½æ•°é™å®šåœ¨æœ¬æºç æ–‡ä»¶ä¸­ï¼Œä¸èƒ½è¢«æœ¬æºç æ–‡ä»¶ä»¥å¤–çš„ä»£ç æ–‡ä»¶è°ƒç”¨ã€‚è€Œæ™®é€šçš„å‡½æ•°ï¼Œé»˜è®¤æ˜¯externçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥è¢«å…¶å®ƒä»£ç æ–‡ä»¶è°ƒç”¨è¯¥å‡½æ•°ã€‚<strong>åŒæ—¶staticå‡½æ•°åœ¨å†…å­˜ä¸­åªæœ‰ä¸€ä»½ï¼Œæ™®é€šå‡½æ•°åœ¨æ¯ä¸ªè¢«è°ƒç”¨ä¸­ç»´æŒä¸€ä»½æ‹·è´ã€‚</strong></p>
<p><strong>inlineä¸Ždefineçš„åŒºåˆ«ï¼š</strong></p>
<p>å†…è”å‡½æ•°å’Œå®çš„åŒºåˆ«åœ¨äºŽï¼Œ<strong>å®æ˜¯ç”±é¢„å¤„ç†å™¨å¯¹å®è¿›è¡Œæ›¿ä»£</strong>ï¼Œè€Œ<strong>å†…è”å‡½æ•°æ˜¯é€šè¿‡ç¼–è¯‘å™¨æŽ§åˆ¶æ¥å®žçŽ°çš„</strong>ã€‚è€Œä¸”å†…è”å‡½æ•°æ˜¯çœŸæ­£çš„å‡½æ•°ï¼Œåªæ˜¯åœ¨éœ€è¦ç”¨åˆ°çš„æ—¶å€™ï¼Œå†…è”å‡½æ•°åƒå®ä¸€æ ·çš„å±•å¼€ï¼Œæ‰€ä»¥<strong>å–æ¶ˆäº†å‡½æ•°çš„å‚æ•°åŽ‹æ ˆï¼Œå‡å°‘äº†è°ƒç”¨çš„å¼€é”€</strong>ã€‚ä½ å¯ä»¥è±¡è°ƒç”¨å‡½æ•°ä¸€æ ·æ¥è°ƒç”¨å†…è”å‡½æ•°ï¼Œè€Œä¸å¿…æ‹…å¿ƒä¼šäº§ç”ŸäºŽå¤„ç†å®çš„ä¸€äº›é—®é¢˜ã€‚å†…è”å‡½æ•°ä¸Žå¸¦å‚æ•°çš„å®å®šä¹‰è¿›è¡Œä¸‹æ¯”è¾ƒï¼Œå®ƒä»¬çš„ä»£ç æ•ˆçŽ‡æ˜¯ä¸€æ ·ï¼Œä½†æ˜¯å†…è”æ¬¢å‡½æ•°è¦ä¼˜äºŽå®å®šä¹‰ï¼Œå› ä¸ºå†…è”å‡½æ•°éµå¾ªçš„ç±»åž‹å’Œä½œç”¨åŸŸè§„åˆ™ï¼Œå®ƒä¸Žä¸€èˆ¬å‡½æ•°æ›´ç›¸è¿‘ï¼Œåœ¨ä¸€äº›ç¼–è¯‘å™¨ä¸­ï¼Œä¸€æ—¦å…³ä¸Šå†…è”æ‰©å±•ï¼Œå°†ä¸Žä¸€èˆ¬å‡½æ•°ä¸€æ ·è¿›è¡Œè°ƒç”¨ï¼Œæ¯”è¾ƒæ–¹ä¾¿ã€‚</p>
<p>inlineä½¿ç”¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// å£°æ˜Ž1ï¼ˆåŠ  inlineï¼Œå»ºè®®ä½¿ç”¨ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">inline</span> <span class="kt">int</span> <span class="nf">functionName</span><span class="p">(</span><span class="kt">int</span> <span class="n">first</span><span class="p">,</span> <span class="kt">int</span> <span class="n">second</span><span class="p">,...);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å£°æ˜Ž2ï¼ˆä¸åŠ  inlineï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">functionName</span><span class="p">(</span><span class="kt">int</span> <span class="n">first</span><span class="p">,</span> <span class="kt">int</span> <span class="n">second</span><span class="p">,...);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å®šä¹‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">inline</span> <span class="kt">int</span> <span class="nf">functionName</span><span class="p">(</span><span class="kt">int</span> <span class="n">first</span><span class="p">,</span> <span class="kt">int</span> <span class="n">second</span><span class="p">,...)</span> <span class="p">{</span><span class="cm">/****/</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç±»å†…å®šä¹‰ï¼Œéšå¼å†…è”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">doA</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>         <span class="c1">// éšå¼å†…è”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç±»å¤–å®šä¹‰ï¼Œéœ€è¦æ˜¾å¼å†…è”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="nf">doA</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">inline</span> <span class="kt">int</span> <span class="n">A</span><span class="o">::</span><span class="n">doA</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>   <span class="c1">// éœ€è¦æ˜¾å¼å†…è”
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ä¼˜ç¼ºç‚¹ï¼š</p>
<p>ä¼˜ç‚¹</p>
<ol>
<li>å†…è”å‡½æ•°åŒå®å‡½æ•°ä¸€æ ·å°†åœ¨è¢«è°ƒç”¨å¤„è¿›è¡Œä»£ç å±•å¼€ï¼ŒçœåŽ»äº†å‚æ•°åŽ‹æ ˆã€æ ˆå¸§å¼€è¾Ÿä¸Žå›žæ”¶ï¼Œç»“æžœè¿”å›žç­‰ï¼Œä»Žè€Œæé«˜ç¨‹åºè¿è¡Œé€Ÿåº¦ã€‚</li>
<li>å†…è”å‡½æ•°ç›¸æ¯”å®å‡½æ•°æ¥è¯´ï¼Œåœ¨ä»£ç å±•å¼€æ—¶ï¼Œä¼šåšå®‰å…¨æ£€æŸ¥æˆ–è‡ªåŠ¨ç±»åž‹è½¬æ¢ï¼ˆåŒæ™®é€šå‡½æ•°ï¼‰ï¼Œè€Œå®å®šä¹‰åˆ™ä¸ä¼šã€‚</li>
<li>åœ¨ç±»ä¸­å£°æ˜ŽåŒæ—¶å®šä¹‰çš„æˆå‘˜å‡½æ•°ï¼Œè‡ªåŠ¨è½¬åŒ–ä¸ºå†…è”å‡½æ•°ï¼Œå› æ­¤å†…è”å‡½æ•°å¯ä»¥è®¿é—®ç±»çš„æˆå‘˜å˜é‡ï¼Œå®å®šä¹‰åˆ™ä¸èƒ½ã€‚</li>
<li><strong>å†…è”å‡½æ•°åœ¨è¿è¡Œæ—¶å¯è°ƒè¯•ï¼Œè€Œå®å®šä¹‰ä¸å¯ä»¥ã€‚</strong></li>
</ol>
<p>ç¼ºç‚¹</p>
<ol>
<li><strong>ä»£ç è†¨èƒ€</strong>ã€‚å†…è”æ˜¯ä»¥ä»£ç è†¨èƒ€ï¼ˆå¤åˆ¶ï¼‰ä¸ºä»£ä»·ï¼Œæ¶ˆé™¤å‡½æ•°è°ƒç”¨å¸¦æ¥çš„å¼€é”€ã€‚å¦‚æžœæ‰§è¡Œå‡½æ•°ä½“å†…ä»£ç çš„æ—¶é—´ï¼Œç›¸æ¯”äºŽå‡½æ•°è°ƒç”¨çš„å¼€é”€è¾ƒå¤§ï¼Œé‚£ä¹ˆæ•ˆçŽ‡çš„æ”¶èŽ·ä¼šå¾ˆå°‘ã€‚å¦ä¸€æ–¹é¢ï¼Œæ¯ä¸€å¤„å†…è”å‡½æ•°çš„è°ƒç”¨éƒ½è¦å¤åˆ¶ä»£ç ï¼Œå°†ä½¿ç¨‹åºçš„æ€»ä»£ç é‡å¢žå¤§ï¼Œæ¶ˆè€—æ›´å¤šçš„å†…å­˜ç©ºé—´ã€‚</li>
<li>inline å‡½æ•°æ— æ³•éšç€å‡½æ•°åº“å‡çº§è€Œå‡çº§ã€‚inlineå‡½æ•°çš„æ”¹å˜éœ€è¦<strong>é‡æ–°ç¼–è¯‘</strong>ï¼Œä¸åƒ non-inline å¯ä»¥ç›´æŽ¥é“¾æŽ¥ã€‚</li>
<li><strong>æ˜¯å¦å†…è”ï¼Œç¨‹åºå‘˜ä¸å¯æŽ§</strong>ã€‚å†…è”å‡½æ•°åªæ˜¯å¯¹ç¼–è¯‘å™¨çš„å»ºè®®ï¼Œæ˜¯å¦å¯¹å‡½æ•°å†…è”ï¼Œå†³å®šæƒåœ¨äºŽç¼–è¯‘å™¨ã€‚</li>
</ol>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://blog.csdn.net/jigetage/article/details/86065114">inlineå†…è”å‡½æ•° staticé™æ€å‡½æ•° æ™®é€šå‡½æ•°åŒºåˆ«</a></li>
<li><a href="https://www.cnblogs.com/yanwei-wang/p/4691146.html">C++ inlineå’Œ#defineå®çš„åŒºåˆ«</a></li>
</ol>
<h3 id="cå†…å­˜å¸ƒå±€">ðŸ’ŸC++å†…å­˜å¸ƒå±€</h3>
<p><img src="https://i.loli.net/2020/10/30/NcQjdHME1DUWV69.png" alt="å†…å­˜åˆ†åŒº" /></p>
<ol>
<li>
<p>å†…æ ¸ç©ºé—´</p>
</li>
<li>
<p>æ ˆ</p>
<p>1ã€stackå­˜æ”¾å‡½æ•°çš„ä¸´æ—¶å˜é‡ã€å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°å’Œè¿”å›žå€¼<br />
2ã€ç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾ã€‚</p>
</li>
<li>
<p>åŠ¨æ€é“¾æŽ¥åº“(å…±äº«æ˜ å°„åŒº)</p>
<p>è°ƒç”¨çš„åº“æ–‡ä»¶ï¼Œä½äºŽå †å’Œæ ˆä¹‹é—´</p>
</li>
<li>
<p>å †</p>
<p>heapç”¨æ¥åŠ¨æ€åˆ†é…å†…å­˜ï¼Œç”±ç¨‹åºå‘˜æŽ§åˆ¶ï¼Œäº¤ç”±ç¨‹åºè‡ªèº«å†³å®šå¼€è¾Ÿå’Œé‡Šæ”¾ã€‚</p>
</li>
<li>
<p>å…¨å±€æ•°æ®åŒº</p>
<p><code>.bss</code></p>
<p><code>bss</code>æ®µç”¨æ¥å­˜æ”¾æ²¡æœ‰è¢«åˆå§‹åŒ–å’Œå·²ç»è¢«åˆå§‹åŒ–ä¸º0çš„å…¨å±€å˜é‡</p>
<p><code>.data</code></p>
<p><code>data</code>æ®µç”¨æ¥å­˜æ”¾å·²ç»è¢«åˆå§‹åŒ–ä¸ºéž0çš„å…¨å±€å˜é‡</p>
</li>
<li>
<p>å¸¸é‡åŒº</p>
<p><code>.rodata</code></p>
<p><code>rodata</code>æ®µç”¨æ¥å­˜æ”¾å¸¸é‡æ•°æ®ã€è¢«ç¼–è¯‘å™¨è‡ªåŠ¨å­˜æ”¾æ¥çš„å­—ç¬¦ä¸²å’ŒåŠ <code>const</code>å…³é”®å­—çš„å¸¸é‡æ•°æ®ã€‚</p>
</li>
<li>
<p>ä»£ç åŒº</p>
<p><code>.text</code></p>
<p><code>text</code>æ®µç”¨æ¥å­˜æ”¾ä»£ç å’Œéƒ¨åˆ†æ•´æ•°å¸¸é‡ï¼Œè¯¥æ®µæ˜¯å¯æ‰§è¡Œçš„ã€‚</p>
</li>
</ol>
<h3 id="-cç©ºç±»äº§ç”Ÿå“ªäº›æˆå‘˜å‡½æ•°">ðŸ’± C++ç©ºç±»äº§ç”Ÿå“ªäº›æˆå‘˜å‡½æ•°</h3>
<p><strong>æž„é€ ã€æ‹·è´æž„é€ ã€èµ‹å€¼ã€æžæž„</strong>ã€å–åœ°å€ã€å–åœ°å€constï¼Œ</p>
<p><a href="https://blog.csdn.net/makuiyu/article/details/8047340">C++ ç©ºç±»é»˜è®¤äº§ç”Ÿçš„ç±»æˆå‘˜å‡½æ•°</a></p>
<h3 id="-æŒ‡é’ˆå¸¸è§é”™è¯¯">âœˆï¸ æŒ‡é’ˆå¸¸è§é”™è¯¯</h3>
<p><a href="https://blog.csdn.net/wujiafei_njgcxy/article/details/77940793">é¢è¯•é¢˜Getmemory</a></p>
<h3 id="-cçš„å†…å­˜ç»“æž„">ðŸš™ Cçš„å†…å­˜ç»“æž„</h3>
<p><a href="https://blog.csdn.net/wujiafei_njgcxy/article/details/77777936">Cè¯­è¨€å†…å­˜å¸ƒå±€</a></p>
<p><img src="https://i.loli.net/2020/10/30/FmpXJ7UHBdkteTa.jpg" alt="Cå†…å­˜ç»“æž„" /></p>
<h3 id="ç¨‹åºè¿è¡Œæ—¶å†…å­˜åˆ†é…">ðŸ—¡ç¨‹åºè¿è¡Œæ—¶å†…å­˜åˆ†é…</h3>
<p><strong>å˜é‡å’Œå‡½æ•°å ç”¨çš„å†…å­˜æ˜¯ç³»ç»Ÿåœ¨ç¨‹åºè¿è¡Œæ—¶ä¸ºç¨‹åºåˆ†é…çš„ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„å˜é‡å’Œå‡½æ•°éƒ½è¢«åˆ†é…åœ¨åŒä¸€å—å†…å­˜åŒºåŸŸä¸­</strong>ã€‚å¯¹äºŽä¸€ä¸ªC++ç¨‹åºæ¥è¯´ï¼Œç³»ç»Ÿä¸€èˆ¬é‡‡ç”¨3ç§æ–¹å¼ä¸ºç¨‹åºåˆ†é…å†…å­˜ï¼Œä¸‹é¢å°†åˆ†åˆ«ä»‹ç»è¿™3ç§æ–¹å¼ã€‚</p>
<ol>
<li>
<p><strong>ä»Žé™æ€å­˜å‚¨åŒºåŸŸåˆ†é…</strong></p>
<p>**è¿™éƒ¨åˆ†å†…å­˜åœ¨ç¨‹åºç¼–è¯‘çš„æ—¶å€™å°±å·²ç»åˆ†é…å¥½ï¼Œå¹¶ä¸”è¿™å—å†…å­˜åœ¨ç¨‹åºçš„æ•´ä¸ªè¿è¡ŒæœŸé—´éƒ½å­˜åœ¨ã€‚ä¾‹å¦‚åœ¨å‡½æ•°å¤–å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œä»¥åŠåœ¨åˆ›å»ºæ—¶ä½¿ç”¨staticä¿®é¥°ç¬¦çš„å˜é‡ã€‚**åœ¨è¯¥åŒºåŸŸå­˜å‚¨çš„å†…å®¹ä¸€èˆ¬æ˜¯å…¨å±€å˜é‡ï¼Œå…¶ä¸­å­˜å‚¨åœ¨æ•°æ®æ®µä¸­çš„å…¨å±€å˜é‡é€šå¸¸å·²ç»è¢«åˆå§‹åŒ–ã€‚</p>
</li>
<li>
<p><strong>åœ¨æ ˆä¸Šè¿›è¡Œå†…å­˜åˆ†é…</strong></p>
<p>è¿™éƒ¨åˆ†åŒºåŸŸè¢«ç§°ä¸ºå †æ ˆï¼Œä½†è¿™åªæ˜¯ä¸€ç§ä¹ æƒ¯æ€§è¯´æ³•ï¼Œå¹¶ä¸æ˜¯å †å’Œæ ˆçš„ç»Ÿç§°ã€‚è¯¥éƒ¨åˆ†å­˜å‚¨çš„å˜é‡ä¸€èˆ¬æ˜¯åœ¨å‡½æ•°ä½“ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡ï¼ˆä¸åŒ…æ‹¬staticå£°æ˜Žçš„å˜é‡ï¼Œstaticæ„å‘³ç€å˜é‡å­˜æ”¾åœ¨æ•°æ®æ®µä¸­ï¼‰ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œç»å¸¸åœ¨æ ˆåŒºå‡ºçŽ°çš„è¿˜æœ‰ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°å’Œå‡½æ•°çš„è¿”å›žå€¼ç­‰ã€‚æ ˆåŒºå˜é‡çš„ç”Ÿå­˜å‘¨æœŸæ˜¯åœ¨å…¥æ ˆå‰ï¼ˆå‡½æ•°å¼€å§‹è¢«è°ƒç”¨ï¼‰èŽ·å¾—å†…å­˜ç©ºé—´ï¼Œè€Œåœ¨å‡ºæ ˆæ—¶ï¼ˆå‡½æ•°ç»“æŸè°ƒç”¨ï¼‰é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚å› æ­¤å°½é‡ä¸è¦å°†å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ä½œä¸ºå‡½æ•°çš„è¿”å›žå€¼ï¼Œå› ä¸ºåœ¨å‡½æ•°è°ƒç”¨ç»“æŸåŽï¼Œå±€éƒ¨å˜é‡å°±ä¸å­˜åœ¨äº†ï¼Œå†ä½¿ç”¨æ­¤å˜é‡çš„å€¼ä½œä¸ºè¿”å›žå€¼ï¼Œä¼šä½¿ç¨‹åºèŽ·å–çš„è¿”å›žå€¼æœ‰å¯èƒ½ä¸ºéšæœºæ•°ã€‚åœ¨æ‰§è¡Œå‡½æ•°æ—¶ï¼Œå‡½æ•°ä½“å†…çš„å±€éƒ¨å˜é‡åœ¨æ ˆä¸Šè¢«è‡ªåŠ¨åˆ›å»ºï¼Œè€Œåœ¨å‡½æ•°æ‰§è¡Œç»“æŸæ—¶ï¼Œè¿™äº›å­˜å‚¨å•å…ƒè‡ªåŠ¨è¢«é‡Šæ”¾ã€‚æ ˆå†…å­˜åˆ†é…ç”±æ“ä½œç³»ç»Ÿå®Œæˆè€Œä¸éœ€è¦ç¨‹åºå‘˜æ‰‹åŠ¨å‚ä¸Žã€‚å› æ­¤å…¶æ‰§è¡Œæ•ˆçŽ‡éžå¸¸é«˜ã€‚ä½†æ˜¯æ•´ä¸ªæ ˆåŒºå¯ä»¥è¢«åˆ†é…çš„å†…å­˜å®¹é‡æœ‰é™ã€‚å› æ­¤å®šä¹‰è¿‡å¤šçš„æœªä½¿ç”¨çš„å±€éƒ¨å˜é‡ä¼šä½¿ç¨‹åºæ‰§è¡Œå˜æ…¢ã€‚</p>
</li>
<li>
<p><strong>ä»Žå †ä¸Šåˆ†é…</strong></p>
<p>é€šå¸¸ç§°ä¸ºåŠ¨æ€åˆ†é…çš„å†…å­˜ï¼Œè¯¥éƒ¨åˆ†å†…å­˜åŒºåŸŸçš„å¤§å°å¹¶ä¸å›ºå®šï¼Œå½“ç¨‹åºè¿è¡Œæ—¶æœ‰ç¨‹åºå‘˜ç”¨ malloc() å‡½æ•°ç­‰å†…å­˜åˆ†é…å‡½æ•°æ¥åˆ†é…ï¼Œæˆ–ä½¿ç”¨ new æ“ä½œç¬¦ç­‰ç³»ç»Ÿæä¾›çš„å‡½æ•°æ¥åˆ†é…ã€‚è¯¥å†…å­˜çš„å¤§å°å¯ä»¥æ ¹æ®ç¨‹åºä¸­çš„å®žé™…éœ€è¦æ¥æŒ‡å®šã€‚<strong>è¯¥éƒ¨åˆ†å†…å­˜ç©ºé—´ä¸ä¼šéšç€å‡½æ•°è¿è¡Œçš„ç»“æŸè€Œè¢«è‡ªåŠ¨å›žæ”¶ï¼Œä¹Ÿä¸ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ï¼Œéœ€è¦ç¨‹åºå‘˜è‡ªå·±ç”¨ free() å‡½æ•°æˆ– delete æ“ä½œç¬¦è¿›è¡Œå†…å­˜çš„å›žæ”¶</strong>ã€‚åŠ¨æ€å†…å­˜çš„ç”Ÿå­˜æœŸç”±ç¨‹åºå‘˜è‡ªè¡Œå†³å®šï¼Œä½†å¦‚æžœåˆ†é…äº†ç©ºé—´ï¼Œå°±å¿…é¡»å¯¹å…¶å›žæ”¶ï¼Œå¦åˆ™è¿è¡Œçš„ç¨‹åºä¼šå‡ºçŽ°å†…å­˜æ³„æ¼ï¼Œå¹¶ä¸”é¢‘ç¹åœ°åˆ†é…å’Œé‡Šæ”¾ä¸åŒå¤§å°çš„å †ç©ºé—´å°†ä¼šäº§ç”Ÿå †å†…ç¢Žå—ï¼Œé—´æŽ¥é™ä½Žå†…å­˜ç©ºé—´çš„ä½¿ç”¨çŽ‡ï¼Œä¸¥é‡æ—¶ä¼šäº§ç”Ÿå¤§é‡å†…å­˜ç¢Žç‰‡ã€‚</p>
</li>
</ol>
<p>ã€€ï¼ˆ<strong>å†…å­˜ç¢Žç‰‡æ˜¯ä¸€äº›åˆ†æ•£çš„å†…å­˜åŒºåŸŸï¼Œå¤§é‡å†…å­˜ç¢Žç‰‡çš„å­˜åœ¨ä¼šé™ä½Žå†…å­˜çš„ä½¿ç”¨çŽ‡ã€‚</strong>ï¼‰</p>
<h3 id="structå­—èŠ‚å¯¹é½é—®é¢˜">ðŸ‘½structå­—èŠ‚å¯¹é½é—®é¢˜</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">c1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">short</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">c2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">T_FOO</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„ç»“æž„ä½“ä½¿ç”¨<code>sizeof</code>è¾“å‡ºå¤§å°ä¸º12ã€‚ï¼ˆå‡è®¾è¿™ä¸ªç»“æž„ä½“çš„æˆå‘˜åœ¨å†…å­˜ä¸­æ˜¯ç´§å‡‘æŽ’åˆ—çš„ï¼Œä¸”c1çš„èµ·å§‹åœ°å€æ˜¯0ï¼Œåˆ™sçš„åœ°å€å°±æ˜¯1ï¼Œc2çš„åœ°å€æ˜¯3ï¼Œiçš„åœ°å€æ˜¯4ï¼‰</p>
<p><strong>å­—èŠ‚å¯¹é½</strong></p>
<p>çŽ°ä»£è®¡ç®—æœºä¸­ï¼Œå†…å­˜ç©ºé—´æŒ‰ç…§å­—èŠ‚åˆ’åˆ†ï¼Œç†è®ºä¸Šå¯ä»¥ä»Žä»»ä½•èµ·å§‹åœ°å€è®¿é—®ä»»æ„ç±»åž‹çš„å˜é‡ã€‚ä½†å®žé™…ä¸­åœ¨è®¿é—®ç‰¹å®šç±»åž‹å˜é‡æ—¶ç»å¸¸åœ¨ç‰¹å®šçš„å†…å­˜åœ°å€è®¿é—®ï¼Œè¿™å°±éœ€è¦å„ç§ç±»åž‹æ•°æ®æŒ‰ç…§ä¸€å®šçš„è§„åˆ™åœ¨ç©ºé—´ä¸ŠæŽ’åˆ—ï¼Œè€Œä¸æ˜¯é¡ºåºä¸€ä¸ªæŽ¥ä¸€ä¸ªåœ°å­˜æ”¾ï¼Œè¿™å°±æ˜¯å¯¹é½ã€‚</p>
<p><strong>å¯¹é½çš„åŽŸå› å’Œä½œç”¨</strong></p>
<ul>
<li>
<p><strong>ä¸åŒç¡¬ä»¶å¹³å°å¯¹å­˜å‚¨ç©ºé—´çš„å¤„ç†ä¸Šå­˜åœ¨å¾ˆå¤§çš„ä¸åŒ</strong>ã€‚æŸäº›å¹³å°å¯¹ç‰¹å®šç±»åž‹çš„æ•°æ®åªèƒ½ä»Žç‰¹å®šåœ°å€å¼€å§‹å­˜å–ï¼Œè€Œä¸å…è®¸å…¶åœ¨å†…å­˜ä¸­ä»»æ„å­˜æ”¾ã€‚ä¾‹å¦‚Motorola 68000 å¤„ç†å™¨ä¸å…è®¸16ä½çš„å­—å­˜æ”¾åœ¨å¥‡åœ°å€ï¼Œå¦åˆ™ä¼šè§¦å‘å¼‚å¸¸ï¼Œå› æ­¤åœ¨è¿™ç§æž¶æž„ä¸‹ç¼–ç¨‹å¿…é¡»ä¿è¯å­—èŠ‚å¯¹é½ã€‚</p>
</li>
<li>
<p><strong>ä½†æœ€å¸¸è§çš„æƒ…å†µæ˜¯ï¼Œå¦‚æžœä¸æŒ‰ç…§å¹³å°è¦æ±‚å¯¹æ•°æ®å­˜æ”¾è¿›è¡Œå¯¹é½ï¼Œä¼šå¸¦æ¥å­˜å–æ•ˆçŽ‡ä¸Šçš„æŸå¤±</strong>ã€‚æ¯”å¦‚32ä½çš„Intelå¤„ç†å™¨é€šè¿‡æ€»çº¿è®¿é—®(åŒ…æ‹¬è¯»å’Œå†™)å†…å­˜æ•°æ®ã€‚æ¯ä¸ªæ€»çº¿å‘¨æœŸä»Žå¶åœ°å€å¼€å§‹è®¿é—®32ä½å†…å­˜æ•°æ®ï¼Œå†…å­˜æ•°æ®ä»¥å­—èŠ‚ä¸ºå•ä½å­˜æ”¾ã€‚å¦‚æžœä¸€ä¸ª32ä½çš„æ•°æ®æ²¡æœ‰å­˜æ”¾åœ¨4å­—èŠ‚æ•´é™¤çš„å†…å­˜åœ°å€å¤„ï¼Œé‚£ä¹ˆå¤„ç†å™¨å°±éœ€è¦2ä¸ªæ€»çº¿å‘¨æœŸå¯¹å…¶è¿›è¡Œè®¿é—®ï¼Œæ˜¾ç„¶è®¿é—®æ•ˆçŽ‡ä¸‹é™å¾ˆå¤šã€‚</p>
<p>å› æ­¤ï¼Œ<strong>é€šè¿‡åˆç†çš„å†…å­˜å¯¹é½å¯ä»¥æé«˜è®¿é—®æ•ˆçŽ‡ã€‚ä¸ºä½¿CPUèƒ½å¤Ÿå¯¹æ•°æ®è¿›è¡Œå¿«é€Ÿè®¿é—®ï¼Œæ•°æ®çš„èµ·å§‹åœ°å€åº”å…·æœ‰â€œå¯¹é½â€ç‰¹æ€§</strong>ã€‚æ¯”å¦‚4å­—èŠ‚æ•°æ®çš„èµ·å§‹åœ°å€åº”ä½äºŽ4å­—èŠ‚è¾¹ç•Œä¸Šï¼Œå³èµ·å§‹åœ°å€èƒ½å¤Ÿè¢«4æ•´é™¤</p>
</li>
<li>
<p><strong>æ­¤å¤–ï¼Œåˆç†åˆ©ç”¨å­—èŠ‚å¯¹é½è¿˜å¯ä»¥æœ‰æ•ˆåœ°èŠ‚çœå­˜å‚¨ç©ºé—´</strong>ã€‚ä½†è¦æ³¨æ„ï¼Œåœ¨32ä½æœºä¸­ä½¿ç”¨1å­—èŠ‚æˆ–2å­—èŠ‚å¯¹é½ï¼Œåè€Œä¼šé™ä½Žå˜é‡è®¿é—®é€Ÿåº¦ã€‚å› æ­¤éœ€è¦è€ƒè™‘å¤„ç†å™¨ç±»åž‹ã€‚è¿˜åº”è€ƒè™‘ç¼–è¯‘å™¨çš„ç±»åž‹ã€‚åœ¨VC/C++å’ŒGNU GCCä¸­éƒ½æ˜¯é»˜è®¤æ˜¯4å­—èŠ‚å¯¹é½ã€‚</p>
</li>
</ul>
<p><strong>å¯¹é½å‡†åˆ™</strong></p>
<ol>
<li>
<p><code>sizeof</code>çš„æœ€ç»ˆç»“æžœå¿…ç„¶æ˜¯ç»“æž„å†…éƒ¨æœ€å¤§æˆå‘˜çš„æ•´æ•°å€ï¼Œä¸å¤Ÿè¡¥é½ã€‚</p>
</li>
<li>
<p>ç»“æž„å†…éƒ¨å„ä¸ªæˆå‘˜çš„é¦–åœ°å€å¿…ç„¶æ˜¯è‡ªèº«å¤§å°çš„æ•´æ•°å€ã€‚</p>
<p>å¦‚æžœå®šä¹‰äº†<code>#pragma pack(n)</code>ï¼Œåˆ™ä¸Šè¿°ä¿©æ¡è§„åˆ™å¯å®šä¹‰ä¸ºï¼š</p>
<p>1ã€æ•´ä¸ª<code>sizeof</code>çš„æœ€ç»ˆç»“æžœå¿…ç„¶æ˜¯ <code>min[n,ç»“æž„å†…éƒ¨æœ€å¤§æˆå‘˜]</code> çš„æ•´æ•°å€ï¼Œä¸å¤Ÿè¡¥é½ã€‚</p>
<p>2ã€ç»“æž„å†…éƒ¨å„ä¸ªæˆå‘˜çš„é¦–åœ°å€å¿…ç„¶æ˜¯<code>min[n,è‡ªèº«å¤§å°]</code>çš„æ•´æ•°å€ã€‚</p>
<blockquote>
<p>ç”±ä¸Šè¿°åŽŸåˆ™å¯çŸ¥ï¼Œåœ¨å†™ç»“æž„ä½“æ—¶ï¼Œæˆå‘˜å…ˆåŽä¸è¦éšæ„å†™å“¦ï¼Œåº”éµå¾ªä»Žå¤§åˆ°å°çš„åŽŸåˆ™ï¼Œè¿™æ ·æœ‰åŠ©äºŽèŠ‚çœç©ºé—´ã€‚</p>
</blockquote>
</li>
</ol>
<p>ä½¿ç”¨å››å­—èŠ‚å¯¹é½ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#pragma pack(push)
</span></span></span><span class="line"><span class="cl"><span class="cp">#pragma pack(4)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">typedef</span> <span class="k">struct</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">c1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">short</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">c2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">T_FOO</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#pragma pack(pop)
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¯¹å…¶ä½¿ç”¨<code>sizeof</code>å¾—åˆ°çš„å¤§å°ä¸º12</p>
<p>ä¸ä½¿ç”¨å­—èŠ‚å¯¹é½ï¼Œå³ä½¿ç”¨1å­—èŠ‚å¯¹é½ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#pragma pack(push)
</span></span></span><span class="line"><span class="cl"><span class="cp">#pragma pack(1)
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">typedef</span> <span class="k">struct</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">c1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">short</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">c2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">T_FOO</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#pragma pack(pop)
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>å¤§å°ä¸º8</p>
<p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/clover-toeic/p/3853132.html">Cè¯­è¨€å­—èŠ‚å¯¹é½é—®é¢˜è¯¦è§£</a></p>
<h3 id="mallocä¸€æ¬¡æ€§æœ€å¤§èƒ½ç”³è¯·å¤šå¤§å†…å­˜ç©ºé—´">â“œï¸mallocä¸€æ¬¡æ€§æœ€å¤§èƒ½ç”³è¯·å¤šå¤§å†…å­˜ç©ºé—´ï¼Ÿ</h3>
<p>å…·ä½“æƒ…å†µåˆ†æž</p>
<h3 id="å­—èŠ‚åºäº†è§£å—è®²ä¸€ä¸‹å¤§ç«¯å¯¹é½å’Œå°ç«¯å¯¹é½">ðŸ”¶å­—èŠ‚åºäº†è§£å—ï¼Ÿè®²ä¸€ä¸‹å¤§ç«¯å¯¹é½å’Œå°ç«¯å¯¹é½</h3>
<p>ä¸»æœºå­—èŠ‚åºåˆå« CPU å­—èŠ‚åºï¼Œå…¶ä¸æ˜¯ç”±æ“ä½œç³»ç»Ÿå†³å®šçš„ï¼Œè€Œæ˜¯ç”± CPU æŒ‡ä»¤é›†æž¶æž„å†³å®šçš„ã€‚ä¸»æœºå­—èŠ‚åºåˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li><strong>å¤§ç«¯å­—èŠ‚åºï¼ˆBig Endianï¼‰</strong>ï¼šé«˜åºå­—èŠ‚å­˜å‚¨åœ¨ä½Žä½åœ°å€ï¼Œä½Žåºå­—èŠ‚å­˜å‚¨åœ¨é«˜ä½åœ°å€</li>
<li><strong>å°ç«¯å­—èŠ‚åºï¼ˆLittle Endian</strong>ï¼‰ï¼šé«˜åºå­—èŠ‚å­˜å‚¨åœ¨é«˜ä½åœ°å€ï¼Œä½Žåºå­—èŠ‚å­˜å‚¨åœ¨ä½Žä½åœ°å€</li>
</ul>
<p>32 ä½æ•´æ•° <code>0x12345678</code> æ˜¯ä»Žèµ·å§‹ä½ç½®ä¸º <code>0x00</code> çš„åœ°å€å¼€å§‹å­˜æ”¾ï¼Œåˆ™ï¼š</p>
<table>
<thead>
<tr>
<th>å†…å­˜åœ°å€</th>
<th>0x00</th>
<th>0x01</th>
<th>0x02</th>
<th>0x03</th>
</tr>
</thead>
<tbody>
<tr>
<td>å¤§ç«¯</td>
<td>12</td>
<td>34</td>
<td>56</td>
<td>78</td>
</tr>
<tr>
<td>å°ç«¯</td>
<td>78</td>
<td>56</td>
<td>34</td>
<td>12</td>
</tr>
</tbody>
</table>
<p><img src="https://i.loli.net/2020/10/15/o2U3L1mwFnTX7gQ.png" alt="å¤§ç«¯åº" /> <img src="https://i.loli.net/2020/10/15/62KchFkCYRTtHyb.png" alt="å°ç«¯åº" /></p>
<p><strong>åˆ¤æ–­å¤§ç«¯å°ç«¯</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mh">0x12345678</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x12</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;å¤§ç«¯&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>    
</span></span><span class="line"><span class="cl">        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;å°ç«¯&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç½‘ç»œå­—èŠ‚é¡ºåºæ˜¯ TCP/IP ä¸­è§„å®šå¥½çš„ä¸€ç§æ•°æ®è¡¨ç¤ºæ ¼å¼ï¼Œå®ƒä¸Žå…·ä½“çš„ CPU ç±»åž‹ã€æ“ä½œç³»ç»Ÿç­‰æ— å…³ï¼Œä»Žè€Œå¯ä»¥ä¿è¯æ•°æ®åœ¨ä¸åŒä¸»æœºä¹‹é—´ä¼ è¾“æ—¶èƒ½å¤Ÿè¢«æ­£ç¡®è§£é‡Šã€‚</p>
<p><strong>ç½‘ç»œå­—èŠ‚é¡ºåºé‡‡ç”¨ï¼šå¤§ç«¯ï¼ˆBig Endianï¼‰æŽ’åˆ—æ–¹å¼ã€‚</strong></p>
<h3 id="å­—ç¬¦ä¸²ä¸Žå­—ç¬¦ä¸²æŒ‡é’ˆçš„å¤§å°">ðŸ“å­—ç¬¦ä¸²ä¸Žå­—ç¬¦ä¸²æŒ‡é’ˆçš„å¤§å°</h3>
<ul>
<li><code>sizeof</code> å¯¹æ•°ç»„ï¼Œå¾—åˆ°æ•´ä¸ªæ•°ç»„æ‰€å ç©ºé—´å¤§å°ã€‚</li>
<li><code>sizeof</code> å¯¹æŒ‡é’ˆï¼Œå¾—åˆ°æŒ‡é’ˆæœ¬èº«æ‰€å ç©ºé—´å¤§å°ã€‚</li>
</ul>
<p>å¯ä»¥çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="s">&#34;abcd&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;sizeof a = &#34;</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;  &#34;</span>
</span></span><span class="line"><span class="cl">         <span class="o">&lt;&lt;</span> <span class="s">&#34;strlen(a) = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">b</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&#34;abcd&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;sizeof b = &#34;</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;  &#34;</span>
</span></span><span class="line"><span class="cl">         <span class="o">&lt;&lt;</span> <span class="s">&#34;strlen(b) = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">c</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;abcd&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;sizeof c = &#34;</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;  &#34;</span>
</span></span><span class="line"><span class="cl">         <span class="o">&lt;&lt;</span> <span class="s">&#34;strlen(c) = &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">strlen</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¾“å‡ºä¸ºï¼š</p>
<pre tabindex="0"><code>sizeof a = 8  strlen(a) = 4
sizeof b = 5  strlen(b) = 4
sizeof c = 10  strlen(c) = 4
</code></pre><p><code>strlen()</code>çš„ç»“æžœéƒ½ä¸€æ ·ï¼Œè¿”å›žçš„æ˜¯å­—ç¬¦ä¸²çš„é•¿åº¦(ä¸è®¡<code>\0</code>);ä½†æ˜¯<code>sizeof()</code>æ˜¯è¿”å›žç±»åž‹çš„å¤§å°ï¼Œå‡å¦‚æ˜¯æŒ‡é’ˆï¼Œè¿”å›žå½“å‰æ“ä½œç³»ç»Ÿåœ°å€æŒ‡é’ˆçš„å¤§å°ï¼›å‡å¦‚æ˜¯æ˜¾ç¤ºæ•°ç»„åˆå§‹åŒ–çš„æ•°ç»„ï¼Œå°±è¿”å›žæ•°ç»„å®žé™…å¤§å°çš„å­—èŠ‚æ•°ã€‚</p>
<h3 id="åŠ¨æ€é“¾æŽ¥å’Œé™æ€é“¾æŽ¥çš„åŒºåˆ«">ðŸ’ƒåŠ¨æ€é“¾æŽ¥å’Œé™æ€é“¾æŽ¥çš„åŒºåˆ«</h3>
<p><a href="https://www.cnblogs.com/tracylee/archive/2012/10/15/2723816.html">https://www.cnblogs.com/tracylee/archive/2012/10/15/2723816.html</a></p>
<p>é™æ€é“¾æŽ¥æ–¹å¼ï¼šåœ¨ç¨‹åºæ‰§è¡Œä¹‹å‰å®Œæˆæ‰€æœ‰çš„ç»„è£…å·¥ä½œï¼Œç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œçš„ç›®æ ‡æ–‡ä»¶ï¼ˆEXEæ–‡ä»¶ï¼‰ã€‚</p>
<p>åŠ¨æ€é“¾æŽ¥æ–¹å¼ï¼šåœ¨ç¨‹åºå·²ç»ä¸ºäº†æ‰§è¡Œè¢«è£…å…¥å†…å­˜ä¹‹åŽå®Œæˆé“¾æŽ¥å·¥ä½œï¼Œå¹¶ä¸”åœ¨å†…å­˜ä¸­ä¸€èˆ¬åªä¿ç•™è¯¥ç¼–è¯‘å•å…ƒçš„ä¸€ä»½æ‹·è´ã€‚</p>
<h3 id="æ™ºèƒ½æŒ‡é’ˆçš„å¤šçº¿ç¨‹é—®é¢˜">ðŸ›©ï¸æ™ºèƒ½æŒ‡é’ˆçš„å¤šçº¿ç¨‹é—®é¢˜</h3>
<h3 id="-å…³äºŽtemplateçš„ä¸‰ä¸ªé—®é¢˜">ðŸŽª å…³äºŽtemplateçš„ä¸‰ä¸ªé—®é¢˜</h3>
<ol>
<li>templateçš„å£°æ˜Žã€‚</li>
<li>å¦‚ä½•â€œå®žä¾‹åŒ–ï¼ˆinstantiatesï¼‰â€class objectã€inline nonmemberä»¥åŠ member templatefunctionsã€‚<strong>è¿™äº›æ˜¯â€œæ¯ä¸€ä¸ªç¼–è¯‘å•ä½éƒ½ä¼šæ‹¥æœ‰ä¸€ä»½å®žä¾‹â€çš„ä¸œè¥¿ã€‚</strong></li>
<li>å¦‚ä½•â€œå®žä¾‹åŒ–ï¼ˆinstantiatesï¼‰â€nonmemberã€member template functionsä»¥åŠ static template class membersã€‚<strong>è¿™äº›éƒ½æ˜¯â€œæ¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä¸­åªéœ€è¦ä¸€ä»½å®žä¾‹â€çš„ä¸œè¥¿ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸€èˆ¬è€Œè¨€ templateæ‰€å¸¦æ¥çš„é—®é¢˜ã€‚</strong></li>
</ol>
<p>ä»£ç æ ·ä¾‹ï¼š</p>
<p><img src="https://i.loli.net/2020/10/18/BEU7oO2mvw9xNnA.png" alt="code" /></p>
<p><strong>é¦–å…ˆï¼Œå½“ç¼–è¯‘å™¨çœ‹åˆ°template class å£°æ˜Žæ—¶ï¼Œå®ƒä¼šåšå‡ºä»€ä¹ˆååº”ï¼Ÿåœ¨å®žé™…ç¨‹åºä¸­ï¼Œä»€ä¹ˆååº”ä¹Ÿæ²¡æœ‰ï¼</strong></p>
<p><strong>é™æ€æˆå‘˜å˜é‡</strong></p>
<p>å¯¹äºŽæ¨¡æ¿ç±»é‡Œé¢çš„é™æ€æˆå‘˜å˜é‡ï¼Œå½“åˆå§‹åŒ–å®ƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢ä¸€æ¡è¯­å¥æ‰èƒ½ä½¿ç”¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">Point</span><span class="o">&lt;</span> <span class="kt">float</span> <span class="o">&gt;::</span><span class="n">freeList</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸èƒ½ä½¿ç”¨<code>Point::freeList;</code>ï¼Œ<strong>æ­¤æ—¶ä¼šä½¿å…¶ä¸€ä»½å®žä¾‹ä¸Ž Point class çš„ float instantiationåœ¨ç¨‹åºä¸­äº§ç”Ÿå…³è”ã€‚</strong></p>
<p>å½“æˆ‘ä»¬å†è°ƒç”¨ä¸‹é¢çš„è¯­å¥æ—¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">Point</span><span class="o">&lt;</span> <span class="kt">double</span> <span class="o">&gt;::</span><span class="n">freeList</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å°±ä¼šå‡ºçŽ°ç¬¬äºŒä¸ªfreeListå®žä¾‹ï¼Œä¸ŽPoint classçš„double instantiationäº§ç”Ÿå…³è”ã€‚</strong></p>
<p><strong>ç±»å¯¹è±¡å®žä¾‹</strong></p>
<p>æ‰€ä»¥ï¼Œä¸€ä¸ªclass object çš„å®šä¹‰ï¼Œä¸è®ºæ˜¯ç”±ç¼–è¯‘å™¨æš—ä¸­åœ°åšï¼ˆåƒç¨æ—©ç¨‹åºä»£ç ä¸­å‡ºçŽ°è¿‡çš„temporaryï¼‰ï¼Œæˆ–æ˜¯ç”±ç¨‹åºå‘˜åƒä¸‹é¢è¿™æ ·æ˜¾å¼åœ°åšï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">const</span> <span class="n">Point</span><span class="o">&lt;</span> <span class="kt">float</span> <span class="o">&gt;</span> <span class="n">origin</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>éƒ½ä¼šå¯¼è‡´template classçš„â€œå®žä¾‹åŒ–â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œfloat instantiationçš„çœŸæ­£å¯¹è±¡å¸ƒå±€ä¼šè¢«äº§ç”Ÿå‡ºæ¥ã€‚</p>
<blockquote>
<p>å›žé¡¾å…ˆå‰çš„ template å£°æ˜Žï¼Œæˆ‘ä»¬çœ‹åˆ° Point æœ‰ä¸‰ä¸ª nonstatic membersï¼Œæ¯ä¸€ä¸ªçš„ç±»åž‹éƒ½æ˜¯Typeã€‚TypeçŽ°åœ¨è¢«ç»‘å®šä¸ºfloatï¼Œæ‰€ä»¥originçš„é…ç½®ç©ºé—´å¿…é¡»è¶³å¤Ÿå®¹çº³ä¸‰ä¸ªfloatæˆå‘˜ã€‚</p>
</blockquote>
<p><strong>æˆå‘˜å‡½æ•°</strong></p>
<p>ç„¶è€Œï¼Œmember functionsï¼ˆè‡³å°‘å¯¹äºŽé‚£äº›æœªè¢«ä½¿ç”¨è¿‡çš„ï¼‰ä¸åº”è¯¥è¢«â€œå®žä¾‹åŒ–â€ã€‚åªæœ‰åœ¨memberfunctionsè¢«ä½¿ç”¨çš„æ—¶å€™ï¼ŒC++Standardæ‰è¦æ±‚å®ƒä»¬è¢«â€œå®žä¾‹åŒ–â€ã€‚</p>
<p>è¿™äº›å‡½æ•°åœ¨ä»€ä¹ˆæ—¶å€™â€œå®žä¾‹åŒ–â€ï¼Ÿç›®å‰æµè¡Œä¸¤ç§ç­–ç•¥ï¼š</p>
<ul>
<li>åœ¨ç¼–è¯‘çš„æ—¶å€™ã€‚é‚£ä¹ˆå‡½æ•°å°†â€œå®žä¾‹åŒ–â€äºŽ originå’Œ på­˜åœ¨çš„é‚£ä¸ªæ–‡ä»¶ä¸­ã€‚</li>
<li>åœ¨é“¾æŽ¥çš„æ—¶å€™ã€‚é‚£ä¹ˆç¼–è¯‘å™¨ä¼šè¢«ä¸€äº›è¾…åŠ©å·¥å…·é‡æ–°æ¿€æ´»ã€‚template å‡½æ•°å®žä¾‹å¯èƒ½è¢«æ”¾åœ¨è¿™ä¸€æ–‡ä»¶ä¸­ã€åˆ«çš„æ–‡ä»¶ä¸­æˆ–ä¸€ä¸ªåˆ†ç¦»çš„å­˜å‚¨ä½ç½®ã€‚</li>
</ul>
<p>æ¨¡æ¿é”™è¯¯æŠ¥å‘Šï¼š</p>
<p>cfrontå¯¹templateçš„å¤„ç†æ˜¯å®Œå…¨è§£æžï¼ˆparseï¼‰ä½†ä¸åšç±»åž‹æ£€éªŒï¼›åªæœ‰åœ¨æ¯ä¸€ä¸ªå®žä¾‹åŒ–æ“ä½œï¼ˆinstantiationï¼‰å‘ç”Ÿæ—¶æ‰åšç±»åž‹æ£€éªŒã€‚æ‰€ä»¥åœ¨ä¸€ä¸ªparsingç­–ç•¥ä¹‹ä¸‹ï¼Œæ‰€æœ‰è¯­æ±‡ï¼ˆlexingï¼‰é”™è¯¯å’Œè§£æžï¼ˆparsingï¼‰é”™è¯¯éƒ½ä¼šåœ¨å¤„ç†templateå£°æ˜Žçš„è¿‡ç¨‹ä¸­è¢«æ ‡ç¤ºå‡ºæ¥ã€‚</p>
<h3 id="cçš„å¼‚å¸¸å¤„ç†æœºåˆ¶">â—c++çš„å¼‚å¸¸å¤„ç†æœºåˆ¶</h3>
<p>æ¬²æ”¯æŒexception handlingï¼Œç¼–è¯‘å™¨çš„ä¸»è¦å·¥ä½œå°±æ˜¯æ‰¾å‡ºcatchå­å¥ï¼Œä»¥å¤„ç†è¢«æŠ›å‡ºæ¥çš„exceptionã€‚</p>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œexception handlingæœºåˆ¶éœ€è¦ä¸Žç¼–è¯‘å™¨æ‰€äº§ç”Ÿçš„æ•°æ®ç»“æž„ä»¥åŠæ‰§è¡ŒæœŸçš„ä¸€ä¸ªexception libraryç´§å¯†åˆä½œã€‚åœ¨ç¨‹åºå¤§å°å’Œæ‰§è¡Œé€Ÿåº¦ä¹‹é—´ï¼Œç¼–è¯‘å™¨å¿…é¡»æœ‰æ‰€æŠ‰æ‹©ï¼š</p>
<ul>
<li>ä¸ºäº†ç»´æŠ¤æ‰§è¡Œé€Ÿåº¦ï¼Œç¼–è¯‘å™¨å¯ä»¥åœ¨ç¼–è¯‘æ—¶æœŸå»ºç«‹èµ·ç”¨äºŽæ”¯æŒçš„æ•°æ®ç»“æž„ã€‚è¿™ä¼šä½¿ç¨‹åºçš„å¤§å°å‘ç”Ÿè†¨èƒ€ï¼Œä½†ç¼–è¯‘å™¨å¯ä»¥å‡ ä¹Žå¿½ç•¥è¿™äº›ç»“æž„ï¼Œç›´åˆ°æœ‰ä¸ª exceptionè¢«æŠ›å‡ºæ¥ã€‚</li>
<li>ä¸ºäº†ç»´æŠ¤ç¨‹åºå¤§å°ï¼Œç¼–è¯‘å™¨å¯ä»¥åœ¨æ‰§è¡ŒæœŸå»ºç«‹èµ·ç”¨äºŽæ”¯æŒçš„æ•°æ®ç»“æž„ã€‚è¿™ä¼šå½±å“ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦ï¼Œä½†æ„å‘³ç€ç¼–è¯‘å™¨åªæœ‰åœ¨å¿…è¦çš„æ—¶å€™æ‰å»ºç«‹é‚£äº›æ•°æ®ç»“æž„ï¼ˆå¹¶ä¸”å¯ä»¥æŠ›å¼ƒä¹‹ï¼‰ã€‚</li>
</ul>
<p>C++çš„exception handlingç”±ä¸‰ä¸ªä¸»è¦çš„è¯­æ±‡ç»„ä»¶æž„æˆï¼š</p>
<ol>
<li>ä¸€ä¸ª throw å­å¥ã€‚å®ƒåœ¨ç¨‹åºæŸå¤„å‘å‡ºä¸€ä¸ª exceptionã€‚è¢«æŠ›å‡ºåŽ»çš„exceptionå¯ä»¥æ˜¯å†…å»ºç±»åž‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ä½¿ç”¨è€…è‡ªå®šç±»åž‹ã€‚</li>
<li>ä¸€ä¸ªæˆ–å¤šä¸ª catchå­å¥ã€‚æ¯ä¸€ä¸ª catchå­å¥éƒ½æ˜¯ä¸€ä¸ª exception handlerã€‚å®ƒç”¨æ¥è¡¨ç¤ºè¯´ï¼Œè¿™ä¸ªå­å¥å‡†å¤‡å¤„ç†æŸç§ç±»åž‹çš„ exceptionï¼Œå¹¶ä¸”åœ¨å°é—­çš„å¤§æ‹¬å·åŒºæ®µä¸­æä¾›å®žé™…çš„å¤„ç†ç¨‹åºã€‚</li>
<li>ä¸€ä¸ª tryåŒºæ®µã€‚å®ƒè¢«å›´ç»•ä»¥ä¸€ç³»åˆ—çš„å™è¿°å¥ï¼ˆstatementsï¼‰ï¼Œè¿™äº›å™è¿°å¥å¯èƒ½ä¼šå¼•å‘ catchå­å¥èµ·ä½œç”¨ã€‚</li>
</ol>
<p>å½“ä¸€ä¸ªexception è¢«æŠ›å‡ºåŽ»æ—¶ï¼ŒæŽ§åˆ¶æƒä¼šä»Žå‡½æ•°è°ƒç”¨ä¸­è¢«é‡Šæ”¾å‡ºæ¥ï¼Œå¹¶å¯»æ‰¾ä¸€ä¸ªå»åˆçš„catchå­å¥ã€‚å¦‚æžœéƒ½æ²¡æœ‰å»åˆè€…ï¼Œé‚£ä¹ˆé»˜è®¤çš„å¤„ç†ä¾‹ç¨‹terminateï¼ˆï¼‰ä¼šè¢«è°ƒç”¨ã€‚å½“æŽ§åˆ¶æƒè¢«æ”¾å¼ƒåŽï¼Œå †æ ˆä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ä¹Ÿå°±è¢«æŽ¨ç¦»ï¼ˆpopped upï¼‰ã€‚è¿™ä¸ªç¨‹åºç§°ä¸ºunwinding the stackã€‚åœ¨æ¯ä¸€ä¸ªå‡½æ•°è¢«æŽ¨ç¦»å †æ ˆä¹‹å‰ï¼Œå‡½æ•°çš„local class objectsçš„destructorä¼šè¢«è°ƒç”¨ã€‚</p>
<h3 id="æ‰§è¡ŒæœŸç±»åž‹è¯†åˆ«runtime-type-identificationrtti">ðŸƒâ€â™‚ï¸æ‰§è¡ŒæœŸç±»åž‹è¯†åˆ«ï¼ˆRuntime Type Identificationï¼ŒRTTIï¼‰</h3>
<ol>
<li>ç±»åž‹å®‰å…¨çš„å‘ä¸‹è½¬åž‹ï¼Œä¸€ä¸ªå®‰å…¨çš„å‘ä¸‹è½¬åž‹éœ€è¦åœ¨æ‰§è¡ŒæœŸå¯ä»¥å¯¹æŒ‡é’ˆè¿›è¡ŒæŸ¥è¯¢ï¼Œç¡®å®šå¯ä»¥æ­£ç¡®ä¸”å®‰å…¨çš„å‘ä¸‹è½¬åž‹ã€‚å› ä¸ºéœ€è¦æ”¯æŒæŸ¥è¯¢ï¼Œåˆ™éœ€è¦åœ¨è½¬åž‹æ—¶çš„ç©ºé—´å’Œæ‰§è¡Œæ—¶é—´ä¸Šçš„é¢å¤–è´Ÿæ‹…ã€‚é¢å¤–è´Ÿæ‹…æœ‰ï¼š</li>
</ol>
<p>ã€€ã€€ã€€ã€€1) é¢å¤–ç©ºé—´ä»¥å­˜å‚¨ç±»åž‹ä¿¡æ¯ï¼Œé€šå¸¸ä¸ºä¸€ä¸ªæŒ‡å‘æŸç±»åž‹ä¿¡æ¯èŠ‚ç‚¹çš„æŒ‡é’ˆï¼›</p>
<p>ã€€ã€€ã€€ã€€2) é¢å¤–æ—¶é—´ä»¥å†³å®šæ‰§è¡ŒæœŸçš„ç±»åž‹ã€‚</p>
<p>ã€€ã€€ã€€ã€€C++åˆ©ç”¨è™šè¡¨ï¼Œå°†ç±»ç›¸å…³çš„RTTIå¯¹è±¡åœ°å€(å³type_infoå¯¹è±¡åœ°å€)æ”¾åœ¨è™šè¡¨ä¸­(ä¸€èˆ¬ä¸ºç¬¬ä¸€ä¸ªslot)ï¼Œæ­¤æ—¶ç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™è®¾å®švtprå’Œè™šè¡¨å³å¯ï¼Œå½“éœ€è¦å‘ä¸‹è½¬åž‹æ—¶åˆ©ç”¨RTTIå†³å®šæ‰§è¡ŒæœŸç±»åž‹ç­‰ä¿¡æ¯ã€‚</p>
<ol start="2">
<li>
<p>ç±»åž‹å®‰å…¨çš„åŠ¨æ€è½¬æ¢dynamic_castå¯ä»¥ç¡®ä¿è½¬åŒ–åˆé€‚çš„ç±»åž‹å¯¹è±¡ï¼Œè‹¥å¤±è´¥åˆ™è¿”å›žç©ºæŒ‡é’ˆ(å½“è½¬åŒ–ä¸ºæŒ‡é’ˆç±»åž‹æ—¶)æˆ–è€…æŠ›å‡ºå¼‚å¸¸(å½“è½¬åŒ–ä¸ºå¼•ç”¨ç±»åž‹æ—¶)ã€‚dynamic_castçš„æˆæœ¬åœ¨äºŽè¿è¡ŒæœŸçš„ç±»åž‹è¯†åˆ«åˆ¤æ–­ã€‚</p>
</li>
<li>
<p>ä½¿ç”¨typeidè¿ç®—ç¬¦èŽ·å–å¯¹è±¡çš„ç±»åž‹ï¼Œå³type_infoï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡typeidæ¥ç¡®å®šæ˜¯å¦æ»¡è¶³æŸä¸ªç±»åž‹ï¼Œç„¶åŽè°ƒç”¨static_castè½¬åŒ–å³å¯ã€‚å³if(typeid(someObj) == typeid(someType) ) {someType &amp;rf = static_cast&lt;someType&amp;&gt;(someObj);}ã€‚æ­¤å¤–RTTIä¸ä»…å¯ç”¨äºŽå¤šæ€ç±»ï¼Œä¹Ÿå¯ä»¥ç”¨äºŽå†…ç½®ç±»åž‹å’Œéžå¤šæ€çš„ç”¨æˆ·è‡ªå®šä¹‰ç±»åž‹ã€‚</p>
</li>
</ol>
<h3 id="cæž„é€ å‡½æ•°">ðŸš§C++æž„é€ å‡½æ•°</h3>
<blockquote>
<p>å››ç§æƒ…å†µï¼Œé€ æˆâ€œç¼–è¯‘å™¨ä¼šä¸ºæœªå£°æ˜Žçš„constructorçš„classesåˆæˆä¸€ä¸ªdefault constructor</p>
</blockquote>
<ol>
<li>
<p><strong>å¸¦æœ‰Default Constructor çš„Member Class Object</strong></p>
<p>å¦‚æžœä¸€ä¸ªclassæ²¡æœ‰ä»»ä½•constructorï¼Œä½†å®ƒå†…å«ä¸€ä¸ªmember objectï¼Œè€ŒåŽè€… æœ‰default constructorï¼Œé‚£ä¹ˆè¿™ä¸ªclassçš„implicit default constructor å°±æ˜¯ â€œnontrivialâ€,ç¼–è¯‘å™¨éœ€è¦ä¸ºæ­¤classåˆæˆå‡ºä¸€ä¸ªdefault constructorã€‚ä¸è¿‡è¿™ä¸ª åˆæˆæ“ä½œåªæœ‰åœ¨constructorçœŸæ­£éœ€è¦è¢«è°ƒç”¨æ—¶æ‰ä¼šå‘ç”Ÿã€‚</p>
<p>ä¾‹å­ï¼šBarä¼šç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„æž„é€ å‡½æ•°</p>
<p><img src="https://i.loli.net/2020/09/22/GS9Jnxq7oOI2cwU.png" alt="å¸¦æœ‰é»˜è®¤æž„é€ å‡½æ•°çš„æˆå‘˜ç±»å¯¹è±¡" /></p>
<blockquote>
<p>æç¤ºï¼šè¢«åˆæˆçš„é»˜è®¤æž„é€ å‡½æ•°åªæ˜¯æ»¡è¶³ç¼–è¯‘å™¨çš„éœ€è¦ï¼Œè€Œä¸æ˜¯ç¨‹åºçš„éœ€è¦ã€‚</p>
</blockquote>
</li>
<li>
<p><strong>â€œå¸¦æœ‰ Default Constructorâ€çš„ Base Class</strong></p>
<p>å¦‚æžœä¸€ä¸ªæ²¡æœ‰ä»»ä½•constructorsçš„classæ´¾ç”Ÿè‡ªä¸€ä¸ªâ€œå¸¦æœ‰default constructorâ€çš„base class,é‚£ä¹ˆè¿™ä¸ªderived classçš„default constructorä¼šè¢«è§†ä¸ºnontrivialï¼Œå¹¶å› æ­¤éœ€è¦è¢«åˆæˆå‡ºæ¥ã€‚å®ƒå°†è°ƒç”¨ä¸Šä¸€å±‚base classesçš„default constructor(æ ¹æ®å®ƒä»¬çš„å£°æ˜Žæ¬¡åºï¼‰ã€‚å¯¹ä¸€ä¸ªåŽç»§æ´¾ç”Ÿçš„classè€Œè¨€ï¼Œè¿™ä¸ªåˆæˆçš„constructorå’Œä¸€ä¸ªâ€œè¢«æ˜Žç¡®æä¾›çš„default constructorâ€æ²¡æœ‰ä»€ä¹ˆå·®å¼‚ã€‚</p>
</li>
<li>
<p><strong>â€œå¸¦æœ‰ä¸€ä¸ª Virtual Functionâ€çš„Class</strong></p>
<p>æž„é€ å‡½æ•°çš„æž„å»ºä¸»è¦æ˜¯ä¸ºäº†åˆå§‹åŒ–æˆ–è€…æ›´æ–°<strong>è™šå‡½æ•°æŒ‡é’ˆ</strong></p>
<p>ä¾‹å­</p>
<p><img src="https://i.loli.net/2020/09/22/B6neWJKNdSQg3bX.png" alt="è™šå‡½æ•°æž„é€ å‡½æ•°" /></p>
</li>
<li>
<p><strong>â€œå¸¦æœ‰ä¸€ä¸ªVirtual Base Classâ€çš„Class</strong></p>
<p>ä¾‹å­ï¼š</p>
<p><img src="https://i.loli.net/2020/09/22/cd9vs2xjmb5FN7f.png" alt="è™šåŸºç±»" /></p>
</li>
</ol>
<p>åœ¨åˆæˆçš„default constructorä¸­ï¼Œåªæœ‰base class subobjectså’Œmember classobjectsä¼šè¢«åˆå§‹åŒ–ã€‚æ‰€æœ‰å…¶å®ƒçš„ nonstatic data memberï¼Œå¦‚æ•´æ•°ã€æ•´æ•°æŒ‡é’ˆã€æ•´æ•°æ•°ç»„ç­‰ç­‰éƒ½ä¸ä¼šè¢«åˆå§‹åŒ–ã€‚è¿™äº›åˆå§‹åŒ–æ“ä½œå¯¹ç¨‹åºè€Œè¨€æˆ–è®¸æœ‰éœ€è¦ï¼Œä½†å¯¹ç¼–è¯‘å™¨åˆ™å¹¶éžå¿…è¦ã€‚å¦‚æžœç¨‹åºéœ€è¦ä¸€ä¸ªâ€œæŠŠæŸæŒ‡é’ˆè®¾ä¸º0â€çš„default constructor,é‚£ä¹ˆæä¾›å®ƒçš„äººåº”è¯¥æ˜¯ç¨‹åºå‘˜ã€‚</p>
<h3 id="cæ‹·è´æž„é€ å‡½æ•°">ðŸ‘®â€â™‚ï¸C++æ‹·è´æž„é€ å‡½æ•°</h3>
<p>æœ‰ä¸‰ç§æƒ…å†µï¼Œä¼šä»¥ä¸€ä¸ªobjectçš„å†…å®¹ä½œä¸ºå¦ä¸€ä¸ªclass objectçš„åˆå€¼:</p>
<ol>
<li>
<p>å¯¹ä¸€ä¸ªobjectåšæ˜Žç¡®çš„åˆå§‹åŒ–æ“ä½œï¼Œåƒè¿™æ ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">X</span><span class="p">{...};</span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æ˜Žç¡®åœ°ä»¥ä¸€ä¸ªobjectçš„å†…å®¹ä½œä¸ºå¦ä¸€ä¸ªclass objectçš„åˆå€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">X</span> <span class="n">xx</span> <span class="o">=</span> <span class="n">x</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å½“object è¢«å½“ä½œå‚æ•°äº¤ç»™æŸä¸ªå‡½æ•°æ—¶,ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">extern</span> <span class="kt">void</span> <span class="nf">foo</span><span class="p">(</span><span class="n">X</span> <span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">test</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">X</span> <span class="n">xx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">foo</span><span class="p">(</span><span class="n">xx</span><span class="p">);</span>	<span class="c1">//ä»¥xxä½œä¸ºfooï¼ˆï¼‰ç¬¬ä¸€ä¸ªå‚æ•°çš„åˆå€¼ï¼ˆä¸æ˜Žæ˜¾çš„åˆå§‹åŒ–æ“ä½œï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å½“å‡½æ•°ä¼ å›žä¸€ä¸ªclass objectæ—¶ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">X</span> <span class="nf">foo_bar</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">X</span> <span class="n">xx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">xx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h4 id="default-memberwise-initialization">Default Memberwise Initialization</h4>
<p>å¦‚æžœå‡½æ•°å¹¶æ²¡æœ‰æä¾›ä¸€ä¸ª<code>explicit copy constructor</code>ï¼Œé‚£ä¹ˆå…¶æ‹·è´åŒç±»åž‹å¯¹è±¡çš„æ“ä½œç”±<code>default memberwise initialization</code>å®Œæˆï¼Œå…¶æ‰§è¡Œç­–ç•¥ä¸ºï¼šå¯¹æ¯ä¸€ä¸ªå†…å»ºæˆ–æ´¾ç”Ÿçš„<code>data member</code>çš„å€¼ï¼Œä»ŽæŸä¸€ä¸ª<code>object</code>æ‹·è´åˆ°å¦ä¸€ä¸ª<code>object</code>ã€‚ä¸è¿‡å®ƒä¸ä¼šæ‹·è´å…¶ä¸­çš„<code>member class object</code>ï¼Œè€Œæ˜¯å®žæ–½é€’å½’å¼çš„<code>memberwise initialization</code>(å¯¹æ¯ä¸€ä¸ªå¯¹è±¡ä¾æ¬¡æ‰§è¡Œ<code>default memberwise initialization</code>ï¼‰ã€‚</p>
<blockquote>
<p>Default constructors å’Œ copy constructorsåœ¨å¿…è¦çš„æ—¶å€™æ‰ç”±ç¼–è¯‘å™¨äº§ç”Ÿå‡ºæ¥ã€‚</p>
</blockquote>
<h4 id="bitwise-copy-semanticsä½é€æ¬¡æ‹·è´">Bitwise Copy Semantics(ä½é€æ¬¡æ‹·è´ï¼‰</h4>
<p>çœ‹çœ‹ä¸‹é¢çš„ç¨‹åºæ®µï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span><span class="cpf">&#34;Word.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">Word</span> <span class="nf">noun</span><span class="p">(</span><span class="s">&#34;book&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">foo</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">Word</span> <span class="n">verb</span> <span class="o">=</span> <span class="n">noun</span><span class="p">;</span> <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ä¸å¯èƒ½é¢„æµ‹è¿™ä¸ªåˆå§‹åŒ–æ“ä½œçš„ç¨‹åºè¡Œä¸ºã€‚å¦‚æžœclass Wordçš„è®¾è®¡è€…å®šä¹‰äº†ä¸€ä¸ªcopy constructorï¼Œverbçš„åˆå§‹åŒ–æ“ä½œä¼šè°ƒç”¨å®ƒã€‚ä½†å¦‚æžœè¯¥class æ²¡æœ‰å®šä¹‰explicit copy constructor,é‚£ä¹ˆæ˜¯å¦ä¼šæœ‰ä¸€ä¸ªç¼–è¯‘å™¨åˆæˆçš„å®žä½“è¢«è°ƒç”¨å‘¢ï¼Ÿè¿™å°±å¾—è§†è¯¥class æ˜¯å¦å±•çŽ°&quot;bitwise copy semanticsâ€è€Œå®šã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå·²çŸ¥ä¸‹é¢çš„class Word å£°æ˜Žï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">//ä»¥ä¸‹å£°æ˜Žå±•çŽ°äº†bitwise copy semantics
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Word</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Word</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">~</span><span class="n">Word</span><span class="p">(){</span> <span class="k">delete</span> <span class="p">[]</span><span class="n">str</span><span class="p">;}</span> 	<span class="c1">//..
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">cnt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="err">ï¼›</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§æƒ…å†µä¸‹å¹¶<strong>ä¸éœ€è¦</strong>åˆæˆå‡ºä¸€ä¸ªdefault copy constructorï¼Œå› ä¸ºä¸Šè¿°å£°æ˜Žå±•çŽ°äº†â€œdefault copy semanticsâ€ã€‚</p>
<p>å†å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">//ä»¥ä¸‹å£°æ˜Žå¹¶æœªå±•çŽ°å‡ºbitwise copy semantics
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Word</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Word</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span><span class="o">&amp;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="o">~</span><span class="n">Word</span><span class="p">(){</span> <span class="k">delete</span> <span class="p">[]</span><span class="n">str</span><span class="p">;}</span> 	<span class="c1">//..
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">cnt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">String</span> <span class="n">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="err">ï¼›</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­Stringå£°æ˜Žäº†ä¸€ä¸ªæ˜¾ç¤ºçš„æ‹·è´æž„é€ å‡½æ•°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">String</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">~</span><span class="n">String</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å¿…é¡»åˆæˆå‡ºä¸€ä¸ªcopy constructor ä»¥ä¾¿è°ƒç”¨member class String objectçš„ copy constructor:</p>
<p><strong>ä»€ä¹ˆæ—¶å€™ä¸€ä¸ªclassä¸å±•çŽ°å‡ºâ€œbitwise copy semanticsâ€å‘¢?æœ‰å››ç§æƒ…å†µï¼š</strong></p>
<ol>
<li>å½“classå†…å«ä¸€ä¸ªmember objectè€ŒåŽè€…çš„classå£°æ˜Žæœ‰ä¸€ä¸ªcopy constructoræ—¶ï¼ˆä¸è®ºæ˜¯è¢«class è®¾è®¡è€…æ˜Žç¡®åœ°å£°æ˜Žï¼Œå°±åƒå‰é¢çš„Stringé‚£æ ·ï¼›æˆ–æ˜¯è¢«ç¼–è¯‘å™¨åˆæˆï¼Œåƒclass Wordé‚£æ ·ï¼‰ã€‚</li>
<li>å½“classç»§æ‰¿è‡ªä¸€ä¸ªbase classè€ŒåŽè€…å­˜åœ¨æœ‰ä¸€ä¸ªcopy constructoræ—¶ï¼ˆå†æ¬¡å¼ºè°ƒï¼Œä¸è®ºæ˜¯è¢«æ˜Žç¡®å£°æ˜Žæˆ–æ˜¯è¢«åˆæˆè€Œå¾—ï¼‰ã€‚</li>
<li>å½“classå£°æ˜Žäº†ä¸€ä¸ªæˆ–å¤šä¸ªvirtual functionsæ—¶ã€‚</li>
<li>å½“classæ´¾ç”Ÿè‡ªä¸€ä¸ªç»§æ‰¿ä¸²é“¾ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªvirtual base classesæ—¶ã€‚</li>
</ol>
<p>å‰ä¸¤ç¥žæƒ…å†µä¸­ï¼Œç¼–è¯‘å™¨å¿…é¡»å°†memberæˆ–base classçš„â€œcopy constructorsè°ƒç”¨æ“ä½œâ€å®‰æ’åˆ°è¢«åˆæˆçš„copy constructorä¸­ã€‚</p>
<p><strong>è™šå‡½æ•°æŒ‡é’ˆ</strong></p>
<p>ç¼–è¯‘æ—¶æœŸæœ‰ä¸¤ä¸ªç¨‹åºçš„æ‰©å¼ æ“ä½œï¼š</p>
<p>â–  å¢žåŠ ä¸€ä¸ªvirtual function tableï¼ˆvtbl)ï¼Œå†…å«æ¯ä¸€ä¸ªæœ‰ä½œç”¨çš„ virtual functionçš„åœ°å€ã€‚<br />
â–  å°†ä¸€ä¸ªæŒ‡å‘virtual function tableçš„æŒ‡é’ˆï¼ˆvptr)ï¼Œå®‰æ’åœ¨æ¯ä¸€ä¸ªclass objectå†…ã€‚</p>
<p>å¾ˆæ˜¾ç„¶ï¼Œå¦‚æžœç¼–è¯‘å™¨å¯¹äºŽæ¯ä¸€ä¸ªæ–°äº§ç”Ÿçš„<code>class object</code>çš„<code>vptr</code>ä¸èƒ½æˆåŠŸè€Œæ­£ç¡®åœ°è®¾å¥½å…¶åˆå€¼ï¼Œå°†å¯¼è‡´å¯æ€•çš„åŽæžœã€‚å› æ­¤ï¼Œå½“ç¼–è¯‘å™¨å¯¼å…¥ä¸€ä¸ª<code>vptr</code>åˆ°<code>class</code>ä¹‹ä¸­æ—¶ï¼Œè¯¥<code>class</code>å°±ä¸å†å±•çŽ°<code>bitwise semantics</code>äº†ã€‚çŽ°åœ¨ï¼Œç¼–è¯‘å™¨éœ€è¦åˆæˆå‡ºä¸€ä¸ª<code>copy constructor</code>ï¼Œä»¥æ±‚å°†<code>vptr</code>é€‚å½“åœ°åˆå§‹åŒ–ï¼Œä¸‹é¢æ˜¯ä¸ªä¾‹å­ã€‚</p>
<p>ä»¥ä¸€ä¸ªæ´¾ç”Ÿç±»å¯¹è±¡ä½œä¸ºå…¶çˆ¶ç±»å¯¹è±¡çš„åˆå§‹å€¼ï¼Œç¼–è¯‘å™¨éœ€è¦**â€åˆ¤æ–­â€œ**</p>
<p><img src="https://i.loli.net/2020/09/23/3EO2tFpdbJZc7WH.png" alt="åˆ¤æ–­å¦‚ä½•åŽ»æ‹·è´æž„é€ " /></p>
<h3 id="ç¨‹åºè½¬åŒ–è¯­ä¹‰">ç¨‹åºè½¬åŒ–è¯­ä¹‰</h3>
<p>ä¸‹é¢çš„ç¨‹åºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">X</span> <span class="nf">foo</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">	<span class="n">X</span> <span class="n">xx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span> <span class="n">xx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯èƒ½ä¼šåšå‡ºä»¥ä¸‹å‡è®¾ï¼š</p>
<ol>
<li>æ¯æ¬¡<code>foo0</code>è¢«è°ƒç”¨ï¼Œå°±ä¼ å›žxxçš„å€¼ã€‚</li>
<li>å¦‚æžœ<code>class X</code>å®šä¹‰äº†ä¸€ä¸ª<code>copy constructor</code>ï¼Œé‚£ä¹ˆå½“<code>foo0</code>è¢«è°ƒç”¨æ—¶ï¼Œä¿è¯è¯¥<code>copy constructor</code> ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚</li>
</ol>
<blockquote>
<p>ç¬¬ä¸€ä¸ªå‡è®¾çš„çœŸå®žæ€§ï¼Œå¿…é¡»è§†<code>class X</code>å¦‚ä½•å®šä¹‰è€Œå®šã€‚ç¬¬äºŒä¸ªå‡è®¾çš„çœŸå®žæ€§ï¼Œè™½ç„¶ä¹Ÿæœ‰éƒ¨åˆ†å¿…é¡»è§†<code>class X</code>å¦‚ä½•å®šä¹‰è€Œå®šï¼Œä½†æœ€ä¸»è¦è¿˜æ˜¯è§†ä½ çš„C++ç¼–è¯‘å™¨æ‰€æä¾›çš„è¿›å–æ€§ä¼˜åŒ–ç¨‹åº¦ï¼ˆdegree of aggressive optimization)è€Œå®šã€‚ä½ ç”šè‡³å¯ä»¥å‡è®¾åœ¨ä¸€ä¸ªé«˜å“è´¨çš„C++ç¼–è¯‘å™¨ä¸­ï¼Œä¸Šè¿°ä¸¤ç‚¹å¯¹äºŽclass Xçš„nontrivial definitionséƒ½ä¸æ­£ç¡®ã€‚</p>
</blockquote>
<p><strong>æ˜¾å¼åˆå§‹åŒ–æ“ä½œ(Explicit Initialization)</strong></p>
<p>ä¸‹é¢çš„ä¾‹å­æ˜¯ä¸‰ç§æ˜¾ç¤ºçš„æ‹·è´æž„é€ æ“ä½œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">X</span> <span class="n">x0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">X</span> <span class="n">x1</span><span class="p">(</span><span class="n">x0</span><span class="p">);</span>     <span class="c1">// ç¬¬ä¸€ç§æ˜¾ç¤ºæ‹·è´æž„é€ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">X</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">x0</span><span class="p">;</span>    <span class="c1">// ç¬¬äºŒç§æ˜¾ç¤ºæ‹·è´æž„é€ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">X</span> <span class="n">x3</span> <span class="o">=</span> <span class="n">X</span><span class="p">(</span><span class="n">x0</span><span class="p">);</span> <span class="c1">// ç¬¬ä¸‰ç§æ˜¾ç¤ºæ‹·è´æž„é€ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„ç¨‹åºè½¬åŒ–å¯èƒ½ä¼šæœ‰ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li>é‡å†™æ¯ä¸€ä¸ªå®šä¹‰ï¼Œå…¶ä¸­çš„åˆå§‹åŒ–æ“ä½œä¼šè¢«å‰¥é™¤ã€‚</li>
<li>classçš„copy constructor è°ƒç”¨æ“ä½œä¼šè¢«å®‰æ’è¿›åŽ»ã€‚</li>
</ol>
<p>å¯èƒ½ä¼šå˜æˆä¸‹é¢è¿™æ ·</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">test_Cpp</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ... x0çš„æž„é€ å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ä¸‰ä¸ªå£°æ˜Ž
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">X</span> <span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">x3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ä¸‰ä¸ªå®šä¹‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">x1</span><span class="p">.</span><span class="n">X</span><span class="o">::</span><span class="n">X</span><span class="p">(</span><span class="n">x0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">x2</span><span class="p">.</span><span class="n">X</span><span class="o">::</span><span class="n">X</span><span class="p">(</span><span class="n">x0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">x3</span><span class="p">.</span><span class="n">X</span><span class="o">::</span><span class="n">X</span><span class="p">(</span><span class="n">x0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å‚æ•°çš„åˆå§‹åŒ–ï¼ˆArgument Initialization)</strong></p>
<p>C++æ ‡å‡†è¯´ï¼ŒæŠŠä¸€ä¸ªclass object å½“åšå‚æ•°ä¼ ç»™ä¸€ä¸ªå‡½æ•°ï¼Œç›¸å½“äºŽä¸€ä¸‹å½¢å¼çš„åˆå§‹åŒ–æ“ä½œï¼š</p>
<p>(å®šä¹‰ä¸€ä¸ªç±»Xï¼Œä½œä¸ºtestå‡½æ•°çš„å‚æ•°)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">X</span> <span class="n">xx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">test</span><span class="p">(</span><span class="n">xx</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­testå‡½æ•°çš„å£°æ˜Žå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">test</span><span class="p">(</span><span class="n">X</span> <span class="n">x0</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„å‚æ•°xxè¿™ä¸ªå˜é‡ä½œä¸ºå‚æ•°ä¼ åˆ°å‡½æ•°testä¸­ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œå¹¶ä¸”ä¼šè°ƒç”¨æ‹·è´æž„é€ å‡½æ•°å°†è¿™ä¸ªä¸´æ—¶å¯¹è±¡åˆå§‹åŒ–ï¼Œç»è¿‡è¿™äº›æ­¥éª¤è¿™ä¸ªå‚æ•°æ‰çœŸæ­£ä¼ å…¥å‡½æ•°ä¸­è¿›è¡Œä½¿ç”¨ã€‚</p>
<p>æ‰€ä»¥ä¸Šé¢çš„ä»£ç å¯èƒ½ä¼šè½¬æ¢ä¸ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">X</span> <span class="n">__temp</span><span class="p">;</span>	<span class="c1">// ä¸´æ—¶å¯¹è±¡äº§ç”Ÿ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">__temp</span><span class="p">.</span><span class="n">X</span><span class="o">::</span><span class="n">X</span><span class="p">(</span><span class="n">xx</span><span class="p">);</span>	<span class="c1">//ç¼–è¯‘å™¨å¯¹æ‹·è´æž„é€ å‡½æ•°çš„è°ƒç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">test</span><span class="p">(</span><span class="n">__temp</span><span class="p">);</span>		<span class="c1">//é‡æ–°æ”¹å†™å‡½æ•°çš„è°ƒç”¨æ“ä½œ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶è€Œä¸Šé¢çš„åšæ³•åªå®Œæˆäº†ä¸€èˆ¬ï¼Œå› ä¸ºå‡½æ•°xxçš„å£°æ˜Žè¿˜æ˜¯ä¸€ä¸ªä¼ å€¼çš„å‚æ•°ï¼Œtestçš„å£°æ˜Žä¹Ÿä¹Ÿé¡»è¢«è½¬åŒ–ï¼Œå½¢å¼å‚æ•°å¿…é¡»ä»ŽåŽŸå…ˆçš„ä¸€ä¸ªclass X objectæ”¹å˜ä¸ºä¸€ä¸ªclass X reference,åƒè¿™æ ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">test</span><span class="p">(</span><span class="n">X</span><span class="o">&amp;</span> <span class="n">x0</span><span class="p">)</span><span class="err">ï¼›</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>è¿”å›žå€¼çš„åˆå§‹åŒ–ï¼ˆReturn Value Initialization)</strong></p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">X</span> <span class="nf">test</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">X</span> <span class="n">xx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">xx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç¼–è¯‘å™¨å¯èƒ½ä¼šåšå¦‚ä¸‹<code>NRV</code>ä¼˜åŒ–ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">X</span> <span class="n">__result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">test</span><span class="p">(</span><span class="n">X</span><span class="o">&amp;</span> <span class="n">__result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">__result</span><span class="p">.</span><span class="n">X</span><span class="o">::</span><span class="n">X</span><span class="p">()</span><span class="err">ï¼›</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å½“ç±»æ˜¾ç¤ºBitwiseçš„æƒ…å†µä¸‹ï¼Œåº”è¯¥ä¸åŽ»å®šä¹‰ä¸€ä¸ªæ‹·è´æž„é€ å‡½æ•°ï¼Œä½¿ç”¨ç¼–è¯‘å™¨åˆæˆå°±éžå¸¸é«˜æ•ˆå’Œå®‰å…¨ï¼</strong></p>
<hr />
<p><strong>Dataè¯­ä¹‰å­¦</strong></p>
<hr />
<h3 id="cdataè¯­ä¹‰">ðŸ’½C++â€”â€”dataè¯­ä¹‰</h3>
<p>æ¯ä¸€ä¸ªclass object å› æ­¤å¿…é¡»æœ‰è¶³å¤Ÿçš„å¤§å°ä»¥å®¹çº³å®ƒæ‰€æœ‰çš„ nonstatic datamembersã€‚æœ‰æ—¶å€™å…¶å€¼å¯èƒ½ä»¤ä½ åƒæƒŠï¼ˆæ­£å¦‚é‚£ä½æ³•å›½æ¥ä¿¡è€…ï¼‰ï¼Œå› ä¸ºå®ƒå¯èƒ½æ¯”ä½ æƒ³è±¡çš„è¿˜å¤§ï¼ŒåŽŸå› æ˜¯ï¼š</p>
<ol>
<li>ç”±ç¼–è¯‘å™¨è‡ªåŠ¨åŠ ä¸Šçš„é¢å¤–data membersï¼Œç”¨ä»¥æ”¯æŒæŸäº›è¯­è¨€ç‰¹æ€§ï¼ˆä¸»è¦æ˜¯å„ç§virtualç‰¹æ€§ï¼‰.</li>
<li>å› ä¸ºalignmentï¼ˆè¾¹ç•Œè°ƒæ•´ï¼‰çš„éœ€è¦ã€‚</li>
</ol>
<p><strong>Data Memberçš„ç»‘å®š</strong></p>
<p>çœ‹çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">//æŸä¸ªfoo.hå¤´æ–‡ä»¶ï¼Œä»ŽæŸå¤„å«å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">extern</span> <span class="kt">float</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ç¨‹åºå‘˜çš„Point3d.hæ–‡ä»¶ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Point3d</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">Point3d</span><span class="p">(</span><span class="kt">float</span><span class="p">,</span><span class="kt">float</span><span class="p">,</span><span class="kt">float</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="c1">//é—®é¢˜ï¼šè¢«ä¼ å›žå’Œè¢«è®¾å®šçš„xæ˜¯å“ªä¸€ä¸ªxå‘¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">float</span> <span class="nf">X</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span><span class="p">;}</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">X</span><span class="p">(</span> <span class="kt">float</span> <span class="k">new</span> <span class="n">x</span><span class="p">)</span> <span class="k">const</span><span class="p">{</span><span class="n">x</span><span class="o">=</span><span class="n">new_x</span><span class="p">;}</span> <span class="c1">//..â€¦ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æžœæˆ‘é—®ä½ <code>Point3d::X()</code>ä¼ å›žå“ªä¸€ä¸ªxï¼Ÿæ˜¯classå†…éƒ¨çš„é‚£ä¸ªxï¼Œè¿˜æ˜¯å¤–éƒ¨ï¼ˆextern)çš„é‚£ä¸ªxï¼Ÿä»Šå¤©æ¯ä¸ªäººéƒ½ä¼šå›žç­”æˆ‘æ˜¯å†…éƒ¨é‚£ä¸€ä¸ªã€‚è¿™ä¸ªç­”æ¡ˆæ˜¯æ­£ç¡®çš„ï¼Œä½†å¹¶ä¸æ˜¯ä»Žè¿‡åŽ»ä»¥æ¥ä¸€ç›´éƒ½æ­£ç¡®ï¼</p>
<p>æ—©æœŸC++çš„ä¸¤ç§é˜²å¾¡æ€§ç¨‹åºè®¾è®¡é£Žæ ¼ï¼š</p>
<ol>
<li>æŠŠæ‰€æœ‰çš„<code>data members</code>æ”¾åœ¨<code>class</code>å£°æ˜Žèµ·å¤´å¤„ï¼Œä»¥ç¡®ä¿æ­£ç¡®çš„ç»‘å®šï¼š</li>
<li>æŠŠæ‰€æœ‰çš„<code>inline functions</code>ï¼Œä¸ç®¡å¤§å°éƒ½æ”¾åœ¨<code>class</code>å£°æ˜Žä¹‹å¤–ï¼š</li>
</ol>
<p>è¿™ä¸ªè¯­è¨€è§„åˆ™è¢«ç§°ä¸ºâ€œmember rewriting ruleâ€ï¼Œå¤§æ„æ˜¯â€œä¸€ä¸ª<code>inline</code>å‡½æ•°å®žä½“ï¼Œåœ¨æ•´ä¸ª <code>class</code>å£°æ˜Žæœªè¢«å®Œå…¨çœ‹è§ä¹‹å‰ï¼Œæ˜¯ä¸ä¼šè¢«è¯„ä¼°æ±‚å€¼ï¼ˆevaluatedï¼‰çš„â€ã€‚C++Standard ä»¥â€œmember scope resolution rulesâ€æ¥ç²¾ç‚¼è¿™ä¸ªâ€œrewriting ruleâ€ï¼Œå…¶æ•ˆæžœæ˜¯ï¼Œå¦‚æžœä¸€ä¸ª<code>inline</code>å‡½æ•°åœ¨<code>class</code>å£°æ˜Žä¹‹åŽç«‹åˆ»è¢«å®šä¹‰çš„è¯ï¼Œé‚£ä¹ˆå°±è¿˜æ˜¯å¯¹å…¶è¯„ä¼°æ±‚å€¼ï¼ˆevaluate)ã€‚</p>
<p>ç„¶è€Œï¼Œè¿™å¯¹äºŽmember functionçš„argument list å¹¶ä¸ä¸ºçœŸã€‚Argument listä¸­çš„åç§°è¿˜æ˜¯ä¼šåœ¨å®ƒä»¬ç¬¬ä¸€æ¬¡é­é‡æ—¶è¢«é€‚å½“åœ°å†³è®®ï¼ˆresolvedï¼‰å®Œæˆã€‚å› æ­¤åœ¨externå’Œnested type namesä¹‹é—´çš„éžç›´è§‰ç»‘å®šæ“ä½œè¿˜æ˜¯ä¼šå‘ç”Ÿã€‚ä¾‹å¦‚åœ¨ä¸‹é¢çš„ç¨‹åºç‰‡æ®µä¸­ï¼Œlengthçš„ç±»åž‹åœ¨ä¸¤ä¸ªmember function signaturesä¸­éƒ½å†³è®®ï¼ˆresolve)ä¸ºglobal typedef,ä¹Ÿå°±æ˜¯int.å½“åŽç»­å†æœ‰lengthçš„nested typedef å£°æ˜Žå‡ºçŽ°æ—¶ï¼ŒC+Standard å°±æŠŠç¨æ—©çš„ç»‘å®šæ ‡ç¤ºä¸ºéžæ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="kt">int</span> <span class="n">length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Point3D</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    	<span class="c1">// 1ength è¢«å†³è®®(resolvedï¼‰ä¸ºglobal
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">void</span> <span class="n">mumble</span><span class="p">(</span><span class="n">length</span> <span class="n">val</span><span class="p">){</span><span class="n">_val</span> <span class="o">=</span> <span class="n">val</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">        <span class="n">length</span> <span class="nf">mumble</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">_val</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">typedef</span> <span class="kt">float</span> <span class="n">length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    	<span class="c1">// 1ength è¢«å†³è®®(resolvedï¼‰ä¸ºlocal
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">length</span> <span class="n">_val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šè¿°è¿™ç§è¯­è¨€çŠ¶å†µï¼Œä»ç„¶éœ€è¦æŸç§é˜²å¾¡æ€§ç¨‹åºé£Žæ ¼ï¼šè¯·å§‹ç»ˆæŠŠâ€œnested typeå£°æ˜Žâ€æ”¾åœ¨classçš„èµ·å§‹å¤„ã€‚åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œå¦‚æžœæŠŠlengthçš„nested typedefå®šä¹‰äºŽâ€œåœ¨classä¸­è¢«å‚è€ƒâ€ä¹‹å‰ï¼Œå°±å¯ä»¥ç¡®ä¿éžç›´è§‰ç»‘å®šçš„æ­£ç¡®æ€§ã€‚</p>
<p><strong>Data Memberçš„å¸ƒå±€ï¼ˆData Member Layout)</strong></p>
<p><strong>Data Memberçš„å­˜å–</strong></p>
<p>æˆ‘ç”¨å®ƒä»¬æ¥å­˜å–data membersï¼Œåƒè¿™æ ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">pt</span><span class="o">-&gt;</span><span class="n">x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡originå­˜å–å’Œé€šè¿‡ptå­˜å–ï¼Œæœ‰ä»€ä¹ˆé‡å¤§å·®å¼‚å—ï¼Ÿ</p>
<p>â€œä»Žoriginå­˜å–â€å’Œâ€œä»Žptå­˜å–â€æœ‰ä»€ä¹ˆé‡å¤§çš„å·®å¼‚ï¼Ÿç­”æ¡ˆæ˜¯â€œå½“<code>Point3d</code>æ˜¯ä¸€ä¸ªderived classï¼Œè€Œåœ¨å…¶ç»§æ‰¿ç»“æž„ä¸­æœ‰ä¸€ä¸ªvirtual base classï¼Œå¹¶ä¸”è¢«å­˜å–çš„member(å¦‚æœ¬ä¾‹çš„xï¼‰æ˜¯ä¸€ä¸ªä»Žè¯¥virtual base classç»§æ‰¿è€Œæ¥çš„memberæ—¶ï¼Œå°±ä¼šæœ‰é‡å¤§çš„å·®å¼‚â€ã€‚è¿™æ—¶å€™æˆ‘ä»¬ä¸èƒ½å¤Ÿè¯´ptå¿…ç„¶æŒ‡å‘å“ªä¸€ç§ class typeï¼ˆå› æ­¤æˆ‘ä»¬ä¹Ÿå°±ä¸çŸ¥é“ç¼–è¯‘æ—¶æœŸè¿™ä¸ªmemberçœŸæ­£çš„offsetä½ç½®ï¼‰ï¼Œæ‰€ä»¥è¿™ä¸ªå­˜å–æ“ä½œå¿…é¡»å»¶è¿Ÿè‡³æ‰§è¡ŒæœŸï¼Œç»ç”±ä¸€ä¸ªé¢å¤–çš„é—´æŽ¥å¯¼å¼•ï¼Œæ‰èƒ½å¤Ÿè§£å†³ã€‚ä½†å¦‚æžœä½¿ç”¨originï¼Œå°±ä¸ä¼šæœ‰è¿™äº›é—®é¢˜ï¼Œå…¶ç±»åž‹æ— ç–‘æ˜¯Point3d classï¼Œè€Œå³ä½¿å®ƒç»§æ‰¿è‡ª virtual baseclassï¼Œmembersçš„offsetä½ç½®ä¹Ÿåœ¨ç¼–è¯‘æ—¶æœŸå°±å›ºå®šäº†ã€‚ä¸€ä¸ªç§¯æžè¿›å–çš„ç¼–è¯‘å™¨ç”šè‡³å¯ä»¥é™æ€åœ°ç»ç”± originå°±è§£å†³æŽ‰å¯¹xçš„å­˜å–ã€‚â€œä»Žoriginå­˜å–â€å’Œâ€œä»Žptå­˜å–â€æœ‰ä»€ä¹ˆé‡å¤§çš„å·®å¼‚ï¼Ÿç­”æ¡ˆæ˜¯â€œå½“Point3dæ˜¯ä¸€ä¸ªderived classï¼Œè€Œåœ¨å…¶ç»§æ‰¿ç»“æž„ä¸­æœ‰ä¸€ä¸ªvirtual base classï¼Œå¹¶ä¸”è¢«å­˜å–çš„member(å¦‚æœ¬ä¾‹çš„xï¼‰æ˜¯ä¸€ä¸ªä»Žè¯¥virtual base classç»§æ‰¿è€Œæ¥çš„memberæ—¶ï¼Œå°±ä¼šæœ‰é‡å¤§çš„å·®å¼‚â€ã€‚è¿™æ—¶å€™æˆ‘ä»¬ä¸èƒ½å¤Ÿè¯´ptå¿…ç„¶æŒ‡å‘å“ªä¸€ç§ class typeï¼ˆå› æ­¤æˆ‘ä»¬ä¹Ÿå°±ä¸çŸ¥é“ç¼–è¯‘æ—¶æœŸè¿™ä¸ªmemberçœŸæ­£çš„offsetä½ç½®ï¼‰ï¼Œ<code>æ‰€ä»¥è¿™ä¸ªå­˜å–æ“ä½œå¿…é¡»å»¶è¿Ÿè‡³æ‰§è¡ŒæœŸ</code>ï¼Œç»ç”±ä¸€ä¸ªé¢å¤–çš„é—´æŽ¥å¯¼å¼•ï¼Œæ‰èƒ½å¤Ÿè§£å†³ã€‚ä½†å¦‚æžœä½¿ç”¨originï¼Œå°±ä¸ä¼šæœ‰è¿™äº›é—®é¢˜ï¼Œå…¶ç±»åž‹æ— ç–‘æ˜¯Point3d classï¼Œè€Œå³ä½¿å®ƒç»§æ‰¿è‡ª virtual baseclassï¼Œmembersçš„offsetä½ç½®ä¹Ÿåœ¨ç¼–è¯‘æ—¶æœŸå°±å›ºå®šäº†ã€‚ä¸€ä¸ªç§¯æžè¿›å–çš„ç¼–è¯‘å™¨ç”šè‡³å¯ä»¥é™æ€åœ°ç»ç”± originå°±è§£å†³æŽ‰å¯¹xçš„å­˜å–ã€‚</p>
<p>é™æ€æ•°æ®æˆå‘˜</p>
<p>ã€‚ã€‚ã€‚</p>
<p>éžé™æ€æ•°æ®æˆå‘˜</p>
<p>ã€‚ã€‚ã€‚</p>
<p><strong>ç»§æ‰¿ä¸Žæ•°æ®æˆå‘˜</strong></p>
<p><strong>æŒ‡å‘Data Membersçš„æŒ‡é’ˆï¼ˆPointer to Data Membersï¼‰</strong></p>
<p>å¦‚æžœvptræ”¾åœ¨å¯¹è±¡çš„å°¾ç«¯ï¼Œä¸‰ä¸ªåæ ‡å€¼åœ¨å¯¹è±¡å¸ƒå±€ä¸­çš„offsetåˆ†åˆ«æ˜¯0ï¼Œ4ï¼Œ8ã€‚å¦‚æžœvptræ”¾åœ¨å¯¹è±¡çš„èµ·å¤´ï¼Œä¸‰ä¸ªåæ ‡å€¼åœ¨å¯¹è±¡å¸ƒå±€ä¸­çš„offsetåˆ†åˆ«æ˜¯4ï¼Œ8ï¼Œ12ã€‚ç„¶è€Œä½ è‹¥åŽ»å–data membersçš„åœ°å€ï¼Œä¼ å›žçš„å€¼æ€»æ˜¯å¤š1ï¼Œä¹Ÿå°±æ˜¯1ï¼Œ5ï¼Œ9æˆ–5ï¼Œ9ï¼Œ13ç­‰ç­‰ã€‚ä½ çŸ¥é“ä¸ºä»€ä¹ˆBjarneå†³å®šè¦è¿™ä¹ˆåšå—ï¼Ÿ</p>
<p>ä¸ºäº†åŒºåˆ†ç¬¬ä¸€ä¸ªæ•°æ®æˆå‘˜ä¸ŽæŒ‡å‘ç±»å¯¹è±¡çš„åœ°å€ã€‚</p>
<hr />
<p>ðŸ–• Functionè¯­ä¹‰å­¦</p>
<hr />
<p>å¦‚æžœæˆ‘æœ‰ä¸€ä¸ªPoint3dçš„æŒ‡é’ˆå’Œå¯¹è±¡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">Point3d</span> <span class="n">obj</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Point3d</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">obj</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“æˆ‘è¿™æ ·åšï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">obj</span><span class="p">.</span><span class="n">normalize</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">normalize</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ—¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆäº‹ï¼Ÿå…¶ä¸­çš„Point3dï¼šï¼šnormalizeï¼ˆï¼‰å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p><strong>Memberçš„å„ç§è°ƒç”¨æ–¹å¼</strong></p>
<p>éžé™æ€æˆå‘˜å‡½æ•°</p>
<p>C++çš„è®¾è®¡å‡†åˆ™ä¹‹ä¸€å°±æ˜¯ï¼šnonstatic member function è‡³å°‘å¿…é¡»å’Œä¸€èˆ¬çš„nonmember functionæœ‰ç›¸åŒçš„æ•ˆçŽ‡ã€‚</p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ä¸¤ä¸ªå‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">float</span> <span class="nf">magnitude</span><span class="p">(</span><span class="k">const</span> <span class="n">Point3d</span> <span class="o">*</span><span class="n">_this</span><span class="p">){...}</span>
</span></span><span class="line"><span class="cl"><span class="kt">float</span> <span class="n">Point3d</span><span class="o">::</span><span class="n">magnitude</span><span class="p">(){...}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€‰æ‹©member functionä¸åº”è¯¥å¸¦æ¥ä»€ä¹ˆé¢å¤–è´Ÿæ‹…ã€‚è¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨å†…éƒ¨å·²å°†â€œmemberå‡½æ•°å®žä¾‹â€è½¬æ¢ä¸ºå¯¹ç­‰çš„â€œnonmemberå‡½æ•°å®žä¾‹â€ã€‚</p>
<p>ä¸‹é¢æ˜¯è½¬åŒ–æ­¥éª¤ï¼š</p>
<ol>
<li>
<p>æ”¹å†™å‡½æ•°çš„ signatureï¼ˆè¯‘æ³¨ï¼šæ„æŒ‡å‡½æ•°åŽŸåž‹ï¼‰ä»¥å®‰æ’ä¸€ä¸ªé¢å¤–çš„å‚æ•°åˆ°member functionä¸­ï¼Œç”¨ä»¥æä¾›ä¸€ä¸ªå­˜å–ç®¡é“ï¼Œä½¿ class objectå¾—ä»¥å°†æ­¤å‡½æ•°è°ƒç”¨ã€‚è¯¥é¢å¤–å‚æ•°è¢«ç§°ä¸º thisæŒ‡é’ˆï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">//non-const nonstatic memberçš„æ‰©å¼ è¿‡ç¨‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Point3d</span> <span class="n">Point3d</span><span class="o">::</span><span class="n">magnitude</span><span class="p">(</span><span class="n">Point3d</span> <span class="o">*</span><span class="k">const</span> <span class="k">this</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æžœmember functionæ˜¯constï¼Œåˆ™å˜æˆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">//non-const nonstatic memberçš„æ‰©å¼ è¿‡ç¨‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Point3d</span> <span class="n">Point3d</span><span class="o">::</span><span class="n">magnitude</span><span class="p">(</span><span class="k">const</span> <span class="n">Point3d</span> <span class="o">*</span><span class="k">const</span> <span class="k">this</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å°†æ¯ä¸€ä¸ªâ€œå¯¹ nonstatic data member çš„å­˜å–æ“ä½œâ€æ”¹ä¸ºç»ç”± thisæŒ‡é’ˆæ¥å­˜å–ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nf">sqrt</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">-&gt;</span><span class="n">_x</span> <span class="o">*</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">_x</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">         <span class="k">this</span><span class="o">-&gt;</span><span class="n">_y</span> <span class="o">*</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">_y</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">         <span class="k">this</span><span class="o">-&gt;</span><span class="n">_z</span> <span class="o">*</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">_z</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å°† member functioné‡æ–°å†™æˆä¸€ä¸ªå¤–éƒ¨å‡½æ•°ã€‚å°†å‡½æ•°åç§°ç»è¿‡â€œmanglingâ€å¤„ç†ï¼Œä½¿å®ƒåœ¨ç¨‹åºä¸­æˆä¸ºç‹¬ä¸€æ— äºŒçš„è¯­æ±‡ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">extern</span> <span class="nf">magnitude_7Point3dFv</span><span class="p">(</span> <span class="k">register</span> <span class="n">Point3d</span> <span class="o">*</span><span class="k">const</span> <span class="k">this</span> <span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>åç§°çš„ç‰¹æ®Šå¤„ç†</p>
<p>ä¸€èˆ¬è€Œè¨€ï¼Œmemberçš„åç§°å‰é¢ä¼šè¢«åŠ ä¸Šclassåç§°ï¼Œå½¢æˆç‹¬ä¸€æ— äºŒçš„å‘½åã€‚ä¾‹å¦‚ä¸‹é¢çš„å£°æ˜Žï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Bar</span> <span class="p">{</span><span class="k">public</span><span class="o">:</span><span class="kt">int</span> <span class="n">ival</span><span class="p">;...};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­çš„ivalæœ‰å¯èƒ½å˜æˆè¿™æ ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">//member ç»è¿‡name-manglingä¹‹åŽçš„å¯èƒ½ç»“æžœä¹‹ä¸€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">ival__3Bar</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é™æ€æˆå‘˜å‡½æ•°</p>
<h3 id="å…³äºŽtypedefçš„ç”¨æ³•æ€»ç»“">å…³äºŽtypedefçš„ç”¨æ³•æ€»ç»“</h3>
<p><a href="https://www.cnblogs.com/csyisong/archive/2009/01/09/1372363.html">https://www.cnblogs.com/csyisong/archive/2009/01/09/1372363.html</a></p>
<h3 id="-æ™ºèƒ½æŒ‡é’ˆ">âœ’ï¸ æ™ºèƒ½æŒ‡é’ˆ</h3>
<h4 id="unique_ptr">unique_ptr</h4>
<p><code>std::unique_ptr</code> æ˜¯é€šè¿‡æŒ‡é’ˆå æœ‰å¹¶ç®¡ç†å¦ä¸€å¯¹è±¡ï¼Œå¹¶åœ¨ <code>unique_ptr</code> ç¦»å¼€ä½œç”¨åŸŸæ—¶é‡Šæ”¾è¯¥å¯¹è±¡çš„æ™ºèƒ½æŒ‡é’ˆã€‚åœ¨ä¸‹åˆ—ä¸¤è€…ä¹‹ä¸€å‘ç”Ÿæ—¶ç”¨å…³è”çš„åˆ é™¤å™¨é‡Šæ”¾å¯¹è±¡ï¼š</p>
<ul>
<li>é”€æ¯äº†ç®¡ç†çš„ <code>unique_ptr</code> å¯¹è±¡</li>
<li>é€šè¿‡ <code>operator=</code> æˆ– <code>reset()</code> èµ‹å€¼å¦ä¸€æŒ‡é’ˆç»™ç®¡ç†çš„ <code>unique_ptr</code> å¯¹è±¡ã€‚</li>
</ul>
<h4 id="shared_ptr">shared_ptr</h4>
<p><code>std::shared_ptr</code> æ˜¯é€šè¿‡æŒ‡é’ˆä¿æŒå¯¹è±¡å…±äº«æ‰€æœ‰æƒçš„æ™ºèƒ½æŒ‡é’ˆã€‚å¤šä¸ª <code>shared_ptr</code> å¯¹è±¡å¯å æœ‰åŒä¸€å¯¹è±¡ã€‚ä¸‹åˆ—æƒ…å†µä¹‹ä¸€å‡ºçŽ°æ—¶é”€æ¯å¯¹è±¡å¹¶è§£åˆ†é…å…¶å†…å­˜ï¼š</p>
<ul>
<li>æœ€åŽå‰©ä¸‹çš„å æœ‰å¯¹è±¡çš„ <code>shared_ptr</code> è¢«é”€æ¯ï¼›</li>
<li>æœ€åŽå‰©ä¸‹çš„å æœ‰å¯¹è±¡çš„ <code>shared_ptr</code> è¢«é€šè¿‡ <code>operator=</code> æˆ– <code>reset()</code> èµ‹å€¼ä¸ºå¦ä¸€æŒ‡é’ˆã€‚</li>
</ul>
<p>æ¯æ¬¡åˆ›å»ºç±»çš„æ–°å¯¹è±¡æ—¶ï¼Œåˆå§‹åŒ–æŒ‡é’ˆå¹¶å°†å¼•ç”¨è®¡æ•°ç½®ä¸º1ï¼›å½“å¯¹è±¡ä½œä¸ºå¦ä¸€å¯¹è±¡çš„å‰¯æœ¬è€Œåˆ›å»ºæ—¶ï¼Œå¼•ç”¨è®¡æ•°åŠ 1ï¼›å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡Œèµ‹å€¼æ—¶ï¼Œèµ‹å€¼æ“ä½œç¬¦å‡å°‘å·¦æ“ä½œæ•°æ‰€æŒ‡å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼ˆå¦‚æžœå¼•ç”¨è®¡æ•°ä¸ºå‡è‡³0ï¼Œåˆ™åˆ é™¤å¯¹è±¡ï¼‰ï¼Œå¹¶å¢žåŠ å³æ“ä½œæ•°æ‰€æŒ‡å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼›è°ƒç”¨æžæž„å‡½æ•°æ—¶ï¼Œæž„é€ å‡½æ•°å‡å°‘å¼•ç”¨è®¡æ•°ï¼ˆå¦‚æžœå¼•ç”¨è®¡æ•°å‡è‡³0ï¼Œåˆ™åˆ é™¤åŸºç¡€å¯¹è±¡ï¼‰ã€‚</p>
<p><strong>shared_ptr</strong>çš„å†…å­˜æ¨¡åž‹ï¼š</p>
<p><img src="https://i.loli.net/2020/09/10/FICeMdSV9NlLza8.png" alt="å†…å­˜æ¨¡åž‹" /></p>
<p><strong>ä¸‹é¢æ˜¯ç”¨ç±»æ¨¡æ¿ç®€å•å®žçŽ°shared_ptr.</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SmartPointer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">T</span><span class="o">*</span> <span class="n">p_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">size_t</span><span class="o">*</span> <span class="n">count_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">SmartPointer</span><span class="p">(</span><span class="n">T</span><span class="o">*</span> <span class="n">ptr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">)</span> <span class="o">:</span> <span class="n">p_</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">p_</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">count_</span> <span class="o">=</span> <span class="k">new</span> <span class="n">size_t</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">count_</span> <span class="o">=</span> <span class="k">new</span> <span class="n">size_t</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">	<span class="n">SmartPointer</span><span class="p">(</span><span class="k">const</span> <span class="n">SmartPointer</span><span class="o">&amp;</span> <span class="n">ptr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">p_</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">.</span><span class="n">p_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">count_</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">.</span><span class="n">count_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="o">*</span><span class="n">count_</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">	<span class="n">SmartPointer</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">SmartPointer</span><span class="o">&amp;</span> <span class="n">ptr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">p_</span> <span class="o">==</span> <span class="n">ptr</span><span class="p">.</span><span class="n">p_</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">p_</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="p">(</span><span class="o">*</span><span class="n">count_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">delete</span> <span class="n">p_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="k">delete</span> <span class="n">count_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">		<span class="n">p_</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">.</span><span class="n">p_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">count_</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">.</span><span class="n">count_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="o">*</span><span class="n">count_</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">	<span class="o">~</span><span class="n">SmartPointer</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="p">(</span><span class="o">*</span><span class="n">count_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">delete</span> <span class="n">p_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">delete</span> <span class="n">count_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">	<span class="n">size_t</span> <span class="nf">use_count</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">*</span><span class="n">count_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">SmartPointer</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">sp1</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">SmartPointer</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">sp2</span><span class="p">(</span><span class="n">sp1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">SmartPointer</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">sp3</span><span class="p">(</span><span class="k">new</span> <span class="kt">int</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">sp2</span> <span class="o">=</span> <span class="n">sp3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">sp1</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">sp3</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ™ºèƒ½æŒ‡é’ˆå¸¦æ¥çš„æ€§èƒ½å½±å“:</p>
<p>1ï¼‰<code>shared_ptr</code>çš„å°ºå¯¸æ˜¯è£¸æŒ‡é’ˆçš„ä¸¤å€ã€‚</p>
<p>2ï¼‰ä¼šå¸¦æ¥æŽ§åˆ¶å—çš„å¼€é”€ã€‚</p>
<p>3ï¼‰å¼•ç”¨è®¡æ•°çš„é€’å¢žå’Œé€’å‡æ˜¯åŽŸå­æ“ä½œï¼ŒåŽŸå­æ“ä½œä¸€èˆ¬éƒ½æ¯”éžåŽŸå­æ“ä½œæ…¢ã€‚</p>
<h4 id="weak_ptr">weak_ptr</h4>
<p><code>weak_ptr</code> æ˜¯ä¸€ç§ä¸æŽ§åˆ¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„æ™ºèƒ½æŒ‡é’ˆ, å®ƒæŒ‡å‘ä¸€ä¸ª <code>shared_ptr</code> ç®¡ç†çš„å¯¹è±¡. è¿›è¡Œè¯¥å¯¹è±¡çš„å†…å­˜ç®¡ç†çš„æ˜¯é‚£ä¸ªå¼ºå¼•ç”¨çš„ <code>shared_ptr</code>. <code>weak_ptr</code>åªæ˜¯æä¾›äº†å¯¹ç®¡ç†å¯¹è±¡çš„ä¸€ä¸ªè®¿é—®æ‰‹æ®µã€‚<code>weak_ptr</code> è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºé…åˆ <code>shared_ptr</code> è€Œå¼•å…¥çš„ä¸€ç§æ™ºèƒ½æŒ‡é’ˆæ¥ååŠ© <code>shared_ptr</code> å·¥ä½œ, å®ƒåªå¯ä»¥ä»Žä¸€ä¸ª <code>shared_ptr</code> æˆ–å¦ä¸€ä¸ª <code>weak_ptr</code> å¯¹è±¡æž„é€ , å®ƒçš„æž„é€ å’Œæžæž„ä¸ä¼šå¼•èµ·å¼•ç”¨è®°æ•°çš„å¢žåŠ æˆ–å‡å°‘ã€‚<code>weak_ptr</code>æ˜¯ç”¨æ¥è§£å†³<code>shared_ptr</code>ç›¸äº’å¼•ç”¨æ—¶çš„æ­»é”é—®é¢˜,å¦‚æžœè¯´ä¸¤ä¸ª<code>shared_ptr</code>ç›¸äº’å¼•ç”¨,é‚£ä¹ˆè¿™ä¸¤ä¸ªæŒ‡é’ˆçš„å¼•ç”¨è®¡æ•°æ°¸è¿œä¸å¯èƒ½ä¸‹é™ä¸º0,èµ„æºæ°¸è¿œä¸ä¼šé‡Šæ”¾ã€‚å®ƒæ˜¯å¯¹å¯¹è±¡çš„ä¸€ç§å¼±å¼•ç”¨ï¼Œä¸ä¼šå¢žåŠ å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œå’Œ<code>shared_ptr</code>ä¹‹é—´å¯ä»¥ç›¸äº’è½¬åŒ–ï¼Œ<code>shared_ptr</code>å¯ä»¥ç›´æŽ¥èµ‹å€¼ç»™å®ƒï¼Œå®ƒå¯ä»¥é€šè¿‡è°ƒç”¨lockå‡½æ•°æ¥èŽ·å¾—<code>shared_ptr</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;memory&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">A</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">weak_ptr</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span> <span class="n">pb_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">A</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;A delete</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">B</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="n">pa_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">~</span><span class="n">B</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;B delete</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">fun</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span> <span class="n">pb</span><span class="p">(</span><span class="k">new</span> <span class="n">B</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="n">pa</span><span class="p">(</span><span class="k">new</span> <span class="n">A</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="n">pb</span><span class="o">-&gt;</span><span class="n">pa_</span> <span class="o">=</span> <span class="n">pa</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">pa</span><span class="o">-&gt;</span><span class="n">pb_</span> <span class="o">=</span> <span class="n">pb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pb</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">pa</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">fun</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>æ³¨æ„çš„æ˜¯æˆ‘ä»¬ä¸èƒ½é€šè¿‡weak_ptrç›´æŽ¥è®¿é—®å¯¹è±¡çš„æ–¹æ³•ï¼Œæ¯”å¦‚Bå¯¹è±¡ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•print(),æˆ‘ä»¬ä¸èƒ½è¿™æ ·è®¿é—®ï¼Œpa-&gt;pb_-&gt;print(); è‹±æ–‡pb_æ˜¯ä¸€ä¸ªweak_ptrï¼Œåº”è¯¥å…ˆæŠŠå®ƒè½¬åŒ–ä¸ºshared_ptr,å¦‚ï¼šshared_ptr p = pa-&gt;pb_.lock(); p-&gt;print();</p>
</blockquote>
<h4 id="å¤šçº¿ç¨‹è¯»å†™shared_ptréœ€è¦åŠ é”">å¤šçº¿ç¨‹è¯»å†™<code>shared_ptr</code>éœ€è¦åŠ é”</h4>
<p>åœ¨çŽ°ä»£C++ä¸­ï¼Œé€šè¿‡ä½¿ç”¨<code>shared_ptr</code>è¿™æ ·çš„æ™ºèƒ½æŒ‡é’ˆèƒ½å¤Ÿå¾ˆå¥½çš„é™ä½Žå†…å­˜æ³„æ¼çš„å¯èƒ½æ€§ï¼Œä½†æ˜¯åœ¨å¤šçº¿ç¨‹ä¸­æ— ä¿æŠ¤çš„è¯»å†™<code>shared_ptr</code>åˆ™æœ‰å¯èƒ½å¸¦æ¥race conditionçš„æƒ…å†µã€‚</p>
<blockquote>
<p>ç«žäº‰å±å®³ (race hazard) åˆå<a href="https://baike.baidu.com/item/%E7%AB%9E%E6%80%81%E6%9D%A1%E4%BB%B6/1321097">ç«žæ€æ¡ä»¶</a> (race condition)ã€‚æ—¨åœ¨æè¿°ä¸€ä¸ªç³»ç»Ÿæˆ–è€…è¿›ç¨‹çš„è¾“å‡ºå±•çŽ°æ— æ³•é¢„æµ‹çš„ã€å¯¹äº‹ä»¶é—´ç›¸å¯¹æ—¶é—´çš„æŽ’åˆ—é¡ºåºçš„è‡´å‘½ç›¸ä¾æ€§ã€‚</p>
</blockquote>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://blog.csdn.net/i_chaoren/article/details/82586456">C++11&ndash;æ™ºèƒ½æŒ‡é’ˆè¯¦è§£åŠå®žçŽ°</a></li>
<li><a href="https://originlee.com/2015/05/22/read-write-in-mutithread-need-lock/">å¤šçº¿ç¨‹è¯»å†™shared_ptréœ€è¦åŠ é”</a></li>
</ol>
<p><strong>é‡ŽæŒ‡é’ˆ</strong></p>
<p>é‡ŽæŒ‡é’ˆå°±æ˜¯æŒ‡å‘ä¸€ä¸ªå·²åˆ é™¤çš„å¯¹è±¡æˆ–è€…æœªç”³è¯·è®¿é—®å—é™å†…å­˜åŒºåŸŸçš„æŒ‡é’ˆ</p>
<h1 id="cå†…å­˜ç®¡ç†ä¸Žç¨‹åºå†…å­˜åˆ†åŒº">C++å†…å­˜ç®¡ç†ä¸Žç¨‹åºå†…å­˜åˆ†åŒº</h1>
<h2 id="cå†…å­˜åˆ†åŒº">C++å†…å­˜åˆ†åŒº</h2>
<p>C++å­˜åœ¨å¦‚ä¸‹çš„å†…å­˜åˆ†åŒº</p>
<p>1ï¼‰æ ˆåŒºï¼ˆstackï¼‰ï¼šç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…é‡Šæ”¾ ï¼Œå­˜æ”¾å‡½æ•°çš„ å‚æ•°å€¼ï¼Œå±€éƒ¨å˜é‡çš„å€¼ç­‰ã€‚å…¶æ“ä½œæ–¹å¼ç±»ä¼¼äºŽæ•°æ®ç»“ æž„ä¸­çš„æ ˆã€‚</p>
<p>2ï¼‰å †åŒºï¼ˆheapï¼‰ï¼šä¸€èˆ¬ç”±ç¨‹åºå‘˜åˆ†é…é‡Šæ”¾ï¼Œè‹¥ç¨‹åºå‘˜ä¸ é‡Šæ”¾ï¼Œç¨‹åºç»“æŸæ—¶å¯èƒ½ç”±OSå›žæ”¶ã€‚æ³¨æ„å®ƒä¸Žæ•°æ®ç»“æž„ ä¸­çš„å †æ˜¯ä¸¤å›žäº‹ï¼Œåˆ†é…æ–¹å¼å€’æ˜¯ç±»ä¼¼äºŽé“¾è¡¨ã€‚</p>
<p>3ï¼‰å…¨å±€/é™æ€åŒº(staticï¼‰ï¼šå…¨å±€å˜é‡å’Œé™æ€å˜é‡çš„å­˜å‚¨æ˜¯ æ”¾åœ¨ä¸€å—çš„ï¼Œåœ¨ç¨‹åºç¼–è¯‘æ—¶åˆ†é…</p>
<p>4ï¼‰æ–‡å­—å¸¸é‡åŒºï¼šå­˜æ”¾å¸¸é‡å­—ç¬¦ä¸²</p>
<p>5ï¼‰ç¨‹åºä»£ç åŒºï¼šå­˜æ”¾å‡½æ•°ä½“ï¼ˆç±»çš„æˆå‘˜å‡½æ•°ã€å…¨å±€å‡½æ•°ï¼‰ çš„äºŒè¿›åˆ¶ä»£ç </p>
<p>Cè¯­è¨€ä¸­ï¼Œå†…å­˜åˆ†é…æœ‰ä¸‰ç§ï¼š</p>
<ol>
<li>é™æ€åŒºåŸŸåˆ†é…ï¼šç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…ä¸Žé‡Šæ”¾ï¼Œå†…å­˜åœ¨ç¼–è¯‘çš„æ—¶å€™å·²ç»åˆ†é…å¥½ï¼Œè¿™å—å†…å­˜åœ¨æ•´ä¸ªç¨‹åºçš„è¿è¡ŒæœŸé—´éƒ½å­˜åœ¨ç›´åˆ°ç¨‹åºç»“æŸæ—¶æ‰è¢«é‡Šæ”¾ï¼Œå¦‚å…¨å±€å˜é‡ä¸Žstaticå˜é‡ã€‚</li>
<li>æ ˆåˆ†é…ï¼šç”±ç¼–è¯‘å™¨åœ¨ç¨‹åºè¿è¡Œæ—¶ä»Žæ ˆä¸Šåˆ†é…ï¼Œå‡½æ•°æ ˆé€€å‡ºæ—¶è‡ªåŠ¨é‡Šæ”¾ã€‚æ ˆåˆ†é…çš„è¿ç®—åœ¨å¤„ç†å™¨çš„æŒ‡ä»¤é›†ä¸­ï¼Œæ‰€ä»¥å®ƒçš„è¿è¡Œæ•ˆçŽ‡å¾ˆé«˜ï¼Œä½†èƒ½åˆ†é…çš„å†…å®¹æ˜¯æœ‰é™çš„ã€‚</li>
<li>å †åˆ†é…ï¼šæœ‰ç¨‹åºå‘˜ä¸»åŠ¨è°ƒç”¨å†…å­˜åˆ†é…å‡½æ•°æ¥ç”³è¯·å†…å­˜ï¼Œä¸”ä½¿ç”¨å®Œæ¯•åŽç”±ç¨‹åºå‘˜è‡ªå·±é‡Šæ”¾ï¼Œå…¶ä½¿ç”¨éžå¸¸çµæ´»ï¼Œä½†å…¶åˆ†é…æ–¹å¼æ˜¯é€šè¿‡è°ƒç”¨å‡½æ•°æ¥å®žçŽ°ï¼Œæ•ˆçŽ‡æ²¡æ ˆé«˜ã€‚<code>malloc</code>,<code>alloc</code>ç­‰</li>
</ol>
<h2 id="ç¨‹åºåœ¨å†…å­˜ä¸­çš„åˆ†å¸ƒ">ç¨‹åºåœ¨å†…å­˜ä¸­çš„åˆ†å¸ƒ</h2>
<p><img src="https://i.loli.net/2020/09/10/g2xFw8PycTqzplY.png" alt="ç¨‹åºå†…å­˜åˆ†åŒº" /></p>
<p>ä¸­æ–‡ç‰ˆ</p>
<p><img src="eM8XiqRdGhFOnzb.jpg" alt="å†…å­˜åˆ†åŒº" /></p>
<ol>
<li>
<p>å†…æ ¸ç©ºé—´</p>
</li>
<li>
<p>æ ˆ</p>
<p>1ã€stackå­˜æ”¾å‡½æ•°çš„ä¸´æ—¶å˜é‡ã€å±€éƒ¨å˜é‡ã€å‡½æ•°å‚æ•°å’Œè¿”å›žå€¼<br />
2ã€ç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…å’Œé‡Šæ”¾ã€‚</p>
</li>
<li>
<p>åŠ¨æ€é“¾æŽ¥åº“(å…±äº«æ˜ å°„åŒº)</p>
<p>è°ƒç”¨çš„åº“æ–‡ä»¶ï¼Œä½äºŽå †å’Œæ ˆä¹‹é—´</p>
</li>
<li>
<p>å †</p>
<p>heapç”¨æ¥åŠ¨æ€åˆ†é…å†…å­˜ï¼Œç”±ç¨‹åºå‘˜æŽ§åˆ¶ï¼Œäº¤ç”±ç¨‹åºè‡ªèº«å†³å®šå¼€è¾Ÿå’Œé‡Šæ”¾ã€‚</p>
</li>
<li>
<p>å…¨å±€æ•°æ®åŒº</p>
<p><code>.bss</code></p>
<p><code>bss</code>æ®µç”¨æ¥å­˜æ”¾æ²¡æœ‰è¢«åˆå§‹åŒ–å’Œå·²ç»è¢«åˆå§‹åŒ–ä¸º0çš„å…¨å±€å˜é‡</p>
<p><code>.data</code></p>
<p><code>data</code>æ®µç”¨æ¥å­˜æ”¾å·²ç»è¢«åˆå§‹åŒ–ä¸ºéž0çš„å…¨å±€å˜é‡</p>
</li>
<li>
<p>å¸¸é‡åŒº</p>
<p><code>.rodata</code></p>
<p><code>rodata</code>æ®µç”¨æ¥å­˜æ”¾å¸¸é‡æ•°æ®ã€è¢«ç¼–è¯‘å™¨è‡ªåŠ¨å­˜æ”¾æ¥çš„å­—ç¬¦ä¸²å’ŒåŠ <code>const</code>å…³é”®å­—çš„å¸¸é‡æ•°æ®ã€‚</p>
</li>
<li>
<p>ä»£ç åŒº</p>
<p><code>.text</code></p>
<p><code>text</code>æ®µç”¨æ¥å­˜æ”¾ä»£ç å’Œéƒ¨åˆ†æ•´æ•°å¸¸é‡ï¼Œè¯¥æ®µæ˜¯å¯æ‰§è¡Œçš„ã€‚</p>
</li>
</ol>
<h3 id="å †ä¸Žæ ˆ">å †ä¸Žæ ˆ</h3>
<p>æ ˆæ˜¯ä¸€ç§çš„â€œå…ˆè¿›åŽå‡ºâ€çš„å­˜å‚¨ç»“æž„ã€‚</p>
<p>å †æ˜¯ä¸€ç§å®Œå…¨äºŒå‰æ ‘ã€‚èŠ‚ç‚¹ä»Žå·¦åˆ°å³å¡«æ»¡ï¼Œæœ€åŽä¸€å±‚çš„æ ‘å¶éƒ½åœ¨æœ€å·¦è¾¹ã€‚ï¼ˆå³å¦‚æžœä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰å·¦è¾¹å„¿å­ï¼Œé‚£ä¹ˆå®ƒä¸€å®šæ²¡æœ‰å³è¾¹å„¿å­ï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å°äºŽï¼ˆæˆ–è€…å¤§äºŽï¼‰å…¶å­èŠ‚ç‚¹çš„å€¼ï¼ˆå¤§é¡¶å †ã€å°é¡¶å †ï¼‰ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯å¯ä»¥ä½¿ç”¨ä¸€ç»´æ•°ç»„æ¥è¡¨ç¤ºã€‚å †çš„æ“ä½œä¹Ÿå¯é€šè¿‡æ•°æ®å…ƒç´ äº¤æ¢çš„å½¢å¼è§£å†³ï¼Œéžå¸¸é€‚åˆå†…å­˜ç©ºé—´çº¿æ€§çš„ç‰¹ç‚¹ã€‚</p>
<hr />
<p>å‚è€ƒåœ°å€</p>
<ol>
<li><a href="https://www.cnblogs.com/Lynn-Zhang/p/5449199.html">ç¨‹åºåœ¨å†…å­˜ä¸­çš„åˆ†å¸ƒ</a></li>
<li><a href="http://baijiahao.baidu.com/s?id=1664957369973450228&amp;wfr=spider&amp;for=pc">http://baijiahao.baidu.com/s?id=1664957369973450228&amp;wfr=spider&amp;for=pc</a></li>
</ol>
<h1 id="cå†…å­˜æ³„æ¼">C++å†…å­˜æ³„æ¼</h1>
<blockquote>
<p>ç³»ç»Ÿèµ„æºæ³„éœ²ï¼ˆResource Leakï¼‰ã€‚ä¸»è¦æŒ‡ç¨‹åºä½¿ç”¨ç³»ç»Ÿåˆ†é…çš„èµ„æºæ¯”å¦‚ Bitmap,handle ,SOCKETç­‰æ²¡æœ‰ä½¿ç”¨ç›¸åº”çš„å‡½æ•°é‡Šæ”¾æŽ‰ï¼Œå¯¼è‡´ç³»ç»Ÿèµ„æºçš„æµªè´¹ï¼Œä¸¥é‡å¯å¯¼è‡´ç³»ç»Ÿæ•ˆèƒ½é™ä½Žï¼Œç³»ç»Ÿè¿è¡Œä¸ç¨³å®šã€‚</p>
</blockquote>
<h2 id="å†…å­˜æ³„æ¼">å†…å­˜æ³„æ¼</h2>
<p>å†…å­˜æ³„æ¼æŒ‡ç”±äºŽç–å¿½æˆ–é”™è¯¯é€ æˆç¨‹åºæœªèƒ½é‡Šæ”¾å·²ç»ä¸å†ä½¿ç”¨çš„å†…å­˜çš„æƒ…å†µ</p>
<h3 id="æ£€æµ‹å†…å­˜æ³„æ¼çš„åŽŸç†">æ£€æµ‹å†…å­˜æ³„æ¼çš„åŽŸç†</h3>
<p>ä¸»è¦è¿˜æ˜¯è¿ç”¨äºŒè¿›åˆ¶æ’æ¡©ï¼Œè®°å½•èµ„æºçš„ç”³è¯·å’Œé‡Šæ”¾æ“ä½œï¼Œç„¶åŽå¯¹è®°å½•è¿›è¡ŒåŒ¹é…å‰”é™¤ï¼Œæœ€åŽå°±æ˜¯å‰©ä¸‹çš„æ³„æ¼çš„äº†ã€‚</p>
<h2 id="æ£€æµ‹æ–¹æ³•">æ£€æµ‹æ–¹æ³•</h2>
<h3 id="æœ€ç®€å•çš„">æœ€ç®€å•çš„</h3>
<p><strong>åœ¨æ¯ä¸€å¤„ç”³è¯·/é‡Šæ”¾å†…å­˜çš„åœ°æ–¹è¿›è¡Œæ‰“ç‚¹ï¼Œç„¶åŽåŒ¹å¯¹ä¸€ä¸‹å°±çŸ¥é“å“ªé‡Œå†…å­˜æ³„éœ²äº†ã€‚</strong></p>
<h2 id="windowså¹³å°ä¸‹çš„å†…å­˜æ³„æ¼æ£€æµ‹">Windowså¹³å°ä¸‹çš„å†…å­˜æ³„æ¼æ£€æµ‹</h2>
<p>Windowså¹³å°ä¸‹é¢Visual Studio è°ƒè¯•å™¨å’Œ C è¿è¡Œæ—¶ (CRT) åº“ä¸ºæˆ‘ä»¬æä¾›äº†æ£€æµ‹å’Œè¯†åˆ«å†…å­˜æ³„æ¼çš„æœ‰æ•ˆæ–¹æ³•ï¼ŒåŽŸç†å¤§è‡´å¦‚ä¸‹ï¼šå†…å­˜åˆ†é…è¦é€šè¿‡CRTåœ¨è¿è¡Œæ—¶å®žçŽ°ï¼Œåªè¦åœ¨åˆ†é…å†…å­˜å’Œé‡Šæ”¾å†…å­˜æ—¶åˆ†åˆ«åšå¥½è®°å½•ï¼Œç¨‹åºç»“æŸæ—¶å¯¹æ¯”åˆ†é…å†…å­˜å’Œé‡Šæ”¾å†…å­˜çš„è®°å½•å°±å¯ä»¥ç¡®å®šæ˜¯ä¸æ˜¯æœ‰å†…å­˜æ³„æ¼ã€‚åœ¨vsä¸­å¯ç”¨å†…å­˜æ£€æµ‹çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>åœ¨ç¨‹åºä¸­åŒ…æ‹¬ä»¥ä¸‹è¯­å¥ï¼š ï¼ˆ#include è¯­å¥å¿…é¡»é‡‡ç”¨ä¸Šæ–‡æ‰€ç¤ºé¡ºåºã€‚ å¦‚æžœæ›´æ”¹äº†é¡ºåºï¼Œæ‰€ä½¿ç”¨çš„å‡½æ•°å¯èƒ½æ— æ³•æ­£å¸¸å·¥ä½œã€‚ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define _CRTDBG_MAP_ALLOC
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;crtdbg.h&gt;</span><span class="cp">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>é€šè¿‡åŒ…æ‹¬ crtdbg.hï¼Œå°† <a href="http://msdn.microsoft.com/zh-cn/library/6ewkz86d.aspx">malloc</a> å’Œ <a href="http://msdn.microsoft.com/zh-cn/library/we1whae7.aspx">free</a> å‡½æ•°æ˜ å°„åˆ°å®ƒä»¬çš„è°ƒè¯•ç‰ˆæœ¬ï¼Œå³ <a href="http://msdn.microsoft.com/zh-cn/library/faz3a37z.aspx">_malloc_dbg</a> å’Œ <a href="http://msdn.microsoft.com/zh-cn/library/16swbsbc.aspx">_free_dbg</a>ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°å°†è·Ÿè¸ªå†…å­˜åˆ†é…å’Œé‡Šæ”¾ã€‚ æ­¤æ˜ å°„åªåœ¨è°ƒè¯•ç‰ˆæœ¬ï¼ˆåœ¨å…¶ä¸­å®šä¹‰äº†**_DEBUG**ï¼‰ä¸­å‘ç”Ÿã€‚ å‘å¸ƒç‰ˆæœ¬ä½¿ç”¨æ™®é€šçš„ <strong>malloc</strong> å’Œ <strong>free</strong> å‡½æ•°ã€‚</p>
</blockquote>
<p>#define è¯­å¥å°† CRT å †å‡½æ•°çš„åŸºç‰ˆæœ¬æ˜ å°„åˆ°å¯¹åº”çš„â€œDebugâ€ç‰ˆæœ¬ã€‚ å¹¶éžç»å¯¹éœ€è¦è¯¥è¯­å¥ï¼›ä½†å¦‚æžœæ²¡æœ‰è¯¥è¯­å¥ï¼Œå†…å­˜æ³„æ¼è½¬å‚¨åŒ…å«çš„æœ‰ç”¨ä¿¡æ¯å°†è¾ƒå°‘ã€‚</p>
</li>
<li>
<p>åœ¨æ·»åŠ äº†ä¸Šè¿°è¯­å¥ä¹‹åŽï¼Œå¯ä»¥é€šè¿‡åœ¨ç¨‹åºä¸­åŒ…æ‹¬ä»¥ä¸‹è¯­å¥ï¼ˆé€šå¸¸åº”æ°å¥½æ”¾åœ¨ç¨‹åºé€€å‡ºä½ç½®ä¹‹å‰ï¼‰æ¥è½¬å‚¨å†…å­˜æ³„æ¼ä¿¡æ¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="nf">_CrtDumpMemoryLeaks</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://i.loli.net/2020/09/08/2m8Vo4Cv9utNkYH.png" alt="ç»“æžœ" /></p>
<p>å¦‚æžœæ²¡æœ‰ä½¿ç”¨ #define _CRTDBG_MAP_ALLOC è¯­å¥ï¼Œå†…å­˜æ³„æ¼è½¬å‚¨å°†å¦‚ä¸‹æ‰€ç¤º</p>
<p><img src="https://i.loli.net/2020/09/08/gN3w1bf8QrokKZa.png" alt="image-20200908101606289" /></p>
<blockquote>
<p>æœªå®šä¹‰ _CRTDBG_MAP_ALLOC æ—¶ï¼Œæ‰€æ˜¾ç¤ºçš„ä¼šæ˜¯ï¼š</p>
<ul>
<li>å†…å­˜åˆ†é…ç¼–å·ï¼ˆåœ¨å¤§æ‹¬å·å†…ï¼‰ã€‚</li>
<li><a href="http://msdn.microsoft.com/zh-cn/library/htdyz80k.aspx">å—ç±»åž‹</a>ï¼ˆæ™®é€šã€å®¢æˆ·ç«¯æˆ– CRTï¼‰ã€‚</li>
</ul>
</blockquote>
</li>
<li>
<p>å®šä½åˆ°å…·ä½“çš„ä½ç½®</p>
</li>
</ol>
<p>æœ€ç»ˆå®šä½ä»£ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define _CRTDBG_MAP_ALLOC
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;crtdbg.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span> 
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">using</span> <span class="n">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="n">_CrtMemState</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">GetMemory</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="nf">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span> <span class="o">*</span> <span class="n">num</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span><span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_CrtMemCheckpoint</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">s1</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">GetMemory</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_CrtMemCheckpoint</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">s2</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span> <span class="nf">_CrtMemDifference</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">s3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s2</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nf">_CrtMemDumpStatistics</span><span class="p">(</span> <span class="o">&amp;</span><span class="n">s3</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;Memory leak test!&#34;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">_CrtDumpMemoryLeaks</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://i.loli.net/2020/09/08/4qnMckJ8ydCVwoe.png" alt="image-20200908101909957" /></p>
<h3 id="linuxå¹³å°ä¸‹çš„å†…å­˜æ³„æ¼æ£€æµ‹">Linuxå¹³å°ä¸‹çš„å†…å­˜æ³„æ¼æ£€æµ‹</h3>
<p>Valgrindæ˜¯ä¸€å¥—Linuxä¸‹ï¼Œå¼€æ”¾æºä»£ç ï¼ˆGPL V2ï¼‰çš„ä»¿çœŸè°ƒè¯•å·¥å…·çš„é›†åˆã€‚Valgrindç”±å†…æ ¸ï¼ˆcoreï¼‰ä»¥åŠåŸºäºŽå†…æ ¸çš„å…¶ä»–è°ƒè¯•å·¥å…·ç»„æˆã€‚å†…æ ¸ç±»ä¼¼äºŽä¸€ä¸ªæ¡†æž¶ï¼ˆframeworkï¼‰ï¼Œå®ƒæ¨¡æ‹Ÿäº†ä¸€ä¸ªCPUçŽ¯å¢ƒï¼Œå¹¶æä¾›æœåŠ¡ç»™å…¶ä»–å·¥å…·ï¼›è€Œå…¶ä»–å·¥å…·åˆ™ç±»ä¼¼äºŽæ’ä»¶ (plug-in)ï¼Œåˆ©ç”¨å†…æ ¸æä¾›çš„æœåŠ¡å®Œæˆå„ç§ç‰¹å®šçš„å†…å­˜è°ƒè¯•ä»»åŠ¡ã€‚Valgrindçš„ä½“ç³»ç»“æž„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://i.loli.net/2020/09/08/MQ2pqTxZPFWjKvc.jpg" alt="img" /></p>
<hr />
<p>å‚è€ƒé“¾æŽ¥ï¼š</p>
<ol>
<li><a href="https://www.cnblogs.com/skynet/archive/2011/02/20/1959162.html">C/C++å†…å­˜æ³„æ¼åŠæ£€æµ‹</a></li>
<li></li>
</ol>
<h1 id="cå‡½æ•°æŒ‡é’ˆ">C++å‡½æ•°æŒ‡é’ˆ</h1>
<p>å‡½æ•°æŒ‡é’ˆæ˜¯æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆå˜é‡ã€‚</p>
<p><code>æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆå˜é‡</code>çš„ä¸€èˆ¬å®šä¹‰å½¢å¼ä¸ºï¼š æ•°æ®ç±»åž‹ (*æŒ‡é’ˆå˜é‡å)(å‚æ•°è¡¨);</p>
<p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/405a81d8e7b4">C++å‡½æ•°æŒ‡é’ˆè¯¦è§£</a></p>
<h1 id="mallocçš„åŽŸç†">mallocçš„åŽŸç†</h1>
<p><code>Malloc</code>å‡½æ•°ç”¨äºŽåŠ¨æ€åˆ†é…å†…å­˜ã€‚ä¸ºäº†å‡å°‘å†…å­˜ç¢Žç‰‡å’Œç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ï¼Œ<code>malloc</code>å…¶é‡‡ç”¨å†…å­˜æ± çš„æ–¹å¼ï¼Œå…ˆç”³è¯·å¤§å—å†…å­˜ä½œä¸ºå †åŒºï¼Œç„¶åŽå°†å †åŒºåˆ†ä¸ºå¤šä¸ªå†…å­˜å—ï¼Œä»¥å—ä½œä¸ºå†…å­˜ç®¡ç†çš„åŸºæœ¬å•ä½ã€‚å½“ç”¨æˆ·ç”³è¯·å†…å­˜æ—¶ï¼Œç›´æŽ¥ä»Žå †åŒºåˆ†é…ä¸€å—åˆé€‚çš„ç©ºé—²å—ã€‚<code>Malloc</code>é‡‡ç”¨éšå¼é“¾è¡¨ç»“æž„å°†å †åŒºåˆ†æˆè¿žç»­çš„ã€å¤§å°ä¸ä¸€çš„å—ï¼ŒåŒ…å«å·²åˆ†é…å—å’Œæœªåˆ†é…å—ï¼›åŒæ—¶<code>malloc</code>é‡‡ç”¨æ˜¾ç¤ºé“¾è¡¨ç»“æž„æ¥ç®¡ç†æ‰€æœ‰çš„ç©ºé—²å—ï¼Œå³ä½¿ç”¨ä¸€ä¸ªåŒå‘é“¾è¡¨å°†ç©ºé—²å—è¿žæŽ¥èµ·æ¥ï¼Œæ¯ä¸€ä¸ªç©ºé—²å—è®°å½•äº†ä¸€ä¸ªè¿žç»­çš„ã€æœªåˆ†é…çš„åœ°å€ã€‚å½“è¿›è¡Œå†…å­˜åˆ†é…æ—¶ï¼Œ<code>Malloc</code>ä¼šé€šè¿‡éšå¼é“¾è¡¨éåŽ†æ‰€æœ‰çš„ç©ºé—²å—ï¼Œé€‰æ‹©æ»¡è¶³è¦æ±‚çš„å—è¿›è¡Œåˆ†é…ï¼›å½“è¿›è¡Œå†…å­˜åˆå¹¶æ—¶ï¼Œ<code>malloc</code>é‡‡ç”¨è¾¹ç•Œæ ‡è®°æ³•ï¼Œæ ¹æ®æ¯ä¸ªå—çš„å‰åŽå—æ˜¯å¦å·²ç»åˆ†é…æ¥å†³å®šæ˜¯å¦è¿›è¡Œå—åˆå¹¶ã€‚</p>
<p><strong><code>Malloc</code>åœ¨ç”³è¯·å†…å­˜æ—¶ï¼Œä¸€èˆ¬ä¼šé€šè¿‡<code>brk</code>æˆ–è€…<code>mmap</code>ç³»ç»Ÿè°ƒç”¨è¿›è¡Œç”³è¯·ã€‚å…¶ä¸­å½“ç”³è¯·å†…å­˜å°äºŽ<code>128K</code>æ—¶ï¼Œä¼šä½¿ç”¨ç³»ç»Ÿå‡½æ•°<code>brk</code>åœ¨å †åŒºä¸­åˆ†é…ï¼›è€Œå½“ç”³è¯·å†…å­˜å¤§äºŽ<code>128K</code>æ—¶ï¼Œä¼šä½¿ç”¨ç³»ç»Ÿå‡½æ•°<code>mmap</code>åœ¨æ˜ å°„åŒºåˆ†é…ã€‚</strong></p>
<h1 id="cæ¨¡æ¿">C++æ¨¡æ¿</h1>
<p><a href="https://www.cnblogs.com/gw811/archive/2012/10/25/2738929.html">https://www.cnblogs.com/gw811/archive/2012/10/25/2738929.html</a></p>
<p>æ¨¡æ¿æ˜¯ä¸€ç§å¯¹ç±»åž‹è¿›è¡Œå‚æ•°åŒ–çš„å·¥å…·ï¼›é€šå¸¸æœ‰ä¸¤ç§å½¢å¼ï¼šå‡½æ•°æ¨¡æ¿å’Œç±»æ¨¡æ¿ï¼›å‡½æ•°æ¨¡æ¿é’ˆå¯¹ä»…å‚æ•°ç±»åž‹ä¸åŒçš„å‡½æ•°ï¼›ç±»æ¨¡æ¿é’ˆå¯¹ä»…æ•°æ®æˆå‘˜å’Œæˆå‘˜å‡½æ•°ç±»åž‹ä¸åŒçš„ç±»ã€‚</p>
<h2 id="å‡½æ•°æ¨¡æ¿">å‡½æ•°æ¨¡æ¿</h2>
<h4 id="å‡½æ•°æ¨¡æ¿æ ¼å¼">å‡½æ•°æ¨¡æ¿æ ¼å¼</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="err">ã€€</span><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">å½¢å‚åï¼Œ</span><span class="nc">class</span> <span class="err">å½¢å‚åï¼Œ</span><span class="p">......</span><span class="o">&gt;</span> <span class="err">è¿”å›žç±»åž‹</span> <span class="err">å‡½æ•°å</span><span class="p">(</span><span class="err">å‚æ•°åˆ—è¡¨</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">ã€€ã€€ã€€</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="err">ã€€ã€€ã€€ã€€ã€€ã€€å‡½æ•°ä½“</span>
</span></span><span class="line"><span class="cl"><span class="err">ã€€ã€€ã€€</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å…¶ä¸­<strong>template</strong>å’Œ<strong>class</strong>æ˜¯å…³è§å­—ï¼Œ<strong>class</strong>å¯ä»¥ç”¨<strong>typename</strong> å…³è§å­—ä»£æ›¿ï¼Œåœ¨è¿™é‡Œ<strong>typename å’Œclassæ²¡åŒºåˆ«</strong></p>
</blockquote>
<h2 id="ç±»æ¨¡æ¿">ç±»æ¨¡æ¿</h2>
<h4 id="ç±»æ¨¡æ¿æ ¼å¼">ç±»æ¨¡æ¿æ ¼å¼</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span>  <span class="err">å½¢å‚åï¼Œ</span><span class="nc">class</span> <span class="err">å½¢å‚åï¼Œâ€¦</span><span class="o">&gt;</span>   <span class="k">class</span> <span class="err">ç±»å</span>
</span></span><span class="line"><span class="cl"><span class="err">ã€€ã€€ã€€ã€€</span><span class="p">{</span> <span class="p">...</span> <span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç±»æ¨¡æ¿å¯¹è±¡çš„åˆ›å»º</p>
<p>æ¯”å¦‚ä¸€ä¸ªæ¨¡æ¿ç±»Aï¼Œåˆ™ä½¿ç”¨ç±»æ¨¡æ¿åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ä¸ºA<int> m;åœ¨ç±»AåŽé¢è·Ÿä¸Šä¸€ä¸ª&lt;&gt;å°–æ‹¬å·å¹¶åœ¨é‡Œé¢å¡«ä¸Šç›¸åº”çš„ç±»åž‹ï¼Œè¿™æ ·çš„è¯ç±»Aä¸­å‡¡æ˜¯ç”¨åˆ°æ¨¡æ¿å½¢å‚çš„åœ°æ–¹éƒ½ä¼šè¢«int æ‰€ä»£æ›¿ã€‚å½“ç±»æ¨¡æ¿æœ‰ä¸¤ä¸ªæ¨¡æ¿å½¢å‚æ—¶åˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ä¸ºA&lt;int, double&gt; m;ç±»åž‹ä¹‹é—´ç”¨é€—å·éš”å¼€ã€‚</p>
<p>åœ¨ç±»æ¨¡æ¿å¤–éƒ¨å®šä¹‰æˆå‘˜å‡½æ•°çš„æ–¹æ³•ä¸ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="err">æ¨¡æ¿å½¢å‚åˆ—è¡¨</span><span class="o">&gt;</span> <span class="err">å‡½æ•°è¿”å›žç±»åž‹</span> <span class="err">ç±»å</span><span class="o">&lt;</span><span class="err">æ¨¡æ¿å½¢å‚å</span><span class="o">&gt;::</span><span class="err">å‡½æ•°å</span><span class="p">(</span><span class="err">å‚æ•°åˆ—è¡¨</span><span class="p">){</span><span class="err">å‡½æ•°ä½“</span><span class="p">}</span><span class="err">ï¼Œ</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T1</span><span class="p">,</span><span class="k">class</span> <span class="nc">T2</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">A</span><span class="o">&lt;</span><span class="n">T1</span><span class="p">,</span><span class="n">T2</span><span class="o">&gt;::</span><span class="n">h</span><span class="p">(){}</span><span class="err">ã€‚</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="cå¼•ç”¨">C++å¼•ç”¨</h1>
<p>å¼•ç”¨é™å®šç¬¦ï¼š &amp; ä¸Ž &amp;&amp; ï¼Œæœ‰constçš„è¯ä¸¤ä¸ªé™å®šç¬¦å‡éœ€è¦åœ¨conståŽé¢</p>
<p><strong>ç§»åŠ¨</strong></p>
<p>std::move()</p>
<p><strong>è½¬å‘</strong></p>
<p>std::forward()</p>
<p>ä¿æŒå®žå‚çš„æºç±»åž‹ä»¥åŠå€¼</p>
<h1 id="æ ˆæˆ–è€…å †ä¸Šé¢åˆ›å»ºç±»">æ ˆæˆ–è€…å †ä¸Šé¢åˆ›å»ºç±»</h1>
<h2 id="åœ¨å †ä¸Šåˆ›å»ºç±»å¯¹è±¡">åœ¨å †ä¸Šåˆ›å»ºç±»å¯¹è±¡</h2>
<p>è®¾ç½®æžæž„å‡½æ•°ä¸ºç§æœ‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HeapClass</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">HeapClass</span><span class="p">(){}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="o">~</span><span class="n">HeapClass</span><span class="p">(){}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://i.loli.net/2020/08/08/pfFMmhwY3uiXENy.png" alt="r" /></p>
<h2 id="åœ¨æ ˆä¸Šåˆ›å»ºç±»å¯¹è±¡">åœ¨æ ˆä¸Šåˆ›å»ºç±»å¯¹è±¡</h2>
<p>é‡è½½newå’Œdeleteè¿ç®—ç¬¦ä¸ºç§æœ‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">StackClass</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">StackClass</span><span class="p">(){}</span>
</span></span><span class="line"><span class="cl">        <span class="o">~</span><span class="n">StackClass</span><span class="p">(){}</span>
</span></span><span class="line"><span class="cl">    <span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">        <span class="kt">void</span><span class="o">*</span> <span class="k">operator</span> <span class="k">new</span><span class="p">(</span><span class="n">size_t</span> <span class="n">t</span><span class="p">){}</span>
</span></span><span class="line"><span class="cl">        <span class="kt">void</span> <span class="k">operator</span> <span class="nf">delete</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">){}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://i.loli.net/2020/08/08/DfmtyWHO7Lgo1uK.png" alt="r" /></p>
<h1 id="ä¸ä½¿ç”¨ç¬¬ä¸‰ä¸ªæ•°äº¤æ¢ä¸¤ä¸ªæ•°">ä¸ä½¿ç”¨ç¬¬ä¸‰ä¸ªæ•°äº¤æ¢ä¸¤ä¸ªæ•°</h1>
<h2 id="åŠ æ³•">åŠ æ³•</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">swap1</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å¼‚æˆ–">å¼‚æˆ–</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">swap2</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">^</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">^</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">^</span> <span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="å›žè°ƒå‡½æ•°ä¸Žä»¿å‡½æ•°">å›žè°ƒå‡½æ•°ä¸Žä»¿å‡½æ•°</h1>
<p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ä»¿å‡½æ•°ï¼Ÿ</strong></p>
<ol>
<li>è¿­ä»£å’Œè®¡ç®—é€»è¾‘åˆ†ç¦»</li>
<li>å‚æ•°å¯è®¾ç½®</li>
<li>æœ‰çŠ¶æ€</li>
<li>æ€§èƒ½(ç¼–è¯‘æ—¶æœŸå°±èƒ½å¤Ÿç¡®å®šè°ƒç”¨çš„å‡½æ•°)</li>
</ol>
<p>å‡½æ•°æŒ‡é’ˆæœ‰ç¼ºç‚¹,æœ€é‡è¦çš„æ˜¯å®ƒæ— æ³•æŒæœ‰è‡ªå·±çš„çŠ¶æ€(æ‰€è°“å±€éƒ¨çŠ¶æ€,localstatesï¼‰ï¼Œä¹Ÿæ— æ³•è¾¾åˆ°ç»„ä»¶æŠ€æœ¯ä¸­çš„å¯é€‚é…æ€§ï¼ˆadaptabilityï¼‰â€”â€”ä¹Ÿå°±æ˜¯æ— æ³•å†å°†æŸäº›ä¿®é¥°æ¡ä»¶åŠ è¯¸äºŽå…¶ä¸Šè€Œæ”¹å˜å…¶çŠ¶æ€ã€‚<br />
ä¸ºæ­¤ï¼ŒSTL ç®—æ³•çš„ç‰¹æ®Šç‰ˆæœ¬æ‰€æŽ¥å—çš„æ‰€è°“â€œæ¡ä»¶â€æˆ– â€œç­–ç•¥â€æˆ– â€œä¸€æ•´ç»„æ“ä½œâ€ï¼Œéƒ½ä»¥ä»¿å‡½æ•°å½¢å¼å‘ˆçŽ°ã€‚æ‰€è°“ä»¿å‡½æ•°ï¼ˆfunctorï¼‰å°±æ˜¯ä½¿ç”¨èµ·æ¥åƒå‡½æ•°ä¸€æ ·çš„ä¸œè¥¿ã€‚å¦‚æžœä½ é’ˆå¯¹æŸä¸ª class è¿›è¡Œ operator(ï¼‰é‡è½½ï¼Œå®ƒå°±æˆä¸ºä¸€ä¸ªä»¿å‡½æ•°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;algorithm&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å›žè°ƒå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">call_back</span><span class="p">(</span><span class="kt">char</span> <span class="n">elem</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">elem</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ä»¿å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">struct</span> <span class="nc">Functor</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="kt">void</span> <span class="nf">operator</span><span class="p">()</span> <span class="p">(</span><span class="kt">char</span> <span class="n">elem</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">elem</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="n">string</span> <span class="n">strA</span> <span class="o">=</span> <span class="s">&#34;hello&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="n">string</span> <span class="n">strB</span> <span class="o">=</span> <span class="s">&#34;world&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> <span class="n">for_each</span><span class="p">(</span><span class="n">strA</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">strA</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="n">Functor</span><span class="p">());</span>
</span></span><span class="line"><span class="cl"> <span class="n">cout</span><span class="o">&lt;&lt;</span><span class="s">&#34;===========GAP===============&#34;</span><span class="o">&lt;&lt;</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="n">for_each</span><span class="p">(</span><span class="n">strB</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="n">strB</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="n">call_back</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"> <span class="n">getchar</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ä»¿å‡½æ•°éœ€è¦ç»è¿‡3æ¬¡çš„æž„é€ å’Œæžæž„ã€‚</p>
</blockquote>
<p>ä»¿å‡½æ•°å’Œå›žè°ƒå‡½æ•°åŒºåˆ«åœ¨äºŽ:</p>
<ol>
<li>ä½¿ç”¨ä»¿å‡½æ•°å¯ä»¥å£°æ˜Žåœ¨ä¸šåŠ¡ç›¸å…³çš„ç±»å†…éƒ¨ ç¼©å°ä½œç”¨åŸŸ</li>
<li>ä½¿ç”¨ä»¿å‡½æ•°å¯ä»¥ä½¿ç”¨ç±»çš„æˆå‘˜å±žæ€§å’Œæˆå‘˜å‡½æ•°</li>
<li>ä»¿å‡½æ•°æ˜¯ä¸€ä¸ª<strong>ç±»</strong> å¯ä»¥ä½¿ç”¨é¢å‘å¯¹è±¡çš„å„ç§æœºåˆ¶(å°è£… ç»§æ‰¿ å¤šæ€)</li>
<li>è‹¥ä½¿ç”¨å›žè°ƒå‡½æ•° é‚£ä¹ˆåªèƒ½å£°æ˜Žä¸ºæŸä¸ªç±»çš„é™æ€æˆå‘˜å‡½æ•°æˆ–å…¨å±€å‡½æ•°ï¼Œä½¿ç”¨ç±»å†…éƒ¨çš„èµ„æºéœ€è¦ç”¨ä¸€äº›æ‰‹æ®µä¼ å‚,æ²¡æœ‰ç›´æŽ¥ä½¿ç”¨æˆå‘˜å‡½æ•°ä¾¿æ·</li>
</ol>
<hr />
<p>å‚è€ƒï¼š</p>
<p><a href="https://my.oschina.net/mlgb/blog/290350">https://my.oschina.net/mlgb/blog/290350</a></p>
<p><a href="https://my.oschina.net/llehs/blog/180594">C++ä»¿å‡½æ•°ï¼ˆfunctorï¼‰</a></p>
<h1 id="cæžæž„å‡½æ•°ä¸ºä»€ä¹ˆæ˜¯è™šå‡½æ•°">C++æžæž„å‡½æ•°ä¸ºä»€ä¹ˆæ˜¯è™šå‡½æ•°</h1>
<p>åŽŸå› ï¼šåŸºç±»å¯¹è±¡çš„æŒ‡é’ˆæ“ä½œæ´¾ç”Ÿç±»å¯¹è±¡æ—¶ï¼Œé˜²æ­¢æžæž„å‡½æ•°åªè°ƒç”¨åŸºç±»çš„ï¼Œè€Œä¸è°ƒç”¨æ´¾ç”Ÿç±»çš„</p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://blog.csdn.net/zkangaroo/article/details/57000397">https://blog.csdn.net/zkangaroo/article/details/57000397</a></li>
</ol>
<p>+++++++++++++++++</p>
<h1 id="å®žçŽ°memcpy">å®žçŽ°memcpyðŸ“</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="nf">my_memcpy</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)(</span><span class="n">dst</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)(</span><span class="n">src</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="n">s</span> <span class="o">&amp;&amp;</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">s</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span><span class="o">--</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">*</span><span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">*</span><span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">dst</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="memmoveä¸Žmemcpyçš„åŒºåˆ«">memmoveä¸Žmemcpyçš„åŒºåˆ«ï¼Ÿ</h3>
<h3 id="strcpyä¸Žmencpyçš„åŒºåˆ«">strcpyä¸Žmencpyçš„åŒºåˆ«?</h3>
<h1 id="å¿«é€ŸæŽ’åº">å¿«é€ŸæŽ’åºâ²ï¸</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">partition</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">nums</span><span class="p">,</span> <span class="kt">int</span> <span class="n">start</span><span class="p">,</span> <span class="kt">int</span> <span class="n">end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="n">nums</span><span class="p">[</span><span class="n">start</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="k">while</span> <span class="p">(</span><span class="n">start</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">while</span> <span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">p</span> <span class="o">&amp;&amp;</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="o">--</span><span class="n">end</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">nums</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="n">nums</span><span class="p">[</span><span class="n">end</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="k">while</span> <span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">p</span> <span class="o">&amp;&amp;</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="o">++</span><span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">nums</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">nums</span><span class="p">[</span><span class="n">start</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">nums</span><span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">start</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">quick_sort</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">nums</span><span class="p">,</span> <span class="kt">int</span> <span class="n">left</span><span class="p">,</span> <span class="kt">int</span> <span class="n">right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">quick_sort</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">quick_sort</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="å †æŽ’åº">å †æŽ’åºðŸŽ³</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">heap_sort</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">nums</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="o">--</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">left</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">imax</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">left</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">&amp;&amp;</span> <span class="n">nums</span><span class="p">[</span><span class="n">left</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">nums</span><span class="p">[</span><span class="n">imax</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">			<span class="n">imax</span> <span class="o">=</span> <span class="n">left</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">right</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">&amp;&amp;</span> <span class="n">nums</span><span class="p">[</span><span class="n">right</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">nums</span><span class="p">[</span><span class="n">imax</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">			<span class="n">imax</span> <span class="o">=</span> <span class="n">right</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">imax</span> <span class="o">!=</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">swap</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nums</span><span class="p">[</span><span class="n">imax</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">swap</span><span class="p">(</span><span class="n">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nums</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">	<span class="n">heap_sort</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="å †topk">ðŸ‘ å †TopK</h1>
<p><a href="https://blog.csdn.net/qq_37941471/article/details/81841624">C++å®žçŽ°æœ€å¤§å †å’Œæœ€å°å †</a></p>
<p><a href="https://blog.csdn.net/hrn1216/article/details/51465270">æœ€å°å † æž„å»ºã€æ’å…¥ã€åˆ é™¤çš„è¿‡ç¨‹å›¾è§£</a></p>
<hr />
<p>#Network</p>
<p><img src="https://i.loli.net/2020/11/12/9QHpVy1oEwDJ3uX.png" alt="img" /></p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://juejin.im/post/6844903662838349838">æžå®šè®¡ç®—æœºç½‘ç»œé¢è¯•ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†ï¼ˆè¡¥å……ç‰ˆï¼‰</a></li>
</ol>
<h1 id="å¤šé—®ä¸ºä»€ä¹ˆ">å¤šé—®ä¸ºä»€ä¹ˆï¼</h1>
<h3 id="-ç½‘ç»œåˆ†å±‚">ðŸŽšï¸ ç½‘ç»œåˆ†å±‚</h3>
<p><code>OSI</code>ä¸Ž<code>TCP/IP</code>åˆ†å±‚æ¨¡åž‹</p>
<p><img src="https://i.loli.net/2020/11/08/ehZWxY8KMJpaBQr.png" alt="ç½‘ç»œåˆ†å±‚æ¨¡åž‹" /></p>
<p><strong>ä¸ºä»€ä¹ˆç½‘ç»œéœ€è¦åˆ†å±‚ï¼Ÿ</strong></p>
<ul>
<li>
<p>å¤§éƒ¨åˆ†è½¯ä»¶ç³»ç»Ÿéƒ½æ˜¯åˆ†å±‚æž¶æž„çš„ï¼Œä¸ºäº†å·¥ç¨‹ä¸Šå®žçŽ°/è°ƒè¯•/ç»´æŠ¤æ–¹ä¾¿ã€‚ç½‘ç»œç³»ç»Ÿåˆ†å¾—æ›´æ˜Žæ˜¾ä¸€ç‚¹ï¼Œå› ä¸ºå…¶ç³»ç»Ÿè®¾è®¡å†™æˆäº†åè®®ã€‚</p>
</li>
<li>
<p>æŠŠ<code>TCP/IP</code>å±‚æ¬¡åŒ–æ˜¯æœ‰å¥½å¤„çš„ã€‚æ¯”å¦‚ï¼Œå¦‚æžœäº’è”ç½‘åªç”±ä¸€ä¸ªåè®®ç»Ÿç­¹ï¼ŒæŸä¸ªåœ°æ–¹éœ€è¦æ”¹å˜è®¾è®¡æ—¶ï¼Œå°±å¿…é¡»æŠŠæ‰€æœ‰éƒ¨åˆ†æ•´ä½“æ›¿æ¢æŽ‰ã€‚è€Œåˆ†å±‚ä¹‹åŽåªéœ€æŠŠå˜åŠ¨çš„å±‚æ›¿æ¢æŽ‰å³å¯ã€‚æŠŠå„å±‚ä¹‹é—´çš„æŽ¥å£éƒ¨åˆ†è§„åˆ’å¥½ä¹‹åŽï¼Œæ¯ä¸ªå±‚æ¬¡å†…éƒ¨çš„è®¾è®¡å°±èƒ½å¤Ÿè‡ªç”±æ”¹åŠ¨äº†ã€‚</p>
</li>
</ul>
<p><strong>åˆ†å±‚æ¨¡åž‹ä¼ è¾“è¿‡ç¨‹</strong></p>
<p><img src="https://i.loli.net/2020/11/11/bwuhqyjpio1AO7r.png" alt="åˆ†å±‚æ¨¡åž‹ä¼ è¾“è¿‡ç¨‹" /></p>
<p>å‘é€ç«¯åœ¨å±‚ä¸Žå±‚ä¹‹é—´ä¼ è¾“æ•°æ®æ—¶ï¼Œæ¯ç»è¿‡ä¸€å±‚æ—¶å¿…å®šä¼šè¢«æ‰“ä¸Šä¸€ä¸ªè¯¥å±‚æ‰€å±žçš„é¦–éƒ¨ä¿¡æ¯ã€‚åä¹‹ï¼ŒæŽ¥æ”¶ç«¯åœ¨å±‚ä¸Žå±‚ä¼ è¾“æ•°æ®æ—¶ï¼Œæ¯ç»è¿‡ä¸€å±‚æ—¶ä¼šæŠŠå¯¹åº”çš„é¦–éƒ¨æ¶ˆåŽ»ã€‚</p>
<hr />
<p>å‚è€ƒï¼š<a href="https://www.zhihu.com/question/26424507">ä¸ºä»€ä¹ˆç½‘ç»œåè®®é€‰æ‹©åˆ†å±‚è®¾è®¡ï¼Ÿè¿™æ ·åšæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</a></p>
<h3 id="-ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹">ðŸ¥‰ ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹</h3>
<p><strong>ä¸ºä»€ä¹ˆTCPå®¢æˆ·ç«¯æœ€åŽè¿˜è¦å‘é€ä¸€æ¬¡ç¡®è®¤å‘¢ï¼Ÿ</strong></p>
<ol>
<li>
<p>ä¸ºäº†é˜²æ­¢ <strong>å·²å¤±æ•ˆçš„é“¾æŽ¥è¯·æ±‚æŠ¥æ–‡çªç„¶åˆä¼ é€åˆ°äº†æœåŠ¡ç«¯</strong>ï¼Œå› è€Œäº§ç”Ÿé”™è¯¯ã€‚</p>
<p>å®¢æˆ·ç«¯å‘å‡ºçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡å¹¶æœªä¸¢å¤±ï¼Œè€Œæ˜¯åœ¨æŸä¸ªç½‘ç»œèŠ‚ç‚¹é•¿æ—¶é—´æ»žç•™äº†ï¼Œä»¥è‡´å»¶è¯¯åˆ°é“¾æŽ¥é‡Šæ”¾ä»¥åŽçš„æŸä¸ªæ—¶é—´æ‰åˆ°è¾¾Serverã€‚è¿™æ˜¯ï¼ŒServerè¯¯ä»¥ä¸ºè¿™æ˜¯Clientå‘å‡ºçš„ä¸€ä¸ªæ–°çš„é“¾æŽ¥è¯·æ±‚ï¼ŒäºŽæ˜¯å°±å‘å®¢æˆ·ç«¯å‘é€ç¡®è®¤æ•°æ®åŒ…ï¼ŒåŒæ„å»ºç«‹é“¾æŽ¥ã€‚è‹¥ä¸é‡‡ç”¨â€œä¸‰æ¬¡æ¡æ‰‹â€ï¼Œé‚£ä¹ˆåªè¦Serverå‘å‡ºç¡®è®¤æ•°æ®åŒ…ï¼Œæ–°çš„é“¾æŽ¥å°±å»ºç«‹äº†ã€‚ç”±äºŽclientæ­¤æ—¶å¹¶æœªå‘å‡ºå»ºç«‹é“¾æŽ¥çš„è¯·æ±‚ï¼Œæ‰€ä»¥å…¶ä¸ä¼šç†ç¬Serverçš„ç¡®è®¤ï¼Œä¹Ÿä¸ä¸ŽServeré€šä¿¡ï¼›è€Œè¿™æ—¶Serverä¸€ç›´åœ¨ç­‰å¾…Clientçš„è¯·æ±‚ï¼Œè¿™æ ·Serverå°±ç™½ç™½æµªè´¹äº†ä¸€å®šçš„èµ„æºã€‚è‹¥é‡‡ç”¨â€œä¸‰æ¬¡æ¡æ‰‹â€ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºŽServerç«¯æ²¡æœ‰æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„ç¡®è®¤ï¼Œåˆ™å°±ä¼šçŸ¥é“Clientå¹¶æ²¡æœ‰è¦æ±‚å»ºç«‹è¯·æ±‚ï¼Œå°±ä¸ä¼šå»ºç«‹é“¾æŽ¥ã€‚</p>
<p><strong>å¦‚æžœé‡‡ç”¨çš„æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå°±ç®—æ˜¯é‚£ä¸€æ¬¡å¤±æ•ˆçš„æŠ¥æ–‡ä¼ é€è¿‡æ¥äº†ï¼ŒæœåŠ¡ç«¯æŽ¥å—åˆ°äº†é‚£æ¡å¤±æ•ˆæŠ¥æ–‡å¹¶ä¸”å›žå¤äº†ç¡®è®¤æŠ¥æ–‡ï¼Œä½†æ˜¯å®¢æˆ·ç«¯ä¸ä¼šå†æ¬¡å‘å‡ºç¡®è®¤ã€‚ç”±äºŽæœåŠ¡å™¨æ”¶ä¸åˆ°ç¡®è®¤ï¼Œå°±çŸ¥é“å®¢æˆ·ç«¯å¹¶æ²¡æœ‰è¯·æ±‚è¿žæŽ¥ã€‚</strong></p>
</li>
<li>
<p>å› ä¸ºåŒæ–¹éƒ½éœ€è¦ç¡®è®¤å¯¹æ–¹æ”¶åˆ°äº†è‡ªå·±å‘é€çš„åºåˆ—å·ï¼Œç¡®è®¤è¿‡ç¨‹æœ€å°‘è¦è¿›è¡Œä¸‰æ¬¡é€šä¿¡ã€‚</p>
<p>å‚è€ƒï¼š<a href="https://www.zhihu.com/question/24853633/answer/115173386">çŸ¥ä¹Ž . TCP ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œä¸æ˜¯ä¸¤æ¬¡æˆ–å››æ¬¡ï¼Ÿ</a></p>
</li>
<li>
<p>å› ä¸ºä¿¡é“ä¸å¯é ï¼Œè€Œ TCP æƒ³åœ¨ä¸å¯é ä¿¡é“ä¸Šå»ºç«‹å¯é åœ°ä¼ è¾“ï¼Œé‚£ä¹ˆä¸‰æ¬¡é€šä¿¡æ˜¯ç†è®ºä¸Šçš„æœ€å°å€¼ã€‚ï¼ˆè€Œ UDP åˆ™ä¸éœ€å»ºç«‹å¯é ä¼ è¾“ï¼Œå› æ­¤ UDPä¸éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ã€‚ï¼‰</p>
<p>å‚è€ƒï¼š<a href="https://groups.google.com/forum/#!msg/pongba/kF6O7-MFxM0/5S7zIJ4yqKUJ">Google Groups . TCP å»ºç«‹è¿žæŽ¥ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ{æŠ€æœ¯}{ç½‘ç»œé€šä¿¡}</a></p>
</li>
</ol>
<blockquote>
<p><strong>TCPä¼ äº† SYN,ä¸ºå•¥è¿˜è¦ä¼  ACK</strong>ï¼Ÿ</p>
<p>åŒæ–¹é€šä¿¡æ— è¯¯å¿…é¡»æ˜¯ä¸¤è€…äº’ç›¸å‘é€ä¿¡æ¯éƒ½æ— è¯¯ã€‚ä¼ äº† SYNï¼Œè¯æ˜Žå‘é€æ–¹åˆ°æŽ¥æ”¶æ–¹çš„é€šé“æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æŽ¥æ”¶æ–¹åˆ°å‘é€æ–¹çš„é€šé“è¿˜éœ€è¦ ACK ä¿¡å·æ¥è¿›è¡ŒéªŒè¯ã€‚</p>
</blockquote>
<h3 id="-ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹">âœ‹ ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿ</h3>
<ol>
<li>
<p><strong>è¿™ä¸ªæ˜¯ä¸€ä¸ªå…¨åŒå·¥çš„è¿žæŽ¥ï¼Œä¸¤è¾¹éƒ½éœ€è¦æ–­å¼€ï¼Œæ¯æ¬¡çš„æ–­å¼€éƒ½éœ€è¦ä¸¤æ¬¡çš„æ¡æ‰‹ã€‚</strong></p>
<p>å»ºç«‹è¿žæŽ¥çš„æ—¶å€™ï¼Œ æœåŠ¡å™¨åœ¨LISTENçŠ¶æ€ä¸‹ï¼Œæ”¶åˆ°å»ºç«‹è¿žæŽ¥è¯·æ±‚çš„SYNæŠ¥æ–‡åŽï¼ŒæŠŠACKå’ŒSYNæ”¾åœ¨ä¸€ä¸ªæŠ¥æ–‡é‡Œå‘é€ç»™å®¢æˆ·ç«¯ã€‚<br />
è€Œå…³é—­è¿žæŽ¥æ—¶ï¼ŒæœåŠ¡å™¨æ”¶åˆ°å¯¹æ–¹çš„FINæŠ¥æ–‡æ—¶ï¼Œä»…ä»…è¡¨ç¤ºå¯¹æ–¹ä¸å†å‘é€æ•°æ®äº†ä½†æ˜¯è¿˜èƒ½æŽ¥æ”¶æ•°æ®ï¼Œè€Œè‡ªå·±ä¹Ÿæœªå¿…å…¨éƒ¨æ•°æ®éƒ½å‘é€ç»™å¯¹æ–¹äº†ï¼Œæ‰€ä»¥å·±æ–¹å¯ä»¥ç«‹å³å…³é—­ï¼Œä¹Ÿå¯ä»¥å‘é€ä¸€äº›æ•°æ®ç»™å¯¹æ–¹åŽï¼Œå†å‘é€FINæŠ¥æ–‡ç»™å¯¹æ–¹æ¥è¡¨ç¤ºåŒæ„çŽ°åœ¨å…³é—­è¿žæŽ¥ï¼Œ<strong>å› æ­¤ï¼Œå·±æ–¹ACKå’ŒFINä¸€èˆ¬éƒ½ä¼šåˆ†å¼€å‘é€ï¼Œä»Žè€Œå¯¼è‡´å¤šäº†ä¸€æ¬¡ã€‚å³å¦ä¸€æ–¹å¹¶ä¸éœ€è¦ä¹Ÿæ€¥ç€æ–­å¼€ï¼Œè¿˜å¯ä»¥ç»§ç»­å‘é€æ¶ˆæ¯ã€‚</strong></p>
</li>
<li>
<p><strong>æœåŠ¡å™¨å¯èƒ½è¿˜æœ‰æ•°æ®éœ€è¦ä¼ è¾“ç»™å®¢æˆ·ç«¯</strong></p>
<p>å› ä¸ºå®¢æˆ·ç«¯è¯·æ±‚é‡Šæ”¾æ—¶ï¼Œ<strong>æœåŠ¡å™¨å¯èƒ½è¿˜æœ‰æ•°æ®éœ€è¦ä¼ è¾“ç»™å®¢æˆ·ç«¯ï¼Œå› æ­¤æœåŠ¡ç«¯è¦å…ˆå“åº”å®¢æˆ·ç«¯ FIN è¯·æ±‚ï¼ˆæœåŠ¡ç«¯å‘é€ ACKï¼‰ï¼Œç„¶åŽæ•°æ®ä¼ è¾“</strong>ï¼Œä¼ è¾“å®ŒæˆåŽï¼ŒæœåŠ¡ç«¯å†æå‡º FIN è¯·æ±‚ï¼ˆæœåŠ¡ç«¯å‘é€ FINï¼‰ï¼›è€Œè¿žæŽ¥æ—¶åˆ™æ²¡æœ‰ä¸­é—´çš„æ•°æ®ä¼ è¾“ï¼Œå› æ­¤è¿žæŽ¥æ—¶å¯ä»¥ ACK å’Œ SYN ä¸€èµ·å‘é€ã€‚</p>
</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯æœ€åŽè¿˜è¦ç­‰å¾…2MSLï¼Ÿ</strong></p>
<p>MSLï¼ˆMaximum Segment Lifetimeï¼‰ï¼ŒTCPå…è®¸ä¸åŒçš„å®žçŽ°å¯ä»¥è®¾ç½®ä¸åŒçš„MSLå€¼ã€‚</p>
<p>ç¬¬ä¸€ï¼Œä¿è¯å®¢æˆ·ç«¯å‘é€çš„æœ€åŽä¸€ä¸ªACKæŠ¥æ–‡èƒ½å¤Ÿåˆ°è¾¾æœåŠ¡å™¨ï¼Œå› ä¸ºè¿™ä¸ªACKæŠ¥æ–‡å¯èƒ½ä¸¢å¤±ï¼Œç«™åœ¨æœåŠ¡å™¨çš„è§’åº¦çœ‹æ¥ï¼Œæˆ‘å·²ç»å‘é€äº†FIN+ACKæŠ¥æ–‡è¯·æ±‚æ–­å¼€äº†ï¼Œå®¢æˆ·ç«¯è¿˜æ²¡æœ‰ç»™æˆ‘å›žåº”ï¼Œåº”è¯¥æ˜¯æˆ‘å‘é€çš„è¯·æ±‚æ–­å¼€æŠ¥æ–‡å®ƒæ²¡æœ‰æ”¶åˆ°ï¼ŒäºŽæ˜¯æœåŠ¡å™¨åˆä¼šé‡æ–°å‘é€ä¸€æ¬¡ï¼Œè€Œå®¢æˆ·ç«¯å°±èƒ½åœ¨è¿™ä¸ª2MSLæ—¶é—´æ®µå†…æ”¶åˆ°è¿™ä¸ªé‡ä¼ çš„æŠ¥æ–‡ï¼ŒæŽ¥ç€ç»™å‡ºå›žåº”æŠ¥æ–‡ï¼Œå¹¶ä¸”ä¼šé‡å¯2MSLè®¡æ—¶å™¨ã€‚</p>
<p>ç¬¬äºŒï¼Œé˜²æ­¢ç±»ä¼¼ä¸Žâ€œä¸‰æ¬¡æ¡æ‰‹â€ä¸­æåˆ°äº†çš„â€œå·²ç»å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µâ€å‡ºçŽ°åœ¨æœ¬è¿žæŽ¥ä¸­ã€‚å®¢æˆ·ç«¯å‘é€å®Œæœ€åŽä¸€ä¸ªç¡®è®¤æŠ¥æ–‡åŽï¼Œåœ¨è¿™ä¸ª2MSLæ—¶é—´ä¸­ï¼Œå°±å¯ä»¥ä½¿æœ¬è¿žæŽ¥æŒç»­çš„æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡æ®µéƒ½ä»Žç½‘ç»œä¸­æ¶ˆå¤±ã€‚è¿™æ ·æ–°çš„è¿žæŽ¥ä¸­ä¸ä¼šå‡ºçŽ°æ—§è¿žæŽ¥çš„è¯·æ±‚æŠ¥æ–‡ã€‚</p>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://blog.csdn.net/qzcsu/article/details/72861891">ä¸¤å¼ åŠ¨å›¾-å½»åº•æ˜Žç™½TCPçš„ä¸‰æ¬¡æ¡æ‰‹ä¸Žå››æ¬¡æŒ¥æ‰‹</a></li>
</ol>
<h3 id="-å¦‚æžœå·²ç»å»ºç«‹äº†è¿žæŽ¥ä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºçŽ°æ•…éšœäº†æ€Žä¹ˆåŠž">ðŸ‘ å¦‚æžœå·²ç»å»ºç«‹äº†è¿žæŽ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºçŽ°æ•…éšœäº†æ€Žä¹ˆåŠžï¼Ÿ</h3>
<p>TCPè¿˜è®¾æœ‰ä¸€ä¸ª<strong>ä¿æ´»è®¡æ—¶å™¨</strong>ï¼Œæ˜¾ç„¶ï¼Œå®¢æˆ·ç«¯å¦‚æžœå‡ºçŽ°æ•…éšœï¼ŒæœåŠ¡å™¨ä¸èƒ½ä¸€ç›´ç­‰ä¸‹åŽ»ï¼Œç™½ç™½æµªè´¹èµ„æºã€‚æœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€æ¬¡å®¢æˆ·ç«¯çš„è¯·æ±‚åŽéƒ½ä¼šé‡æ–°å¤ä½è¿™ä¸ªè®¡æ—¶å™¨ï¼Œæ—¶é—´é€šå¸¸æ˜¯è®¾ç½®ä¸º2å°æ—¶ï¼Œè‹¥ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„ä»»ä½•æ•°æ®ï¼ŒæœåŠ¡å™¨å°±ä¼šå‘é€ä¸€ä¸ªæŽ¢æµ‹æŠ¥æ–‡æ®µï¼Œä»¥åŽæ¯éš”75ç§’å‘é€ä¸€æ¬¡ã€‚è‹¥ä¸€è¿žå‘é€10ä¸ªæŽ¢æµ‹æŠ¥æ–‡ä»ç„¶æ²¡ååº”ï¼ŒæœåŠ¡å™¨å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼ŒæŽ¥ç€å°±å…³é—­è¿žæŽ¥ã€‚</p>
<h3 id="-get-å’Œ-postçš„åŒºåˆ«">ðŸ“‰ â€‹GET å’Œ POSTçš„åŒºåˆ«</h3>
<ol>
<li>GETç”¨æ¥<strong>èŽ·å–æ•°æ®</strong>ï¼ŒPOSTç”¨æ¥<strong>æäº¤æ•°æ®</strong></li>
<li>GETè¯·æ±‚é€šè¿‡URLï¼ˆè¯·æ±‚è¡Œï¼‰æäº¤æ•°æ®ï¼Œ<strong>åœ¨URLä¸­å¯ä»¥çœ‹åˆ°æ‰€ä¼ å‚æ•°</strong>ã€‚POSTé€šè¿‡â€œè¯·æ±‚ä½“â€ä¼ é€’æ•°æ®ï¼Œ<strong>å‚æ•°ä¸ä¼šåœ¨urlä¸­æ˜¾ç¤º</strong></li>
<li><strong>GETè¯·æ±‚æäº¤çš„æ•°æ®æœ‰é•¿åº¦é™åˆ¶ï¼ŒPOSTè¯·æ±‚æ²¡æœ‰é™åˆ¶ã€‚</strong></li>
<li>GETè¯·æ±‚è¿”å›žçš„å†…å®¹å¯ä»¥è¢«æµè§ˆå™¨ç¼“å­˜èµ·æ¥ã€‚è€Œæ¯æ¬¡æäº¤çš„POSTï¼Œæµè§ˆå™¨åœ¨ä½ æŒ‰ä¸‹F5çš„æ—¶å€™ä¼šè·³å‡ºç¡®è®¤æ¡†ï¼Œæµè§ˆå™¨ä¸ä¼šç¼“å­˜POSTè¯·æ±‚è¿”å›žçš„å†…å®¹ã€‚</li>
<li>GETå¯¹æ•°æ®è¿›è¡ŒæŸ¥è¯¢ï¼ŒPOSTä¸»è¦å¯¹æ•°æ®è¿›è¡Œå¢žåˆ æ”¹ï¼ç®€å•è¯´ï¼ŒGETæ˜¯åªè¯»ï¼ŒPOSTæ˜¯å†™ã€‚</li>
<li>get è¯·æ±‚çš„urlæ˜¯åœ¨æœåŠ¡å™¨ä¸Šæœ‰æ—¥å¿—è®°å½•ï¼Œåœ¨æµè§ˆå™¨ä¹Ÿèƒ½æŸ¥åˆ°åŽ†å²è®°å½•ï¼Œä½†æ˜¯postè¯·æ±‚çš„å‚æ•°éƒ½åœ¨bodyé‡Œé¢ï¼Œæµè§ˆå™¨åŽ†å²è®°å½•ä¸åˆ°</li>
</ol>
<blockquote>
<p>å¦‚æžœæ˜¯æŒ‡ç½‘ç»œå®‰å…¨ï¼Œé‚£ä¸¤è€…ä¸€æ ·ã€‚<br />
å¦‚æžœè€ƒè™‘åˆ°æŸäº›æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„é»˜è®¤é…ç½®å’Œé»˜è®¤ä½¿ç”¨æ–¹å¼ï¼Œé‚£ä¹ˆPOSTåœ¨å¾ˆå¤šæ—¶å€™æ¯”GETå®‰å…¨ã€‚<br />
è€Œåœ¨HTTPçš„å®šä¹‰ä¸­ï¼ŒGETè¢«ç§°ä¸ºå®‰å…¨æ–¹æ³•ï¼ŒPOSTå´ä¸æ˜¯.</p>
</blockquote>
<p>æ„Ÿè§‰å¯¹äºŽæœåŠ¡å™¨æ›´å®‰å…¨çš„æ˜¯Getï¼Œå¯¹äºŽå®¢æˆ·ç«¯æ›´å®‰å…¨çš„æ˜¯Postã€‚</p>
<p><strong>æœ¬è´¨ä¸Šï¼š</strong></p>
<p>é¦–å…ˆgetå’Œpoståœ¨æœ¬è´¨ä¸Šéƒ½æ˜¯tcpé“¾æŽ¥ï¼Œä½†ç”±äºŽhttpåè®®å’Œæµè§ˆå™¨æˆ–è€…æœåŠ¡å™¨çš„é™åˆ¶ï¼Œä»Žè€Œä½¿å®ƒä»¬åœ¨åº”ç”¨è¿‡ç¨‹ä¸­äº§ç”Ÿäº†å·®åˆ«ï¼Œä½†æ˜¯å®ƒä»¬ä¸­è¿˜æœ‰ä¸€ä¸ªè¾ƒå¤§çš„åŒºåˆ«ï¼š<strong>getåœ¨è¯·æ±‚æ—¶å‘é€ä¸€ä¸ªæ•°æ®åŒ…ï¼Œä¼šå°†headerå’Œdataä¸€èµ·å‘é€è¿‡åŽ»ï¼Œè€Œpostä¼šäº§ç”Ÿä¸¤ä¸ªæ•°æ®åŒ…å…ˆå‘é€headerï¼ŒæœåŠ¡å™¨è¿”å›ž100ï¼Œç„¶åŽåœ¨å‘é€dataï¼ŒæœåŠ¡å™¨è¿”å›ž200</strong></p>
<blockquote>
<p>æ‰€ä»¥å½“ä½ ä¸€å±‚ä¸€å±‚çš„æŠŠgetå’Œpostå‰–æžåˆ°åº•ï¼Œä½ ä¼šå‘çŽ°ä»–ä»¬çš„æœ¬è´¨å°±æ˜¯tcpè¿žæŽ¥ï¼Œæ²¡æœ‰å•¥åŒºåˆ«ï¼Œåªæ˜¯ç”±äºŽhttpåè®®è§„å®šå’Œæµè§ˆå™¨æˆ–è€…æœåŠ¡å™¨çš„é™åˆ¶ï¼Œå¯¼è‡´ä»–ä»¬åœ¨åº”ç”¨è¿‡ç¨‹ä¸­ä½“çŽ°å½¢å¼ä¸åŒã€‚</p>
</blockquote>
<p><strong>RFC</strong>ï¼š</p>
<p><strong>1.safeï¼ˆå®‰å…¨ï¼‰</strong></p>
<blockquote>
<p>è¿™é‡Œçš„å®‰å…¨å’Œé€šå¸¸æ‰€ç†è§£çš„å®‰å…¨æ„ä¹‰ä¸åŒï¼Œå°±å¥½æ¯”å¦‚æžœä¸€ä¸ªè¯·æ±‚çš„è¯­ä¹‰æœ¬è´¨ä¸Šå°±æ˜¯èŽ·å–æ•°æ®ï¼ˆåªè¯»ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯·æ±‚å°±æ˜¯å®‰å…¨çš„ã€‚å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·çš„è¯·æ±‚å¦‚æžœæ²¡æœ‰å¼•èµ·æœåŠ¡å™¨ç«¯ä»»ä½•çš„çŠ¶æ€å˜åŒ–ï¼Œé‚£ä¹ˆä»–å°±æ˜¯å®‰å…¨çš„è€Œpostè¯·æ±‚æ¥æäº¤æ•°æ®å¿…ç„¶ä¼šæ˜¯æœåŠ¡å™¨å‘ç”Ÿç›¸åº”çš„å˜åŒ–ã€‚ä»Žè¿™ä¸ªç»´åº¦æ¥çœ‹ï¼Œgetè¯·æ±‚ç›¸å¯¹æœåŠ¡å™¨è€Œè¨€ï¼Œæ˜¯å®‰å…¨çš„ï¼Œpoståˆ™ä¸å®‰å…¨çš„ã€‚</p>
</blockquote>
<p><strong>ldempotendï¼ˆå¹‚ç­‰ï¼‰</strong></p>
<blockquote>
<p>**å¹‚ç­‰é€šä¿—çš„æ¥è®²å°±æ˜¯æŒ‡åŒä¸€ä¸ªè¯·æ±‚æ‰§è¡Œå¤šæ¬¡å’Œä»…æ‰§è¡Œä¸€æ¬¡çš„æ•ˆæžœå®Œå…¨ç›¸ç­‰ã€‚**è¿™é‡Œæ¥æ‰¯å‡ºå¹‚ç­‰ä¸»è¦æ˜¯ä¸ºäº†å¤„ç†åŒä¸€ä¸ªè¯·æ±‚é‡å¤å‘é€çš„æƒ…å†µï¼Œå‡å¦‚åœ¨è¯·æ±‚å“åº”ä¹‹å‰å¤±åŽ»è¿žæŽ¥ï¼Œå¦‚æžœè¿™ä¸ªè¯·æ±‚æ—¶å¹‚ç­‰çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ”¾å¿ƒçš„é‡å‘ä¸€æ¬¡è¯·æ±‚ã€‚æ‰€ä»¥å¯ä»¥å¾—å‡ºgetè¯·æ±‚æ—¶å¹‚ç­‰çš„ï¼Œå¯ä»¥é‡å¤å‘é€è¯·æ±‚ï¼Œpostè¯·æ±‚æ—¶ä¸å¹‚ç­‰çš„ï¼Œé‡å¤è¯·æ±‚å¯èƒ½ä¼šå‘ç”Ÿæ— æ³•é¢„çŸ¥çš„åŽæžœã€‚</p>
</blockquote>
<p><strong>cacheableï¼ˆå¯ç¼“å­˜æ€§ï¼‰</strong></p>
<blockquote>
<p>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€ä¸ªè¯·æ±‚æ˜¯å¦å¯ä»¥è¢«ç¼“å­˜ï¼Œç»å¤§å¤šæ•°éƒ¨åˆ†ï¼Œpostéƒ½æ˜¯ä¸å¯ç¼“å­˜çš„ï¼ˆæŸäº›æµè§ˆå™¨å¯èƒ½æ”¯æŒpostç¼“å­˜ï¼‰ï¼Œä½†getæ˜¯å¯ä»¥ç¼“å­˜çš„ã€‚</p>
</blockquote>
<p><strong>å‹‰å¼ºç†è§£ä¸€ä¸‹å¤§æ¦‚å°±æ˜¯ï¼š</strong></p>
<blockquote>
<p>getæ˜¯è¯·æ±‚èŽ·å–æŒ‡å®šèµ„æºï¼Œgetæ–¹æ³•æ—¶å®‰å…¨ã€å¹‚ç­‰ã€å¯ç¼“å­˜çš„ï¼Œgetæ–¹æ³•çš„æŠ¥æ–‡ä¸»ä½“æ²¡æœ‰ä»»ä½•è¯­ä¹‰ã€‚</p>
</blockquote>
<blockquote>
<p>postæ˜¯æ ¹æ®æŠ¥æ–‡ä¸»ä½“æ¥å¯¹æŒ‡å®šèµ„æºåšå‡ºå¤„ç†ï¼Œpostä¸å®‰å…¨ï¼Œä¸å¹‚ç­‰ï¼Œä¸å¯ç¼“å­˜ï¼ˆå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼‰ã€‚</p>
</blockquote>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://blog.fundebug.com/2019/02/22/compare-http-method-get-and-post/">éƒ½ 2019 å¹´äº†ï¼Œè¿˜é—® GET å’Œ POST çš„åŒºåˆ«</a></li>
<li><a href="https://www.zhihu.com/question/54076547">POST æ–¹æ³•æ¯” GET æ–¹æ³•æ›´å®‰å…¨å—? ä¸ºä»€ä¹ˆ?</a></li>
<li><a href="https://juejin.im/post/6844903824738500615">getå’Œpostçš„åŒºåˆ«ï¼Ÿ</a></li>
</ol>
<h3 id="-httpæŠ¥æ–‡">ðŸ‚ HTTPæŠ¥æ–‡</h3>
<h4 id="è¯·æ±‚æŠ¥æ–‡">è¯·æ±‚æŠ¥æ–‡</h4>
<p>HTTP è¯·æ±‚æŠ¥æ–‡ç”±3éƒ¨åˆ†ç»„æˆ(è¯·æ±‚è¡Œ+è¯·æ±‚å¤´+è¯·æ±‚ä½“)</p>
<p><img src="https://i.loli.net/2020/11/11/pGh3toQX8WC6Nq5.png" alt="HTTPè¯·æ±‚æŠ¥æ–‡" /></p>
<p><strong>è¯·æ±‚è¡Œ</strong>åŒ…æ‹¬ï¼šè¯·æ±‚æ–¹æ³•ã€è¯·æ±‚URLã€HTTPåè®®åŠç‰ˆæœ¬ï¼š</p>
<p>GETå’ŒPOSTæ˜¯æœ€å¸¸è§çš„HTTPæ–¹æ³•,åˆæ¬¡ä»¥å¤–è¿˜åŒ…æ‹¬ DELETEã€HEADã€OPTIONSã€PUTã€TRACEï¼Œä¸è¿‡çŽ°åœ¨å¤§éƒ¨åˆ†çš„æµè§ˆå™¨åªæ”¯æŒGETå’ŒPOST</p>
<p>è¯·æ±‚å¯¹åº”çš„URLåœ°å€,ä»–å’ŒæŠ¥æ–‡å¤´çš„Hostå±žæ€§,ç»„åˆèµ·æ¥æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¯·æ±‚URL</p>
<p><strong>æŠ¥æ–‡å¤´</strong>æ˜¯ä¸€äº›å‚æ•°ä¿¡æ¯ï¼š</p>
<p>æœ‰è‹¥å¹²ä¸ªå±žæ€§,å½¢å¼ä¸ºkey:val,æœåŠ¡ç«¯æ®æ­¤èŽ·å–å®¢æˆ·ç«¯ä¿¡æ¯</p>
<p><strong>æŠ¥æ–‡ä½“</strong>æ˜¯å…·ä½“ä¼ è¾“çš„å†…å®¹ã€‚</p>
<h4 id="å“åº”æŠ¥æ–‡">å“åº”æŠ¥æ–‡</h4>
<p>å“åº”æŠ¥æ–‡ä¸Žè¯·æ±‚æŠ¥æ–‡ä¸€æ ·,ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆ(å“åº”è¡Œ,å“åº”å¤´,å“åº”ä½“)</p>
<p><img src="https://i.loli.net/2020/11/11/vtYpgrFsSqO6UTA.png" alt="HTTPå“åº”æŠ¥æ–‡" /></p>
<p>å‚è€ƒï¼š<a href="https://www.jianshu.com/p/9a68281a3c84">HTTPè¯·æ±‚å¤´å’Œå“åº”å¤´è¯¦è§£</a></p>
<h3 id="-httpçŠ¶æ€ç ">ðŸš‰ HTTPçŠ¶æ€ç ï¼š</h3>
<p><img src="https://i.loli.net/2020/10/19/3Ow5z4nsGbPrMoD.png" alt="HTTPçŠ¶æ€ç " /></p>
<ul>
<li>1xxï¼šè¡¨ç¤ºé€šçŸ¥ä¿¡æ¯ï¼Œå¦‚è¯·æ±‚æ”¶åˆ°äº†æˆ–æ­£åœ¨è¿›è¡Œå¤„ç†
<ul>
<li>100 Continueï¼šç»§ç»­ï¼Œå®¢æˆ·ç«¯åº”ç»§ç»­å…¶è¯·æ±‚</li>
<li>101 Switching Protocols åˆ‡æ¢åè®®ã€‚æœåŠ¡å™¨æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ‡æ¢åè®®ã€‚åªèƒ½åˆ‡æ¢åˆ°æ›´é«˜çº§çš„åè®®ï¼Œä¾‹å¦‚ï¼Œåˆ‡æ¢åˆ° HTTP çš„æ–°ç‰ˆæœ¬åè®®</li>
</ul>
</li>
<li>2xxï¼šè¡¨ç¤ºæˆåŠŸï¼Œå¦‚æŽ¥æ”¶æˆ–çŸ¥é“äº†
<ul>
<li>200 OK: è¯·æ±‚æˆåŠŸ</li>
</ul>
</li>
<li>3xxï¼šè¡¨ç¤ºé‡å®šå‘ï¼Œå¦‚è¦å®Œæˆè¯·æ±‚è¿˜å¿…é¡»é‡‡å–è¿›ä¸€æ­¥çš„è¡ŒåŠ¨
<ul>
<li>301 Moved Permanently: æ°¸ä¹…ç§»åŠ¨ã€‚è¯·æ±‚çš„èµ„æºå·²è¢«æ°¸ä¹…çš„ç§»åŠ¨åˆ°æ–° URLï¼Œè¿”å›žä¿¡æ¯ä¼šåŒ…æ‹¬æ–°çš„ URLï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å®šå‘åˆ°æ–° URLã€‚ä»ŠåŽä»»ä½•æ–°çš„è¯·æ±‚éƒ½åº”ä½¿ç”¨æ–°çš„ URL ä»£æ›¿</li>
</ul>
</li>
<li>4xxï¼šè¡¨ç¤ºå®¢æˆ·çš„å·®é”™ï¼Œå¦‚è¯·æ±‚ä¸­æœ‰é”™è¯¯çš„è¯­æ³•æˆ–ä¸èƒ½å®Œæˆ
<ul>
<li>400 Bad Request: å®¢æˆ·ç«¯è¯·æ±‚çš„è¯­æ³•é”™è¯¯ï¼ŒæœåŠ¡å™¨æ— æ³•ç†è§£</li>
<li>401 Unauthorized: è¯·æ±‚è¦æ±‚ç”¨æˆ·çš„èº«ä»½è®¤è¯</li>
<li>403 Forbidden: æœåŠ¡å™¨ç†è§£è¯·æ±‚å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æ‰§è¡Œæ­¤è¯·æ±‚ï¼ˆæƒé™ä¸å¤Ÿï¼‰</li>
<li>404 Not Found: æœåŠ¡å™¨æ— æ³•æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚æ‰¾åˆ°èµ„æºï¼ˆç½‘é¡µï¼‰ã€‚é€šè¿‡æ­¤ä»£ç ï¼Œç½‘ç«™è®¾è®¡äººå‘˜å¯è®¾ç½® â€œæ‚¨æ‰€è¯·æ±‚çš„èµ„æºæ— æ³•æ‰¾åˆ°â€ çš„ä¸ªæ€§é¡µé¢</li>
<li>408 Request Timeout: æœåŠ¡å™¨ç­‰å¾…å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ—¶é—´è¿‡é•¿ï¼Œè¶…æ—¶</li>
</ul>
</li>
<li>5xxï¼šè¡¨ç¤ºæœåŠ¡å™¨çš„å·®é”™ï¼Œå¦‚æœåŠ¡å™¨å¤±æ•ˆæ— æ³•å®Œæˆè¯·æ±‚
<ul>
<li>500 Internal Server Error: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚</li>
<li>503 Service Unavailable: ç”±äºŽè¶…è½½æˆ–ç³»ç»Ÿç»´æŠ¤ï¼ŒæœåŠ¡å™¨æš‚æ—¶çš„æ— æ³•å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å»¶æ—¶çš„é•¿åº¦å¯åŒ…å«åœ¨æœåŠ¡å™¨çš„ Retry-After å¤´ä¿¡æ¯ä¸­</li>
<li>504 Gateway Timeout: å……å½“ç½‘å…³æˆ–ä»£ç†çš„æœåŠ¡å™¨ï¼ŒæœªåŠæ—¶ä»Žè¿œç«¯æœåŠ¡å™¨èŽ·å–è¯·æ±‚</li>
</ul>
</li>
</ul>
<h3 id="-httpçš„ä¸»è¦æ–¹æ³•">âœ‹ HTTPçš„ä¸»è¦æ–¹æ³•</h3>
<img src="https://i.loli.net/2020/11/07/3rBJ2u5WDK7kRZF.png" alt="HTTPæ–¹æ³•" style="zoom: 67%;" />
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>æ„ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>OPTIONS</td>
<td>è¯·æ±‚ä¸€äº›é€‰é¡¹ä¿¡æ¯ï¼Œå…è®¸å®¢æˆ·ç«¯æŸ¥çœ‹æœåŠ¡å™¨çš„æ€§èƒ½</td>
</tr>
<tr>
<td>GET</td>
<td>è¯·æ±‚æŒ‡å®šçš„é¡µé¢ä¿¡æ¯ï¼Œå¹¶è¿”å›žå®žä½“ä¸»ä½“</td>
</tr>
<tr>
<td>HEAD</td>
<td>ç±»ä¼¼äºŽ get è¯·æ±‚ï¼Œåªä¸è¿‡è¿”å›žçš„å“åº”ä¸­æ²¡æœ‰å…·ä½“çš„å†…å®¹ï¼Œç”¨äºŽèŽ·å–æŠ¥å¤´</td>
</tr>
<tr>
<td>POST</td>
<td>å‘æŒ‡å®šèµ„æºæäº¤æ•°æ®è¿›è¡Œå¤„ç†è¯·æ±‚ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚ä½“ä¸­ã€‚POSTè¯·æ±‚å¯èƒ½ä¼šå¯¼è‡´æ–°çš„èµ„æºçš„å»ºç«‹å’Œ/æˆ–å·²æœ‰èµ„æºçš„ä¿®æ”¹</td>
</tr>
<tr>
<td>PUT</td>
<td>ä»Žå®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€çš„æ•°æ®å–ä»£æŒ‡å®šçš„æ–‡æ¡£çš„å†…å®¹</td>
</tr>
<tr>
<td>DELETE</td>
<td>è¯·æ±‚æœåŠ¡å™¨åˆ é™¤æŒ‡å®šçš„é¡µé¢</td>
</tr>
<tr>
<td>TRACE</td>
<td>å›žæ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºŽæµ‹è¯•æˆ–è¯Šæ–­</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>ä¸‹é¢è¿™ä¸ªä¾‹å­æ˜¯æŸ¥è¯¢HTTPæœåŠ¡å™¨ç«¯æ”¯æŒçš„HTTPæ–¹æ³•ç§ç±»ã€‚</p>
<p><img src="https://i.loli.net/2020/11/11/5VeAOKHfTIRpuvL.png" alt="OPTIONSæ“ä½œ" /></p>
</li>
</ul>
<h3 id="-http20ä¸Žhttp10çš„åŒºåˆ«">ðŸ’« HTTP2.0ä¸ŽHTTP1.0çš„åŒºåˆ«</h3>
<p><img src="https://i.loli.net/2020/11/08/V91ZJx8fDbi2cBK.png" alt="HTTPåŒºåˆ«" /></p>
<h3 id="-ä»€ä¹ˆæ˜¯sqlæ³¨å…¥">ðŸ“¥ ä»€ä¹ˆæ˜¯<code>SQL</code>æ³¨å…¥ï¼Ÿ</h3>
<p><code>SQL</code>æ³¨å…¥å°±æ˜¯é€šè¿‡æŠŠ<code>SQL</code>å‘½ä»¤æ’å…¥åˆ°Webè¡¨å•æäº¤æˆ–è¾“å…¥åŸŸåæˆ–é¡µé¢è¯·æ±‚çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œæœ€ç»ˆè¾¾åˆ°æ¬ºéª—æœåŠ¡å™¨æ‰§è¡Œæ¶æ„çš„<code>SQL</code>å‘½ä»¤ã€‚</p>
<p><code>SQL</code>æ³¨å…¥çš„æ€è·¯ï¼š</p>
<ol>
<li>SQLæ³¨å…¥çš„ä½ç½®</li>
<li>åˆ¤æ–­æœåŠ¡å™¨ç±»åž‹å’ŒåŽå°æ•°æ®ç±»åž‹</li>
<li>é’ˆå¯¹ä¸é€šçš„æœåŠ¡å™¨å’Œæ•°æ®åº“ç‰¹ç‚¹è¿›è¡Œ<code>SQL</code>æ³¨å…¥æ”»å‡»</li>
</ol>
<p>åº”å¯¹çš„æ–¹æ³•ï¼š</p>
<ol>
<li><strong>å‚æ•°ç»‘å®š</strong>ä½¿ç”¨é¢„ç¼–è¯‘æ‰‹æ®µï¼Œç»‘å®šå‚æ•°æ˜¯æœ€å¥½çš„é˜²SQLæ³¨å…¥çš„æ–¹æ³•ã€‚ç›®å‰è®¸å¤šçš„ORMæ¡†æž¶åŠJDBCç­‰éƒ½å®žçŽ°äº†SQLé¢„ç¼–è¯‘å’Œå‚æ•°ç»‘å®šåŠŸèƒ½ï¼Œæ”»å‡»è€…çš„æ¶æ„SQLä¼šè¢«å½“åšSQLçš„å‚æ•°è€Œä¸æ˜¯SQLå‘½ä»¤è¢«æ‰§è¡Œã€‚åœ¨mybatisçš„mapperæ–‡ä»¶ä¸­ï¼Œå¯¹äºŽä¼ é€’çš„å‚æ•°æˆ‘ä»¬ä¸€èˆ¬æ˜¯ä½¿ç”¨<code>#</code>å’Œ<code>$</code>æ¥èŽ·å–å‚æ•°å€¼ã€‚å½“ä½¿ç”¨<code>#</code>æ—¶ï¼Œå˜é‡æ˜¯å ä½ç¬¦ï¼Œå°±æ˜¯ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨javajdbcçš„PrepareStatementæ—¶çš„å ä½ç¬¦ï¼Œæ‰€æœ‰å¯ä»¥é˜²æ­¢sqlæ³¨å…¥ï¼›å½“ä½¿ç”¨â€‹<code>$</code>æ—¶ï¼Œå˜é‡å°±æ˜¯ç›´æŽ¥è¿½åŠ åœ¨sqlä¸­ï¼Œä¸€èˆ¬ä¼šæœ‰sqlæ³¨å…¥é—®é¢˜ã€‚</li>
<li><strong>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤ä¼ å…¥çš„å‚æ•°</strong></li>
</ol>
<h3 id="-cookieæŠ€æœ¯">ðŸª CookieæŠ€æœ¯</h3>
<p><code>Cookie</code> é€šè¿‡åœ¨è¯·æ±‚å’Œå“åº”æŠ¥æ–‡ä¸­å†™å…¥ Cookie ä¿¡æ¯æ¥æŽ§åˆ¶å®¢æˆ·ç«¯çš„çŠ¶æ€ã€‚</p>
<p>ç›¸å½“äºŽï¼Œ<strong>åœ¨å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯·æ±‚åŽï¼ŒæœåŠ¡å™¨ä¼šä¸‹å‘ä¸€ä¸ªè£…æœ‰å®¢æˆ·ä¿¡æ¯çš„ã€Œå°è´´çº¸ã€ï¼ŒåŽç»­å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨çš„æ—¶å€™ï¼Œå¸¦ä¸Šã€Œå°è´´çº¸ã€ï¼ŒæœåŠ¡å™¨å°±èƒ½è®¤å¾—äº†äº†</strong>ã€‚</p>
<ul>
<li>
<p>æ²¡æœ‰Cookieä¿¡æ¯çŠ¶æ€ä¸‹çš„è¯·æ±‚</p>
<p><img src="https://i.loli.net/2020/11/11/sWbtqAl25B3c1Mf.png" alt="" /></p>
</li>
<li>
<p>ç¬¬2æ¬¡ä»¥åŽï¼ˆå­˜æœ‰Cookieä¿¡æ¯çŠ¶æ€ï¼‰çš„è¯·æ±‚</p>
<p><img src="https://i.loli.net/2020/11/11/fxLopbZyX5684ar.png" alt="" /></p>
</li>
</ul>
<p><strong>åº•å±‚åŽŸç†</strong></p>
<ul>
<li>
<p>WEBæœåŠ¡å™¨é€šè¿‡åœ¨HTTPå“åº”æ¶ˆæ¯ä¸­å¢žåŠ Set-Cookieå“åº”å¤´å­—æ®µå°†Cookieä¿¡æ¯å‘é€ç»™æµè§ˆå™¨ï¼Œ</p>
</li>
<li>
<p>æµè§ˆå™¨åˆ™é€šè¿‡åœ¨HTTPè¯·æ±‚æ¶ˆæ¯ä¸­å¢žåŠ Cookieè¯·æ±‚å¤´å­—æ®µå°†Cookieå›žä¼ ç»™WEBæœåŠ¡å™¨ã€‚</p>
</li>
</ul>
<p>Cookieçš„ä¼ é€è¿‡ç¨‹ç¤ºæ„å›¾</p>
<p><img src="https://i.loli.net/2020/11/08/mqBkljREA9ZrG17.jpg" alt="Cookieæµç¨‹" /></p>
<p><strong>Cookieçš„ç¼ºé™·</strong></p>
<p>(1) cookieä¼šè¢«é™„åŠ åœ¨æ¯ä¸ªHTTPè¯·æ±‚ä¸­ï¼Œæ‰€ä»¥æ— å½¢ä¸­å¢žåŠ äº†æµé‡ã€‚</p>
<p>(2) ç”±äºŽåœ¨HTTPè¯·æ±‚ä¸­çš„cookieæ˜¯æ˜Žæ–‡ä¼ é€’çš„ï¼Œæ‰€ä»¥å®‰å…¨æ€§æˆé—®é¢˜ã€‚ï¼ˆé™¤éžç”¨HTTPS)</p>
<p>(3) Cookieçš„å¤§å°é™åˆ¶åœ¨4KBå·¦å³ã€‚å¯¹äºŽå¤æ‚çš„å­˜å‚¨éœ€æ±‚æ¥è¯´æ˜¯ä¸å¤Ÿç”¨çš„ã€‚</p>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://juejin.im/post/6844903930346881038">ä¼šè¯æŠ€æœ¯â€”â€”Cookieså’ŒSessionè¯¦è§£</a></li>
</ol>
<h3 id="-sessionæŠ€æœ¯">ðŸ’¬ SessionæŠ€æœ¯</h3>
<p><strong>ä»€ä¹ˆæ˜¯ä¼šè¯ï¼Ÿ</strong></p>
<p><strong>ä¼šè¯æ˜¯æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„å¤šæ¬¡è¯·æ±‚å’Œå“åº”</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»Žæµè§ˆå™¨<strong>è®¿é—®æœåŠ¡å™¨å¼€å§‹</strong>ï¼Œåˆ°<strong>è®¿é—®æœåŠ¡å™¨ç»“æŸ</strong>ï¼Œ<strong>æµè§ˆå™¨å…³é—­ä¸ºæ­¢</strong>çš„è¿™æ®µæ—¶é—´å†…å®¹äº§ç”Ÿçš„<strong>å¤šæ¬¡è¯·æ±‚å’Œå“åº”</strong>ï¼Œåˆèµ·æ¥å«åšæµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¸€æ¬¡ä¼šè¯ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨ä¼šè¯æŠ€æœ¯ï¼Ÿ</strong></p>
<p>å®žé™…ä¸Šä¼šè¯é—®é¢˜è§£å†³çš„è¿˜æ˜¯å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡é—®é¢˜ï¼Œé€šè¿‡ä¸€äº›ä¼šè¯æŠ€æœ¯ï¼Œå¯ä»¥å°†æ¯ä¸ªç”¨æˆ·çš„æ•°æ®ä»¥ä¾‹å¦‚cookie/sessionçš„å½¢å¼å­˜å‚¨ï¼Œæ–¹ä¾¿ä»¥åŽç”¨æˆ·è®¿é—®webèµ„æºçš„æ—¶å€™ä½¿ç”¨</p>
<blockquote>
<p>å‡å®šåœºæ™¯ï¼šAå’ŒBä¸¤äººåœ¨æŸä¸ªç½‘ä¸Šè´­ç‰©å•†åœºç™»é™†è´¦å·åŽï¼ŒAä¹°äº†ä¸€ä¸ªHHKBçš„é”®ç›˜ï¼Œè€ŒBåˆ™è´­ä¹°äº†ä¸€æŠŠæ°‘è°£å‰ä»–ï¼Œè¿™äº›ä¿¡æ¯éƒ½ä¼šè¢«ä¿å­˜ä¸‹æ¥</p>
<p>ç”¨é€”æ˜¯ï¼šä¿å­˜è´¦æˆ·ä¿¡æ¯ï¼Œç™»å½•æ—¶è¯¢é—®æ—¥åŽæ˜¯å¦è‡ªåŠ¨ç™»å½•ï¼Œæˆ–è€…æ ¹æ®ä¹‹å‰æµè§ˆï¼Œè´­ä¹°è¿‡çš„å•†å“ï¼Œåˆ†æžç”¨æˆ·å–œæ¬¢ä»€ä¹ˆç±»åž‹çš„å•†å“ï¼Œåšå‡ºç²¾å‡†æŽ¨é€</p>
</blockquote>
<p>æœåŠ¡å™¨ä½¿ç”¨sessionæŠŠç”¨æˆ·çš„ä¿¡æ¯ä¸´æ—¶ä¿å­˜åœ¨äº†æœåŠ¡å™¨ä¸Šï¼Œç”¨æˆ·ç¦»å¼€ç½‘ç«™åŽsessionä¼šè¢«é”€æ¯ã€‚è¿™ç§ç”¨æˆ·ä¿¡æ¯å­˜å‚¨æ–¹å¼ç›¸å¯¹cookieæ¥è¯´æ›´å®‰å…¨ï¼Œ<strong>å¯æ˜¯sessionæœ‰ä¸€ä¸ªç¼ºé™·ï¼šå¦‚æžœwebæœåŠ¡å™¨åšäº†è´Ÿè½½å‡è¡¡ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæ“ä½œè¯·æ±‚åˆ°äº†å¦ä¸€å°æœåŠ¡å™¨çš„æ—¶å€™sessionä¼šä¸¢å¤±ã€‚</strong></p>
<p><img src="https://i.loli.net/2020/11/11/yODECA6QiuZRpg9.png" alt="Cookieç®¡ç†Session" /></p>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://juejin.im/post/6844903930346881038">ä¼šè¯æŠ€æœ¯â€”â€”Cookieså’ŒSessionè¯¦è§£</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/63061864">å½»åº•ç†è§£cookieï¼Œsessionï¼Œtoken</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/27669892">è®¤è¯†HTTP&mdash;-Cookieå’ŒSessionç¯‡</a></li>
</ol>
<h3 id="-sessionå’Œcookieçš„åŒºåˆ«">ðŸ“¸ Sessionå’ŒCookieçš„åŒºåˆ«</h3>
<p><strong>ä»Žå­˜å‚¨æ–¹å¼ä¸Šæ¯”è¾ƒ</strong></p>
<p>Cookieåªèƒ½å­˜å‚¨å­—ç¬¦ä¸²ï¼Œå¦‚æžœè¦å­˜å‚¨éžASCIIå­—ç¬¦ä¸²è¿˜è¦å¯¹å…¶ç¼–ç ã€‚</p>
<p>Sessionå¯ä»¥å­˜å‚¨ä»»ä½•ç±»åž‹çš„æ•°æ®ï¼Œå¯ä»¥æŠŠSessionçœ‹æˆæ˜¯ä¸€ä¸ªå®¹å™¨</p>
<p><strong>ä»Žéšç§å®‰å…¨ä¸Šæ¯”è¾ƒ</strong></p>
<p>Cookieå­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ï¼Œå¯¹å®¢æˆ·ç«¯æ˜¯å¯è§çš„ã€‚ä¿¡æ¯å®¹æ˜“æ³„éœ²å‡ºåŽ»ã€‚å¦‚æžœä½¿ç”¨Cookieï¼Œæœ€å¥½å°†CookieåŠ å¯†</p>
<p>Sessionå­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¯¹å®¢æˆ·ç«¯æ˜¯é€æ˜Žçš„ã€‚ä¸å­˜åœ¨æ•æ„Ÿä¿¡æ¯æ³„éœ²é—®é¢˜ã€‚</p>
<p><strong>ä»Žæœ‰æ•ˆæœŸä¸Šæ¯”è¾ƒ</strong></p>
<p>Cookieä¿å­˜åœ¨ç¡¬ç›˜ä¸­ï¼Œåªéœ€è¦è®¾ç½®maxAgeå±žæ€§ä¸ºæ¯”è¾ƒå¤§çš„æ­£æ•´æ•°ï¼Œå³ä½¿å…³é—­æµè§ˆå™¨ï¼ŒCookieè¿˜æ˜¯å­˜åœ¨çš„</p>
<p>Sessionçš„ä¿å­˜åœ¨æœåŠ¡å™¨ä¸­ï¼Œè®¾ç½®maxInactiveIntervalå±žæ€§å€¼æ¥ç¡®å®šSessionçš„æœ‰æ•ˆæœŸã€‚å¹¶ä¸”Sessionä¾èµ–äºŽåä¸ºJSESSIONIDçš„Cookieï¼Œè¯¥Cookieé»˜è®¤çš„maxAgeå±žæ€§ä¸º-1ã€‚å¦‚æžœå…³é—­äº†æµè§ˆå™¨ï¼Œè¯¥Sessionè™½ç„¶æ²¡æœ‰ä»ŽæœåŠ¡å™¨ä¸­æ¶ˆäº¡ï¼Œä½†ä¹Ÿå°±å¤±æ•ˆäº†ã€‚</p>
<p><strong>ä»Žå¯¹æœåŠ¡å™¨çš„è´Ÿæ‹…æ¯”è¾ƒ</strong></p>
<p>Sessionæ˜¯ä¿å­˜åœ¨æœåŠ¡å™¨çš„ï¼Œæ¯ä¸ªç”¨æˆ·éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªSessionï¼Œå¦‚æžœæ˜¯å¹¶å‘è®¿é—®çš„ç”¨æˆ·éžå¸¸å¤šï¼Œæ˜¯ä¸èƒ½ä½¿ç”¨Sessionçš„ï¼ŒSessionä¼šæ¶ˆè€—å¤§é‡çš„å†…å­˜ã€‚</p>
<p>Cookieæ˜¯ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„ã€‚ä¸å ç”¨æœåŠ¡å™¨çš„èµ„æºã€‚åƒbaiduã€Sinaè¿™æ ·çš„å¤§åž‹ç½‘ç«™ï¼Œä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨Cookieæ¥è¿›è¡Œä¼šè¯è·Ÿè¸ªã€‚</p>
<p><strong>ä»Žæµè§ˆå™¨çš„æ”¯æŒä¸Šæ¯”è¾ƒ</strong></p>
<p>å¦‚æžœæµè§ˆå™¨ç¦ç”¨äº†Cookieï¼Œé‚£ä¹ˆCookieæ˜¯æ— ç”¨çš„äº†ï¼</p>
<p>å¦‚æžœæµè§ˆå™¨ç¦ç”¨äº†Cookieï¼ŒSessionå¯ä»¥é€šè¿‡URLåœ°å€é‡å†™æ¥è¿›è¡Œä¼šè¯è·Ÿè¸ªã€‚</p>
<p><strong>ä»Žè·¨åŸŸåä¸Šæ¯”è¾ƒ</strong></p>
<p>Cookieå¯ä»¥è®¾ç½®domainå±žæ€§æ¥å®žçŽ°è·¨åŸŸå</p>
<p>Sessionåªåœ¨å½“å‰çš„åŸŸåå†…æœ‰æ•ˆï¼Œä¸å¯è·¨åŸŸå</p>
<h3 id="-ipåè®®">Â©ï¸ <code>IP</code>åè®®</h3>
<p><code>IP</code>åè®®çš„ä½œç”¨æ˜¯æŠŠå„ç§æ•°æ®åŒ…ä¼ é€ç»™å¯¹æ–¹ã€‚è€Œè¦ä¿è¯ç¡®å®žä¼ é€åˆ°å¯¹æ–¹é‚£é‡Œï¼Œåˆ™éœ€è¦æ»¡è¶³å„ç±»æ¡ä»¶ã€‚å…¶ä¸­ä¸¤ä¸ªé‡è¦çš„æ¡ä»¶æ˜¯<code>IP</code>åœ°å€å’Œ<code>MAC</code>åœ°å€ï¼ˆMedia Access Control Addressï¼‰ã€‚<strong><code>IP</code>åœ°å€æŒ‡æ˜Žäº†èŠ‚ç‚¹è¢«åˆ†é…åˆ°çš„åœ°å€ï¼Œ<code>MAC</code>åœ°å€æ˜¯æŒ‡ç½‘å¡æ‰€å±žçš„å›ºå®šåœ°å€</strong>ã€‚<code>IP</code>åœ°å€å¯ä»¥å’ŒMACåœ°å€è¿›è¡Œé…å¯¹ã€‚<code>IP</code>åœ°å€å¯å˜æ¢ï¼Œä½†<code>MAC</code>åœ°å€åŸºæœ¬ä¸Šä¸ä¼šæ›´æ”¹ã€‚</p>
<p>ä»€ä¹ˆæ˜¯MACåœ°å€ï¼Ÿ</p>
<p>MACåœ°å€ä¹Ÿå«ç‰©ç†åœ°å€ã€ç¡¬ä»¶åœ°å€ï¼Œç”±ç½‘ç»œè®¾å¤‡åˆ¶é€ å•†ç”Ÿäº§æ—¶çƒ§å½•åœ¨ç½‘å¡çš„<a href="https://baike.baidu.com/item/EPROM/1690813">EPROM</a>(ä¸€ç§é—ªå­˜èŠ¯ç‰‡ï¼Œé€šå¸¸å¯ä»¥é€šè¿‡ç¨‹åºæ“¦å†™)ã€‚<a href="https://baike.baidu.com/item/IP%E5%9C%B0%E5%9D%80/150859">IPåœ°å€</a>ä¸ŽMACåœ°å€åœ¨è®¡ç®—æœºé‡Œéƒ½æ˜¯ä»¥<a href="https://baike.baidu.com/item/%E4%BA%8C%E8%BF%9B%E5%88%B6/361457">äºŒè¿›åˆ¶</a>è¡¨ç¤ºçš„ï¼ŒIPåœ°å€æ˜¯32ä½çš„ï¼Œè€ŒMACåœ°å€åˆ™æ˜¯48ä½çš„ ã€‚</p>
<h4 id="æœ‰äº†-ip-åœ°å€ä¸ºä»€ä¹ˆè¿˜è¦ç”¨-mac-åœ°å€">æœ‰äº† IP åœ°å€ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨ MAC åœ°å€</h4>
<p>IPåœ°å€å±žäºŽç½‘ç»œå±‚ï¼Œè€ŒMACåœ°å€å±žäºŽæ•°æ®é“¾è·¯å±‚ã€‚ ç½‘ç»œå±‚åè®®ä½¿æ•°æ®å¯ä»¥ä»Žä¸€ä¸ªç½‘ç»œä¼ é€’åˆ°å¦ä¸€ä¸ªç½‘ç»œä¸Šï¼ˆARPæ ¹æ®ç›®çš„IPåœ°å€ï¼Œæ‰¾åˆ°ä¸­é—´èŠ‚ç‚¹çš„MACåœ°å€ï¼Œé€šè¿‡ä¸­é—´èŠ‚ç‚¹ä¼ é€ï¼Œä»Žè€Œæœ€ç»ˆåˆ°è¾¾ç›®çš„ç½‘ç»œï¼‰ï¼›æ•°æ®é“¾è·¯å±‚åè®®å¯ä»¥ä½¿æ•°æ®ä»Žä¸€ä¸ªèŠ‚ç‚¹ä¼ é€’åˆ°ç›¸åŒé“¾è·¯çš„å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼ˆé€šè¿‡MACåœ°å€ï¼‰ã€‚</p>
<ol>
<li>
<p><strong>MACåœ°å€å¯»å€çš„æ—¶é—´å¤æ‚åº¦å¤ªå¤§</strong></p>
<p>å¦‚æžœåªæœ‰MACåœ°å€ï¼Œæ˜¯æ— æ³•æ”¯æ’‘èµ·è¿™ä¹ˆå¤§çš„ç½‘ç»œçš„ï¼Œä½ è§‰å¾—ç›´æŽ¥è®¿é—®åˆ°MACåœ°å€å°±è¡Œäº†ï¼Œé—®é¢˜æ˜¯ä½ è®©è·¯ç”±å™¨æ€Žä¹ˆç»™ä½ æ‰¾åˆ°è·¯çº¿å‘¢ï¼Ÿ</p>
</li>
<li>
<p><strong>æ²¡æœ‰ç»Ÿä¸€çš„ç¡¬ä»¶åœ°å€</strong></p>
<p>ç”±äºŽå…¨ä¸–ç•Œå­˜åœ¨ç€å„å¼å„æ ·çš„ç½‘ç»œï¼Œ<code>ä»–ä»¬ä½¿ç”¨ä¸åŒçš„ç¡¬ä»¶åœ°å€</code>ã€‚è¦ä½¿è¿™äº›å¼‚æž„ç½‘ç»œèƒ½å¤Ÿäº’ç›¸é€šä¿¡å°±å¿…é¡»è¿›è¡Œ<code>éžå¸¸å¤æ‚çš„ç¡¬ä»¶åœ°å€è½¬åŒ–å·¥ä½œ</code>ï¼Œå› æ­¤ç”±ç”¨æˆ·æˆ–ç”¨æˆ·ä¸»æœºæ¥å®Œæˆè¿™é¡¹å·¥ä½œå‡ ä¹Žæ˜¯ä¸å¯èƒ½çš„çš„äº‹ã€‚ä½†IPç¼–å€å°±æŠŠè¿™ä¸ªå¤æ‚çš„é—®é¢˜è§£å†³äº†ã€‚è¿žæŽ¥åˆ°äº’è”ç½‘çš„ä¸»æœºåªéœ€è¦å„è‡ªæ‹¥æœ‰ä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ï¼Œä»–ä»¬ä¹‹é—´çš„é€šä¿¡å°±åƒè¿žæŽ¥åœ¨åŒä¸€ä¸ªç½‘ç»œé‚£ä¹ˆç®€å•æ–¹ä¾¿ã€‚å› ä¸ºARPæ˜¯ç”±è®¡ç®—æœºè½¯ä»¶è‡ªåŠ¨è¿›è¡Œçš„ï¼Œå¯¹ç”¨æˆ·æ¥è¯´æ˜¯çœ‹ä¸è§è¿™ç§è°ƒç”¨è¿‡ç¨‹çš„ã€‚</p>
</li>
</ol>
<blockquote>
<p>IPåœ°å€æ˜¯é€»è¾‘åœ°å€ï¼Œéœ€è¦æ˜ å°„åˆ°ç‰©ç†åœ°å€MACåœ°å€æ‰èƒ½å°†æ•°æ®å†™å…¥å¯¹æ–¹çš„ç½‘å¡ã€‚</p>
</blockquote>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://blog.csdn.net/hsd2012/article/details/51074549">æœ‰äº† IP åœ°å€ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨ MAC åœ°å€</a></li>
<li><a href="https://www.jianshu.com/p/7d8df9db0484">ä¸ºä»€ä¹ˆæœ‰äº†Macåœ°å€ï¼Œè¿˜è¦IPåœ°å€</a></li>
</ol>
<h3 id="-dnsåè®®">ðŸ›°ï¸ DNSåè®®</h3>
<p><code>DNS</code>ï¼ˆDomain Name Systemï¼‰æœåŠ¡æ˜¯å’ŒHTTPåè®®ä¸€æ ·ä½äºŽåº”ç”¨å±‚çš„åè®®ã€‚å®ƒæä¾›åŸŸååˆ°IPåœ°å€ä¹‹é—´çš„è§£æžæœåŠ¡ã€‚</p>
<p>ç®€å•çš„è¿‡ç¨‹ï¼š</p>
<p><img src="https://i.loli.net/2020/11/11/h1Di7pjZxnPqYgz.png" alt="DNSç®€å•è§£æžè¿‡ç¨‹" /></p>
<p>å¤æ‚è§£æžè¿‡ç¨‹ï¼š</p>
<p>å½“ä¸€ä¸ªåº”ç”¨è¿›ç¨‹éœ€è¦æŠŠä¸»æœºåè§£æžä¸º<code>ip</code>åœ°å€æ—¶ï¼Œè¯¥åº”ç”¨è¿›ç¨‹å°±è°ƒç”¨è§£æžç¨‹åºï¼Œå¹¶æˆä¸º<code>dns</code>çš„ä¸€ä¸ªå®¢æˆ·ï¼ŒæŠŠå¾…è§£æžçš„åŸŸååœ¨<code>dns</code>è¯·æ±‚æŠ¥æ–‡ä¸­ï¼Œä»¥**<code>udp</code>ç”¨æˆ·æ•°æ®æŠ¥**æ–¹å¼å‘é€ç»™æœ¬åœ°åŸŸåæœåŠ¡å™¨ã€‚<strong>æœ¬åœ°åŸŸåæœåŠ¡å™¨</strong>åœ¨æŸ¥æ‰¾åŸŸååŽï¼ŒæŠŠå¯¹åº”çš„<code>ip</code>åœ°å€æ”¾åœ¨å›žç­”æŠ¥æ–‡ä¸­è¿”å›žã€‚åº”ç”¨è¿›ç¨‹èŽ·å¾—ç›®çš„ä¸»æœºçš„<code>ip</code>åœ°å€åŽå³å¯è¿›è¡Œé€šä¿¡ã€‚<br />
è‹¥æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸èƒ½å›žç­”è¯¥è¯·æ±‚ï¼Œåˆ™æ­¤åŸŸåæœåŠ¡å™¨å°±æš‚æ—¶æˆä¸ºäº†<code>dns</code>ä¸­çš„å¦ä¸€ä¸ªå®¢æˆ·ï¼Œå¹¶å‘å…¶å®ƒåŸŸåæœåŠ¡å™¨å‘é€æŸ¥è¯¢è¯·æ±‚ã€‚è¿™ç§è¿‡ç¨‹ç›´è‡³æ‰¾åˆ°èƒ½å¤Ÿå›žç­”è¯¥è¯·æ±‚çš„åŸŸåæœåŠ¡å™¨ä¸ºæ­¢ã€‚</p>
<p><img src="https://i.loli.net/2020/10/18/pTKw2oPygBu3N1C.jpg" alt="img" /></p>
<p>åŸŸåæœåŠ¡è§£æžçš„ä¸¤ç§æ–¹å¼ï¼š</p>
<p><strong>å®¢æˆ·ç«¯å‘å‡ºçš„æŸ¥è¯¢éƒ½æ˜¯é€’å½’æŸ¥è¯¢ï¼ŒDNSæœåŠ¡å™¨å‘å¤–å‘å‡ºçš„æŸ¥è¯¢ä¸€èˆ¬éƒ½æ˜¯è¿­ä»£æŸ¥è¯¢</strong></p>
<p><img src="https://i.loli.net/2020/10/18/4otA7jgN9UEnHO5.jpg" alt="é€’å½’æŸ¥è¯¢" /></p>
<p><img src="https://i.loli.net/2020/10/18/AIYaNl6HeUxySgt.jpg" alt="è¿­ä»£æŸ¥è¯¢" /></p>
<p><img src="https://i.loli.net/2020/10/18/GFAp6VNz71CHd9L.jpg" alt="é€’å½’åŠ è¿­ä»£" /></p>
<h3 id="heading"></h3>
<h3 id="-ftpåè®®">ðŸ—ƒï¸ FTPåè®®</h3>
<p>æ–‡ä»¶ä¼ è¾“åè®®FTP(File Transfer Protocol)æ˜¯å› ç‰¹ç½‘ä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„æ–‡ä»¶ä¼ è¾“åè®®ã€‚FTPä½¿ç”¨äº¤äº’å¼çš„è®¿é—®ï¼Œå…è®¸å®¢æˆ·æŒ‡å®šæ–‡ä»¶çš„ç±»åž‹å’Œæ ¼å¼(å¦‚æŒ‡æ˜Žæ˜¯å¦ä½¿ç”¨ASCIIç )ï¼Œå¹¶å…è®¸æ–‡ä»¶å…·æœ‰å­˜å–æƒé™(å¦‚è®¿é—®æ–‡ä»¶çš„ç”¨æˆ·å¿…é¡»ç»è¿‡æŽˆæƒï¼Œå¹¶è¾“å…¥æœ‰æ•ˆçš„å£ä»¤)ã€‚</p>
<p>æ–‡ä»¶ä¼ è¾“åè®®æœ‰åŸºäºŽ<strong>TCP</strong>çš„FTPå’ŒåŸºäºŽ<strong>UDP</strong>çš„ç®€å•æ–‡ä»¶ä¼ è¾“åè®®<strong>TFTP</strong>ï¼Œå®ƒä»¬éƒ½æ˜¯æ–‡ä»¶å…±äº«åè®®ä¸­çš„ä¸€å¤§ç±»ï¼Œå³å¤åˆ¶æ•´ä¸ªæ–‡ä»¶ï¼Œå…¶ç‰¹ç‚¹æ˜¯ï¼šè‹¥è¦å­˜å–ä¸€ä¸ªæ–‡ä»¶ï¼Œå°±å¿…é¡»å…ˆèŽ·å¾—ä¸€ä¸ªæœ¬åœ°çš„æ–‡ä»¶å‰¯æœ¬ã€‚å¦‚æžœè¦ä¿®æ”¹æ–‡ä»¶ï¼Œåªèƒ½å¯¹æ–‡ä»¶çš„å‰¯æœ¬è¿›è¡Œä¿®æ”¹ï¼Œç„¶åŽå†å°†ä¿®æ”¹åŽçš„æ–‡ä»¶ä¼ å›žåˆ°åŽŸèŠ‚ç‚¹ã€‚</p>
<p>ä¸ŽTelnetç±»ä¼¼ï¼ŒFTPæœ€æ—©çš„è®¾è®¡æ˜¯ç”¨äºŽä¸¤å°ä¸åŒçš„ä¸»æœºï¼Œè¿™ä¸¤ä¸ªä¸»æœºå¯èƒ½è¿è¡Œåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸‹ã€ä½¿ç”¨ä¸åŒçš„æ–‡ä»¶ç»“æž„ã€å¹¶å¯èƒ½ä½¿ç”¨ä¸åŒå­—ç¬¦é›†ã€‚ä½†ä¸åŒçš„æ˜¯ï¼ŒTelnetèŽ·å¾—å¼‚æž„æ€§æ˜¯å¼ºåˆ¶ä¸¤ç«¯éƒ½é‡‡ç”¨åŒä¸€ä¸ªæ ‡å‡†ï¼šä½¿ç”¨7æ¯”ç‰¹ASCIIç çš„NVTã€‚è€ŒFTPæ˜¯é‡‡ç”¨å¦ä¸€ç§æ–¹æ³•æ¥å¤„ç†ä¸åŒç³»ç»Ÿé—´çš„å·®å¼‚ã€‚FTPæ”¯æŒæœ‰é™æ•°é‡çš„æ–‡ä»¶ç±»åž‹ï¼ˆASCIIï¼ŒäºŒè¿›åˆ¶ï¼Œç­‰ç­‰ï¼‰å’Œæ–‡ä»¶ç»“æž„ï¼ˆé¢å‘å­—èŠ‚æµæˆ–è®°å½•ï¼‰</p>
<p>FTPä¸Žæˆ‘ä»¬å·²æè¿°çš„å¦ä¸€ç§åº”ç”¨ä¸åŒï¼Œå®ƒé‡‡ç”¨ä¸¤ä¸ªTCPè¿žæŽ¥æ¥ä¼ è¾“ä¸€ä¸ªæ–‡ä»¶ã€‚</p>
<ol>
<li>æŽ§åˆ¶è¿žæŽ¥ä»¥é€šå¸¸çš„å®¢æˆ·æœåŠ¡å™¨æ–¹å¼å»ºç«‹ã€‚æœåŠ¡å™¨ä»¥è¢«åŠ¨æ–¹å¼æ‰“å¼€ä¼—æ‰€å‘¨çŸ¥çš„ç”¨äºŽFTPçš„ç«¯å£ï¼ˆ21ï¼‰ï¼Œç­‰å¾…å®¢æˆ·çš„è¿žæŽ¥ã€‚å®¢æˆ·åˆ™ä»¥ä¸»åŠ¨æ–¹å¼æ‰“å¼€TCPç«¯å£21ï¼Œæ¥å»ºç«‹è¿žæŽ¥ã€‚æŽ§åˆ¶è¿žæŽ¥å§‹ç»ˆç­‰å¾…å®¢æˆ·ä¸ŽæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ã€‚è¯¥è¿žæŽ¥å°†å‘½ä»¤ä»Žå®¢æˆ·ä¼ ç»™æœåŠ¡å™¨ï¼Œå¹¶ä¼ å›žæœåŠ¡å™¨çš„åº”ç­”ã€‚<br />
ç”±äºŽå‘½ä»¤é€šå¸¸æ˜¯ç”±ç”¨æˆ·é”®å…¥çš„ï¼Œæ‰€ä»¥IPå¯¹æŽ§åˆ¶è¿žæŽ¥çš„æœåŠ¡ç±»åž‹å°±æ˜¯â€œæœ€å¤§é™åº¦åœ°å‡å°è¿Ÿå»¶â€ã€‚</li>
<li>æ¯å½“ä¸€ä¸ªæ–‡ä»¶åœ¨å®¢æˆ·ä¸ŽæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ—¶ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ•°æ®è¿žæŽ¥ã€‚ï¼ˆå…¶ä»–æ—¶é—´ä¹Ÿå¯ä»¥åˆ›å»ºï¼ŒåŽé¢æˆ‘ä»¬å°†è¯´åˆ°ï¼‰ã€‚<br />
ç”±äºŽè¯¥è¿žæŽ¥ç”¨äºŽä¼ è¾“ç›®çš„ï¼Œæ‰€ä»¥IPå¯¹æ•°æ®è¿žæŽ¥çš„æœåŠ¡ç‰¹ç‚¹å°±æ˜¯â€œæœ€å¤§é™åº¦æé«˜åžåé‡â€ã€‚</li>
</ol>
<p>è¿žæŽ¥æƒ…å†µï¼š</p>
<p><img src="https://i.loli.net/2020/11/12/YNWHw5nD4kyS67Z.png" alt="æ–‡ä»¶ä¼ è¾“ä¸­çš„è¿‡ç¨‹å¤„ç†" /></p>
<p>ä»Žå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œäº¤äº’å¼ç”¨æˆ·é€šå¸¸ä¸å¤„ç†åœ¨æŽ§åˆ¶è¿žæŽ¥ä¸­è½¬æ¢çš„å‘½ä»¤å’Œåº”ç­”ã€‚è¿™äº›ç»†èŠ‚å‡ç”±ä¸¤ä¸ªåè®®è§£é‡Šå™¨æ¥å®Œæˆã€‚æ ‡æœ‰â€œç”¨æˆ·æŽ¥å£â€çš„æ–¹æ¡†åŠŸèƒ½æ˜¯æŒ‰ç”¨æˆ·æ‰€éœ€æä¾›å„ç§äº¤äº’ç•Œé¢ï¼ˆå…¨å±å¹•èœå•é€‰æ‹©ï¼Œé€è¡Œè¾“å…¥å‘½ä»¤ï¼Œç­‰ç­‰ï¼‰ï¼Œå¹¶æŠŠå®ƒä»¬è½¬æ¢æˆåœ¨æŽ§åˆ¶è¿žæŽ¥ä¸Šå‘é€çš„FTPå‘½ä»¤ã€‚ç±»ä¼¼åœ°ï¼Œä»ŽæŽ§åˆ¶è¿žæŽ¥ä¸Šä¼ å›žçš„æœåŠ¡å™¨åº”ç­”ä¹Ÿè¢«è½¬æ¢æˆç”¨æˆ·æ‰€éœ€çš„äº¤äº’æ ¼å¼ã€‚</p>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://www.cnblogs.com/luoxn28/p/5585458.html">æ·±å…¥ç†è§£FTPåè®®</a></li>
<li><a href="http://docs.52im.net/extend/docs/book/tcpip/vol1/27/">ç¬¬27ç«  FTP:æ–‡ä»¶ä¼ é€åè®®</a></li>
</ol>
<h2 id="x509-æ•°å­—è¯ä¹¦">X.509 æ•°å­—è¯ä¹¦</h2>
<p>ç®€å•æ¥è¯´ï¼Œæ•°å­—è¯ä¹¦å°±æ˜¯ä¸€å¼ é™„å¸¦äº†æ•°å­—ç­¾åçš„ä¿¡æ¯è¡¨ã€‚</p>
<img src="https://i.loli.net/2020/08/25/7XI4THyOUWvmwCx.jpg" alt="X.509è¯ä¹¦" style="zoom:67%;" />
<h3 id="æ•°å­—è¯ä¹¦çš„ç­¾ç½²">æ•°å­—è¯ä¹¦çš„ç­¾ç½²</h3>
<p>æ€»çš„æ¥è¯´ï¼Œå°±æ˜¯å¯¹å…¬é’¥å’Œä¿¡æ¯è¿›è¡Œhashå¾—åˆ°æ‘˜è¦ï¼Œç„¶åŽä½¿ç”¨ç§é’¥å¯¹æ‘˜è¦è¿›è¡ŒåŠ å¯†å¾—åˆ°åŠ å¯†åŽçš„æ‘˜è¦ã€‚åŠ åŠ å¯†åŽçš„æ‘˜è¦å’Œå…¬é’¥ä»¥åŠä¿¡æ¯åŒ…è£…æˆä¸€ä¸ªè¯ä¹¦ã€‚</p>
<h4 id="æ ¹è®¤è¯æœºæž„çš„æž„å»º">æ ¹è®¤è¯æœºæž„çš„æž„å»º</h4>
<p><strong>ç®€è¦æµç¨‹</strong></p>
<ol>
<li>æ ¹è®¤è¯æœºæž„ã€ŒCAã€ç”Ÿæˆå…¬é’¥ <code>ca_KeyPub</code> å’Œç§é’¥ <code>ca_KeyPri</code>ï¼Œä»¥åŠåŸºæœ¬ä¿¡æ¯è¡¨ <code>ca_Info</code>ã€‚<code>ca_Info</code> ä¸­ä¸€èˆ¬åŒ…å«äº†ã€ŒCAã€çš„åç§°ã€è¯ä¹¦çš„æœ‰æ•ˆæœŸç­‰ä¿¡æ¯ã€‚</li>
<li>æ ¹è®¤è¯æœºæž„ã€ŒCAã€å¯¹ï¼ˆ<code>ca_KeyPub</code> + <code>ca_Info</code>ï¼‰è¿›è¡Œæ•£åˆ—è¿ç®—ï¼Œå¾—åˆ°æ•£åˆ—å€¼ <code>ca_Hash</code>ã€‚</li>
<li>æ ¹è®¤è¯æœºæž„ã€ŒCAã€ä½¿ç”¨å…¶ç§é’¥ <code>ca_KeyPri</code> å¯¹ <code>ca_Hash</code> è¿›è¡Œéžå¯¹ç§°åŠ å¯†ï¼Œå¾—åˆ°åŠ å¯†çš„æ•£åˆ—å€¼ <code>enc_ca_Hash</code>ã€‚</li>
<li>æ ¹è®¤è¯æœºæž„ã€ŒCAã€å°†ï¼ˆ<code>ca_KeyPub</code> + <code>ca_Info</code> + <code>enc_ca_Hash</code>ï¼‰ç»„åˆç”Ÿæˆè‡ªç­¾åçš„æ•°å­—è¯ä¹¦**ã€Œca_Certã€**ã€‚è¿™å¼ è¯ä¹¦ç§°ä¹‹ä¸ºæ ¹è¯ä¹¦ã€‚</li>
</ol>
<p>æ ¹è¯ä¹¦**ã€Œca_Certã€**åŒ…å«çš„å†…å®¹ï¼š<code>ca_KeyPub</code> + <code>ca_Info</code> + <code>enc_ca_Hash</code>ã€‚</p>
<p><img src="https://i.loli.net/2020/08/25/9Zj4xVOUKuL7B6r.png" alt="æ ¹è®¤è¯æœºæž„" /></p>
<p>**ã€Œca_Certã€**å¯ç”¨äºŽç­¾ç½²ä¸‹ä¸€çº§çš„è¯ä¹¦ã€‚</p>
<h4 id="å•çº§è®¤è¯æœºæž„çš„è¯ä¹¦ç­¾ç½²">å•çº§è®¤è¯æœºæž„çš„è¯ä¹¦ç­¾ç½²</h4>
<p><strong>ç®€è¦æµç¨‹</strong></p>
<ol>
<li>æœåŠ¡å™¨ã€ŒSã€ç”Ÿæˆå…¬é’¥ <code>s_KeyPub</code> å’Œç§é’¥ <code>s_KeyPri</code>ï¼Œä»¥åŠåŸºæœ¬ä¿¡æ¯è¡¨ <code>s_Info</code>ã€‚<code>s_Info</code> ä¸­ä¸€èˆ¬åŒ…å«äº†ã€ŒSã€çš„åç§°ã€è¯ä¹¦è¦æ±‚çš„æœ‰æ•ˆæœŸç­‰ä¿¡æ¯ã€‚</li>
<li>æœåŠ¡å™¨ã€ŒSã€å°† <code>s_KeyPub</code>ã€<code>s_Info</code> é€ç»™æ ¹è®¤è¯æœºæž„ã€ŒCAã€ã€‚</li>
<li>æ ¹è®¤è¯æœºæž„ã€ŒCAã€é€šè¿‡æŸç§æ–¹å¼éªŒè¯ã€ŒSã€çš„èº«ä»½ä¹‹åŽï¼Œå†åŠ ä¸Šæ ¹è®¤è¯æœºæž„è‡ªå·±çš„ä¸€äº›ä¿¡æ¯ <code>ca_Info</code>ï¼Œç„¶åŽå¯¹å®ƒä»¬ï¼ˆ<code>s_KeyPub</code> + <code>s_Info</code> + <code>ca_Info</code>ï¼‰è¿›è¡Œæ•£åˆ—è¿ç®—ï¼Œå¾—åˆ°æ•£åˆ—å€¼ <code>s_Hash</code>ã€‚</li>
<li>æ ¹è®¤è¯æœºæž„ã€ŒCAã€ä½¿ç”¨å…¶ç§é’¥ <code>ca_KeyPri</code> å¯¹ <code>s_Hash</code> è¿›è¡Œéžå¯¹ç§°åŠ å¯†ï¼Œå¾—åˆ°åŠ å¯†çš„æ•£åˆ—å€¼ <code>enc_s_Hash</code>ã€‚</li>
<li>æ ¹è®¤è¯æœºæž„ã€ŒCAã€å°†ï¼ˆ<code>s_KeyPub</code> + <code>s_Info</code> + <code>ca_Info</code> + <code>enc_s_Hash</code>ï¼‰ç»„åˆç­¾ç½²æˆæ•°å­—è¯ä¹¦**ã€Œs_Certã€**å¹¶å›žé€ç»™ã€ŒSã€ã€‚</li>
</ol>
<p>æœåŠ¡å™¨è¯ä¹¦**ã€Œs_Certã€**åŒ…å«çš„å†…å®¹ï¼š<code>s_KeyPub</code> + <code>s_Info</code> + <code>ca_Info</code> + <code>enc_s_Hash</code>ã€‚</p>
<p><img src="https://i.loli.net/2020/08/25/H9ysQozAJO825av.png" alt="å•çº§è®¤è¯æœºæž„çš„è¯ä¹¦ç­¾ç½²" /></p>
<p>**ã€Œs_Certã€**ä¸å¯ç”¨äºŽç­¾ç½²ä¸‹ä¸€çº§çš„è¯ä¹¦ã€‚</p>
<h4 id="äºŒçº§æˆ–ä»¥ä¸Šè®¤è¯æœºæž„çš„æž„å»º">äºŒçº§ï¼ˆæˆ–ä»¥ä¸Šï¼‰è®¤è¯æœºæž„çš„æž„å»º</h4>
<blockquote>
<p>åœ¨çŽ°å®žä¸­ï¼Œä»…ä»…é ä¸€ä¸ªè®¤è¯æœºæž„æ˜¯æ»¡è¶³ä¸äº†æµ·é‡è¯ä¹¦ç­¾ç½²éœ€æ±‚çš„ï¼Œå› æ­¤éœ€è¦æž„å»ºåˆ†æ”¯è®¤è¯æœºæž„ã€‚</p>
</blockquote>
<p><strong>ç®€è¦æµç¨‹</strong></p>
<ol>
<li>äºŒçº§è®¤è¯æœºæž„ã€ŒCA2ã€ç”Ÿæˆå…¬é’¥ <code>ca2_KeyPub</code> å’Œç§é’¥ <code>ca2_KeyPri</code>ï¼Œä»¥åŠåŸºæœ¬ä¿¡æ¯è¡¨ <code>ca2_Info</code>ã€‚<code>ca2_Info</code> ä¸­ä¸€èˆ¬åŒ…å«äº†ã€ŒCA2ã€çš„åç§°ã€è¯ä¹¦è¦æ±‚çš„æœ‰æ•ˆæœŸç­‰ä¿¡æ¯ã€‚</li>
<li>äºŒçº§è®¤è¯æœºæž„ã€ŒCA2ã€å°† <code>ca2_KeyPub</code>ã€<code>ca2_Info</code> é€ç»™æ ¹è®¤è¯æœºæž„ã€ŒCAã€ã€‚</li>
<li>æ ¹è®¤è¯æœºæž„ã€ŒCAã€é€šè¿‡æŸç§æ–¹å¼éªŒè¯ã€ŒCA2ã€çš„èº«ä»½ä¹‹åŽï¼Œå†åŠ ä¸Šæ ¹è®¤è¯æœºæž„è‡ªå·±çš„ä¸€äº›ä¿¡æ¯ <code>ca_Info</code>ï¼Œç„¶åŽå¯¹å®ƒä»¬ï¼ˆ<code>ca2_KeyPub</code> + <code>ca2_Info</code> + <code>ca_Info</code>ï¼‰è¿›è¡Œæ•£åˆ—è¿ç®—ï¼Œå¾—åˆ°æ•£åˆ—å€¼ <code>ca2_Hash</code>ã€‚</li>
<li>æ ¹è®¤è¯æœºæž„ã€ŒCAã€ä½¿ç”¨å…¶ç§é’¥ <code>ca_KeyPri</code> å¯¹ <code>ca2_Hash</code> è¿›è¡Œéžå¯¹ç§°åŠ å¯†ï¼Œå¾—åˆ°åŠ å¯†çš„æ•£åˆ—å€¼ <code>enc_ca2_Hash</code>ã€‚</li>
<li>æ ¹è®¤è¯æœºæž„ã€ŒCAã€å°†ï¼ˆ<code>ca2_KeyPub</code> + <code>ca2_Info</code> + <code>ca_Info</code> + <code>enc_ca2_Hash</code>ï¼‰ç»„åˆç­¾ç½²æˆæ•°å­—è¯ä¹¦**ã€Œca2_Certã€**å¹¶å›žé€ç»™ã€ŒCA2ã€ã€‚</li>
</ol>
<p>äºŒçº§è®¤è¯æœºæž„è¯ä¹¦**ã€Œca2_Certã€**åŒ…å«çš„å†…å®¹ï¼š<code>ca2_KeyPub</code> + <code>ca2_Info</code> + <code>ca_Info</code> + <code>enc_ca2_Hash</code>ã€‚</p>
<p>**ã€Œca2_Certã€**å¯ç”¨äºŽç­¾ç½²ä¸‹ä¸€çº§çš„è¯ä¹¦ã€‚</p>
<p>ä¸‰çº§æˆ–æ›´å¤šçº§è®¤è¯æœºæž„çš„æž„å»ºæµç¨‹è·Ÿè¿™ä¸ªæµç¨‹å·®ä¸å¤šï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚</p>
<h4 id="äºŒçº§æˆ–ä»¥ä¸Šè®¤è¯æœºæž„çš„è¯ä¹¦ç­¾ç½²">äºŒçº§ï¼ˆæˆ–ä»¥ä¸Šï¼‰è®¤è¯æœºæž„çš„è¯ä¹¦ç­¾ç½²</h4>
<p><strong>ç®€è¦æµç¨‹</strong></p>
<ol>
<li>æœåŠ¡å™¨ã€ŒS2ã€ç”Ÿæˆå…¬é’¥ <code>s2_KeyPub</code> å’Œç§é’¥ <code>s2_KeyPri</code>ï¼Œä»¥åŠåŸºæœ¬ä¿¡æ¯è¡¨ <code>s2_Info</code>ã€‚<code>s2_Info</code> ä¸­ä¸€èˆ¬åŒ…å«äº†ã€ŒS2ã€çš„åç§°ã€è¯ä¹¦è¦æ±‚çš„æœ‰æ•ˆæœŸç­‰ä¿¡æ¯ã€‚</li>
<li>æœåŠ¡å™¨ã€ŒS2ã€å°† <code>s2_KeyPub</code>ã€<code>s2_Info</code> é€ç»™äºŒçº§è®¤è¯æœºæž„ã€ŒCA2ã€ã€‚</li>
<li>äºŒçº§è®¤è¯æœºæž„ã€ŒCA2ã€é€šè¿‡æŸç§æ–¹å¼éªŒè¯ã€ŒS2ã€çš„èº«ä»½ä¹‹åŽï¼Œå†åŠ ä¸Šæ ¹è®¤è¯æœºæž„è‡ªå·±çš„ä¸€äº›ä¿¡æ¯ <code>ca2_Info</code>ï¼Œç„¶åŽå¯¹å®ƒä»¬ï¼ˆ<code>s2_KeyPub</code> + <code>s2_Info</code> + <code>ca2_Info</code>ï¼‰è¿›è¡Œæ•£åˆ—è¿ç®—ï¼Œå¾—åˆ°æ•£åˆ—å€¼ <code>s2_Hash</code>ã€‚</li>
<li>äºŒçº§è®¤è¯æœºæž„ã€ŒCA2ã€ä½¿ç”¨å…¶ç§é’¥ <code>ca2_KeyPri</code> å¯¹ <code>s2_Hash</code> è¿›è¡Œéžå¯¹ç§°åŠ å¯†ï¼Œå¾—åˆ°åŠ å¯†çš„æ•£åˆ—å€¼ <code>enc_s2_Hash</code>ã€‚</li>
<li>äºŒçº§è®¤è¯æœºæž„ã€ŒCA2ã€å°†ï¼ˆ<code>s2_KeyPub</code> + <code>s2_Info</code> + <code>ca2_Info</code> + <code>enc_s2_Hash</code>ï¼‰ç»„åˆç­¾ç½²æˆæ•°å­—è¯ä¹¦**ã€Œs2_Certã€**å¹¶å›žé€ç»™ã€ŒS2ã€ã€‚</li>
</ol>
<p>æœåŠ¡å™¨è¯ä¹¦**ã€Œs2_Certã€**åŒ…å«çš„å†…å®¹ï¼š<code>s2_KeyPub</code> + <code>s2_Info</code> + <code>ca2_Info</code> + <code>enc_s2_Hash</code>ã€‚</p>
<p>**ã€Œs2_Certã€**ä¸å¯ç”¨äºŽç­¾ç½²ä¸‹ä¸€çº§çš„è¯ä¹¦ã€‚</p>
<p>ä¸‰çº§æˆ–æ›´å¤šçº§è®¤è¯æœºæž„è¯ä¹¦ç­¾ç½²æµç¨‹è·Ÿè¿™ä¸ªæµç¨‹å·®ä¸å¤šï¼Œä¹Ÿä¸å†èµ˜è¿°äº†ã€‚</p>
<p>ä»Žä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œè¯ä¹¦ç­¾ç½²çš„æµç¨‹æ˜¯ï¼š<strong>ã€Œca_Certã€</strong>-&gt; <strong>ã€Œca2_Certã€</strong>-&gt;<strong>ã€Œs2_Certã€</strong>ã€‚å®ƒæ˜¯ä¸€æ¡å®Œæ•´çš„é“¾æ¡ï¼Œæˆ‘ä»¬æŠŠå®ƒç§°ä¹‹ä¸ºã€Œè¯ä¹¦é“¾ã€ã€‚</p>
<h4 id="çŽ°å®žä¸­çš„è¯ä¹¦ç­¾ç½²">çŽ°å®žä¸­çš„è¯ä¹¦ç­¾ç½²</h4>
<p>çŽ°å®žä¸­çš„è¯ä¹¦å¤§å¤šæ•°æ˜¯ç”±äºŒçº§è®¤è¯æœºæž„ç­¾ç½²çš„ã€‚</p>
<p>å¹¶ä¸”ï¼Œä»¥æŸç§æ–¹å¼ï¼ˆå¦‚ DNSï¼‰å¯¹æœåŠ¡å™¨çš„èº«ä»½è¿›è¡ŒéªŒè¯ä¹‹åŽï¼Œä¸€èˆ¬æ— éœ€è®©æœåŠ¡å™¨æä¾›ä»»ä½•ä¿¡æ¯ï¼ˆCSR æ–‡ä»¶ï¼‰ã€‚</p>
<p>è®¤è¯æœºæž„ä¼šæä¾›è¯ä¹¦ã€è¯ä¹¦é“¾ä»¥åŠç§é’¥ï¼ŒæœåŠ¡å™¨ç›´æŽ¥ä½¿ç”¨å°±å¥½äº†ã€‚</p>
<h3 id="æœåŠ¡å™¨çš„é…ç½®">æœåŠ¡å™¨çš„é…ç½®</h3>
<p>å¦‚æžœæœåŠ¡å™¨ã€ŒSã€ä½¿ç”¨çš„è¯ä¹¦æ˜¯ç”±æ ¹è®¤è¯æœºæž„ã€ŒCAã€ç›´æŽ¥ç­¾ç½²çš„ï¼Œé‚£ä¹ˆåªéœ€è¦å‘å®¢æˆ·ç«¯æä¾›**ã€Œs_Certã€**ï¼Œç„¶åŽè‡ªå·±ä½¿ç”¨ç§é’¥ <code>s_KeyPri</code> å³å¯å®žçŽ°éžå¯¹ç§°åŠ å¯†ã€‚</p>
<p>å¦‚æžœæœåŠ¡å™¨ã€ŒS2ã€ä½¿ç”¨çš„è¯ä¹¦ä¸æ˜¯ç”±æ ¹è®¤è¯æœºæž„ã€ŒCAã€ç›´æŽ¥ç­¾ç½²çš„ï¼Œåˆ™ä¸ä»…éœ€è¦å‘å®¢æˆ·ç«¯æä¾›**ã€Œs2_Certã€<strong>ï¼Œè€Œä¸”è¿˜è¦æä¾›é™¤æ ¹è®¤è¯æœºæž„ã€ŒCAã€ä¹‹å¤–æ‰€æœ‰è®¤è¯æœºæž„çš„è¯ä¹¦ï¼ˆè¿™é‡Œè¿˜è¦æä¾›</strong>ã€Œca2_Certã€**ï¼‰ï¼Œå¦åˆ™å®¢æˆ·ç«¯å¯èƒ½ä¼šæç¤ºè¯ä¹¦é“¾ä¸å®Œæ•´è€Œæ— æ³•é€šè¿‡éªŒè¯ã€‚æœåŠ¡å™¨è‡ªå·±ä½¿ç”¨ç§é’¥ <code>s2_KeyPri</code> å³å¯å®žçŽ°éžå¯¹ç§°åŠ å¯†ã€‚</p>
<h3 id="å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨çš„èº«ä»½">å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨çš„èº«ä»½</h3>
<h4 id="å•çº§è®¤è¯æœºæž„çš„éªŒè¯">å•çº§è®¤è¯æœºæž„çš„éªŒè¯</h4>
<p><strong>ç®€è¦æµç¨‹</strong></p>
<p>ï¼ˆå‡è®¾æ ¹è®¤è¯æœºæž„ã€ŒCAã€çš„æ ¹è¯ä¹¦**ã€Œca_Certã€**å·²ç»å®‰è£…åˆ°æ“ä½œç³»ç»Ÿä¸­ä¸”è¢«ä¿¡ä»»ã€‚ä¸‹åŒã€‚ï¼‰</p>
<ol>
<li>æœåŠ¡å™¨ã€ŒSã€ä¸‹å‘è¯ä¹¦**ã€Œs_Certã€**ç»™å®¢æˆ·ç«¯ã€ŒCã€ã€‚</li>
<li>å®¢æˆ·ç«¯ã€ŒCã€æ£€æŸ¥åˆ°**ã€Œs_Certã€**ä¸­çš„ <code>ca_Info</code>ï¼Œå‘çŽ°å®ƒæ˜¯ç”±ã€ŒCAã€ç­¾ç½²çš„ã€‚</li>
<li>å®¢æˆ·ç«¯ã€ŒCã€å–å‡º**ã€Œca_Certã€<strong>ä¸­çš„ <code>ca_KeyPub</code>ï¼Œå¯¹</strong>ã€Œs_Certã€**ä¸­çš„ <code>enc_s_Hash</code> è¿›è¡Œè§£å¯†å¾—åˆ° <code>s_Hash</code>ã€‚</li>
<li>å®¢æˆ·ç«¯ã€ŒCã€å¯¹**ã€Œs_Certã€**ä¸­çš„ï¼ˆ<code>s_KeyPub</code> + <code>s_Info</code> + <code>ca_Info</code>ï¼‰è¿›è¡Œæ•£åˆ—è¿ç®—ï¼Œå¾—åˆ°æ•£åˆ—å€¼ <code>s_Hash_tmp</code>ã€‚</li>
<li>å®¢æˆ·ç«¯ã€ŒCã€åˆ¤æ–­ <code>s_Hash</code> å’Œ <code>s_Hash_tmp</code> æ˜¯å¦ç›¸ç­‰ã€‚å¦‚æžœä¸¤è€…ç›¸ç­‰ï¼Œåˆ™è¯æ˜Ž**ã€Œs_Certã€<strong>æ˜¯ç”±</strong>ã€Œca_Certã€**ç­¾ç½²çš„ã€‚</li>
<li>å®¢æˆ·ç«¯ã€ŒCã€æ£€æŸ¥**ã€Œca_Certã€**ï¼Œå‘çŽ°è¯¥è¯ä¹¦æ˜¯æ ¹è¯ä¹¦ï¼Œä¸”å·²ç»è¢«ç³»ç»Ÿä¿¡ä»»ï¼Œèº«ä»½éªŒè¯é€šè¿‡ã€‚</li>
</ol>
<blockquote>
<p>å¦‚æžœ**ã€Œca_Certã€<strong>æ²¡æœ‰å®‰è£…åˆ°ç³»ç»Ÿä¸­ï¼Œé‚£ä¹ˆå°†æ— æ³•å¯¹ <code>enc_s_Hash</code> è¿›è¡Œè§£å¯†ï¼Œä¹Ÿå°±æ— æ³•éªŒè¯</strong>ã€Œs_Certã€**çš„çœŸå®žæ€§äº†ã€‚ä¸‹åŒã€‚</p>
</blockquote>
<h4 id="äºŒçº§æˆ–ä»¥ä¸Šè®¤è¯æœºæž„çš„éªŒè¯">äºŒçº§ï¼ˆæˆ–ä»¥ä¸Šï¼‰è®¤è¯æœºæž„çš„éªŒè¯</h4>
<p><strong>ç®€è¦æµç¨‹</strong></p>
<ol>
<li>æœåŠ¡å™¨ã€ŒS2ã€ä¸‹å‘è¯ä¹¦**ã€Œs2_Certã€<strong>ã€</strong>ã€Œca2_Certã€**ç»™å®¢æˆ·ç«¯ã€ŒCã€ã€‚</li>
<li>å®¢æˆ·ç«¯ã€ŒCã€æ£€æŸ¥åˆ°**ã€Œs2_Certã€**ä¸­çš„ <code>ca2_Info</code>ï¼Œå‘çŽ°å®ƒæ˜¯ç”±ã€ŒCA2ã€ç­¾ç½²çš„ã€‚</li>
<li>å®¢æˆ·ç«¯ã€ŒCã€å–å‡º**ã€Œca2_Certã€<strong>ä¸­çš„ <code>ca2_KeyPub</code>ï¼Œå¯¹</strong>ã€Œs2_Certã€**ä¸­çš„ <code>enc_s2_Hash</code> è¿›è¡Œè§£å¯†å¾—åˆ° <code>s2_Hash</code>ã€‚</li>
<li>å®¢æˆ·ç«¯ã€ŒCã€å¯¹**ã€Œs2_Certã€**ä¸­çš„ï¼ˆ<code>s2_KeyPub</code> + <code>s2_Info</code> + <code>ca2_Info</code>ï¼‰è¿›è¡Œæ•£åˆ—è¿ç®—ï¼Œå¾—åˆ°æ•£åˆ—å€¼ <code>s2_Hash_tmp</code>ã€‚</li>
<li>å®¢æˆ·ç«¯ã€ŒCã€åˆ¤æ–­ <code>s2_Hash</code> å’Œ <code>s2_Hash_tmp</code> æ˜¯å¦ç›¸ç­‰ã€‚å¦‚æžœä¸¤è€…ç›¸ç­‰ï¼Œåˆ™è¯æ˜Ž**ã€Œs2_Certã€<strong>æ˜¯ç”±</strong>ã€Œca2_Certã€**ç­¾ç½²çš„ã€‚</li>
<li>å®¢æˆ·ç«¯ã€ŒCã€æ£€æŸ¥åˆ°**ã€Œca2_Certã€**ä¸­çš„ <code>ca_Info</code>ï¼Œå‘çŽ°å®ƒæ˜¯ç”±ã€ŒCAã€ç­¾ç½²çš„ã€‚</li>
<li>å®¢æˆ·ç«¯ã€ŒCã€å–å‡º**ã€Œca_Certã€<strong>ä¸­çš„ <code>ca_KeyPub</code>ï¼Œå¯¹</strong>ã€Œca2_Certã€**ä¸­çš„ <code>enc_ca2_Hash</code> è¿›è¡Œè§£å¯†å¾—åˆ° <code>ca2_Hash</code>ã€‚</li>
<li>å®¢æˆ·ç«¯ã€ŒCã€å¯¹**ã€Œca2_Certã€**ä¸­çš„ï¼ˆ<code>ca2_KeyPub</code> + <code>ca2_Info</code> + <code>ca_Info</code>ï¼‰è¿›è¡Œæ•£åˆ—è¿ç®—ï¼Œå¾—åˆ°æ•£åˆ—å€¼ <code>ca2_Hash_tmp</code>ã€‚</li>
<li>å®¢æˆ·ç«¯ã€ŒCã€åˆ¤æ–­ <code>ca2_Hash</code> å’Œ <code>ca2_Hash_tmp</code> æ˜¯å¦ç›¸ç­‰ã€‚å¦‚æžœä¸¤è€…ç›¸ç­‰ï¼Œè¯æ˜Ž**ã€Œca2_Certã€<strong>æ˜¯ç”±</strong>ã€Œca_Certã€**ç­¾ç½²çš„ã€‚</li>
<li>å®¢æˆ·ç«¯ã€ŒCã€æ£€æŸ¥**ã€Œca_Certã€**ï¼Œå‘çŽ°è¯¥è¯ä¹¦æ˜¯æ ¹è¯ä¹¦ï¼Œä¸”å·²ç»è¢«ç³»ç»Ÿä¿¡ä»»ï¼Œèº«ä»½éªŒè¯é€šè¿‡ã€‚</li>
</ol>
<p>ä¸‰çº§æˆ–æ›´å¤šçº§è®¤è¯æœºæž„è¯ä¹¦éªŒè¯æµç¨‹è·Ÿè¿™ä¸ªæµç¨‹å·®ä¸å¤šï¼Œå°±æ˜¯ä¸€çŽ¯æ‰£ä¸€çŽ¯åœ°éªŒè¯ä¸‹åŽ»ã€‚</p>
<h3 id="åŠ å¯†ä¼ è¾“çš„æ•°æ®">åŠ å¯†ä¼ è¾“çš„æ•°æ®</h3>
<p>æœåŠ¡å™¨ã€ŒSã€çš„èº«ä»½å¾—åˆ°å®¢æˆ·ç«¯ã€ŒCã€çš„è®¤å¯ä¹‹åŽï¼ŒæœåŠ¡å™¨ã€ŒSã€å¯ä»¥ä½¿ç”¨ <code>s_KeyPri</code> å¯¹ä¼ å‡ºçš„æ•°æ®è¿›è¡ŒåŠ å¯†æˆ–è€…å¯¹ä¼ å…¥çš„æ•°æ®è¿›è¡Œè§£å¯†ã€‚</p>
<p>åè¿‡æ¥ï¼Œå®¢æˆ·ç«¯ã€ŒCã€å¯ä»¥ä½¿ç”¨ <code>s_KeyPub</code> å¯¹ä¼ å‡ºçš„æ•°æ®è¿›è¡ŒåŠ å¯†æˆ–è€…å¯¹ä¼ å…¥çš„æ•°æ®è¿›è¡Œè§£å¯†ã€‚</p>
<p>ç”±äºŽéžå¯¹ç§°åŠ å¯†çš„æ•ˆçŽ‡è¾ƒä½Žï¼Œæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨éžå¯¹ç§°åŠ å¯†åå•†å¹¶äº¤æ¢ä¸€ä¸ªä¸´æ—¶çš„ä¼šè¯å¯†é’¥ä¹‹åŽï¼Œä½¿ç”¨ä¼šè¯å¯†é’¥è¿›è¡Œå¯¹ç§°åŠ å¯†ã€‚</p>
<h4 id="çŽ°å®žä¸­çš„è¯ä¹¦éªŒè¯">çŽ°å®žä¸­çš„è¯ä¹¦éªŒè¯</h4>
<p>çŽ°å®žä¸­ï¼Œä¸€äº›ä¼—æ‰€å‘¨çŸ¥ä¸”è¢«ä¿¡ä»»è¯ä¹¦è®¤è¯æœºæž„çš„æ ¹è¯ä¹¦éƒ½è¢«å†…ç½®åˆ°äº†æ“ä½œç³»ç»Ÿä¸­ã€‚</p>
<p>è€Œå®¢æˆ·ç«¯åœ¨æ£€æŸ¥æœåŠ¡å™¨è¯ä¹¦çš„æ—¶å€™ï¼Œä¸€èˆ¬è¿˜ä¼šæ£€æŸ¥å®ƒçš„æœ‰æ•ˆæœŸä»¥åŠè¯¥è¯ä¹¦æ˜¯å¦åœ¨è®¤è¯æœºæž„çš„è¯ä¹¦åŠé”€åˆ—è¡¨ä¸­ã€‚è¯ä¹¦åŠé”€åˆ—è¡¨ä¸€èˆ¬æ˜¯åœ¨çº¿æ£€æŸ¥çš„ã€‚</p>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://blog.csdn.net/xy010902100449/article/details/52145009">X.509æ•°å­—è¯ä¹¦çš„ç»“æž„ä¸Žè§£æž</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/36832100">X.509 æ•°å­—è¯ä¹¦çš„åŸºæœ¬åŽŸç†åŠåº”ç”¨</a></li>
</ol>
<h1 id="httpæ¦‚è¿°">HTTPæ¦‚è¿°</h1>
<p>HTTPæ˜¯ä¸€ä¸ªå±žäºŽåº”ç”¨å±‚çš„é¢å‘å¯¹è±¡çš„åè®®ï¼Œç”±äºŽå…¶ç®€æ·ã€å¿«é€Ÿçš„æ–¹å¼ï¼Œé€‚ç”¨äºŽåˆ†å¸ƒå¼è¶…åª’ä½“ä¿¡æ¯ç³»ç»Ÿã€‚</p>
<p><img src="https://i.loli.net/2020/09/11/xQoLU1WAXklzyVi.png" alt="HTTPå‘å±•å²" /></p>
<h2 id="http09">HTTP/0.9</h2>
<p>HTTP æ˜¯åŸºäºŽ TCP/IP åè®®çš„<a href="http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html"><strong>åº”ç”¨å±‚åè®®</strong></a>ã€‚å®ƒä¸æ¶‰åŠæ•°æ®åŒ…ï¼ˆpacketï¼‰ä¼ è¾“ï¼Œä¸»è¦è§„å®šäº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ ¼å¼ï¼Œé»˜è®¤ä½¿ç”¨80ç«¯å£ã€‚</p>
<blockquote>
<p>åè®®è§„å®šï¼ŒæœåŠ¡å™¨åªèƒ½å›žåº”HTMLæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä¸èƒ½å›žåº”åˆ«çš„æ ¼å¼ã€‚</p>
</blockquote>
<h2 id="http1x">HTTP/1.x</h2>
<blockquote>
<p>åœ¨æ—©æœŸï¼ŒHTTP ä½¿ç”¨ä¸€ä¸ªç®€å•çš„æ¨¡åž‹æ¥å¤„ç†è¿™æ ·çš„è¿žæŽ¥ã€‚è¿™äº›è¿žæŽ¥çš„ç”Ÿå‘½å‘¨æœŸæ˜¯çŸ­æš‚çš„ï¼šæ¯å‘èµ·ä¸€ä¸ªè¯·æ±‚æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿žæŽ¥ï¼Œå¹¶åœ¨æ”¶åˆ°åº”ç­”æ—¶ç«‹å³å…³é—­ã€‚è¿žæŽ¥çš„æˆæœ¬è¾ƒé«˜ã€‚</p>
</blockquote>
<p>å½“è¯·æ±‚å‘èµ·æ—¶ï¼Œç½‘ç»œå»¶è¿Ÿå’Œå¸¦å®½éƒ½ä¼šå¯¹æ€§èƒ½é€ æˆå½±å“ã€‚çŽ°ä»£æµè§ˆå™¨å¾€å¾€è¦å‘èµ·å¾ˆå¤šæ¬¡è¯·æ±‚(åå‡ ä¸ªæˆ–è€…æ›´å¤š)æ‰èƒ½æ‹¿åˆ°æ‰€éœ€çš„å®Œæ•´ä¿¡æ¯ï¼Œè¯æ˜Žäº†è¿™ä¸ªæ—©æœŸæ¨¡åž‹çš„æ•ˆçŽ‡ä½Žä¸‹ã€‚</p>
<p>åœ¨ HTTP/1.x é‡Œæœ‰å¤šç§æ¨¡åž‹ï¼š<em>çŸ­è¿žæŽ¥</em>, <em>é•¿è¿žæŽ¥</em>, å’Œ <em>HTTP æµæ°´çº¿ã€‚</em></p>
<p><img src="https://i.loli.net/2020/07/18/BcpZOXTKSFIDRUe.png" alt="HTTPä¸‰ç§æ¨¡åž‹" /></p>
<h3 id="çŸ­é“¾æŽ¥æ¨¡åž‹">çŸ­é“¾æŽ¥æ¨¡åž‹</h3>
<p>HTTP/1.0 çš„é»˜è®¤æ¨¡åž‹ã€‚æ¯ä¸€ä¸ª HTTP è¯·æ±‚éƒ½ç”±å®ƒè‡ªå·±ç‹¬ç«‹çš„è¿žæŽ¥å®Œæˆï¼›è¿™æ„å‘³ç€å‘èµ·æ¯ä¸€ä¸ª HTTP è¯·æ±‚ä¹‹å‰éƒ½ä¼šæœ‰ä¸€æ¬¡ TCP æ¡æ‰‹ï¼Œè€Œä¸”æ˜¯è¿žç»­ä¸æ–­çš„ã€‚</p>
<blockquote>
<p>åœ¨ HTTP/1.1 ä¸­ï¼Œåªæœ‰å½“ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Connection"><code>Connection</code></a> è¢«è®¾ç½®ä¸º <code>close</code> æ—¶æ‰ä¼šç”¨åˆ°è¿™ä¸ªæ¨¡åž‹</p>
</blockquote>
<h3 id="é•¿è¿žæŽ¥æ¨¡åž‹">é•¿è¿žæŽ¥æ¨¡åž‹</h3>
<p>ä¿æŒè¿žæŽ¥åŽ»å®Œæˆå¤šæ¬¡è¿žç»­çš„è¯·æ±‚ï¼Œå‡å°‘äº†ä¸æ–­é‡æ–°æ‰“å¼€è¿žæŽ¥çš„æ—¶é—´ã€‚åœ¨ HTTP/1.1 é‡Œï¼Œé»˜è®¤å°±æ˜¯é•¿è¿žæŽ¥çš„ã€‚</p>
<blockquote>
<p>çŸ­è¿žæŽ¥æœ‰ä¸¤ä¸ªæ¯”è¾ƒå¤§çš„é—®é¢˜ï¼šåˆ›å»ºæ–°è¿žæŽ¥è€—è´¹çš„æ—¶é—´å°¤ä¸ºæ˜Žæ˜¾ï¼Œå¦å¤– TCP è¿žæŽ¥çš„æ€§èƒ½åªæœ‰åœ¨è¯¥è¿žæŽ¥è¢«ä½¿ç”¨ä¸€æ®µæ—¶é—´åŽ(çƒ­è¿žæŽ¥)æ‰èƒ½å¾—åˆ°æ”¹å–„ã€‚å¦å¤–æˆ‘ä»¬çŸ¥é“ï¼ŒTCPåè®®æœ‰ä¸ªæ»‘åŠ¨çª—å£ï¼Œæœ‰æ…¢å¯åŠ¨è¿™å›žäº‹ï¼Œå°±æ˜¯è¯´æ¯æ¬¡å»ºç«‹æ–°è¿žæŽ¥åŽï¼Œæ•°æ®å…ˆæ˜¯æ…¢æ…¢åœ°ä¼ ï¼Œç„¶åŽæ»‘åŠ¨çª—å£æ…¢æ…¢å˜å¤§ï¼Œæ‰èƒ½è¾ƒé«˜é€Ÿåº¦åœ°ä¼ ã€‚</p>
</blockquote>
<p>å…·ä½“æµç¨‹ï¼š</p>
<p>ä¸€ä¸ªé•¿è¿žæŽ¥ä¼šä¿æŒä¸€æ®µæ—¶é—´ï¼Œé‡å¤ç”¨äºŽå‘é€ä¸€ç³»åˆ—è¯·æ±‚ï¼Œ<strong>èŠ‚çœäº†æ–°å»º TCP è¿žæŽ¥æ¡æ‰‹çš„æ—¶é—´ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ TCP çš„æ€§èƒ½å¢žå¼ºèƒ½åŠ›</strong>ã€‚å½“ç„¶è¿™ä¸ªè¿žæŽ¥ä¹Ÿä¸ä¼šä¸€ç›´ä¿ç•™ç€ï¼šè¿žæŽ¥åœ¨ç©ºé—²ä¸€æ®µæ—¶é—´åŽä¼šè¢«å…³é—­(æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Keep-Alive"><code>Keep-Alive</code></a> åè®®å¤´æ¥æŒ‡å®šä¸€ä¸ªæœ€å°çš„è¿žæŽ¥ä¿æŒæ—¶é—´)ã€‚</p>
<p>ç¼ºç‚¹ï¼š</p>
<p>å°±ç®—æ˜¯åœ¨ç©ºé—²çŠ¶æ€ï¼Œå®ƒè¿˜æ˜¯ä¼šæ¶ˆè€—æœåŠ¡å™¨èµ„æºï¼Œè€Œä¸”åœ¨é‡è´Ÿè½½æ—¶ï¼Œè¿˜æœ‰å¯èƒ½é­å— <a href="https://developer.mozilla.org/en-US/docs/Glossary/DoS_attack">DoS attacks</a> æ”»å‡»ã€‚è¿™ç§åœºæ™¯ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨éžé•¿è¿žæŽ¥ï¼Œå³å°½å¿«å…³é—­é‚£äº›ç©ºé—²çš„è¿žæŽ¥ï¼Œä¹Ÿèƒ½å¯¹æ€§èƒ½æœ‰æ‰€æå‡ã€‚</p>
<blockquote>
<p>é•¿è¿žæŽ¥ä¸€ä¸ªä¼˜åŒ–çš„æ–¹æ³•å°±æ˜¯è®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œä½†æ˜¯å…·ä½“è¿™ä¸ªæ—¶é—´æ˜¯å¤šå°‘ï¼Œåº”è¯¥é€šè¿‡æµ‹è¯•ä¹‹åŽå¾—å‡ºä¸€ä¸ªè¾ƒä¸ºå‡è¡¡çš„æ—¶é—´ã€‚</p>
</blockquote>
<h3 id="æµæ°´çº¿æ¨¡åž‹ç®¡çº¿åŒ–">æµæ°´çº¿æ¨¡åž‹(ç®¡çº¿åŒ–)</h3>
<p><strong>å¤šä¸ªè¿žç»­çš„è¯·æ±‚ç”šè‡³éƒ½ä¸ç”¨ç­‰å¾…ç«‹å³è¿”å›žå°±å¯ä»¥è¢«å‘é€</strong>ã€‚HTTP æµæ°´çº¿åœ¨çŽ°ä»£æµè§ˆå™¨ä¸­å¹¶ä¸æ˜¯é»˜è®¤è¢«å¯ç”¨çš„ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<a href="https://developer.mozilla.org/en/HTTP">HTTP</a> è¯·æ±‚æ˜¯æŒ‰é¡ºåºå‘å‡ºçš„ã€‚ä¸‹ä¸€ä¸ªè¯·æ±‚åªæœ‰åœ¨å½“å‰è¯·æ±‚æ”¶åˆ°åº”ç­”è¿‡åŽæ‰ä¼šè¢«å‘å‡ºã€‚ç”±äºŽä¼šå—åˆ°ç½‘ç»œå»¶è¿Ÿå’Œå¸¦å®½çš„é™åˆ¶ï¼Œåœ¨ä¸‹ä¸€ä¸ªè¯·æ±‚è¢«å‘é€åˆ°æœåŠ¡å™¨ä¹‹å‰ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…å¾ˆé•¿æ—¶é—´ã€‚</p>
<p>**æµæ°´çº¿æ˜¯åœ¨åŒä¸€æ¡é•¿è¿žæŽ¥ä¸Šå‘å‡ºè¿žç»­çš„è¯·æ±‚ï¼Œè€Œä¸ç”¨ç­‰å¾…åº”ç­”è¿”å›žã€‚è¿™æ ·å¯ä»¥é¿å…è¿žæŽ¥å»¶è¿Ÿã€‚ç†è®ºä¸Šè®²ï¼Œæ€§èƒ½è¿˜ä¼šå› ä¸ºä¸¤ä¸ª HTTP è¯·æ±‚æœ‰å¯èƒ½è¢«æ‰“åŒ…åˆ°ä¸€ä¸ª TCP æ¶ˆæ¯åŒ…ä¸­è€Œå¾—åˆ°æå‡ã€‚**å°±ç®— HTTP è¯·æ±‚ä¸æ–­çš„ç»§ç»­ï¼Œå°ºå¯¸ä¼šå¢žåŠ ï¼Œä½†è®¾ç½® TCP çš„ <a href="https://en.wikipedia.org/wiki/Maximum_segment_size">MSS</a>(Maximum Segment Size) é€‰é¡¹ï¼Œä»ç„¶è¶³å¤ŸåŒ…å«ä¸€ç³»åˆ—ç®€å•çš„è¯·æ±‚ã€‚</p>
<blockquote>
<p>æ¯”å¦‚ï¼Œå½“è¯·æ±‚ä¸€ä¸ªåŒ…å«10å¼ å›¾ç‰‡çš„HTML Webé¡µé¢ï¼Œä¸ŽæŒ¨ä¸ªè¿žæŽ¥ç›¸æ¯”ï¼Œç”¨æŒä¹…è¿žæŽ¥å¯ä»¥è®©è¯·æ±‚æ›´å¿«ç»“æŸã€‚è€Œç®¡çº¿åŒ–æŠ€æœ¯åˆ™æ¯”æŒä¹…è¿žæŽ¥è¿˜è¦å¿«ã€‚è¯·æ±‚æ•°è¶Šå¤šï¼Œæ—¶é—´å·®å°±è¶Šæ˜Žæ˜¾ã€‚</p>
</blockquote>
<h4 id="é˜Ÿå¤´é˜»å¡ž">é˜Ÿå¤´é˜»å¡ž</h4>
<p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒHTTPéµå®ˆâ€œè¯·æ±‚-å“åº”â€çš„æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯æ¯æ¬¡å‘é€ä¸€ä¸ªè¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯è¿”å›žå“åº”ï¼Œè¿™ç§æ¨¡å¼å¾ˆç®€å•ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªè‡´å‘½ç¼ºé™·é‚£å°±æ˜¯é¡µé¢ä¸­æœ‰å¤šä¸ªè¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚å¿…é¡»ç­‰åˆ°å‰ä¸€ä¸ªè¯·æ±‚å“åº”ä¹‹åŽæ‰èƒ½å‘é€ï¼Œå¹¶ä¸”å½“å‰è¯·æ±‚çš„å“åº”è¿”å›žä¹‹åŽï¼Œå½“å‰è¯·æ±‚çš„ä¸‹ä¸€ä¸ªè¯·æ±‚æ‰èƒ½å‘é€ï¼Œæµç¨‹å¦‚ä¸‹å›¾</p>
<p><img src="https://i.loli.net/2020/11/12/Iim4qdxThogSEMk.png" alt="ä¸å¸¦ç®¡çº¿çš„é˜Ÿå¤´" /></p>
<p>åœ¨TCPé“¾æŽ¥ä¸­ï¼Œhttpè¯·æ±‚å¿…é¡»ç­‰å¾…å‰ä¸€ä¸ªè¯·æ±‚å“åº”ä¹‹åŽï¼Œæ‰èƒ½å‘é€ï¼ŒåŽé¢çš„ä¾æ¬¡ç±»æŽ¨ï¼Œç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œå¦‚æžœåœ¨ä¸€ä¸ªtcpé€šé“ä¸­å¦‚æžœæŸä¸ªhttpè¯·æ±‚çš„å“åº”å› ä¸ºæŸä¸ªåŽŸå› æ²¡æœ‰åŠæ—¶è¿”å›žï¼ŒåŽé¢çš„å“åº”ä¼šè¢«é˜»å¡žï¼Œè¿™å°±æ˜¯<strong>é˜Ÿå¤´é˜»å¡žã€‚</strong></p>
<blockquote>
<p>æ³¨æ„è¿™é‡Œè¯´çš„æ˜¯å“åº”ä¹‹åŽï¼Œå¹¶ä¸æ˜¯è¯·ä¹‹åŽ!</p>
</blockquote>
<p>ä¸ºäº†æé«˜é€Ÿåº¦å’Œæ•ˆçŽ‡ï¼Œåœ¨æŒä¹…è¿žæŽ¥çš„åŸºç¡€ä¸Šï¼ŒHTTP1.1è¿›ä¸€æ­¥åœ°æ”¯æŒåœ¨æŒä¹…è¿žæŽ¥ä¸Šä½¿ç”¨ç®¡é“åŒ–ï¼ˆpipeliningï¼‰ç‰¹æ€§ã€‚<strong>ç®¡é“åŒ–å…è®¸å®¢æˆ·ç«¯åœ¨å·²å‘é€çš„è¯·æ±‚æ”¶åˆ°æœåŠ¡ç«¯çš„å“åº”ä¹‹å‰å‘é€ä¸‹ä¸€ä¸ªè¯·æ±‚</strong>ï¼Œå€Ÿæ­¤æ¥å‡å°‘ç­‰å¾…æ—¶é—´æé«˜åžåï¼Œå¦‚æžœå¤šä¸ªè¯·æ±‚èƒ½åœ¨åŒä¸€ä¸ªTCPåˆ†èŠ‚å‘é€çš„è¯ï¼Œè¿˜èƒ½æé«˜ç½‘ç»œåˆ©ç”¨çŽ‡ï¼Œæµç¨‹å¦‚å›¾ï¼š</p>
<p><img src="https://i.loli.net/2020/11/12/YTriXMRKdEQLf6U.png" alt="å¸¦ç®¡çº¿çš„é˜Ÿå¤´é˜»å¡ž" /></p>
<p>åŒä¸€ä¸ªtcpè¿žæŽ¥ä¸­å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªhttpè¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯å¹¶å‘ï¼Œ<strong>ä½†æ˜¯åœ¨å“åº”çš„æ—¶å€™ï¼Œå¿…é¡»æŽ’é˜Ÿå“åº”ï¼Œè°å…ˆåˆ°è¾¾çš„è°å…ˆå“åº”ï¼Œç›¸æ¯”ä¸æ”¯æŒç®¡é“åŒ–çš„httpè¯·æ±‚ç¡®å®žæé«˜äº†æ•ˆçŽ‡ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å±€é™æ€§</strong>ï¼Œå‡å¦‚å…¶ä¸­æŸä¸ªå“åº”å› ä¸ºæŸç§åŽŸå› å»¶è¿Ÿäº†å‡ ç§’ï¼ŒåŽé¢çš„å“åº”éƒ½ä¼šè¢«é˜»å¡žã€‚ä¸Šé¢ç®­å¤´æ‰€æŒ‡çš„å“åº”å¦‚æžœé˜»å¡žäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªä¹Ÿæ˜¯<strong>é˜Ÿå¤´é˜»å¡ž</strong>ã€‚</p>
<p><strong>å¹¶ä¸”ä½¿ç”¨HTTPç®¡é“åŒ–è¿˜æœ‰ä¸€äº›é™åˆ¶</strong>:</p>
<p>1ã€ç®¡é“åŒ–è¦æ±‚æœåŠ¡ç«¯æŒ‰ç…§è¯·æ±‚å‘é€çš„é¡ºåºè¿”å›žå“åº”ï¼ˆFIFOï¼‰ï¼ŒåŽŸå› å¾ˆç®€å•ï¼ŒHTTPè¯·æ±‚å’Œå“åº”å¹¶æ²¡æœ‰åºå·æ ‡è¯†ï¼Œæ— æ³•å°†ä¹±åºçš„å“åº”ä¸Žè¯·æ±‚å…³è”èµ·æ¥ã€‚</p>
<p>2ã€å½“å®¢æˆ·ç«¯åœ¨æ”¯æŒç®¡é“åŒ–æ—¶éœ€è¦ä¿æŒæœªæ”¶åˆ°å“åº”çš„è¯·æ±‚ï¼Œå½“è¿žæŽ¥æ„å¤–ä¸­æ–­æ—¶ï¼Œéœ€è¦é‡æ–°å‘é€è¿™éƒ¨åˆ†è¯·æ±‚ã€‚å¦‚æžœè¿™ä¸ªè¯·æ±‚åªæ˜¯ä»ŽæœåŠ¡å™¨èŽ·å–æ•°æ®ï¼Œé‚£ä¹ˆå¹¶ä¸ä¼šå¯¹èµ„æºé€ æˆä»»ä½•å½±å“ï¼Œè€Œå¦‚æžœæ˜¯ä¸€ä¸ªæäº¤ä¿¡æ¯çš„è¯·æ±‚å¦‚postè¯·æ±‚ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šé€ æˆèµ„æºå¤šæ¬¡æäº¤ä»Žè€Œæ”¹å˜èµ„æºï¼Œè¿™æ˜¯ä¸å…è®¸çš„ã€‚è€Œä¸ä¼šå¯¹æœåŠ¡å™¨èµ„æºäº§ç”Ÿå½±å“çš„è¯·æ±‚æœ‰ä¸ªä¸“ä¸šåè¯å«åšå¹‚ç­‰è¯·æ±‚ã€‚å®¢æˆ·ç«¯åœ¨ä½¿ç”¨ç®¡é“åŒ–çš„æ—¶å€™è¯·æ±‚æ–¹å¼å¿…é¡»æ˜¯å¹‚ç­‰è¯·æ±‚ã€‚</p>
<p><strong>æ¯”è¾ƒ</strong>ï¼š</p>
<p><img src="https://i.loli.net/2020/11/12/cRSVqah4gTDjWY8.png" alt="ç®¡çº¿åŒ–å’Œéžç®¡çº¿åŒ–çš„å¯¹æ¯”" /></p>
<p><strong>ä¸Šé¢çš„ç®¡çº¿åŒ–çš„æ¨¡åž‹å°±æ˜¯åŠ é€Ÿäº†è¯·æ±‚çš„è¿‡ç¨‹ï¼Œä½†æ˜¯å“åº”çš„è¿‡ç¨‹è¿˜æ˜¯å­˜åœ¨é˜Ÿå¤´é˜»å¡žã€‚</strong></p>
<blockquote>
<p>å› ä¸ºHTTPç®¡é“åŒ–æœ¬èº«å¯èƒ½ä¼šå¯¼è‡´é˜Ÿå¤´é˜»å¡žçš„é—®é¢˜ï¼Œä»¥åŠä¸Šé¢æåˆ°çš„ä¸€äº›é™åˆ¶ï¼Œ<strong>çŽ°ä»£æµè§ˆå™¨é»˜è®¤éƒ½å…³é—­äº†ç®¡é“åŒ–ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ†æœåŠ¡å™¨ä¹Ÿæ˜¯é»˜è®¤ä¸æ”¯æŒç®¡é“åŒ–çš„</strong>ã€‚</p>
</blockquote>
<p><strong>å¦‚ä½•è§£å†³é˜Ÿå¤´é˜»å¡žï¼Ÿ</strong></p>
<p>å®¢æˆ·ç«¯ä½¿ç”¨å¹¶å‘é•¿è¿žæŽ¥ï¼Œæ³¨æ„è¿™ä¸ªå¹¶å‘æŒ‡çš„æ˜¯tcpå¹¶å‘è¿žæŽ¥ã€‚</p>
<blockquote>
<p>å¹¶å‘é•¿è¿žæŽ¥è™½ç„¶åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†httpçš„é˜Ÿå¤´é˜»å¡žï¼Œä½†æ˜¯ä¼šå¯¹æœåŠ¡å™¨çš„æ€§èƒ½æœ‰è¾ƒé«˜çš„è¦æ±‚</p>
</blockquote>
<h2 id="http2">HTTP/2</h2>
<blockquote>
<p>HTTP/1.1 ç‰ˆçš„å¤´ä¿¡æ¯è‚¯å®šæ˜¯æ–‡æœ¬ï¼ˆASCIIç¼–ç ï¼‰ï¼Œæ•°æ®ä½“å¯ä»¥æ˜¯æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒè¿›åˆ¶ã€‚HTTP/2 åˆ™æ˜¯ä¸€ä¸ªå½»åº•çš„äºŒè¿›åˆ¶åè®®ï¼Œå¤´ä¿¡æ¯å’Œæ•°æ®ä½“éƒ½æ˜¯äºŒè¿›åˆ¶ï¼Œå¹¶ä¸”ç»Ÿç§°ä¸º&quot;å¸§&rdquo;ï¼ˆframeï¼‰ï¼šå¤´ä¿¡æ¯å¸§å’Œæ•°æ®å¸§ã€‚</p>
</blockquote>
<p>ðŸ˜† HTTP/2 æ²¡æœ‰æ”¹åŠ¨ HTTP çš„åº”ç”¨è¯­ä¹‰ã€‚ HTTP æ–¹æ³•ã€çŠ¶æ€ä»£ç ã€URI å’Œæ ‡å¤´å­—æ®µç­‰æ ¸å¿ƒæ¦‚å¿µä¸€å¦‚å¾€å¸¸ã€‚ ä¸è¿‡ï¼ŒHTTP/2 ä¿®æ”¹äº†æ•°æ®æ ¼å¼åŒ–ï¼ˆåˆ†å¸§ï¼‰ä»¥åŠåœ¨å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨é—´ä¼ è¾“çš„æ–¹å¼ã€‚è¿™ä¸¤ç‚¹ç»Ÿå¸…å…¨å±€ï¼Œé€šè¿‡æ–°çš„åˆ†å¸§å±‚å‘æˆ‘ä»¬çš„åº”ç”¨éšè—äº†æ‰€æœ‰å¤æ‚æ€§ã€‚ å› æ­¤ï¼Œæ‰€æœ‰çŽ°æœ‰çš„åº”ç”¨éƒ½å¯ä»¥ä¸å¿…ä¿®æ”¹è€Œåœ¨æ–°åè®®ä¸‹è¿è¡Œã€‚</p>
<blockquote>
<p><em>ä¸ºä»€ä¹ˆä¸æ˜¯ HTTP/1.2ï¼Ÿ</em></p>
<p>ä¸ºäº†å®žçŽ° HTTP å·¥ä½œç»„è®¾å®šçš„æ€§èƒ½ç›®æ ‡ï¼ŒHTTP/2 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„äºŒè¿›åˆ¶åˆ†å¸§å±‚ï¼Œè¯¥å±‚æ— æ³•ä¸Žä¹‹å‰çš„ HTTP/1.x æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å‘åŽå…¼å®¹ï¼Œå› æ­¤åè®®çš„ä¸»ç‰ˆæœ¬æå‡åˆ° HTTP/2ã€‚</p>
</blockquote>
<h3 id="äºŒè¿›åˆ¶åˆ†å¸§å±‚">äºŒè¿›åˆ¶åˆ†å¸§å±‚</h3>
<p>HTTP/2 æ‰€æœ‰æ€§èƒ½å¢žå¼ºçš„æ ¸å¿ƒåœ¨äºŽæ–°çš„äºŒè¿›åˆ¶åˆ†å¸§å±‚ï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•å°è£… HTTP æ¶ˆæ¯å¹¶åœ¨å®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“ã€‚</p>
<p><img src="https://i.loli.net/2020/07/18/QFrEgPCV7GAq6wm.png" alt="HTTP/2äºŒè¿›åˆ¶åˆ†å¸§å±‚" /></p>
<p>è¿™é‡Œæ‰€è°“çš„â€œå±‚â€ï¼ŒæŒ‡çš„æ˜¯ä½äºŽå¥—æŽ¥å­—æŽ¥å£ä¸Žåº”ç”¨å¯è§çš„é«˜çº§ HTTP API ä¹‹é—´ä¸€ä¸ªç»è¿‡ä¼˜åŒ–çš„æ–°ç¼–ç æœºåˆ¶ï¼šHTTP çš„è¯­ä¹‰ï¼ˆåŒ…æ‹¬å„ç§åŠ¨è¯ã€æ–¹æ³•ã€æ ‡å¤´ï¼‰éƒ½ä¸å—å½±å“ï¼Œ<strong>ä¸åŒçš„æ˜¯ä¼ è¾“æœŸé—´å¯¹å®ƒä»¬çš„ç¼–ç æ–¹å¼å˜äº†</strong>ã€‚ <strong>HTTP/1.x åè®®ä»¥æ¢è¡Œç¬¦ä½œä¸ºçº¯æ–‡æœ¬çš„åˆ†éš”ç¬¦ï¼Œè€Œ HTTP/2 å°†æ‰€æœ‰ä¼ è¾“çš„ä¿¡æ¯åˆ†å‰²ä¸ºæ›´å°çš„æ¶ˆæ¯å’Œå¸§ï¼Œå¹¶é‡‡ç”¨äºŒè¿›åˆ¶æ ¼å¼å¯¹å®ƒä»¬ç¼–ç ã€‚</strong></p>
<h4 id="æ•°æ®æµæ¶ˆæ¯å’Œå¸§">æ•°æ®æµã€æ¶ˆæ¯å’Œå¸§</h4>
<ul>
<li><em>æ•°æ®æµ</em>ï¼šå·²å»ºç«‹çš„è¿žæŽ¥å†…çš„åŒå‘å­—èŠ‚æµï¼Œå¯ä»¥æ‰¿è½½ä¸€æ¡æˆ–å¤šæ¡æ¶ˆæ¯ã€‚</li>
<li><em>æ¶ˆæ¯</em>ï¼šä¸Žé€»è¾‘è¯·æ±‚æˆ–å“åº”æ¶ˆæ¯å¯¹åº”çš„å®Œæ•´çš„ä¸€ç³»åˆ—å¸§ã€‚</li>
<li><em>å¸§</em>ï¼šHTTP/2 é€šä¿¡çš„æœ€å°å•ä½ï¼Œæ¯ä¸ªå¸§éƒ½åŒ…å«å¸§å¤´ï¼Œè‡³å°‘ä¹Ÿä¼šæ ‡è¯†å‡ºå½“å‰å¸§æ‰€å±žçš„æ•°æ®æµã€‚</li>
</ul>
<p>å…³ç³»ï¼š</p>
<ul>
<li>æ‰€æœ‰é€šä¿¡éƒ½åœ¨ä¸€ä¸ª TCP è¿žæŽ¥ä¸Šå®Œæˆï¼Œæ­¤è¿žæŽ¥å¯ä»¥æ‰¿è½½ä»»æ„æ•°é‡çš„åŒå‘æ•°æ®æµã€‚(<strong>å¤šå·¥</strong>)</li>
<li>æ¯ä¸ªæ•°æ®æµéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦å’Œå¯é€‰çš„ä¼˜å…ˆçº§ä¿¡æ¯ï¼Œç”¨äºŽæ‰¿è½½åŒå‘æ¶ˆæ¯ã€‚</li>
<li>æ¯æ¡æ¶ˆæ¯éƒ½æ˜¯ä¸€æ¡é€»è¾‘ HTTP æ¶ˆæ¯ï¼ˆä¾‹å¦‚è¯·æ±‚æˆ–å“åº”ï¼‰ï¼ŒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå¸§ã€‚</li>
<li><strong>å¸§æ˜¯æœ€å°çš„é€šä¿¡å•ä½ï¼Œæ‰¿è½½ç€ç‰¹å®šç±»åž‹çš„æ•°æ®ï¼Œä¾‹å¦‚ HTTP æ ‡å¤´ã€æ¶ˆæ¯è´Ÿè½½ç­‰ç­‰ã€‚ æ¥è‡ªä¸åŒæ•°æ®æµçš„å¸§å¯ä»¥äº¤é”™å‘é€ï¼Œç„¶åŽå†æ ¹æ®æ¯ä¸ªå¸§å¤´çš„æ•°æ®æµæ ‡è¯†ç¬¦é‡æ–°ç»„è£…ã€‚</strong></li>
</ul>
<p><img src="https://i.loli.net/2020/07/18/mvZHTDVKUw5paXR.png" alt="äºŒè¿›åˆ¶å¸§" /></p>
<p>ç®€è¨€ä¹‹ï¼ŒHTTP/2 å°† HTTP åè®®é€šä¿¡åˆ†è§£ä¸ºäºŒè¿›åˆ¶ç¼–ç å¸§çš„äº¤æ¢ï¼Œè¿™äº›å¸§å¯¹åº”ç€ç‰¹å®šæ•°æ®æµä¸­çš„æ¶ˆæ¯ã€‚æ‰€æœ‰è¿™äº›éƒ½åœ¨ä¸€ä¸ª TCP è¿žæŽ¥å†…å¤ç”¨ã€‚ è¿™æ˜¯ HTTP/2 åè®®æ‰€æœ‰å…¶ä»–åŠŸèƒ½å’Œæ€§èƒ½ä¼˜åŒ–çš„åŸºç¡€ã€‚</p>
<p>HTTP/2 å¸§ç»“æž„å¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2020/07/18/myhEWKrbG6sPQZu.png" alt="å¸§ç»“æž„" /></p>
<p>å®žé™…çš„ä¼ è¾“è¿‡ç¨‹å¯èƒ½æ˜¯ä¸‹é¢è¿™æ ·(åžåé‡å¢žå¤§)ï¼š</p>
<p><img src="https://i.loli.net/2020/07/18/ShtzgQewfm21aXi.png" alt="HTTP/2ä¼ è¾“" /></p>
<h4 id="è¯·æ±‚ä¸Žå“åº”å¤ç”¨">è¯·æ±‚ä¸Žå“åº”å¤ç”¨</h4>
<p>HTTP/2 ä¸­æ–°çš„äºŒè¿›åˆ¶åˆ†å¸§å±‚å®žçŽ°äº†å®Œæ•´çš„è¯·æ±‚å’Œå“åº”å¤ç”¨ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥å°† HTTP æ¶ˆæ¯åˆ†è§£ä¸ºäº’ä¸ä¾èµ–çš„å¸§ï¼Œç„¶åŽäº¤é”™å‘é€ï¼Œæœ€åŽå†åœ¨å¦ä¸€ç«¯æŠŠå®ƒä»¬é‡æ–°ç»„è£…èµ·æ¥ã€‚</p>
<p><img src="https://i.loli.net/2020/07/18/cgiF86Xdl7yeRWJ.png" alt="è¯·æ±‚ä¸Žå¤ç”¨" /></p>
<h4 id="æ•°æ®æµä¼˜å…ˆçº§">æ•°æ®æµä¼˜å…ˆçº§</h4>
<p><img src="https://i.loli.net/2020/07/18/n7HTaUA8ZGp2Egy.png" alt="æ•°æ®æµä¼˜å…ˆçº§" /></p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸Šå›¾ä¸­çš„å‡ ä¸ªæ“ä½œç¤ºä¾‹ã€‚ ä»Žå·¦åˆ°å³ä¾æ¬¡ä¸ºï¼š</p>
<ol>
<li>æ•°æ®æµ A å’Œæ•°æ®æµ B éƒ½æ²¡æœ‰æŒ‡å®šçˆ¶ä¾èµ–é¡¹ï¼Œä¾èµ–äºŽéšå¼â€œæ ¹æ•°æ®æµâ€ï¼›A çš„æƒé‡ä¸º 12ï¼ŒB çš„æƒé‡ä¸º 4ã€‚å› æ­¤ï¼Œæ ¹æ®æ¯”ä¾‹æƒé‡ï¼šæ•°æ®æµ B èŽ·å¾—çš„èµ„æºæ˜¯ A æ‰€èŽ·èµ„æºçš„ä¸‰åˆ†ä¹‹ä¸€ã€‚</li>
<li>æ•°æ®æµ D ä¾èµ–äºŽæ ¹æ•°æ®æµï¼›C ä¾èµ–äºŽ Dã€‚ å› æ­¤ï¼ŒD åº”å…ˆäºŽ C èŽ·å¾—å®Œæ•´èµ„æºåˆ†é…ã€‚ æƒé‡ä¸é‡è¦ï¼Œå› ä¸º C çš„ä¾èµ–å…³ç³»æ‹¥æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚</li>
<li>æ•°æ®æµ D åº”å…ˆäºŽ C èŽ·å¾—å®Œæ•´èµ„æºåˆ†é…ï¼›C åº”å…ˆäºŽ A å’Œ B èŽ·å¾—å®Œæ•´èµ„æºåˆ†é…ï¼›æ•°æ®æµ B èŽ·å¾—çš„èµ„æºæ˜¯ A æ‰€èŽ·èµ„æºçš„ä¸‰åˆ†ä¹‹ä¸€ã€‚</li>
<li>æ•°æ®æµ D åº”å…ˆäºŽ E å’Œ C èŽ·å¾—å®Œæ•´èµ„æºåˆ†é…ï¼›E å’Œ C åº”å…ˆäºŽ A å’Œ B èŽ·å¾—ç›¸åŒçš„èµ„æºåˆ†é…ï¼›A å’Œ B åº”åŸºäºŽå…¶æƒé‡èŽ·å¾—æ¯”ä¾‹åˆ†é…ã€‚</li>
</ol>
<h4 id="æµæŽ§åˆ¶">æµæŽ§åˆ¶</h4>
<p>æµæŽ§åˆ¶æ˜¯ä¸€ç§é˜»æ­¢å‘é€æ–¹å‘æŽ¥æ”¶æ–¹å‘é€å¤§é‡æ•°æ®çš„æœºåˆ¶ï¼Œä»¥å…è¶…å‡ºåŽè€…çš„éœ€æ±‚æˆ–å¤„ç†èƒ½åŠ›ï¼šå‘é€æ–¹å¯èƒ½éžå¸¸ç¹å¿™ã€å¤„äºŽè¾ƒé«˜çš„è´Ÿè½½ä¹‹ä¸‹ï¼Œä¹Ÿå¯èƒ½ä»…ä»…å¸Œæœ›ä¸ºç‰¹å®šæ•°æ®æµåˆ†é…å›ºå®šé‡çš„èµ„æºã€‚ ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯å¯èƒ½è¯·æ±‚äº†ä¸€ä¸ªå…·æœ‰è¾ƒé«˜ä¼˜å…ˆçº§çš„å¤§åž‹è§†é¢‘æµï¼Œä½†æ˜¯ç”¨æˆ·å·²ç»æš‚åœè§†é¢‘ï¼Œå®¢æˆ·ç«¯çŽ°åœ¨å¸Œæœ›æš‚åœæˆ–é™åˆ¶ä»ŽæœåŠ¡å™¨çš„ä¼ è¾“ï¼Œä»¥å…æå–å’Œç¼“å†²ä¸å¿…è¦çš„æ•°æ®ã€‚ å†æ¯”å¦‚ï¼Œä¸€ä¸ªä»£ç†æœåŠ¡å™¨å¯èƒ½å…·æœ‰è¾ƒå¿«çš„ä¸‹æ¸¸è¿žæŽ¥å’Œè¾ƒæ…¢çš„ä¸Šæ¸¸è¿žæŽ¥ï¼Œå¹¶ä¸”ä¹Ÿå¸Œæœ›è°ƒèŠ‚ä¸‹æ¸¸è¿žæŽ¥ä¼ è¾“æ•°æ®çš„é€Ÿåº¦ä»¥åŒ¹é…ä¸Šæ¸¸è¿žæŽ¥çš„é€Ÿåº¦æ¥æŽ§åˆ¶å…¶èµ„æºåˆ©ç”¨çŽ‡ï¼›ç­‰ç­‰ã€‚ç±»ä¼¼TCPæµé‡æŽ§åˆ¶ã€‚</p>
<h4 id="æœåŠ¡å™¨æŽ¨é€">æœåŠ¡å™¨æŽ¨é€</h4>
<p>HTTP/2 æ–°å¢žçš„å¦ä¸€ä¸ªå¼ºå¤§çš„æ–°åŠŸèƒ½æ˜¯ï¼ŒæœåŠ¡å™¨å¯ä»¥å¯¹ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚å‘é€å¤šä¸ªå“åº”ã€‚ æ¢å¥è¯è¯´ï¼Œé™¤äº†å¯¹æœ€åˆè¯·æ±‚çš„å“åº”å¤–ï¼ŒæœåŠ¡å™¨è¿˜å¯ä»¥å‘å®¢æˆ·ç«¯æŽ¨é€é¢å¤–èµ„æºï¼ˆå›¾ 12-5ï¼‰ï¼Œè€Œæ— éœ€å®¢æˆ·ç«¯æ˜Žç¡®åœ°è¯·æ±‚ã€‚</p>
<p><img src="https://i.loli.net/2020/07/18/Bht8slFucdr7veP.png" alt="æœåŠ¡å™¨æŽ¨é€" /></p>
<h4 id="æ ‡å¤´åŽ‹ç¼©">æ ‡å¤´åŽ‹ç¼©</h4>
<p>æ¯ä¸ª HTTP ä¼ è¾“éƒ½æ‰¿è½½ä¸€ç»„æ ‡å¤´ï¼Œè¿™äº›æ ‡å¤´è¯´æ˜Žäº†ä¼ è¾“çš„èµ„æºåŠå…¶å±žæ€§ã€‚ åœ¨ HTTP/1.x ä¸­ï¼Œæ­¤å…ƒæ•°æ®å§‹ç»ˆä»¥çº¯æ–‡æœ¬å½¢å¼ï¼Œé€šå¸¸ä¼šç»™æ¯ä¸ªä¼ è¾“å¢žåŠ  500â€“800 å­—èŠ‚çš„å¼€é”€ã€‚å¦‚æžœä½¿ç”¨ HTTP Cookieï¼Œå¢žåŠ çš„å¼€é”€æœ‰æ—¶ä¼šè¾¾åˆ°ä¸Šåƒå­—èŠ‚ã€‚ä¸ºäº†å‡å°‘æ­¤å¼€é”€å’Œæå‡æ€§èƒ½ï¼ŒHTTP/2 ä½¿ç”¨ HPACK åŽ‹ç¼©æ ¼å¼åŽ‹ç¼©è¯·æ±‚å’Œå“åº”æ ‡å¤´å…ƒæ•°æ®ï¼Œè¿™ç§æ ¼å¼é‡‡ç”¨ä¸¤ç§ç®€å•ä½†æ˜¯å¼ºå¤§çš„æŠ€æœ¯ï¼š</p>
<ol>
<li>è¿™ç§æ ¼å¼æ”¯æŒé€šè¿‡é™æ€éœå¤«æ›¼ä»£ç å¯¹ä¼ è¾“çš„æ ‡å¤´å­—æ®µè¿›è¡Œç¼–ç ï¼Œä»Žè€Œå‡å°äº†å„ä¸ªä¼ è¾“çš„å¤§å°ã€‚</li>
<li>è¿™ç§æ ¼å¼è¦æ±‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ—¶ç»´æŠ¤å’Œæ›´æ–°ä¸€ä¸ªåŒ…å«ä¹‹å‰è§è¿‡çš„æ ‡å¤´å­—æ®µçš„ç´¢å¼•åˆ—è¡¨ï¼ˆæ¢å¥è¯è¯´ï¼Œå®ƒå¯ä»¥å»ºç«‹ä¸€ä¸ªå…±äº«çš„åŽ‹ç¼©ä¸Šä¸‹æ–‡ï¼‰ï¼Œæ­¤åˆ—è¡¨éšåŽä¼šç”¨ä½œå‚è€ƒï¼Œå¯¹ä¹‹å‰ä¼ è¾“çš„å€¼è¿›è¡Œæœ‰æ•ˆç¼–ç ã€‚</li>
</ol>
<p>åˆ©ç”¨éœå¤«æ›¼ç¼–ç ï¼Œå¯ä»¥åœ¨ä¼ è¾“æ—¶å¯¹å„ä¸ªå€¼è¿›è¡ŒåŽ‹ç¼©ï¼Œè€Œåˆ©ç”¨ä¹‹å‰ä¼ è¾“å€¼çš„ç´¢å¼•åˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ è¾“ç´¢å¼•å€¼çš„æ–¹å¼å¯¹é‡å¤å€¼è¿›è¡Œç¼–ç ï¼Œç´¢å¼•å€¼å¯ç”¨äºŽæœ‰æ•ˆæŸ¥è¯¢å’Œé‡æž„å®Œæ•´çš„æ ‡å¤´é”®å€¼å¯¹ã€‚</p>
<p><img src="https://i.loli.net/2020/07/18/Ghy8azel4qFEiBm.png" alt="æ ‡å¤´åŽ‹ç¼©" /></p>
<h4 id="å“ˆå¤«æ›¼æ ‘å¦‚ä½•åŽ‹ç¼©">å“ˆå¤«æ›¼æ ‘å¦‚ä½•åŽ‹ç¼©</h4>
<p>æ–‡ä»¶åŽ‹ç¼©çš„ä¸»è¦æ€æƒ³æ˜¯åˆ©ç”¨å“ˆå¤«æ›¼ç¼–ç æ¥å®žçŽ°çš„ï¼Œä½†æ˜¯å¾—åˆ°ç¼–ç ä¹‹å‰æˆ‘ä»¬éœ€è¦æž„å»ºè¿™æ£µæ ‘ã€‚é‚£ä¹ˆåˆ©ç”¨ä»€ä¹ˆæ¥æž„å»ºæ ‘å‘¢ï¼Ÿï¼è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦ç»Ÿè®¡æ¯ä¸ªå­—ç¬¦å‡ºçŽ°çš„æ¬¡æ•°ï¼Œç”¨æ¬¡æ•°æ¥æž„å»ºHuffmanTreeã€‚å‡è®¾æˆ‘ä»¬çŽ°åœ¨æœ‰ä¸€ä¸ª.txtçš„å°æ–‡ä»¶ï¼Œå†…å®¹æ˜¯&quot;aaaabbbccd&rdquo;ã€‚å­—ç¬¦å­˜åœ¨è®¡ç®—æœºä¸­æ—¶ä»¥å­—èŠ‚ä¸ºå•ä½çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†è¿™äº›å­—ç¬¦åŽ‹ç¼©æˆ0ã€1è¡¨ç¤ºçš„ç¼–ç ï¼Œ0å’Œ1è¡¨ç¤ºå­—èŠ‚ä¸­çš„â€œä½â€ï¼Œè¿™æ ·èƒ½å¤§å¤§é™ä½Žæ–‡ä»¶çš„å¤§å°ã€‚</p>
<p><img src="https://i.loli.net/2020/09/11/VLBIRDHC8kPO6xw.png" alt="å“ˆå¤«æ›¼æ ‘åŽ‹ç¼©" /></p>
<h4 id="ä½“éªŒhttp2">ä½“éªŒHTTP2</h4>
<p><a href="https://http2.akamai.com/demo">https://http2.akamai.com/demo</a></p>
<hr />
<p>å‚è€ƒé“¾æŽ¥ï¼š</p>
<ol>
<li><a href="https://segmentfault.com/a/1190000013594849">HTTP è¿žæŽ¥ç®¡ç†è¿›åŒ–è®º</a></li>
<li><a href="https://developers.google.com/web/fundamentals/performance/http2?hl=zh-cn">https://developers.google.com/web/fundamentals/performance/http2?hl=zh-cn</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1509279">ç™½è¯httpé˜Ÿå¤´é˜»å¡ž</a></li>
</ol>
<h2 id="httpsè¯¦è§£">HTTPSè¯¦è§£</h2>
<p><img src="https://i.loli.net/2020/10/17/BFiqd65hfxjDRSV.png" alt="dasda" /></p>
<h3 id="ä»€ä¹ˆæ˜¯https">ä»€ä¹ˆæ˜¯HTTPSï¼Ÿ</h3>
<p>HTTPSæ˜¯åœ¨HTTPä¸Šå»ºç«‹SSLåŠ å¯†å±‚ï¼Œå¹¶å¯¹ä¼ è¾“æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œæ˜¯HTTPåè®®çš„å®‰å…¨ç‰ˆã€‚<strong>çŽ°åœ¨å®ƒè¢«å¹¿æ³›ç”¨äºŽä¸‡ç»´ç½‘ä¸Šå®‰å…¨æ•æ„Ÿçš„é€šè®¯ï¼Œä¾‹å¦‚äº¤æ˜“æ”¯ä»˜æ–¹é¢ã€‚</strong></p>
<h3 id="httpåè®®å­˜åœ¨çš„é—®é¢˜">HTTPåè®®å­˜åœ¨çš„é—®é¢˜ï¼Ÿ</h3>
<ol>
<li>é€šä¿¡ä½¿ç”¨æ˜Žæ–‡ï¼ˆä¸åŠ å¯†ï¼‰ï¼Œå†…å®¹å¯èƒ½è¢«çªƒå¬</li>
<li>æ— æ³•è¯æ˜ŽæŠ¥æ–‡çš„å®Œæ•´æ€§ï¼Œæ‰€ä»¥å¯èƒ½é­ç¯¡æ”¹</li>
<li>ä¸éªŒè¯é€šä¿¡æ–¹çš„èº«ä»½ï¼Œå› æ­¤æœ‰å¯èƒ½é­é‡ä¼ªè£…</li>
</ol>
<h3 id="httpsçš„ä¼˜åŠ¿">HTTPSçš„ä¼˜åŠ¿ï¼Ÿ</h3>
<ol>
<li>æ•°æ®éšç§æ€§ï¼šå†…å®¹ç»è¿‡å¯¹ç§°åŠ å¯†ï¼Œæ¯ä¸ªè¿žæŽ¥ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„åŠ å¯†å¯†é’¥</li>
<li>æ•°æ®å®Œæ•´æ€§ï¼šå†…å®¹ä¼ è¾“ç»è¿‡å®Œæ•´æ€§æ ¡éªŒ</li>
<li>èº«ä»½è®¤è¯ï¼šç¬¬ä¸‰æ–¹æ— æ³•ä¼ªé€ æœåŠ¡ç«¯ï¼ˆå®¢æˆ·ç«¯ï¼‰èº«ä»½</li>
</ol>
<p><img src="https://i.loli.net/2020/08/25/DZ8aQeSNg2j3czw.jpg" alt="HTTP/HTTPS" /></p>
<h3 id="httpsåè®®">HTTPSåè®®</h3>
<p>HTTPSå¹¶éžæ˜¯åº”ç”¨å±‚çš„ä¸€ç§æ–°åè®®ã€‚åªæ˜¯HTTPé€šä¿¡æŽ¥å£éƒ¨åˆ†ç”¨SSLå’ŒTLSåè®®ä»£æ›¿è€Œå·²ã€‚</p>
<p>é€šå¸¸ï¼ŒHTTPç›´æŽ¥å’ŒTCPé€šä¿¡ã€‚å½“ä½¿ç”¨SSLæ—¶ï¼Œåˆ™æ¼”å˜æˆå…ˆå’ŒSSLé€šä¿¡ï¼Œå†ç”±SSLå’ŒTCPé€šä¿¡äº†ã€‚ç®€è¨€ä¹‹ï¼Œ<strong>æ‰€è°“HTTPSï¼Œå…¶å®žå°±æ˜¯èº«æŠ«SSLåè®®è¿™å±‚å¤–å£³çš„HTTP</strong>ã€‚</p>
<p><img src="https://i.loli.net/2020/10/17/oSFPaGJkXDwWOu4.png" alt="image-20201017115517500" /></p>
<p>åœ¨é‡‡ç”¨SSLåŽï¼ŒHTTPå°±æ‹¥æœ‰äº†HTTPSçš„åŠ å¯†ã€è¯ä¹¦å’Œå®Œæ•´æ€§ä¿æŠ¤è¿™äº›åŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´<strong>HTTPåŠ ä¸ŠåŠ å¯†å¤„ç†å’Œè®¤è¯ä»¥åŠå®Œæ•´æ€§ä¿æŠ¤åŽå³æ˜¯HTTPS</strong>ã€‚</p>
<p>HTTPS åè®®çš„ä¸»è¦åŠŸèƒ½åŸºæœ¬éƒ½ä¾èµ–äºŽ TLS/SSL åè®®ï¼ŒTLS/SSL çš„åŠŸèƒ½å®žçŽ°ä¸»è¦ä¾èµ–äºŽä¸‰ç±»åŸºæœ¬ç®—æ³•ï¼šæ•£åˆ—å‡½æ•° ã€å¯¹ç§°åŠ å¯†å’Œéžå¯¹ç§°åŠ å¯†ï¼Œå…¶åˆ©ç”¨éžå¯¹ç§°åŠ å¯†å®žçŽ°èº«ä»½è®¤è¯å’Œå¯†é’¥åå•†ï¼Œå¯¹ç§°åŠ å¯†ç®—æ³•é‡‡ç”¨åå•†çš„å¯†é’¥å¯¹æ•°æ®åŠ å¯†ï¼ŒåŸºäºŽæ•£åˆ—å‡½æ•°éªŒè¯ä¿¡æ¯çš„å®Œæ•´æ€§ã€‚</p>
<p><img src="https://i.loli.net/2020/08/25/Gc5ohszgeSOMKUT.jpg" alt="HTTPSä¾èµ–çš„ç®—æ³•" /></p>
<h3 id="æ•°å­—è¯ä¹¦">æ•°å­—è¯ä¹¦</h3>
<p>æ•°å­—è¯ä¹¦è®¤è¯æœºæž„å¤„äºŽå®¢æˆ·ç«¯ä¸ŽæœåŠ¡å™¨åŒæ–¹éƒ½å¯ä¿¡èµ–çš„ç¬¬ä¸‰æ–¹æœºæž„çš„ç«‹åœºä¸Šã€‚</p>
<p><img src="https://i.loli.net/2020/08/27/cVIlSrNBJEd2Xhp.jpg" alt="æ•°å­—è¯ä¹¦" /></p>
<p>æ•°å­—è¯ä¹¦è®¤è¯æœºæž„çš„ä¸šåŠ¡æµç¨‹ï¼š</p>
<ul>
<li>æœåŠ¡å™¨çš„è¿è¥äººå‘˜å‘ç¬¬ä¸‰æ–¹æœºæž„CAæäº¤å…¬é’¥ã€ç»„ç»‡ä¿¡æ¯ã€ä¸ªäººä¿¡æ¯(åŸŸå)ç­‰ä¿¡æ¯å¹¶ç”³è¯·è®¤è¯;</li>
<li>CAé€šè¿‡çº¿ä¸Šã€çº¿ä¸‹ç­‰å¤šç§æ‰‹æ®µéªŒè¯ç”³è¯·è€…æä¾›ä¿¡æ¯çš„çœŸå®žæ€§ï¼Œå¦‚ç»„ç»‡æ˜¯å¦å­˜åœ¨ã€ä¼ä¸šæ˜¯å¦åˆæ³•ï¼Œæ˜¯å¦æ‹¥æœ‰åŸŸåçš„æ‰€æœ‰æƒç­‰;</li>
<li>å¦‚ä¿¡æ¯å®¡æ ¸é€šè¿‡ï¼ŒCAä¼šå‘ç”³è¯·è€…ç­¾å‘è®¤è¯æ–‡ä»¶-è¯ä¹¦ã€‚è¯ä¹¦åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼šç”³è¯·è€…å…¬é’¥ã€ç”³è¯·è€…çš„ç»„ç»‡ä¿¡æ¯å’Œä¸ªäººä¿¡æ¯ã€ç­¾å‘æœºæž„ CAçš„ä¿¡æ¯ã€æœ‰æ•ˆæ—¶é—´ã€è¯ä¹¦åºåˆ—å·ç­‰ä¿¡æ¯çš„æ˜Žæ–‡ï¼ŒåŒæ—¶åŒ…å«ä¸€ä¸ªç­¾åã€‚ å…¶ä¸­ç­¾åçš„äº§ç”Ÿç®—æ³•ï¼šé¦–å…ˆï¼Œä½¿ç”¨æ•£åˆ—å‡½æ•°è®¡ç®—å…¬å¼€çš„æ˜Žæ–‡ä¿¡æ¯çš„ä¿¡æ¯æ‘˜è¦ï¼Œç„¶åŽï¼Œé‡‡ç”¨ CAçš„ç§é’¥å¯¹ä¿¡æ¯æ‘˜è¦è¿›è¡ŒåŠ å¯†ï¼Œå¯†æ–‡å³ç­¾å;</li>
<li>å®¢æˆ·ç«¯ Client å‘æœåŠ¡å™¨ Server å‘å‡ºè¯·æ±‚æ—¶ï¼ŒServer è¿”å›žè¯ä¹¦æ–‡ä»¶;</li>
<li>å®¢æˆ·ç«¯ Client è¯»å–è¯ä¹¦ä¸­çš„ç›¸å…³çš„æ˜Žæ–‡ä¿¡æ¯ï¼Œé‡‡ç”¨ç›¸åŒçš„æ•£åˆ—å‡½æ•°è®¡ç®—å¾—åˆ°ä¿¡æ¯æ‘˜è¦ï¼Œç„¶åŽï¼Œåˆ©ç”¨å¯¹åº” CAçš„å…¬é’¥è§£å¯†ç­¾åæ•°æ®ï¼Œå¯¹æ¯”è¯ä¹¦çš„ä¿¡æ¯æ‘˜è¦ï¼Œå¦‚æžœä¸€è‡´ï¼Œåˆ™å¯ä»¥ç¡®è®¤è¯ä¹¦çš„åˆæ³•æ€§ï¼Œå³æœåŠ¡å™¨çš„å…¬å¼€å¯†é’¥æ˜¯å€¼å¾—ä¿¡èµ–çš„ã€‚</li>
<li>å®¢æˆ·ç«¯è¿˜ä¼šéªŒè¯è¯ä¹¦ç›¸å…³çš„åŸŸåä¿¡æ¯ã€æœ‰æ•ˆæ—¶é—´ç­‰ä¿¡æ¯; å®¢æˆ·ç«¯ä¼šå†…ç½®ä¿¡ä»»CAçš„è¯ä¹¦ä¿¡æ¯(åŒ…å«å…¬é’¥)ï¼Œå¦‚æžœCAä¸è¢«ä¿¡ä»»ï¼Œåˆ™æ‰¾ä¸åˆ°å¯¹åº” CAçš„è¯ä¹¦ï¼Œè¯ä¹¦ä¹Ÿä¼šè¢«åˆ¤å®šéžæ³•ã€‚</li>
</ul>
<h3 id="httpså·¥ä½œæµç¨‹">HTTPSå·¥ä½œæµç¨‹</h3>
<p><img src="https://i.loli.net/2020/08/26/TQeCNM26jFX3nWv.jpg" alt="httpså·¥ä½œæµç¨‹" /></p>
<ol>
<li>
<p>Clientå‘èµ·ä¸€ä¸ªHTTPSï¼ˆæ¯”å¦‚<a href="https://link.zhihu.com/?target=https%3A//juejin.im/user/5a9a9cdcf265da238b7d771c">https://juejin.im/user/5a9a9cdcf265da238b7d771c</a>ï¼‰çš„è¯·æ±‚ï¼Œæ ¹æ®RFC2818çš„è§„å®šï¼ŒClientçŸ¥é“éœ€è¦è¿žæŽ¥Serverçš„443ï¼ˆé»˜è®¤ï¼‰ç«¯å£ã€‚</p>
</li>
<li>
<p>ServeræŠŠäº‹å…ˆé…ç½®å¥½çš„å…¬é’¥è¯ä¹¦ï¼ˆpublic key certificateï¼‰è¿”å›žç»™å®¢æˆ·ç«¯ã€‚</p>
</li>
<li>
<p>ClientéªŒè¯å…¬é’¥è¯ä¹¦ï¼šæ¯”å¦‚æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…ï¼Œè¯ä¹¦çš„ç”¨é€”æ˜¯ä¸æ˜¯åŒ¹é…Clientè¯·æ±‚çš„ç«™ç‚¹ï¼Œæ˜¯ä¸æ˜¯åœ¨CRLåŠé”€åˆ—è¡¨é‡Œé¢ï¼Œå®ƒçš„ä¸Šä¸€çº§è¯ä¹¦æ˜¯å¦æœ‰æ•ˆï¼Œè¿™æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œç›´åˆ°éªŒè¯åˆ°æ ¹è¯ä¹¦ï¼ˆæ“ä½œç³»ç»Ÿå†…ç½®çš„Rootè¯ä¹¦æˆ–è€…Clientå†…ç½®çš„Rootè¯ä¹¦ï¼‰ã€‚å¦‚æžœéªŒè¯é€šè¿‡åˆ™ç»§ç»­ï¼Œä¸é€šè¿‡åˆ™æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯ã€‚</p>
</li>
<li>
<p>Clientä½¿ç”¨ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ç”ŸæˆåŠ å¯†æ‰€ä½¿ç”¨çš„å¯¹ç§°å¯†é’¥ï¼Œç„¶åŽç”¨è¯ä¹¦çš„å…¬é’¥åŠ å¯†è¿™ä¸ªå¯¹ç§°å¯†é’¥ï¼Œå‘ç»™Serverã€‚</p>
</li>
<li>
<p>Serverä½¿ç”¨è‡ªå·±çš„ç§é’¥ï¼ˆprivate keyï¼‰è§£å¯†è¿™ä¸ªæ¶ˆæ¯ï¼Œå¾—åˆ°å¯¹ç§°å¯†é’¥ã€‚è‡³æ­¤ï¼ŒClientå’ŒServeråŒæ–¹éƒ½æŒæœ‰äº†ç›¸åŒçš„å¯¹ç§°å¯†é’¥ã€‚</p>
</li>
<li>
<p>Serverä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†â€œæ˜Žæ–‡å†…å®¹Aâ€ï¼Œå‘é€ç»™Clientã€‚</p>
</li>
<li>
<p>Clientä½¿ç”¨å¯¹ç§°å¯†é’¥è§£å¯†å“åº”çš„å¯†æ–‡ï¼Œå¾—åˆ°â€œæ˜Žæ–‡å†…å®¹Aâ€ã€‚</p>
</li>
<li>
<p>Clientå†æ¬¡å‘èµ·HTTPSçš„è¯·æ±‚ï¼Œä½¿ç”¨å¯¹ç§°å¯†é’¥åŠ å¯†è¯·æ±‚çš„â€œæ˜Žæ–‡å†…å®¹Bâ€ï¼Œç„¶åŽServerä½¿ç”¨å¯¹ç§°å¯†é’¥è§£å¯†å¯†æ–‡ï¼Œå¾—åˆ°â€œæ˜Žæ–‡å†…å®¹Bâ€ã€‚</p>
</li>
</ol>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://www.jianshu.com/p/aa3f6e47f327">HTTPSçš„å®‰å…¨åŽŸç†</a></li>
</ol>
<h2 id="è™šæ‹ŸipåŽŸç†">è™šæ‹ŸIPåŽŸç†</h2>
<p>è™šæ‹ŸIPæŠ€æœ¯ã€‚è™šæ‹ŸIPï¼Œå°±æ˜¯ä¸€ä¸ªæœªåˆ†é…ç»™çœŸå®žä¸»æœºçš„IPï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹å¤–æä¾›æ•°æ®åº“æœåŠ¡å™¨çš„ä¸»æœºé™¤äº†æœ‰ä¸€ä¸ªçœŸå®žIPå¤–è¿˜æœ‰ä¸€ä¸ªè™šIPï¼Œä½¿ç”¨è¿™ä¸¤ä¸ªIPä¸­çš„ä»»æ„ä¸€ä¸ªéƒ½å¯ä»¥è¿žæŽ¥åˆ°è¿™å°ä¸»æœºï¼Œæ‰€æœ‰é¡¹ç›®ä¸­æ•°æ®åº“é“¾æŽ¥ä¸€é¡¹é…ç½®çš„éƒ½æ˜¯è¿™ä¸ªè™šIPï¼Œå½“æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ— æ³•å¯¹å¤–æä¾›æœåŠ¡æ—¶ï¼ŒåŠ¨æ€å°†è¿™ä¸ªè™šIPåˆ‡æ¢åˆ°å¤‡ç”¨ä¸»æœºã€‚</p>
<p>å…¶å®žçŽ°åŽŸç†ä¸»è¦æ˜¯é  TCP/IP çš„ ARP åè®®ã€‚å› ä¸ºIPåœ°å€åªæ˜¯ä¸€ä¸ªé€»è¾‘åœ°å€ï¼Œåœ¨ä»¥å¤ªç½‘ä¸­ MAC åœ°å€æ‰æ˜¯çœŸæ­£ç”¨æ¥è¿›è¡Œæ•°æ®ä¼ è¾“çš„ç‰©ç†åœ°å€ï¼Œæ¯å°ä¸»æœºä¸­éƒ½æœ‰ä¸€ä¸ª ARP é«˜é€Ÿç¼“å­˜ï¼Œå­˜å‚¨åŒä¸€ä¸ªç½‘ç»œå†…çš„ IP åœ°å€ä¸Ž MAC åœ°å€çš„å¯¹åº”å…³ç³»ï¼Œä»¥å¤ªç½‘ä¸­çš„ä¸»æœºå‘é€æ•°æ®æ—¶ä¼šå…ˆä»Žè¿™ä¸ªç¼“å­˜ä¸­æŸ¥è¯¢ç›®æ ‡ IP å¯¹åº”çš„ MAC åœ°å€ï¼Œä¼šå‘è¿™ä¸ª MAC åœ°å€å‘é€æ•°æ®ã€‚æ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨ç»´æŠ¤è¿™ä¸ªç¼“å­˜ã€‚è¿™å°±æ˜¯æ•´ä¸ªå®žçŽ°çš„å…³é”®ã€‚</p>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="http://www.xumenger.com/virtual-ip-20190220/">è™šæ‹ŸIPæŠ€æœ¯</a></li>
</ol>
<h1 id="ä¼ è¾“å±‚">ä¼ è¾“å±‚ðŸš™</h1>
<h2 id="tcp">TCPã€°ï¸</h2>
<h4 id="tcpä¸­æµçš„è§£é‡Š">TCPä¸­æµçš„è§£é‡Š</h4>
<p>TCPä¸­çš„â€œæµâ€(stream)æŒ‡çš„æ˜¯æµå…¥åˆ°è¿›ç¨‹æˆ–ä»Žè¿›ç¨‹æµå‡ºçš„å­—èŠ‚åºåˆ—ã€‚â€œé¢å‘å­—èŠ‚æµâ€çš„å«ä¹‰æ˜¯ï¼šè™½ç„¶åº”ç”¨ç¨‹åºå’ŒTCPçš„äº¤äº’æ˜¯ä¸€æ¬¡ä¸€ä¸ªæ•°æ®å—ï¼ˆå¤§å°ä¸ç­‰ï¼‰ï¼Œä½†TCPæŠŠåº”ç”¨ç¨‹åºäº¤ä¸‹æ¥çš„æ•°æ®çœ‹æˆä»…ä»…æ˜¯ä¸€è¿žä¸²çš„æ— ç»“æž„çš„å­—èŠ‚æµã€‚TCPå¹¶ä¸çŸ¥é“æ‰€ä¼ é€çš„å­—èŠ‚æµçš„å«ä¹‰ã€‚TCPä¸ä¿è¯æŽ¥æ”¶æ–¹åº”ç”¨ç¨‹åºæ‰€æ”¶åˆ°çš„æ•°æ®å—å’Œå‘é€æ–¹åº”ç”¨ç¨‹åºæ‰€å‘å‡ºçš„æ•°æ®å—å…·æœ‰å¯¹åº”å¤§å°çš„å…³ç³»ï¼ˆä¾‹å¦‚ï¼Œå‘é€æ–¹åº”ç”¨ç¨‹åºäº¤ç»™å‘é€æ–¹çš„TCPå…±10ä¸ªæ•°æ®å—ï¼Œä½†æŽ¥æ”¶æ–¹çš„TCPå¯èƒ½åªç”¨äº†4ä¸ªæ•°æ®å—å°±æŠŠæ”¶åˆ°çš„å­—èŠ‚æµäº¤ä»˜ä¸Šå±‚çš„åº”ç”¨ç¨‹åºï¼‰ã€‚ä½†æŽ¥æ”¶æ–¹åº”ç”¨ç¨‹åºæ”¶åˆ°çš„å­—èŠ‚æµå¿…é¡»å’Œå‘é€æ–¹åº”ç”¨ç¨‹åºå‘å‡ºçš„å­—èŠ‚æµå®Œå…¨ä¸€æ ·ã€‚å½“ç„¶ï¼ŒæŽ¥æ”¶æ–¹çš„åº”ç”¨ç¨‹åºå¿…é¡»æœ‰èƒ½åŠ›è¯†åˆ«æ”¶åˆ°çš„å­—èŠ‚æµï¼ŒæŠŠå®ƒè¿˜åŽŸæˆæœ‰æ„ä¹‰çš„åº”ç”¨å±‚æ•°æ®ã€‚</p>
<p>ä¸€ä¸ªç®€å•çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2020/07/11/ty89pm5J12SBYxT.png" alt="TCPæµçš„æ¦‚å¿µ" /></p>
<blockquote>
<p>TCPå’ŒUDPåœ¨å‘é€æŠ¥æ–‡æ—¶æ‰€é‡‡ç”¨çš„æ–¹å¼å®Œå…¨ä¸åŒã€‚TCPå¹¶ä¸å…³å¿ƒåº”ç”¨è¿›ç¨‹ä¸€æ¬¡æŠŠå¤šé•¿çš„æŠ¥æ–‡å‘é€åˆ°TCPçš„ç¼“å­˜ä¸­ï¼Œè€Œæ˜¯æ ¹æ®å¯¹æ–¹ç»™å‡ºçš„çª—å£å€¼å’Œå½“å‰ç½‘ç»œæ‹¥å¡žçš„ç¨‹åº¦æ¥å†³å®šä¸€ä¸ªæŠ¥æ–‡æ®µåº”åŒ…å«å¤šå°‘ä¸ªå­—èŠ‚ï¼ˆUDPå‘é€çš„æŠ¥æ–‡é•¿åº¦æ˜¯åº”ç”¨è¿›ç¨‹ç»™å‡ºçš„ï¼‰ã€‚å¦‚æžœåº”ç”¨è¿›ç¨‹ä¼ é€åˆ°TCPç¼“å­˜çš„æ•°æ®å—å¤ªé•¿ï¼ŒTCPå°±å¯ä»¥æŠŠå®ƒåˆ’åˆ†çŸ­ä¸€äº›å†ä¼ é€ã€‚å¦‚æžœåº”ç”¨è¿›ç¨‹ä¸€æ¬¡åªå‘æ¥ä¸€ä¸ªå­—èŠ‚ï¼ŒTCPä¹Ÿå¯ä»¥ç­‰å¾…ç§¯ç´¯æœ‰è¶³å¤Ÿå¤šçš„å­—èŠ‚åŽå†æž„æˆæŠ¥æ–‡æ®µå‘é€å‡ºåŽ»</p>
</blockquote>
<h4 id="tcpæŠ¥æ–‡æ ¼å¼">TCPæŠ¥æ–‡æ ¼å¼</h4>
<p><img src="https://i.loli.net/2020/07/11/WOpzMnVACiHdgkb.png" alt="TCPæŠ¥æ–‡" /></p>
<p>è‹±æ–‡ç‰ˆï¼š</p>
<p><img src="https://i.loli.net/2020/11/12/cftgZa6eoYsb5zm.png" alt="TCPæŠ¥æ–‡" /></p>
<p>TCPçš„å›ºå®šåŒ…å¤´ä¸º20ä¸ªå­—èŠ‚ï¼Œä¸‹é¢æ˜¯å‡ ä¸ªå‚æ•°ï¼š</p>
<ol>
<li>åºå·ï¼šå³SEQåºå·ã€‚TCPè¿žæŽ¥ä¸­ä¼ é€çš„æ•°æ®æµä¸­çš„æ¯ä¸€ä¸ªå­—èŠ‚éƒ½ç¼–ä¸Šä¸€ä¸ªåºå·ã€‚åºå·å­—æ®µçš„å€¼åˆ™æŒ‡çš„æ˜¯æœ¬æŠ¥æ–‡æ®µæ‰€å‘é€çš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚</li>
<li>ç¡®è®¤å·ï¼šå³ç¡®è®¤åºå·ï¼Œä¹Ÿå«ACKåºå·ã€‚æ˜¯æœŸæœ›æ”¶åˆ°å¯¹æ–¹çš„ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚åªæœ‰ACKæ ‡å¿—ä½ä¸º1æ—¶ï¼Œç¡®è®¤åºå·å­—æ®µæ‰æœ‰æ•ˆï¼ŒACK=SEQ+1ã€‚</li>
<li>æ•°æ®åç§»ï¼šå®ƒæŒ‡å‡ºTCPæŠ¥æ–‡æ®µçš„æ•°æ®èµ·å§‹å¤„è·ç¦»TCPæŠ¥æ–‡æ®µçš„èµ·å§‹å¤„æœ‰å¤šè¿œã€‚è¯¥å­—æ®µé•¿ 4 ä½ï¼Œå•ä½ä¸º 4 å­—èŠ‚ã€‚è¡¨ç¤ºä¸º TCP é¦–éƒ¨çš„é•¿åº¦ã€‚æ‰€ä»¥ TCP é¦–éƒ¨é•¿åº¦æœ€å¤šä¸º 60 å­—èŠ‚ã€‚</li>
<li>æ ‡å¿—ä½ï¼šå…±6ä¸ªï¼Œå³URG(ç´§æ€¥æ¯”ç‰¹)ã€ACK(ç¡®è®¤æ¯”ç‰¹)ã€PSH(æŽ¨é€æ¯”ç‰¹)ã€RST(å¤ä½æ¯”ç‰¹)ã€SYN(åŒæ­¥æ¯”ç‰¹)ã€FIN(ç»“æŸæ¯”ç‰¹)ç­‰ã€‚</li>
<li>çª—å£å¤§å°ï¼šçª—å£å­—æ®µç”¨æ¥æŽ§åˆ¶å¯¹æ–¹å‘é€çš„æ•°æ®é‡ï¼Œå•ä½ä¸ºå­—èŠ‚ã€‚TCPè¿žæŽ¥çš„ä¸€ç«¯æ ¹æ®è®¾ç½®çš„ç¼“å­˜ç©ºé—´å¤§å°ç¡®å®šè‡ªå·±çš„æŽ¥æ”¶çª—å£å¤§å°ï¼Œç„¶åŽé€šçŸ¥å¯¹æ–¹ä»¥ç¡®å®šå¯¹æ–¹çš„å‘é€çª—å£çš„ä¸Šã€‚</li>
<li>æ ¡éªŒå’Œï¼šæ£€éªŒå’Œå­—æ®µæ£€éªŒçš„èŒƒå›´åŒ…æ‹¬é¦–éƒ¨å’Œæ•°æ®è¿™ä¸¤éƒ¨åˆ†ã€‚åœ¨è®¡ç®—æ£€éªŒå’Œæ—¶ï¼Œè¦åœ¨TCPæŠ¥æ–‡æ®µçš„å‰é¢åŠ ä¸Š12å­—èŠ‚çš„ä¼ªé¦–éƒ¨ã€‚</li>
<li>ç´§æ€¥æŒ‡é’ˆï¼šç´§æ€¥æŒ‡é’ˆæŒ‡å‡ºåœ¨æœ¬æŠ¥æ–‡æ®µä¸­çš„ç´§æ€¥æ•°æ®çš„æœ€åŽä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚</li>
<li>é€‰é¡¹ï¼šTCPåªè§„å®šäº†ä¸€ç§é€‰é¡¹ï¼Œå³æœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦MSSï¼ˆMaximumSegment Sizeï¼‰ã€‚MSSå‘Šè¯‰å¯¹æ–¹TCPï¼šâ€œæˆ‘çš„ç¼“å­˜æ‰€èƒ½æŽ¥æ”¶çš„æŠ¥æ–‡æ®µçš„æ•°æ®å­—æ®µçš„æœ€å¤§é•¿åº¦æ˜¯MSS ä¸ªå­—èŠ‚ã€‚â€</li>
</ol>
<p>å‡ ä¸ªæŽ§åˆ¶ä½ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">CWRï¼šç”¨äºŽ IP é¦–éƒ¨çš„ ECN å­—æ®µã€‚ECE ä¸º 1 æ—¶ï¼Œåˆ™é€šçŸ¥å¯¹æ–¹å·²å°†æ‹¥å¡žçª—å£ç¼©å°ã€‚
</span></span><span class="line"><span class="cl">ECEï¼šåœ¨æ”¶åˆ°æ•°æ®åŒ…çš„ IP é¦–éƒ¨ä¸­ ECN ä¸º 1 æ—¶å°† TCP é¦–éƒ¨ä¸­çš„ ECE è®¾ç½®ä¸º 1ï¼Œè¡¨ç¤ºä»Žå¯¹æ–¹åˆ°è¿™è¾¹çš„ç½‘ç»œæœ‰æ‹¥å¡žã€‚
</span></span><span class="line"><span class="cl">URGï¼šç´§æ€¥æ¨¡å¼
</span></span><span class="line"><span class="cl">ACKï¼šç¡®è®¤
</span></span><span class="line"><span class="cl">PSHï¼šæŽ¨é€ï¼ŒæŽ¥æ”¶æ–¹åº”å°½å¿«ç»™åº”ç”¨ç¨‹åºä¼ é€è¿™ä¸ªæ•°æ®ã€‚æ²¡ç”¨åˆ°
</span></span><span class="line"><span class="cl">RSTï¼šè¯¥ä½ä¸º 1 è¡¨ç¤º TCP è¿žæŽ¥ä¸­å‡ºçŽ°å¼‚å¸¸å¿…é¡»å¼ºåˆ¶æ–­å¼€è¿žæŽ¥ã€‚
</span></span><span class="line"><span class="cl">SYNï¼šåˆå§‹åŒ–ä¸€ä¸ªè¿žæŽ¥çš„åŒæ­¥åºåˆ—å·
</span></span><span class="line"><span class="cl">FINï¼šè¯¥ä½ä¸º 1 è¡¨ç¤ºä»ŠåŽä¸ä¼šæœ‰æ•°æ®å‘é€ï¼Œå¸Œæœ›æ–­å¼€è¿žæŽ¥
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€‰é¡¹ï¼ˆOptionsï¼‰ï¼š</p>
<p>å— Data Offset æŽ§åˆ¶ï¼Œé•¿åº¦æœ€å¤§ä¸º 40 å­—èŠ‚ã€‚ä¸€èˆ¬ Option çš„æ ¼å¼ä¸º TLV ç»“æž„ï¼š</p>
<p><img src="https://i.loli.net/2020/11/12/bgudhc4e2AFEJKH.png" alt="é€‰é¡¹æ ¼å¼" /></p>
<p>å¸¸è§çš„ TCP Options æœ‰ï¼ŒSACK å­—æ®µå°±ä½äºŽè¯¥é€‰é¡¹ä¸­:</p>
<p><img src="https://i.loli.net/2020/11/12/ruohKXElcVspNCi.jpg" alt="img" /></p>
<p><strong>SACK çš„å·¥ä½œåŽŸç†</strong></p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ æŽ¥æ”¶æ–¹æ”¶åˆ° 500-699 çš„æ•°æ®åŒ…ï¼Œä½†æ²¡æœ‰æ”¶åˆ° 300-499 çš„æ•°æ®åŒ…å°±ä¼šå›ž SACK(500-700) ç»™å‘é€ç«¯ï¼Œè¡¨ç¤ºæ”¶åˆ° 500-699 çš„æ•°æ®ã€‚</p>
<p><img src="https://i.loli.net/2020/11/12/GEOyYZBe9XNjFfL.jpg" alt="img" /></p>
<h4 id="ä¸‰æ¬¡æ¡æ‰‹">ä¸‰æ¬¡æ¡æ‰‹ï¼š</h4>
<blockquote>
<p>ä¸‰æ¬¡æ¡æ‰‹æ˜¯å¿…é¡»çš„â€”â€”TCP éœ€è¦ seq åºåˆ—å·æ¥åšå¯é é‡ä¼ æˆ–æŽ¥æ”¶ï¼Œè€Œé¿å…è¿žæŽ¥å¤ç”¨æ—¶æ— æ³•åˆ†è¾¨å‡º seq æ˜¯å»¶è¿Ÿæˆ–è€…æ˜¯æ—§é“¾æŽ¥çš„ seqï¼Œå› æ­¤éœ€è¦ä¸‰æ¬¡æ¡æ‰‹æ¥çº¦å®šç¡®å®šåŒæ–¹çš„ ISNï¼ˆåˆå§‹ seq åºåˆ—å·ï¼‰ã€‚</p>
</blockquote>
<p><img src="https://i.loli.net/2020/07/11/EwG4tcyShsvIARa.png" alt="image-20200711165225619" /></p>
<h4 id="å››æ¬¡æŒ¥æ‰‹">å››æ¬¡æŒ¥æ‰‹</h4>
<p>å…¶ä¸­Aå‘é€çš„Xä¸ºå‰é¢å·²ä¼ é€è¿‡çš„æ•°æ®çš„æœ€åŽä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ã€‚</p>
<p>ç¬¬ä¸€æ¬¡Aåˆ°Bæ–¹å‘ç»“æŸï¼Œç¬¬äºŒæ¬¡Båˆ°Aæ–¹å‘ç»“æŸã€‚</p>
<p>ç¬¬äºŒæ¬¡Bå‘é€çš„SEQ=Z(åœ¨åŠå…³é—­çŠ¶æ€Bå¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®),Bè¿˜å¿…é¡»é‡å¤ä¸Šæ¬¡å·²å‘é€è¿‡çš„ç¡®è®¤å·ACK = X+1ã€‚</p>
<p><img src="https://i.loli.net/2020/07/11/jaXZsPKSeGUuN6k.png" alt="image-20200711170105870" /></p>
<blockquote>
<p>è¯·æ³¨æ„ï¼ŒTCPè§„å®šï¼ŒFINæŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œå®ƒä¹Ÿæ¶ˆè€—æŽ‰ä¸€ä¸ªåºå·ã€‚</p>
<p>è¯·æ³¨æ„ï¼ŒçŽ°åœ¨TCPè¿žæŽ¥è¿˜æ²¡æœ‰é‡Šæ”¾æŽ‰ã€‚å¿…é¡»ç»è¿‡æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨(TIME-WAIT timer)è®¾ç½®çš„æ—¶é—´2MSLåŽï¼ŒAæ‰è¿›å…¥åˆ°CLOSEDçŠ¶æ€ã€‚æ—¶é—´MSLå«åšæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½(Maximum Segment Lifetime)ï¼ŒRFC 793å»ºè®®è®¾ä¸º2åˆ†é’Ÿã€‚ä½†è¿™å®Œå…¨æ˜¯ä»Žå·¥ç¨‹ä¸Šæ¥è€ƒè™‘ï¼Œå¯¹äºŽçŽ°åœ¨çš„ç½‘ç»œï¼ŒMSL = 2åˆ†é’Ÿå¯èƒ½å¤ªé•¿äº†ä¸€äº›ã€‚å› æ­¤TCPå…è®¸ä¸åŒçš„å®žçŽ°å¯æ ¹æ®å…·ä½“æƒ…å†µä½¿ç”¨æ›´å°çš„MSLå€¼ã€‚å› æ­¤ï¼Œä»ŽAè¿›å…¥åˆ°TIME-WAITçŠ¶æ€åŽï¼Œè¦ç»è¿‡4åˆ†é’Ÿæ‰èƒ½è¿›å…¥åˆ°CLOSEDçŠ¶æ€ï¼Œæ‰èƒ½å¼€å§‹å»ºç«‹ä¸‹ä¸€ä¸ªæ–°çš„è¿žæŽ¥ã€‚å½“Aæ’¤é”€ç›¸åº”çš„ä¼ è¾“æŽ§åˆ¶å—TCBåŽï¼Œå°±ç»“æŸäº†è¿™æ¬¡çš„TCPè¿žæŽ¥ã€‚</p>
</blockquote>
<p>ä¸ºä»€ä¹ˆAåœ¨TIME-WAITçŠ¶æ€(å‘é€æœ€åŽä¸€ä¸ªæ•°æ®åŒ…ä¹‹åŽ)å¿…é¡»ç­‰å¾…2MSLçš„æ—¶é—´å‘¢ï¼Ÿè¿™æœ‰ä¸¤ä¸ªç†ç”±ã€‚</p>
<ul>
<li>
<p>ç¬¬ä¸€ï¼Œä¸ºäº†ä¿è¯Aå‘é€çš„æœ€åŽä¸€ä¸ªACKæŠ¥æ–‡æ®µèƒ½å¤Ÿåˆ°è¾¾Bã€‚è¿™ä¸ªACKæŠ¥æ–‡æ®µæœ‰å¯èƒ½ä¸¢å¤±ï¼Œå› è€Œä½¿å¤„åœ¨LAST-ACKçŠ¶æ€çš„Bæ”¶ä¸åˆ°å¯¹å·²å‘é€çš„FIN + ACKæŠ¥æ–‡æ®µçš„ç¡®è®¤ã€‚Bä¼šè¶…æ—¶é‡ä¼ è¿™ä¸ªFIN + ACKæŠ¥æ–‡æ®µï¼Œè€ŒAå°±èƒ½åœ¨2MSLæ—¶é—´å†…æ”¶åˆ°è¿™ä¸ªé‡ä¼ çš„FIN + ACKæŠ¥æ–‡æ®µã€‚æŽ¥ç€Aé‡ä¼ ä¸€æ¬¡ç¡®è®¤ï¼Œé‡æ–°å¯åŠ¨2MSLè®¡æ—¶å™¨ã€‚æœ€åŽï¼ŒAå’ŒBéƒ½æ­£å¸¸è¿›å…¥åˆ°CLOSEDçŠ¶æ€ã€‚å¦‚æžœAåœ¨TIME-WAITçŠ¶æ€ä¸ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè€Œæ˜¯åœ¨å‘é€å®ŒACKæŠ¥æ–‡æ®µåŽç«‹å³é‡Šæ”¾è¿žæŽ¥ï¼Œé‚£ä¹ˆå°±æ— æ³•æ”¶åˆ°Bé‡ä¼ çš„FIN + ACKæŠ¥æ–‡æ®µï¼Œå› è€Œä¹Ÿä¸ä¼šå†å‘é€ä¸€æ¬¡ç¡®è®¤æŠ¥æ–‡æ®µã€‚è¿™æ ·ï¼ŒBå°±æ— æ³•æŒ‰ç…§æ­£å¸¸æ­¥éª¤è¿›å…¥CLOSEDçŠ¶æ€ã€‚</p>
</li>
<li>
<p>ç¬¬äºŒï¼Œé˜²æ­¢ä¸Šä¸€èŠ‚æåˆ°çš„â€œå·²å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µâ€å‡ºçŽ°åœ¨æœ¬è¿žæŽ¥ä¸­ã€‚Aåœ¨å‘é€å®Œæœ€åŽä¸€ä¸ªACKæŠ¥æ–‡æ®µåŽï¼Œå†ç»è¿‡æ—¶é—´2MSLï¼Œå°±å¯ä»¥ä½¿æœ¬è¿žæŽ¥æŒç»­çš„æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡æ®µéƒ½ä»Žç½‘ç»œä¸­æ¶ˆå¤±ã€‚è¿™æ ·å°±å¯ä»¥ä½¿ä¸‹ä¸€ä¸ªæ–°çš„è¿žæŽ¥ä¸­ä¸ä¼šå‡ºçŽ°è¿™ç§æ—§çš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µã€‚Båªè¦æ”¶åˆ°äº†Aå‘å‡ºçš„ç¡®è®¤ï¼Œå°±è¿›å…¥CLOSEDçŠ¶æ€ã€‚åŒæ ·ï¼ŒBåœ¨æ’¤é”€ç›¸åº”çš„ä¼ è¾“æŽ§åˆ¶å—TCBåŽï¼Œå°±ç»“æŸäº†è¿™æ¬¡çš„TCPè¿žæŽ¥ã€‚<strong>æˆ‘ä»¬æ³¨æ„åˆ°ï¼ŒBç»“æŸTCPè¿žæŽ¥çš„æ—¶é—´è¦æ¯”Aæ—©ä¸€äº›ã€‚</strong></p>
</li>
</ul>
<h4 id="tcpçš„4ä¸ªå®šæ—¶å™¨"><strong>TCP</strong>çš„4ä¸ªå®šæ—¶å™¨</h4>
<blockquote>
<p>é‡ä¼ å®šæ—¶å™¨ã€åšæŒå®šæ—¶å™¨ã€ä¿æŒå®šæ—¶å™¨ã€æ—¶é—´ç­‰å¾…å®šæ—¶å™¨</p>
</blockquote>
<p><strong>é‡ä¼ è®¡æ—¶å™¨</strong>ï¼š</p>
<p>å½“TCPå‘é€æŠ¥æ–‡æ®µæ—¶ï¼Œå°±åˆ›å»ºè¯¥ç‰¹å®šæŠ¥æ–‡æ®µçš„é‡ä¼ è®¡æ—¶å™¨ã€‚</p>
<ol>
<li>è‹¥åœ¨è®¡æ—¶å™¨æˆªæ­¢æ—¶é—´åˆ°(é€šå¸¸60ç§’)ä¹‹å‰æ”¶åˆ°äº†å¯¹æ­¤ç‰¹å®šæŠ¥æ–‡æ®µçš„ç¡®è®¤ï¼Œåˆ™æ’¤é”€æ­¤è®¡æ—¶å™¨ã€‚</li>
<li>è‹¥åœ¨è®¡æ—¶å™¨æˆªæ­¢æ—¶é—´ä¹‹å‰æ²¡æœ‰æ”¶åˆ°å¯¹æ­¤ç‰¹å®šæŠ¥æ–‡çš„ç¡®è®¤ï¼Œåˆ™å°±è®¤ä¸ºè¯¥æŠ¥æ–‡ä¸¢å¤±ï¼Œéœ€è¦é‡ä¼ æ­¤æŠ¥æ–‡æ®µï¼Œå¹¶å°†è®¡æ—¶å™¨å¤ä½ã€‚</li>
</ol>
<p><strong>åšæŒè®¡æ—¶å™¨</strong>-é˜²æ­¢æ”¶ä¸åˆ°éž0çª—å£å¤§å°çš„æŠ¥æ–‡</p>
<blockquote>
<p>å‡è®¾TCPæ”¶åˆ°äº†ä¸€ä¸ªçª—å£å¤§å°ä¸º0æŠ¥æ–‡æ®µï¼Œå‘é€TCPå°±åœæ­¢ä¼ é€æŠ¥æ–‡æ®µï¼Œç›´åˆ°æŽ¥æ”¶TCPå‘é€ä¸€ä¸ªéžé›¶çš„çª—å£å¤§å°ã€‚ä½†æ˜¯è¿™ä¸ªç¡®è®¤æœ‰å¯èƒ½ä¸¢å¤±ï¼Œè‹¥ç¡®è®¤ä¸¢äº†ï¼ŒæŽ¥æ”¶TCPå¹¶ä¸ä¼šçŸ¥é“ï¼Œè€Œæ˜¯è®¤ä¸ºä»–å·²ç»å®Œæˆä»»åŠ¡äº†ã€‚ä½†æ˜¯å‘é€TCPç”±äºŽæ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œå°±ä¼šä¸€ç›´ç­‰å¾…æŽ¥æ”¶æ–¹å‘é€ç¡®è®¤æ¥é€šçŸ¥çª—å£çš„å¤§å°ã€‚åŒæ–¹çš„TCPè¿™æ—¶å°±ä¼šé€ æˆæ­»é”ï¼Œæ‰€ä»¥è¦ä½¿ç”¨ä¸€ä¸ªè®¡æ—¶å™¨æ¥é¿å…æ­»é”çš„å‘é€ã€‚</p>
</blockquote>
<ol>
<li>å½“TCPæ”¶åˆ°ä¸€ä¸ªçª—å£å¤§å°ä¸º0çš„ç¡®è®¤æ—¶ï¼Œå°±è¦å¯åŠ¨åšæŒè®¡æ—¶å™¨ã€‚å½“åšæŒè®¡æ—¶å™¨æœŸé™åˆ°æ—¶ï¼Œå‘é€TCPå°±å‘é€ä¸€ä¸ªç‰¹æ®Šçš„æŽ¢æµ‹æŠ¥æ–‡ï¼Œè¿™ä¸ªæŽ¢æµ‹æŠ¥æ–‡æ®µåªæœ‰ä¸€ä¸ªå­—èŠ‚æ•°æ®ï¼Œå®ƒæœ‰ä¸€ä¸ªåºå·ï¼Œä½†æ˜¯å®ƒçš„åºå·æ°¸è¿œä¸éœ€è¦ç¡®è®¤ã€‚æŽ¢æµ‹æŠ¥æ–‡æ®µæé†’å¯¹ç«¯ï¼Œç¡®è®¤å·²ä¸¢å¤±ï¼Œå¿…é¡»é‡ä¼ ã€‚</li>
<li>åšæŒè®¡æ—¶å™¨çš„å€¼è®¾ç½®ä¸ºé‡ä¼ æ—¶é—´çš„æ•°å€¼ã€‚è‹¥æ²¡æœ‰æ”¶åˆ°ä»ŽæŽ¥æ”¶ç«¯æ¥çš„å“åº”ï¼Œéœ€è¦å‘é€ä¸€ä¸ªæŽ¢æµ‹æŠ¥æ–‡ï¼Œå¹¶å°†åšæŒè®¡æ—¶å™¨çš„å€¼åŠ å€å’Œå¤ä½ï¼Œç›´åˆ°è¿™ä¸ªå€¼å¢žå¤§åˆ°é—¨é™å€¼(é€šå¸¸60ç§’)ä¸ºæ­¢ã€‚åœ¨è¿™ä»¥åŽï¼Œå‘é€ç«¯æ¯éš”60ç§’å‘é€ä¸€ä¸ªæŽ¢æµ‹æŠ¥æ–‡ï¼Œç›´åˆ°çª—å£é‡æ–°æ‰“å¼€ã€‚</li>
</ol>
<p><strong>ä¿æ´»è®¡æ—¶å™¨</strong><br />
ä¿æ´»è®¡æ—¶å™¨ç”¨æ¥é˜²æ­¢ä¸¤ä¸ªTCPä¹‹é—´çš„è¿žç»­å‡ºçŽ°é•¿æ—¶é—´çš„ç©ºé—²ã€‚</p>
<ol>
<li>å‡å®šå®¢æˆ·å·²ä¸»åŠ¨ä¸ŽæœåŠ¡å™¨å»ºç«‹äº†TCPé“¾æŽ¥ã€‚ç„¶åŽè¿™ä¸ªå®¢æˆ·ç«¯å‡ºçŽ°æ•…éšœã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé“¾æŽ¥å°±ä¼šæ°¸è¿œçš„å¤„äºŽæ‰“å¼€çŠ¶æ€ã€‚è€ŒæœåŠ¡å™¨ç»´æŠ¤ä¸€ä¸ªé“¾æŽ¥ï¼Œä¹Ÿæ˜¯è¦è€—è´¹ä¸€å®šçš„èµ„æºçš„ï¼Œæ‰€ä»¥å¿…é¡»é‡‡å–æŽªæ–½ï¼Œä½¿æœåŠ¡å™¨ä¸èƒ½ç™½ç™½ç­‰ä¸‹åŽ»ã€‚</li>
<li>è¦è§£å†³è¿™ç§é—®é¢˜ï¼Œå°±è¦å¯¹æœåŠ¡å™¨è®¾ç½®ä¿æ´»è®¡æ—¶å™¨ã€‚æ¯å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·çš„ä¿¡æ¯ï¼Œå°±å°†è®¡æ—¶å™¨å¤ä½ï¼Œä¿æ´»æ—¶é—´é€šå¸¸è®¾ç½®ä¸º2å°æ—¶ã€‚è‹¥æœåŠ¡å™¨è¿‡äº†ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·çš„ä¿¡æ¯ï¼Œä»–å°±å‘é€ä¸€ä¸ªæŽ¢æµ‹æŠ¥æ–‡ï¼Œä»¥åŽæ¯éš”75ç§’å°±å‘ä¸€æ¬¡ï¼Œè¿žç»­å‘é€10ä¸ªæŽ¢æµ‹æŠ¥æ–‡åŽå®¢æˆ·ç«¯ä»ç„¶æ²¡æœ‰å“åº”ï¼ŒæœåŠ¡å™¨å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºçŽ°äº†æ•…éšœï¼ŒæŽ¥ç€å°±å…³é—­è¿™ä¸ªé“¾æŽ¥ã€‚</li>
</ol>
<p><strong>æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨</strong><br />
å½“å®¢æˆ·ç«¯è¿›å…¥TIME-WAITçŠ¶æ€çš„æ—¶å€™ï¼Œé“¾æŽ¥è¿˜æ²¡æœ‰é‡Šæ”¾æŽ‰ï¼Œå¿…é¡»ç­‰å¾…2å€çš„MSL(æœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½)åŽï¼Œå®¢æˆ·ç«¯æ‰èƒ½å…³é—­è¿žæŽ¥ã€‚åœ¨æ—¶é—´ç­‰å¾…æœŸé—´ï¼Œé“¾æŽ¥è¿˜å¤„äºŽä¸€ç§è¿‡æ¸¡çŠ¶æ€ã€‚è¿™å°±å¯ä»¥ä½¿é‡å¤çš„FINæŠ¥æ–‡æ®µ(è‹¥æžœæœ‰çš„è¯)å¯ä»¥åˆ°è¾¾ç›®çš„ç«™å› è€Œå¯å°†å…¶ä¸¢å¼ƒã€‚</p>
<h4 id="ä¿è¯ä¼ è¾“å¯é ">ä¿è¯ä¼ è¾“å¯é </h4>
<p>ç†æƒ³çš„ä¼ è¾“æ¡ä»¶æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p>
<ol>
<li>ä¼ è¾“ä¿¡é“ä¸äº§ç”Ÿå·®é”™ã€‚</li>
<li>ä¸ç®¡å‘é€æ–¹ä»¥å¤šå¿«çš„é€Ÿåº¦å‘é€æ•°æ®ï¼ŒæŽ¥æ”¶æ–¹æ€»æ˜¯æ¥å¾—åŠå¤„ç†æ”¶åˆ°çš„æ•°æ®ã€‚</li>
</ol>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›å¯é ä¼ è¾“åè®®ï¼Œå½“å‡ºçŽ°å·®é”™æ—¶è®©å‘é€æ–¹é‡ä¼ å‡ºçŽ°å·®é”™çš„æ•°æ®ï¼ŒåŒæ—¶åœ¨æŽ¥æ”¶æ–¹æ¥ä¸åŠå¤„ç†æ”¶åˆ°çš„æ•°æ®æ—¶ï¼ŒåŠæ—¶å‘Šè¯‰å‘é€æ–¹é€‚å½“é™ä½Žå‘é€æ•°æ®çš„é€Ÿåº¦ã€‚è¿™æ ·ä¸€æ¥ï¼Œæœ¬æ¥æ˜¯ä¸å¯é çš„ä¼ è¾“ä¿¡é“å°±èƒ½å¤Ÿå®žçŽ°å¯é ä¼ è¾“äº†ã€‚</p>
</blockquote>
<p><strong>åºå·ä¸Žç¡®è®¤å·</strong></p>
<p>æœ‰ä¸€ä¸ªé—®é¢˜ï¼šè¿™æ¡è¿žæŽ¥çªç„¶æ–­å¼€é‡è¿žåŽï¼ŒTCP æ€Žä¹ˆæ ·è¯†åˆ«ä¹‹å‰æ—§é“¾æŽ¥é‡å‘çš„åŒ…ï¼Ÿâ€”â€”è¿™å°±éœ€è¦ç‹¬ä¸€æ— äºŒçš„ ISNï¼ˆåˆå§‹åºåˆ—å·ï¼‰æœºåˆ¶ã€‚</p>
<p><strong>è¶…æ—¶é‡ä¼ </strong></p>
<p>è¶…æ—¶é‡ä¼ ï¼šå¯é ä¼ è¾“åè®®æ˜¯è¿™æ ·è®¾è®¡çš„ï¼šAåªè¦è¶…è¿‡äº†ä¸€æ®µæ—¶é—´ä»ç„¶æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œå°±è®¤ä¸ºåˆšæ‰å‘é€çš„åˆ†ç»„ä¸¢å¤±äº†ï¼Œå› è€Œé‡ä¼ å‰é¢å‘é€è¿‡çš„åˆ†ç»„ã€‚è¿™å°±å«åšè¶…æ—¶é‡ä¼ ã€‚</p>
<blockquote>
<p>è¦å®žçŽ°è¶…æ—¶é‡ä¼ ï¼Œå°±è¦åœ¨æ¯å‘é€å®Œä¸€ä¸ªåˆ†ç»„è®¾ç½®ä¸€ä¸ªè¶…æ—¶è®¡æ—¶å™¨ã€‚å¦‚æžœåœ¨è¶…æ—¶è®¡æ—¶å™¨åˆ°æœŸä¹‹å‰æ”¶åˆ°äº†å¯¹æ–¹çš„ç¡®è®¤ï¼Œå°±æ’¤é”€å·²è®¾ç½®çš„è¶…æ—¶è®¡æ—¶å™¨</p>
</blockquote>
<p>ç¡®è®¤ä¸¢å¤±ä¸Žç¡®è®¤è¿Ÿåˆ°ï¼š</p>
<p><img src="https://i.loli.net/2020/07/12/xdfKO1VknoBw93Y.png" alt="è¶…æ—¶é‡ä¼ " /></p>
<p><strong>åœæ­¢ç­‰å¾…åè®®</strong> - ç®€å•çš„ä¿è¯ä¼ è¾“çš„å¯é æ€§- ARQåè®®</p>
<p>åœæ­¢ç­‰å¾…åè®®ï¼šâ€œåœæ­¢ç­‰å¾…â€å°±æ˜¯æ¯å‘é€å®Œä¸€ä¸ªåˆ†ç»„å°±åœæ­¢å‘é€ï¼Œç­‰å¾…å¯¹æ–¹çš„ç¡®è®¤ã€‚åœ¨æ”¶åˆ°ç¡®è®¤åŽå†å‘é€ä¸‹ä¸€ä¸ªåˆ†ç»„ã€‚(ä¿¡é“åˆ©ç”¨çŽ‡ä½Ž)</p>
<p><strong>è¿žç»­ARQåè®®</strong></p>
<p>è¿žç»­ARQåè®®ï¼šå‘é€æ–¹æ¯æ”¶åˆ°ä¸€ä¸ªç¡®è®¤ï¼Œå°±	æŠŠå‘é€çª—å£å‘å‰æ»‘åŠ¨ä¸€ä¸ªåˆ†ç»„çš„ä½ç½®ã€‚</p>
<p>æŽ¥æ”¶æ–¹ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨ç´¯ç§¯ç¡®è®¤çš„æ–¹å¼ã€‚è¿™å°±æ˜¯è¯´ï¼ŒæŽ¥æ”¶æ–¹ä¸å¿…å¯¹æ”¶åˆ°çš„åˆ†ç»„é€ä¸ªå‘é€ç¡®è®¤ï¼Œè€Œæ˜¯åœ¨æ”¶åˆ°å‡ ä¸ªåˆ†ç»„åŽï¼Œå¯¹æŒ‰åºåˆ°è¾¾çš„æœ€åŽä¸€ä¸ªåˆ†ç»„å‘é€ç¡®è®¤ï¼Œè¿™å°±è¡¨ç¤ºï¼šåˆ°è¿™ä¸ªåˆ†ç»„ä¸ºæ­¢çš„æ‰€æœ‰åˆ†ç»„éƒ½å·²æ­£ç¡®æ”¶åˆ°äº†ã€‚</p>
<p><img src="https://i.loli.net/2020/07/12/zPNJiYuF54cKZjR.png" alt="è¿žç»­ARQåè®®" /></p>
<p><strong>æ»‘åŠ¨çª—å£</strong></p>
<p>å‘é€çª—å£è¡¨ç¤ºï¼šåœ¨æ²¡æœ‰æ”¶åˆ°Bçš„ç¡®è®¤çš„æƒ…å†µä¸‹ï¼ŒAå¯ä»¥è¿žç»­æŠŠçª—å£å†…çš„æ•°æ®éƒ½å‘é€å‡ºåŽ»ã€‚å‡¡æ˜¯å·²ç»å‘é€è¿‡çš„æ•°æ®ï¼Œåœ¨æœªæ”¶åˆ°ç¡®è®¤ä¹‹å‰éƒ½å¿…é¡»æš‚æ—¶ä¿ç•™ï¼Œä»¥ä¾¿åœ¨è¶…æ—¶é‡ä¼ æ—¶ä½¿ç”¨</p>
<p><img src="https://i.loli.net/2020/07/12/5S4jCXeYUzdsA9c.png" alt="image-20200712102609675" /></p>
<p>ä»Žä»¥ä¸Šæ‰€è¿°å¯ä»¥çœ‹å‡ºï¼Œè¦æè¿°ä¸€ä¸ªå‘é€çª—å£çš„çŠ¶æ€éœ€è¦ä¸‰ä¸ªæŒ‡é’ˆï¼šP1ï¼ŒP2å’ŒP3ã€‚æŒ‡é’ˆéƒ½æŒ‡å‘å­—èŠ‚çš„åºå·ã€‚è¿™ä¸‰ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å‡ ä¸ªéƒ¨åˆ†çš„æ„ä¹‰å¦‚ä¸‹ï¼šå°äºŽP1çš„æ˜¯å·²å‘é€å¹¶å·²æ”¶åˆ°ç¡®è®¤çš„éƒ¨åˆ†ï¼Œè€Œå¤§äºŽP3çš„æ˜¯ä¸å…è®¸å‘é€çš„éƒ¨åˆ†ã€‚P3 - P1 = Açš„å‘é€çª—å£ï¼ˆåˆç§°ä¸ºé€šçŸ¥çª—å£ï¼‰P2 - P1 = å·²å‘é€ä½†å°šæœªæ”¶åˆ°ç¡®è®¤çš„å­—èŠ‚æ•°P3 - P2 = å…è®¸å‘é€ä½†å°šæœªå‘é€çš„å­—èŠ‚æ•°ï¼ˆåˆç§°ä¸ºå¯ç”¨çª—å£æˆ–æœ‰æ•ˆçª—å£ï¼‰</p>
<p>å‘é€æ–¹çš„åº”ç”¨è¿›ç¨‹æŠŠå­—èŠ‚æµå†™å…¥TCPçš„å‘é€ç¼“å­˜ï¼ŒæŽ¥æ”¶æ–¹çš„åº”ç”¨è¿›ç¨‹ä»ŽTCPçš„æŽ¥æ”¶ç¼“å­˜ä¸­è¯»å–å­—èŠ‚æµã€‚ä¸‹å›¾è¡¨ç¤ºäº†å‘é€æ–¹ç»´æŒçš„å‘é€ç¼“å­˜å’Œå‘é€çª—å£ï¼Œä»¥åŠæŽ¥æ”¶æ–¹ç»´æŒçš„æŽ¥æ”¶ç¼“å­˜å’ŒæŽ¥æ”¶çª—å£ã€‚</p>
<p><img src="https://i.loli.net/2020/07/13/AHokRbG94IL2QTJ.png" alt="å‘é€çª—å£-æŽ¥å—çª—å£" /></p>
<p>æ€»ç»“ï¼š</p>
<p>å‘é€ç¼“å­˜ç”¨æ¥æš‚æ—¶å­˜æ”¾ï¼š</p>
<ol>
<li>å‘é€åº”ç”¨ç¨‹åºä¼ é€ç»™å‘é€æ–¹TCPå‡†å¤‡å‘é€çš„æ•°æ®</li>
<li>TCPå·²å‘é€å‡ºä½†å°šæœªæ”¶åˆ°ç¡®è®¤çš„æ•°æ®ã€‚</li>
</ol>
<blockquote>
<p>å‘é€çª—å£é€šå¸¸åªæ˜¯å‘é€ç¼“å­˜çš„ä¸€éƒ¨åˆ†ã€‚å·²è¢«ç¡®è®¤çš„æ•°æ®åº”å½“ä»Žå‘é€ç¼“å­˜ä¸­åˆ é™¤ï¼Œå› æ­¤å‘é€ç¼“å­˜å’Œå‘é€çª—å£çš„åŽæ²¿æ˜¯é‡åˆçš„ã€‚å‘é€åº”ç”¨ç¨‹åºæœ€åŽå†™å…¥å‘é€ç¼“å­˜çš„å­—èŠ‚å‡åŽ»æœ€åŽè¢«ç¡®è®¤çš„å­—èŠ‚ï¼Œå°±æ˜¯è¿˜ä¿ç•™åœ¨å‘é€ç¼“å­˜ä¸­çš„è¢«å†™å…¥çš„å­—èŠ‚æ•°ã€‚å‘é€åº”ç”¨ç¨‹åºå¿…é¡»æŽ§åˆ¶å†™å…¥ç¼“å­˜çš„é€ŸçŽ‡ï¼Œä¸èƒ½å¤ªå¿«ï¼Œå¦åˆ™å‘é€ç¼“å­˜å°±ä¼šæ²¡æœ‰å­˜æ”¾æ•°æ®çš„ç©ºé—´ã€‚</p>
</blockquote>
<p>æŽ¥æ”¶ç¼“å­˜ç”¨æ¥æš‚æ—¶å­˜æ”¾ï¼š</p>
<ol>
<li>æŒ‰åºåˆ°è¾¾çš„ã€ä½†å°šæœªè¢«æŽ¥æ”¶åº”ç”¨ç¨‹åºè¯»å–çš„æ•°æ®</li>
<li>æœªæŒ‰åºåˆ°è¾¾çš„æ•°æ®ã€‚</li>
</ol>
<blockquote>
<p>å¦‚æžœæ”¶åˆ°çš„åˆ†ç»„è¢«æ£€æµ‹å‡ºæœ‰å·®é”™ï¼Œåˆ™è¦ä¸¢å¼ƒã€‚å¦‚æžœæŽ¥æ”¶åº”ç”¨ç¨‹åºæ¥ä¸åŠè¯»å–æ”¶åˆ°çš„æ•°æ®ï¼ŒæŽ¥æ”¶ç¼“å­˜æœ€ç»ˆå°±ä¼šè¢«å¡«æ»¡ï¼Œä½¿æŽ¥æ”¶çª—å£å‡å°åˆ°é›¶ã€‚åä¹‹ï¼Œå¦‚æžœæŽ¥æ”¶åº”ç”¨ç¨‹åºèƒ½å¤ŸåŠæ—¶ä»ŽæŽ¥æ”¶ç¼“å­˜ä¸­è¯»å–æ”¶åˆ°çš„æ•°æ®ï¼ŒæŽ¥æ”¶çª—å£å°±å¯ä»¥å¢žå¤§ï¼Œä½†æœ€å¤§ä¸èƒ½è¶…è¿‡æŽ¥æ”¶ç¼“å­˜çš„å¤§å°ã€‚</p>
</blockquote>
<p><strong>è¶…æ—¶é‡ä¼ çš„é€‰æ‹©</strong></p>
<p>TCPé‡‡ç”¨äº†ä¸€ç§è‡ªé€‚åº”ç®—æ³•ï¼Œå®ƒè®°å½•ä¸€ä¸ªæŠ¥æ–‡æ®µå‘å‡ºçš„æ—¶é—´ï¼Œä»¥åŠæ”¶åˆ°ç›¸åº”çš„ç¡®è®¤çš„æ—¶é—´ã€‚è¿™ä¸¤ä¸ªæ—¶é—´ä¹‹å·®å°±æ˜¯æŠ¥æ–‡æ®µçš„å¾€è¿”æ—¶é—´RTTã€‚TCPä¿ç•™äº†RTTçš„ä¸€ä¸ªåŠ æƒå¹³å‡å¾€è¿”æ—¶é—´ $RTT_S$ï¼ˆè¿™åˆç§°ä¸ºå¹³æ»‘çš„å¾€è¿”æ—¶é—´ï¼ŒSè¡¨ç¤ºSmoothedã€‚å› ä¸ºè¿›è¡Œçš„æ˜¯åŠ æƒå¹³å‡ï¼Œå› æ­¤å¾—å‡ºçš„ç»“æžœæ›´åŠ å¹³æ»‘ï¼‰ã€‚æ¯å½“ç¬¬ä¸€æ¬¡æµ‹é‡åˆ°RTTæ ·æœ¬æ—¶ï¼ŒRTTSå€¼å°±å–ä¸ºæ‰€æµ‹é‡åˆ°çš„RTTæ ·æœ¬å€¼ã€‚ä½†ä»¥åŽæ¯æµ‹é‡åˆ°ä¸€ä¸ªæ–°çš„RTTæ ·æœ¬ï¼Œå°±æŒ‰ä¸‹å¼é‡æ–°è®¡ç®—ä¸€æ¬¡$RTT_S$</p>
<p><img src="https://i.loli.net/2020/07/12/GJhzbLVsRHOAl24.png" alt="image-20200712151531273" /></p>
<blockquote>
<p>RFC2988æŽ¨èçš„Î±å€¼ä¸º1/8ï¼Œå³0.125ã€‚ç”¨è¿™ç§æ–¹æ³•å¾—å‡ºçš„åŠ æƒå¹³å‡å¾€è¿”æ—¶é—´RTTSå°±æ¯”æµ‹é‡å‡ºçš„RTTå€¼æ›´åŠ å¹³æ»‘</p>
</blockquote>
<p>è¶…æ—¶è®¡æ—¶å™¨è®¾ç½®çš„è¶…æ—¶é‡ä¼ æ—¶é—´ RTO (RetransmissionTime-Out)åº”ç•¥å¤§äºŽä¸Šé¢å¾—å‡ºçš„åŠ æƒå¹³å‡å¾€è¿”æ—¶é—´$RTT_S$ã€‚RFC 2988å»ºè®®ä½¿ç”¨ä¸‹å¼è®¡ç®—RTOï¼š<br />
$$<br />
RTO = RTT_{S} + 4 \times RTT_{D}<br />
$$<br />
è€Œ$RTT_D$æ˜¯RTTçš„åå·®çš„åŠ æƒå¹³å‡å€¼ï¼Œå®ƒä¸Ž$RTT_S$å’Œæ–°çš„RTTæ ·æœ¬ä¹‹å·®æœ‰å…³ã€‚å½“ç¬¬ä¸€æ¬¡æµ‹é‡æ—¶ï¼ŒRTTDå€¼å–ä¸ºæµ‹é‡åˆ°çš„RTTæ ·æœ¬å€¼çš„ä¸€åŠã€‚åœ¨ä»¥åŽçš„æµ‹é‡ä¸­ï¼Œåˆ™ä½¿ç”¨ä¸‹å¼è®¡ç®—åŠ æƒå¹³å‡çš„RTTDï¼š</p>
<p><img src="https://i.loli.net/2020/07/13/m7gAfzWUo5RbspQ.png" alt="image-20200713230031382" /></p>
<blockquote>
<p>è¿™é‡Œ Î² æ˜¯ä¸ªå°äºŽ1çš„ç³»æ•°ï¼Œå®ƒçš„æŽ¨èå€¼æ˜¯1/4ï¼Œå³0.25ã€‚</p>
</blockquote>
<p>æŽ¥å—æ–¹æœ‰ä¸€ä¸ªåˆ¤æ–­æŽ¥å—çš„æŠ¥æ–‡æ—¶ä¹‹å‰å‘é€çš„è¿˜æ˜¯ä¹‹åŽé‡ä¼ çš„æŠ¥æ–‡çš„é—®é¢˜ï¼Œè¿™é‡ŒæŽ¥å—æ–¹å¦‚ä½•åˆ¤æ–­ç»™å“ªä¸€ä¸ªæŠ¥æ–‡å‘é€ç¡®è®¤ï¼Ÿ</p>
<p><img src="https://i.loli.net/2020/07/13/qjMtme2gTbl5LBp.png" alt="åˆ¤æ–­æŠ¥æ–‡" /></p>
<p><strong>é€‰æ‹©ç¡®è®¤SACK</strong></p>
<p>è¿™å°±æ˜¯è‹¥æ”¶åˆ°çš„æŠ¥æ–‡æ®µæ— å·®é”™ï¼Œåªæ˜¯æœªæŒ‰åºå·ï¼Œä¸­é—´è¿˜ç¼ºå°‘ä¸€äº›åºå·çš„æ•°æ®ï¼Œé‚£ä¹ˆèƒ½å¦è®¾æ³•åªä¼ é€ç¼ºå°‘çš„æ•°æ®è€Œä¸é‡ä¼ å·²ç»æ­£ç¡®åˆ°è¾¾æŽ¥æ”¶æ–¹çš„æ•°æ®ï¼Ÿ</p>
<h4 id="æµé‡æŽ§åˆ¶">æµé‡æŽ§åˆ¶</h4>
<blockquote>
<p>æ‰€è°“æµé‡æŽ§åˆ¶(flow control)å°±æ˜¯è®©å‘é€æ–¹çš„å‘é€é€ŸçŽ‡ä¸è¦å¤ªå¿«ï¼Œè¦è®©æŽ¥æ”¶æ–¹æ¥å¾—åŠæŽ¥æ”¶</p>
</blockquote>
<p>æ»‘åŠ¨çª—å£æµé‡æŽ§åˆ¶ï¼š</p>
<p><img src="https://i.loli.net/2020/07/12/CWZ9bIioQDTj5aA.png" alt="å¯å˜çª—å£æµé‡æŽ§åˆ¶" /></p>
<p>çŽ°åœ¨æˆ‘ä»¬è€ƒè™‘ä¸€ç§æƒ…å†µã€‚ã€Bå‘Aå‘é€äº†é›¶çª—å£çš„æŠ¥æ–‡æ®µåŽä¸ä¹…ï¼ŒBçš„æŽ¥æ”¶ç¼“å­˜åˆæœ‰äº†ä¸€äº›å­˜å‚¨ç©ºé—´ã€‚äºŽæ˜¯Bå‘Aå‘é€äº†rwnd = 400çš„æŠ¥æ–‡æ®µã€‚ç„¶è€Œè¿™ä¸ªæŠ¥æ–‡æ®µåœ¨ä¼ é€è¿‡ç¨‹ä¸­ä¸¢å¤±äº†ã€‚Aä¸€ç›´ç­‰å¾…æ”¶åˆ°Bå‘é€çš„éžé›¶çª—å£çš„é€šçŸ¥ï¼Œè€ŒBä¹Ÿä¸€ç›´ç­‰å¾…Aå‘é€çš„æ•°æ®ã€‚å¦‚æžœæ²¡æœ‰å…¶ä»–æŽªæ–½ï¼Œè¿™ç§äº’ç›¸ç­‰å¾…çš„æ­»é”å±€é¢å°†ä¸€ç›´å»¶ç»­ä¸‹åŽ»ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦<strong>åšæŒè®¡æ—¶å™¨</strong>æ¥ä¿è¯äº†ã€‚</p>
<h4 id="æŽ§åˆ¶tcpå‘é€æŠ¥æ–‡æ®µçš„æ—¶æœº">æŽ§åˆ¶TCPå‘é€æŠ¥æ–‡æ®µçš„æ—¶æœº</h4>
<p>æœ‰ä¸‰ç§å‘é€æŠ¥æ–‡æ®µçš„æ–¹æ³•ï¼š</p>
<ol>
<li>ç¬¬ä¸€ç§æœºåˆ¶æ˜¯TCPç»´æŒä¸€ä¸ªå˜é‡ï¼Œå®ƒç­‰äºŽæœ€å¤§æŠ¥æ–‡æ®µé•¿åº¦MSSã€‚åªè¦ç¼“å­˜ä¸­å­˜æ”¾çš„æ•°æ®è¾¾åˆ°MSSå­—èŠ‚æ—¶ï¼Œå°±ç»„è£…æˆä¸€ä¸ªTCPæŠ¥æ–‡æ®µå‘é€å‡ºåŽ»ã€‚</li>
<li>ç¬¬äºŒç§æœºåˆ¶æ˜¯ç”±å‘é€æ–¹çš„åº”ç”¨è¿›ç¨‹æŒ‡æ˜Žè¦æ±‚å‘é€æŠ¥æ–‡æ®µï¼Œå³TCPæ”¯æŒçš„æŽ¨é€(push)æ“ä½œ</li>
<li>ç¬¬ä¸‰ç§æœºåˆ¶æ˜¯å‘é€æ–¹çš„ä¸€ä¸ªè®¡æ—¶å™¨æœŸé™åˆ°äº†ï¼Œè¿™æ—¶å°±æŠŠå½“å‰å·²æœ‰çš„ç¼“å­˜æ•°æ®è£…å…¥æŠ¥æ–‡æ®µï¼ˆä½†é•¿åº¦ä¸èƒ½è¶…è¿‡MSSï¼‰å‘é€å‡ºåŽ»ã€‚</li>
</ol>
<p>åœ¨TCPçš„å®žçŽ°ä¸­å¹¿æ³›ä½¿ç”¨Nagleç®—æ³•ã€‚ç®—æ³•å¦‚ä¸‹ï¼šè‹¥å‘é€åº”ç”¨è¿›ç¨‹æŠŠè¦å‘é€çš„æ•°æ®é€ä¸ªå­—èŠ‚åœ°é€åˆ°TCPçš„å‘é€ç¼“å­˜ï¼Œåˆ™å‘é€æ–¹å°±æŠŠç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚å…ˆå‘é€å‡ºåŽ»ï¼ŒæŠŠåŽé¢åˆ°è¾¾çš„æ•°æ®å­—èŠ‚éƒ½ç¼“å­˜èµ·æ¥ã€‚å½“å‘é€æ–¹æ”¶åˆ°å¯¹ç¬¬ä¸€ä¸ªæ•°æ®å­—ç¬¦çš„ç¡®è®¤åŽï¼Œå†æŠŠå‘é€ç¼“å­˜ä¸­çš„æ‰€æœ‰æ•°æ®ç»„è£…æˆä¸€ä¸ªæŠ¥æ–‡æ®µå‘é€å‡ºåŽ»ï¼ŒåŒæ—¶ç»§ç»­å¯¹éšåŽåˆ°è¾¾çš„æ•°æ®è¿›è¡Œç¼“å­˜ã€‚åªæœ‰åœ¨æ”¶åˆ°å¯¹å‰ä¸€ä¸ªæŠ¥æ–‡æ®µçš„ç¡®è®¤åŽæ‰ç»§ç»­å‘é€ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µã€‚å½“æ•°æ®åˆ°è¾¾è¾ƒå¿«è€Œç½‘ç»œé€ŸçŽ‡è¾ƒæ…¢æ—¶ï¼Œç”¨è¿™æ ·çš„æ–¹æ³•å¯æ˜Žæ˜¾åœ°å‡å°‘æ‰€ç”¨çš„ç½‘ç»œå¸¦å®½ã€‚Nagleç®—æ³•è¿˜è§„å®šï¼Œå½“åˆ°è¾¾çš„æ•°æ®å·²è¾¾åˆ°å‘é€çª—å£å¤§å°çš„ä¸€åŠæˆ–å·²è¾¾åˆ°æŠ¥æ–‡æ®µçš„æœ€å¤§é•¿åº¦æ—¶ï¼Œå°±ç«‹å³å‘é€ä¸€ä¸ªæŠ¥æ–‡æ®µã€‚è¿™æ ·åšï¼Œå°±å¯ä»¥æœ‰æ•ˆåœ°æé«˜ç½‘ç»œçš„åžåé‡ã€‚</p>
<p>å¦ä¸€ä¸ªé—®é¢˜å«åšç³Šæ¶‚çª—å£ç»¼åˆç—‡ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è®©æŽ¥æ”¶æ–¹ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä½¿å¾—æˆ–è€…æŽ¥æ”¶ç¼“å­˜å·²æœ‰è¶³å¤Ÿç©ºé—´å®¹çº³ä¸€ä¸ªæœ€é•¿çš„æŠ¥æ–‡æ®µï¼Œæˆ–è€…ç­‰åˆ°æŽ¥æ”¶ç¼“å­˜å·²æœ‰ä¸€åŠç©ºé—²çš„ç©ºé—´ã€‚åªè¦å‡ºçŽ°è¿™ä¸¤ç§æƒ…å†µä¹‹ä¸€ï¼ŒæŽ¥æ”¶æ–¹å°±å‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼Œå¹¶å‘å‘é€æ–¹é€šçŸ¥å½“å‰çš„çª—å£å¤§å°ã€‚æ­¤å¤–ï¼Œå‘é€æ–¹ä¹Ÿä¸è¦å‘é€å¤ªå°çš„æŠ¥æ–‡æ®µï¼Œè€Œæ˜¯æŠŠæ•°æ®ç§¯ç´¯æˆè¶³å¤Ÿå¤§çš„æŠ¥æ–‡æ®µï¼Œæˆ–è¾¾åˆ°æŽ¥æ”¶æ–¹ç¼“å­˜çš„ç©ºé—´çš„ä¸€åŠå¤§å°ã€‚</p>
<h4 id="æ‹¥å¡žæŽ§åˆ¶">æ‹¥å¡žæŽ§åˆ¶</h4>
<blockquote>
<p>æµé‡æŽ§åˆ¶ä¸Žæ‹¥å¡žæŽ§åˆ¶çš„åŒºåˆ«ï¼š</p>
<p>æ‹¥å¡žæŽ§åˆ¶ä¸Žæµé‡æŽ§åˆ¶çš„å…³ç³»å¯†åˆ‡ï¼Œå®ƒä»¬ä¹‹é—´ä¹Ÿå­˜åœ¨ç€ä¸€äº›å·®åˆ«ã€‚æ‰€è°“æ‹¥å¡žæŽ§åˆ¶å°±æ˜¯é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œè¿™æ ·å¯ä»¥ä½¿ç½‘ç»œä¸­çš„è·¯ç”±å™¨æˆ–é“¾è·¯ä¸è‡´è¿‡è½½ã€‚</p>
<p>ç›¸åï¼Œæµé‡æŽ§åˆ¶å¾€å¾€æŒ‡ç‚¹å¯¹ç‚¹é€šä¿¡é‡çš„æŽ§åˆ¶ï¼Œæ˜¯ä¸ªç«¯åˆ°ç«¯çš„é—®é¢˜ï¼ˆæŽ¥æ”¶ç«¯æŽ§åˆ¶å‘é€ç«¯ï¼‰ã€‚æµé‡æŽ§åˆ¶æ‰€è¦åšçš„å°±æ˜¯æŠ‘åˆ¶å‘é€ç«¯å‘é€æ•°æ®çš„é€ŸçŽ‡ï¼Œä»¥ä¾¿ä½¿æŽ¥æ”¶ç«¯æ¥å¾—åŠæŽ¥æ”¶ã€‚</p>
</blockquote>
<p><img src="https://i.loli.net/2020/07/14/fLu7xqndgeIrDW6.png" alt="æ‹¥å¡žæŽ§åˆ¶" /></p>
<p>ä»€ä¹ˆæ˜¯ç½‘ç»œæ‹¥å¡žï¼Ÿ</p>
<p>åœ¨è®¡ç®—æœºç½‘ç»œä¸­çš„é“¾è·¯å®¹é‡ï¼ˆå³å¸¦å®½ï¼‰ã€äº¤æ¢ç»“ç‚¹ä¸­çš„ç¼“å­˜å’Œå¤„ç†æœºç­‰ï¼Œéƒ½æ˜¯ç½‘ç»œçš„èµ„æºã€‚åœ¨æŸæ®µæ—¶é—´ï¼Œè‹¥å¯¹ç½‘ç»œä¸­æŸä¸€èµ„æºçš„éœ€æ±‚è¶…è¿‡äº†è¯¥èµ„æºæ‰€èƒ½æä¾›çš„å¯ç”¨éƒ¨åˆ†ï¼Œç½‘ç»œçš„æ€§èƒ½å°±è¦å˜åã€‚è¿™ç§æƒ…å†µå°±å«åšæ‹¥å¡ž(congestion)ã€‚</p>
<blockquote>
<p>æ‰€è°“æ‹¥å¡žæŽ§åˆ¶å°±æ˜¯é˜²æ­¢è¿‡å¤šçš„æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œä¸­ï¼Œè¿™æ ·å¯ä»¥ä½¿ç½‘ç»œä¸­çš„è·¯ç”±å™¨æˆ–é“¾è·¯ä¸è‡´è¿‡è½½ã€‚</p>
</blockquote>
<p>æ‹¥å¡žæŽ§åˆ¶æ‰€è¦åšçš„éƒ½æœ‰ä¸€ä¸ªå‰æï¼Œå°±æ˜¯ç½‘ç»œèƒ½å¤Ÿæ‰¿å—çŽ°æœ‰çš„ç½‘ç»œè´Ÿè·ã€‚æ‹¥å¡žæŽ§åˆ¶æ˜¯ä¸€ä¸ªå…¨å±€æ€§çš„è¿‡ç¨‹ï¼Œæ¶‰åŠåˆ°æ‰€æœ‰çš„ä¸»æœºã€æ‰€æœ‰çš„è·¯ç”±å™¨ï¼Œä»¥åŠä¸Žé™ä½Žç½‘ç»œä¼ è¾“æ€§èƒ½æœ‰å…³çš„æ‰€æœ‰å› ç´ ã€‚ä½†TCPè¿žæŽ¥çš„ç«¯ç‚¹åªè¦è¿Ÿè¿Ÿä¸èƒ½æ”¶åˆ°å¯¹æ–¹çš„ç¡®è®¤ä¿¡æ¯ï¼Œå°±çŒœæƒ³åœ¨å½“å‰ç½‘ç»œä¸­çš„æŸå¤„å¾ˆå¯èƒ½å‘ç”Ÿäº†æ‹¥å¡žï¼Œä½†è¿™æ—¶å´æ— æ³•çŸ¥é“æ‹¥å¡žåˆ°åº•å‘ç”Ÿåœ¨ç½‘ç»œçš„ä½•å¤„ï¼Œä¹Ÿæ— æ³•çŸ¥é“å‘ç”Ÿæ‹¥å¡žçš„å…·ä½“åŽŸå› ï¼ˆæ˜¯è®¿é—®æŸä¸ªæœåŠ¡å™¨çš„é€šä¿¡é‡è¿‡å¤§ï¼Ÿè¿˜æ˜¯åœ¨æŸä¸ªåœ°åŒºå‡ºçŽ°äº†è‡ªç„¶ç¾å®³ï¼‰ã€‚</p>
<p>æ‹¥å¡žæŽ§åˆ¶æ‰€èµ·çš„ä½œç”¨å¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2020/07/14/hJ7a5IwSXPsgWnR.png" alt="image-20200714152723980" /></p>
<p>å›¾ä¸­éšç€æä¾›çš„è´Ÿè½½çš„å¢žå¤§ï¼Œç½‘ç»œåžåé‡çš„å¢žé•¿é€ŸçŽ‡é€æ¸å‡å°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç½‘ç»œåžåé‡è¿˜æœªè¾¾åˆ°é¥±å’Œæ—¶ï¼Œå°±å·²ç»æœ‰ä¸€éƒ¨åˆ†çš„è¾“å…¥åˆ†ç»„è¢«ä¸¢å¼ƒäº†ã€‚å½“ç½‘ç»œçš„åžåé‡æ˜Žæ˜¾åœ°å°äºŽç†æƒ³çš„åžåé‡æ—¶ï¼Œç½‘ç»œå°±è¿›å…¥äº†è½»åº¦æ‹¥å¡žçš„çŠ¶æ€ã€‚æ›´å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“æä¾›çš„è´Ÿè½½è¾¾åˆ°æŸä¸€æ•°å€¼æ—¶ï¼Œç½‘ç»œçš„åžåé‡åè€Œéšæä¾›çš„è´Ÿè½½çš„å¢žå¤§è€Œä¸‹é™ï¼Œè¿™æ—¶ç½‘ç»œå°±è¿›å…¥äº†æ‹¥å¡žçŠ¶æ€ã€‚å½“æä¾›çš„è´Ÿè½½ç»§ç»­å¢žå¤§åˆ°æŸä¸€æ•°å€¼æ—¶ï¼Œç½‘ç»œçš„åžåé‡å°±ä¸‹é™åˆ°é›¶ï¼Œç½‘ç»œå·²æ— æ³•å·¥ä½œã€‚è¿™å°±æ˜¯æ‰€è°“çš„æ­»é”(deadlock)ã€‚</p>
<p>ç”±äºŽè®¡ç®—æœºç½‘ç»œæ˜¯ä¸€ä¸ªå¾ˆå¤æ‚çš„ç³»ç»Ÿï¼Œå› æ­¤å¯ä»¥ä»ŽæŽ§åˆ¶ç†è®ºçš„è§’åº¦æ¥çœ‹æ‹¥å¡žæŽ§åˆ¶è¿™ä¸ªé—®é¢˜ã€‚è¿™æ ·ï¼Œä»Žå¤§çš„æ–¹é¢çœ‹ï¼Œå¯ä»¥åˆ†ä¸ºå¼€çŽ¯æŽ§åˆ¶å’Œé—­çŽ¯æŽ§åˆ¶ä¸¤ç§æ–¹æ³•ã€‚å¼€çŽ¯æŽ§åˆ¶æ–¹æ³•å°±æ˜¯åœ¨è®¾è®¡ç½‘ç»œæ—¶äº‹å…ˆå°†æœ‰å…³å‘ç”Ÿæ‹¥å¡žçš„å› ç´ è€ƒè™‘å‘¨åˆ°ï¼ŒåŠ›æ±‚ç½‘ç»œåœ¨å·¥ä½œæ—¶ä¸äº§ç”Ÿæ‹¥å¡žã€‚ä½†ä¸€æ—¦æ•´ä¸ªç³»ç»Ÿè¿è¡Œèµ·æ¥ï¼Œå°±ä¸å†ä¸­é€”è¿›è¡Œæ”¹æ­£äº†ã€‚</p>
<p>é—­çŽ¯æŽ§åˆ¶æ˜¯åŸºäºŽåé¦ˆçŽ¯è·¯çš„æ¦‚å¿µã€‚å±žäºŽé—­çŽ¯æŽ§åˆ¶çš„æœ‰ä»¥ä¸‹å‡ ç§æŽªæ–½ï¼š</p>
<ol>
<li>ç›‘æµ‹ç½‘ç»œç³»ç»Ÿä»¥ä¾¿æ£€æµ‹åˆ°æ‹¥å¡žåœ¨ä½•æ—¶ã€ä½•å¤„å‘ç”Ÿã€‚</li>
<li>æŠŠæ‹¥å¡žå‘ç”Ÿçš„ä¿¡æ¯ä¼ é€åˆ°å¯é‡‡å–è¡ŒåŠ¨çš„åœ°æ–¹ã€‚</li>
<li>è°ƒæ•´ç½‘ç»œç³»ç»Ÿçš„è¿è¡Œä»¥è§£å†³å‡ºçŽ°çš„é—®é¢˜ã€‚</li>
</ol>
<h5 id="å‡ ç§æ–¹æ³•">å‡ ç§æ–¹æ³•</h5>
<blockquote>
<p>1999å¹´å…¬å¸ƒçš„å› ç‰¹ç½‘å»ºè®®æ ‡å‡†RFC 2581å®šä¹‰äº†è¿›è¡Œæ‹¥å¡žæŽ§åˆ¶çš„å››ç§ç®—æ³•ï¼Œå³æ…¢å¼€å§‹(slow-start)ã€æ‹¥å¡žé¿å…(congestion avoidance)ã€å¿«é‡ä¼ (fast retransmit)å’Œå¿«æ¢å¤(fast recovery)ã€‚</p>
</blockquote>
<ol>
<li>
<p><strong>æ…¢å¼€å§‹å’Œæ‹¥å¡žé¿å…</strong></p>
<p>å‘é€æ–¹ç»´æŒä¸€ä¸ªå«åšæ‹¥å¡žçª—å£ cwnd (congestion window)çš„çŠ¶æ€å˜é‡ã€‚æ‹¥å¡žçª—å£çš„å¤§å°å–å†³äºŽç½‘ç»œçš„æ‹¥å¡žç¨‹åº¦ï¼Œå¹¶ä¸”åŠ¨æ€åœ°åœ¨å˜åŒ–ã€‚å‘é€æ–¹è®©è‡ªå·±çš„å‘é€çª—å£ç­‰äºŽæ‹¥å¡žçª—å£ã€‚</p>
<p>é€æ–¹æŽ§åˆ¶æ‹¥å¡žçª—å£çš„åŽŸåˆ™æ˜¯ï¼šåªè¦ç½‘ç»œæ²¡æœ‰å‡ºçŽ°æ‹¥å¡žï¼Œæ‹¥å¡žçª—å£å°±å†å¢žå¤§ä¸€äº›ï¼Œä»¥ä¾¿æŠŠæ›´å¤šçš„åˆ†ç»„å‘é€å‡ºåŽ»ã€‚ä½†åªè¦ç½‘ç»œå‡ºçŽ°æ‹¥å¡žï¼Œæ‹¥å¡žçª—å£å°±å‡å°ä¸€äº›ï¼Œä»¥å‡å°‘æ³¨å…¥åˆ°ç½‘ç»œä¸­çš„åˆ†ç»„æ•°ã€‚</p>
<blockquote>
<p>å‘é€æ–¹åˆæ˜¯å¦‚ä½•çŸ¥é“ç½‘ç»œå‘ç”Ÿäº†æ‹¥å¡žå‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œå½“ç½‘ç»œå‘ç”Ÿæ‹¥å¡žæ—¶ï¼Œè·¯ç”±å™¨å°±è¦ä¸¢å¼ƒåˆ†ç»„ã€‚å› æ­¤åªè¦å‘é€æ–¹æ²¡æœ‰æŒ‰æ—¶æ”¶åˆ°åº”å½“åˆ°è¾¾çš„ç¡®è®¤æŠ¥æ–‡ï¼Œå°±å¯ä»¥çŒœæƒ³ç½‘ç»œå¯èƒ½å‡ºçŽ°äº†æ‹¥å¡žã€‚çŽ°åœ¨é€šä¿¡çº¿è·¯çš„ä¼ è¾“è´¨é‡ä¸€èˆ¬éƒ½å¾ˆå¥½ï¼Œå› ä¼ è¾“å‡ºå·®é”™è€Œä¸¢å¼ƒåˆ†ç»„çš„æ¦‚çŽ‡æ˜¯å¾ˆå°çš„ï¼ˆè¿œå°äºŽ1 %ï¼‰ã€‚</p>
</blockquote>
<p>æ…¢å¼€å§‹ç®—æ³•çš„æ€è·¯æ˜¯è¿™æ ·çš„ã€‚å½“ä¸»æœºå¼€å§‹å‘é€æ•°æ®æ—¶ï¼Œå¦‚æžœç«‹å³æŠŠå¤§é‡æ•°æ®å­—èŠ‚æ³¨å…¥åˆ°ç½‘ç»œï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å¼•èµ·ç½‘ç»œæ‹¥å¡žï¼Œå› ä¸ºçŽ°åœ¨å¹¶ä¸æ¸…æ¥šç½‘ç»œçš„è´Ÿè·æƒ…å†µã€‚</p>
<p>ç»éªŒè¯æ˜Žï¼Œè¾ƒå¥½çš„æ–¹æ³•æ˜¯å…ˆæŽ¢æµ‹ä¸€ä¸‹ï¼Œå³ç”±å°åˆ°å¤§é€æ¸å¢žå¤§å‘é€çª—å£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç”±å°åˆ°å¤§é€æ¸å¢žå¤§æ‹¥å¡žçª—å£æ•°å€¼ã€‚é€šå¸¸åœ¨åˆšåˆšå¼€å§‹å‘é€æŠ¥æ–‡æ®µæ—¶ï¼Œå…ˆæŠŠæ‹¥å¡žçª—å£cwndè®¾ç½®ä¸ºä¸€ä¸ªæœ€å¤§æŠ¥æ–‡æ®µMSSçš„æ•°å€¼[æ’å›¾]ã€‚è€Œåœ¨æ¯æ”¶åˆ°ä¸€ä¸ªå¯¹æ–°çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤åŽï¼ŒæŠŠæ‹¥å¡žçª—å£å¢žåŠ è‡³å¤šä¸€ä¸ªMSSçš„æ•°å€¼ã€‚ç”¨è¿™æ ·çš„æ–¹æ³•é€æ­¥å¢žå¤§å‘é€æ–¹çš„æ‹¥å¡žçª—å£cwndï¼Œå¯ä»¥ä½¿åˆ†ç»„æ³¨å…¥åˆ°ç½‘ç»œçš„é€ŸçŽ‡æ›´åŠ åˆç†ã€‚</p>
<p>æ…¢å¼€å§‹æ‹¥å¡žçª—å£å˜åŒ–ï¼š</p>
<p><img src="https://i.loli.net/2020/07/14/TMJ52wevaWmkRVQ.png" alt="æ…¢å¼€å§‹" /></p>
<p>å›¾è§£ï¼š</p>
<p><img src="https://i.loli.net/2020/07/14/5HK3RSk9TQPIBxv.png" alt="æ‹¥å¡žé¿å…" /></p>
<p>æ‹¥å¡žé¿å…ç®—æ³•å°±æ˜¯æŒ‡æ‹¥å¡žçª—å£æŒ‰çº¿æ€§è§„å¾‹å¢žé•¿ã€‚</p>
<p>åœ¨TCPæ‹¥å¡žæŽ§åˆ¶çš„æ–‡çŒ®ä¸­ç»å¸¸å¯çœ‹è§â€œä¹˜æ³•å‡å°â€(Multiplicative Decrease)å’Œâ€œåŠ æ³•å¢žå¤§â€(Additive Increase)è¿™æ ·çš„ææ³•ã€‚â€œä¹˜æ³•å‡å°â€æ˜¯æŒ‡ä¸è®ºåœ¨æ…¢å¼€å§‹é˜¶æ®µè¿˜æ˜¯æ‹¥å¡žé¿å…é˜¶æ®µï¼Œåªè¦å‡ºçŽ°è¶…æ—¶ï¼ˆå³å¾ˆå¯èƒ½å‡ºçŽ°äº†ç½‘ç»œæ‹¥å¡žï¼‰ï¼Œå°±æŠŠæ…¢å¼€å§‹é—¨é™å€¼ssthreshå‡åŠï¼Œå³è®¾ç½®ä¸ºå½“å‰çš„æ‹¥å¡žçª—å£çš„ä¸€åŠï¼ˆä¸Žæ­¤åŒæ—¶ï¼Œæ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ï¼‰ã€‚å½“ç½‘ç»œé¢‘ç¹å‡ºçŽ°æ‹¥å¡žæ—¶ï¼Œssthreshå€¼å°±ä¸‹é™å¾—å¾ˆå¿«ï¼Œä»¥å¤§å¤§å‡å°‘æ³¨å…¥åˆ°ç½‘ç»œä¸­çš„åˆ†ç»„æ•°ã€‚è€Œâ€œåŠ æ³•å¢žå¤§â€æ˜¯æŒ‡æ‰§è¡Œæ‹¥å¡žé¿å…ç®—æ³•åŽï¼Œä½¿æ‹¥å¡žçª—å£ç¼“æ…¢å¢žå¤§ï¼Œä»¥é˜²æ­¢ç½‘ç»œè¿‡æ—©å‡ºçŽ°æ‹¥å¡žã€‚ä¸Šé¢ä¸¤ç§ç®—æ³•åˆèµ·æ¥å¸¸ç§°ä¸ºAIMDç®—æ³•ï¼ˆåŠ æ³•å¢žå¤§ä¹˜æ³•å‡å°ï¼‰ã€‚å¯¹è¿™ç§ç®—æ³•è¿›è¡Œé€‚å½“ä¿®æ”¹åŽï¼Œåˆå‡ºçŽ°äº†å…¶ä»–ä¸€äº›æ”¹è¿›çš„ç®—æ³•ã€‚ä½†ä½¿ç”¨æœ€å¹¿æ³›çš„è¿˜æ˜¯AIMDç®—æ³•ã€‚</p>
</li>
<li>
<p><strong>å¿«é‡ä¼ å’Œå¿«æ¢å¤</strong></p>
<p>å¿«é‡ä¼ ç®—æ³•è§„å®šï¼Œå‘é€æ–¹åªè¦ä¸€è¿žæ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤å°±åº”å½“ç«‹å³é‡ä¼ å¯¹æ–¹å°šæœªæ”¶åˆ°çš„æŠ¥æ–‡æ®µM3ï¼Œè€Œä¸å¿…ç»§ç»­ç­‰å¾…ä¸ºM3è®¾ç½®çš„é‡ä¼ è®¡æ—¶å™¨åˆ°æœŸã€‚ç”±äºŽå‘é€æ–¹èƒ½å°½æ—©é‡ä¼ æœªè¢«ç¡®è®¤çš„æŠ¥æ–‡æ®µï¼Œå› æ­¤é‡‡ç”¨å¿«é‡ä¼ åŽå¯ä»¥ä½¿æ•´ä¸ªç½‘ç»œçš„åžåé‡æé«˜çº¦20%ã€‚</p>
<p>ç¤ºæ„å›¾ï¼š</p>
<p><img src="https://i.loli.net/2020/07/14/KI9kO2QlhpMxTmw.png" alt="å¿«é‡ä¼ " /></p>
<p>å¿«é‡ä¼ é…åˆä½¿ç”¨çš„è¿˜æœ‰å¿«æ¢å¤ç®—æ³•ï¼Œå…¶è¿‡ç¨‹æœ‰ä»¥ä¸‹ä¸¤ä¸ªè¦ç‚¹ï¼š</p>
<ul>
<li>å½“å‘é€æ–¹è¿žç»­æ”¶åˆ°ä¸‰ä¸ªé‡å¤ç¡®è®¤æ—¶ï¼Œå°±æ‰§è¡Œâ€œä¹˜æ³•å‡å°â€ç®—æ³•ï¼ŒæŠŠæ…¢å¼€å§‹é—¨é™ssthreshå‡åŠã€‚è¿™æ˜¯ä¸ºäº†é¢„é˜²ç½‘ç»œå‘ç”Ÿæ‹¥å¡žã€‚è¯·æ³¨æ„ï¼ŒæŽ¥ä¸‹åŽ»ä¸æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ã€‚</li>
<li>ç”±äºŽå‘é€æ–¹çŽ°åœ¨è®¤ä¸ºç½‘ç»œå¾ˆå¯èƒ½æ²¡æœ‰å‘ç”Ÿæ‹¥å¡žï¼ˆå¦‚æžœç½‘ç»œå‘ç”Ÿäº†ä¸¥é‡çš„æ‹¥å¡žï¼Œå°±ä¸ä¼šä¸€è¿žæœ‰å¥½å‡ ä¸ªæŠ¥æ–‡æ®µè¿žç»­åˆ°è¾¾æŽ¥æ”¶æ–¹ï¼Œä¹Ÿå°±ä¸ä¼šå¯¼è‡´æŽ¥æ”¶æ–¹è¿žç»­å‘é€é‡å¤ç¡®è®¤ï¼‰ï¼Œå› æ­¤ä¸Žæ…¢å¼€å§‹ä¸åŒä¹‹å¤„æ˜¯çŽ°åœ¨ä¸æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ï¼ˆå³æ‹¥å¡žçª—å£cwndçŽ°åœ¨ä¸è®¾ç½®ä¸º1ï¼‰ï¼Œè€Œæ˜¯æŠŠcwndå€¼è®¾ç½®ä¸ºæ…¢å¼€å§‹é—¨é™ssthreshå‡åŠåŽçš„æ•°å€¼ï¼Œç„¶åŽå¼€å§‹æ‰§è¡Œæ‹¥å¡žé¿å…ç®—æ³•ï¼ˆâ€œåŠ æ³•å¢žå¤§â€ï¼‰ï¼Œä½¿æ‹¥å¡žçª—å£ç¼“æ…¢åœ°çº¿æ€§å¢žå¤§ã€‚</li>
</ul>
<p>ç¤ºæ„å›¾ï¼š</p>
<p><img src="https://i.loli.net/2020/07/14/cJgVNzImsjn5ufK.png" alt="å¿«æ¢å¤" /></p>
</li>
</ol>
<p>å¦‚æžœæŠŠæ‹¥å¡žæŽ§åˆ¶å’ŒæŽ¥æ”¶æ–¹å¯¹å‘é€æ–¹çš„æµé‡æŽ§åˆ¶ä¸€èµ·è€ƒè™‘ï¼Œé‚£ä¹ˆå¾ˆæ˜¾ç„¶ï¼Œå‘é€æ–¹çš„çª—å£çš„ä¸Šé™å€¼åº”å½“å–ä¸ºæŽ¥æ”¶æ–¹çª—å£rwndå’Œæ‹¥å¡žçª—å£cwndè¿™ä¸¤ä¸ªå˜é‡ä¸­è¾ƒå°çš„ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<p><img src="https://i.loli.net/2020/07/14/Z7cMaROU4yufg9S.png" alt="çª—å£æŽ§åˆ¶" /></p>
<h3 id="æµé‡æŽ§åˆ¶-1">æµé‡æŽ§åˆ¶</h3>
<p>æ»‘åŠ¨çª—å£</p>
<h3 id="æ‹¥å¡žæŽ§åˆ¶-1">æ‹¥å¡žæŽ§åˆ¶</h3>
<p>å¿«é‡ä¼ ã€å¿«æ¢å¤ã€è¶…æ—¶é‡ä¼ ï¼Œæ‹¥å¡žé¿å…</p>
<h2 id="udp">UDPðŸ“¦</h2>
<p>UDPä¸€æ¬¡äº¤ä»˜ä¸€ä¸ªå®Œæ•´çš„æŠ¥æ–‡ï¼Œä¸ä¼šå¯¹æŠ¥æ–‡è¿›è¡Œæ‹†åˆ†ã€‚å› æ­¤ï¼Œåº”ç”¨ç¨‹åºå¿…é¡»é€‰æ‹©åˆé€‚å¤§å°çš„æŠ¥æ–‡ã€‚è‹¥æŠ¥æ–‡å¤ªé•¿ï¼ŒUDPæŠŠå®ƒäº¤ç»™IPå±‚åŽï¼ŒIPå±‚åœ¨ä¼ é€æ—¶å¯èƒ½è¦è¿›è¡Œåˆ†ç‰‡ï¼Œè¿™ä¼šé™ä½ŽIPå±‚çš„æ•ˆçŽ‡ã€‚åä¹‹ï¼Œè‹¥æŠ¥æ–‡å¤ªçŸ­ï¼ŒUDPæŠŠå®ƒäº¤ç»™IPå±‚åŽï¼Œä¼šä½¿IPæ•°æ®æŠ¥çš„é¦–éƒ¨çš„ç›¸å¯¹é•¿åº¦å¤ªå¤§ï¼Œè¿™ä¹Ÿé™ä½Žäº†IPå±‚çš„æ•ˆçŽ‡ã€‚</p>
<p><img src="https://i.loli.net/2020/07/11/1KCEaScv2sG5tLq.png" alt="UDPä¼ è¾“æ–¹å¼" /></p>
<p>UDPæ•°æ®æŠ¥æ ¼å¼ï¼š(é¦–éƒ¨8å­—èŠ‚)</p>
<p><img src="https://i.loli.net/2020/07/11/LQVmS293fCpDIeF.png" alt="UDPæ ¼å¼" /></p>
<p>ä¼ªæŠ¥å¤´æ ¼å¼ï¼š</p>
<p><img src="https://i.loli.net/2020/07/11/upR5QLAOncyTPjG.png" alt="ä¼ªæŠ¥å¤´æ ¼å¼" /></p>
<blockquote>
<p>**æ ¡éªŒå’Œè®¡ç®—ï¼š**ä¼ªæŠ¥å¤´+UDPæ•°æ®æŠ¥</p>
</blockquote>
<p>ä¼ªæŠ¥å¤´çš„ä½œç”¨æ˜¯éªŒè¯UDPæ•°æ®æŠ¥æ˜¯å¦æ­£ç¡®ä¼ é€åˆ°ç›®çš„è¿›ç¨‹ã€‚</p>
<p>è®¡ç®—æ ¡éªŒå’Œï¼š</p>
<p>åœ¨å‘é€æ–¹ï¼Œé¦–å…ˆæ˜¯å…ˆæŠŠå…¨é›¶æ”¾å…¥æ£€éªŒå’Œå­—æ®µã€‚å†æŠŠä¼ªé¦–éƒ¨ä»¥åŠUDPç”¨æˆ·æ•°æ®æŠ¥çœ‹æˆæ˜¯ç”±è®¸å¤š16ä½çš„å­—ä¸²æŽ¥èµ·æ¥ã€‚è‹¥UDPç”¨æˆ·æ•°æ®æŠ¥çš„æ•°æ®éƒ¨åˆ†ä¸æ˜¯å¶æ•°ä¸ªå­—èŠ‚ï¼Œåˆ™è¦å¡«å…¥ä¸€ä¸ªå…¨é›¶å­—èŠ‚ï¼ˆä½†æ­¤å­—èŠ‚ä¸å‘é€ï¼‰ã€‚ç„¶åŽæŒ‰äºŒè¿›åˆ¶åç è®¡ç®—å‡ºè¿™äº›16ä½å­—çš„å’Œã€‚å°†æ­¤å’Œçš„äºŒè¿›åˆ¶åç å†™å…¥æ£€éªŒå’Œå­—æ®µåŽï¼Œå°±å‘é€è¿™æ ·çš„UDPç”¨æˆ·æ•°æ®æŠ¥ã€‚åœ¨æŽ¥æ”¶æ–¹ï¼ŒæŠŠæ”¶åˆ°çš„UDPç”¨æˆ·æ•°æ®æŠ¥è¿žåŒä¼ªé¦–éƒ¨ï¼ˆä»¥åŠå¯èƒ½çš„å¡«å……å…¨é›¶å­—èŠ‚ï¼‰ä¸€èµ·ï¼ŒæŒ‰äºŒè¿›åˆ¶åç æ±‚è¿™äº›16ä½å­—çš„å’Œã€‚å½“æ— å·®é”™æ—¶å…¶ç»“æžœåº”ä¸ºå…¨1ã€‚</p>
<blockquote>
<p>äºŒè¿›åˆ¶åç æ±‚å’Œï¼š0å’Œ0ç›¸åŠ æ˜¯0ï¼Œä½†è¦äº§ç”Ÿä¸€ä¸ªè¿›ä½1ï¼Œ0å’Œ1ç›¸åŠ æ˜¯1ï¼Œ1å’Œ1ç›¸åŠ æ˜¯0ã€‚è‹¥æœ€é«˜ä½ç›¸åŠ åŽäº§ç”Ÿè¿›ä½ï¼Œåˆ™æœ€åŽå¾—åˆ°çš„ç»“æžœè¦åŠ 1ã€‚</p>
<p>ï¼ˆ0ï¼‰å + ï¼ˆ0ï¼‰å = 1 + 1 = 10</p>
<p>ï¼ˆ1ï¼‰å +ï¼ˆ0ï¼‰å=0+ 1 =1</p>
<p>ï¼ˆ1ï¼‰å + ï¼ˆ1ï¼‰å = 0 + 0 = 0</p>
<p><strong>&ldquo;äºŒè¿›åˆ¶åç æ±‚å’Œ&rdquo; ç­‰ä»·äºŽ &ldquo;äºŒè¿›åˆ¶æ±‚å’Œå†å–å&rdquo;</strong></p>
<p>äºŒè¿›åˆ¶æ±‚å‡ºçš„å’Œå¦‚æžœå¤§äºŽ16ä½æ—¶æ‰€åšçš„æ“ä½œ,ç”¨å’Œå€¼ä¸­é«˜16ä½åŠ ä¸Šä½Ž16ä½çš„å€¼ä½œä¸ºæœ€ç»ˆçš„å’Œå€¼,ç„¶åŽå†åšå–åè¿ç®—.</p>
</blockquote>
<p>ä¸‹é¢æ˜¯è®¡ç®—æ ¡éªŒå’Œçš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<p><img src="https://i.loli.net/2020/07/11/v72HMrARs13nfJO.png" alt="UDPæ ¡éªŒå’Œ" /></p>
<blockquote>
<p>è¿™æ ·çš„æ£€éªŒå’Œï¼Œæ—¢æ£€æŸ¥äº†UDPç”¨æˆ·æ•°æ®æŠ¥çš„æºç«¯å£å·å’Œç›®çš„ç«¯å£å·ä»¥åŠUDPç”¨æˆ·æ•°æ®æŠ¥çš„æ•°æ®éƒ¨åˆ†ï¼Œåˆæ£€æŸ¥äº†IPæ•°æ®æŠ¥çš„æºIPåœ°å€å’Œç›®çš„åœ°å€ã€‚</p>
</blockquote>
<h4 id="heading-1"></h4>
<p>ç½‘å¡æ”¶åˆ°ä¸€æ¡æ•°æ®åˆ°è¿›ç¨‹å¤„ç†æ•°æ®,è¿™ä¹‹é—´ç»åŽ†äº†ä»€ä¹ˆ(ä¸­æ–­çš„ä¸ŠåŠéƒ¨ä¸‹åŠéƒ¨,ç½‘ç»œå±‚åè®®æ‹†åŒ…)ï¼Ÿ</p>
<h2 id="æ‹¥å¡žæŽ§åˆ¶ç®—æ³•">æ‹¥å¡žæŽ§åˆ¶ç®—æ³•</h2>
<p>TCPæ‹¥å¡žæŽ§åˆ¶ç®—æ³•çš„ç›®çš„å¯ä»¥ç®€å•æ¦‚æ‹¬ä¸ºï¼š<strong>å…¬å¹³ç«žäº‰ã€å……åˆ†åˆ©ç”¨ç½‘ç»œå¸¦å®½ã€é™ä½Žç½‘ç»œå»¶æ—¶ã€ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼Œç„¶è€Œå°±ç›®å‰è€Œè¨€è¦å®žçŽ°è¿™äº›ç›®æ ‡å°±éš¾å…æœ‰æƒè¡¡å’Œå–èˆã€‚</strong></p>
<h3 id="ç®—æ³•åˆ†ç±»">ç®—æ³•åˆ†ç±»</h3>
<p><strong>åŸºäºŽä¸¢åŒ…ç­–ç•¥</strong>çš„ä¼ ç»Ÿæ‹¥å¡žæŽ§åˆ¶ç®—æ³•çš„å‡ ä¸ªè¿­ä»£ç‰ˆæœ¬ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://i.loli.net/2020/11/12/DqTPGmJ6UaOvXVp.png" alt="æ‹¥å¡žæŽ§åˆ¶ç®—æ³•è¿­ä»£" /></p>
<p>ä¸Žæ­¤åŒæ—¶è¿˜æœ‰ä¸€ç±»ç®—æ³•æ˜¯åŸºäºŽRTTå»¶æ—¶ç­–ç•¥æ¥è¿›è¡ŒæŽ§åˆ¶çš„ï¼Œä½†æ˜¯è¿™ç±»ç®—æ³•åœ¨å‘åŒ…é€ŸçŽ‡ä¸Šå¯èƒ½ä¸å¤Ÿæ¿€è¿›ï¼Œç«žäº‰æ€§èƒ½ä¸å¦‚å…¶ä»–ç®—æ³•ï¼Œå› æ­¤åœ¨å…±äº«ç½‘ç»œå¸¦å®½æ—¶æœ‰å¤±å…¬å¹³æ€§ï¼Œä½†æ˜¯ç®—æ³•é€ŸçŽ‡æ›²çº¿å´æ˜¯å¾ˆå¹³æ»‘</p>
<p><img src="https://i.loli.net/2020/11/12/JtoOAnGLIm2KSr9.png" alt="img" /></p>
<h3 id="å¦‚ä½•æ„ŸçŸ¥æ‹¥å¡ž">å¦‚ä½•æ„ŸçŸ¥æ‹¥å¡ž</h3>
<p>åœ¨TCPè¿žæŽ¥çš„å‘é€æ–¹ä¸€èˆ¬æ˜¯åŸºäºŽä¸¢åŒ…æ¥åˆ¤æ–­å½“å‰ç½‘ç»œæ˜¯å¦å‘ç”Ÿæ‹¥å¡žï¼Œä¸¢åŒ…å¯ä»¥ç”±é‡ä¼ è¶…æ—¶RTOå’Œé‡å¤ç¡®è®¤æ¥åšåˆ¤æ–­ã€‚</p>
<p><img src="https://i.loli.net/2020/11/12/5OTIDH9tLiFAZmq.png" alt="img" /></p>
<h3 id="æ‹¥å¡žæŽ§åˆ¶åŸºæœ¬ç­–ç•¥">æ‹¥å¡žæŽ§åˆ¶åŸºæœ¬ç­–ç•¥</h3>
<p><strong>æ‹¥å¡žæŽ§åˆ¶æ˜¯ä¸€ä¸ªåŠ¨æ€çš„è¿‡ç¨‹</strong>ï¼Œå®ƒæ—¢è¦æé«˜å¸¦å®½åˆ©ç”¨çŽ‡å‘é€å°½é‡å¤šçš„æ•°æ®åˆè¦é¿å…ç½‘ç»œæ‹¥å µä¸¢åŒ…RTTå¢žå¤§ç­‰é—®é¢˜ï¼ŒåŸºäºŽè¿™ç§é«˜è¦æ±‚å¹¶ä¸æ˜¯å•ä¸€ç­–ç•¥å¯ä»¥æžå®šçš„ï¼Œå› æ­¤TCPçš„ <strong>æ‹¥å¡žæŽ§åˆ¶ç­–ç•¥å®žé™…ä¸Šæ˜¯åˆ†é˜¶æ®µåˆ†ç­–ç•¥çš„ç»¼åˆè¿‡ç¨‹</strong>ï¼š</p>
<p><img src="https://i.loli.net/2020/11/12/V4w9N8qHLQMZBr3.png" alt="img" /></p>
<p><strong>TCP Tahoe å’ŒTCP Reno</strong></p>
<p>è¿™ä¸¤ä¸ªç®—æ³•ä»£å·å–è‡ªå¤ªæµ©æ¹–Lakeå’ŒTahoeé‡Œè¯ºå¸‚ï¼Œä¸¤è€…ç®—æ³•å¤§è‡´ä¸€è‡´ï¼Œå¯¹äºŽä¸¢åŒ…äº‹ä»¶åˆ¤æ–­éƒ½æ˜¯ä»¥é‡ä¼ è¶…æ—¶retransmission timeoutå’Œé‡å¤ç¡®è®¤ä¸ºæ¡ä»¶ï¼Œä½†æ˜¯å¯¹äºŽé‡å¤ç¡®è®¤çš„å¤„ç†ä¸¤è€…æœ‰æ‰€ä¸åŒï¼Œå¯¹äºŽè¶…æ—¶é‡ä¼ RTOæƒ…å†µä¸¤ä¸ªç®—æ³•éƒ½æ˜¯å°†æ‹¥å¡žçª—å£é™ä¸º1ä¸ªMSSï¼Œç„¶åŽè¿›å…¥æ…¢å¯åŠ¨é˜¶æ®µã€‚</p>
<p>TCP Tahoeç®—æ³•ï¼šå¦‚æžœæ”¶åˆ°ä¸‰æ¬¡é‡å¤ç¡®è®¤å³ç¬¬å››æ¬¡æ”¶åˆ°ç›¸åŒç¡®è®¤å·çš„åˆ†æ®µç¡®è®¤ï¼Œå¹¶ä¸”åˆ†æ®µå¯¹åº”åŒ…æ— è´Ÿè½½åˆ†æ®µå’Œæ— æ”¹å˜æŽ¥æ”¶çª—å£çš„è¯ï¼ŒTahoeç®—æ³•åˆ™è¿›å…¥å¿«é€Ÿé‡ä¼ ï¼Œå°†æ…¢å¯åŠ¨é˜ˆå€¼æ”¹ä¸ºå½“å‰æ‹¥å¡žçª—å£çš„ä¸€åŠï¼Œå°†æ‹¥å¡žçª—å£é™ä¸º1ä¸ªMSSï¼Œå¹¶é‡æ–°è¿›å…¥æ…¢å¯åŠ¨é˜¶æ®µã€‚</p>
<p>TCP Renoç®—æ³•ï¼šå¦‚æžœæ”¶åˆ°ä¸‰æ¬¡é‡å¤ç¡®è®¤ï¼ŒRenoç®—æ³•åˆ™è¿›å…¥å¿«é€Ÿé‡ä¼ åªå°†æ‹¥å¡žçª—å£å‡åŠæ¥è·³è¿‡æ…¢å¯åŠ¨é˜¶æ®µï¼Œå°†æ…¢å¯åŠ¨é˜ˆå€¼è®¾ä¸ºå½“å‰æ–°çš„æ‹¥å¡žçª—å£å€¼ï¼Œè¿›å…¥ä¸€ä¸ªç§°ä¸ºå¿«é€Ÿæ¢å¤çš„æ–°è®¾è®¡é˜¶æ®µã€‚TCP New Reno</p>
<p>TCP New Renoæ˜¯å¯¹TCP Renoä¸­å¿«é€Ÿæ¢å¤é˜¶æ®µçš„é‡ä¼ è¿›è¡Œæ”¹å–„çš„ä¸€ç§æ”¹è¿›ç®—æ³•ï¼ŒNew Renoåœ¨ä½Žé”™è¯¯çŽ‡æ—¶è¿è¡Œæ•ˆçŽ‡å’Œé€‰æ‹©ç¡®è®¤SACKç›¸å½“ï¼Œåœ¨é«˜é”™è¯¯çŽ‡ä»ä¼˜äºŽRenoã€‚</p>
<p><strong>TCP BIC å’ŒTCP CUBIC</strong></p>
<p>TCP BICæ—¨åœ¨ä¼˜åŒ–é«˜é€Ÿé«˜å»¶è¿Ÿç½‘ç»œçš„æ‹¥å¡žæŽ§åˆ¶ï¼Œå…¶æ‹¥å¡žçª—å£ç®—æ³•ä½¿ç”¨äºŒåˆ†æœç´¢ç®—æ³•å°è¯•æ‰¾åˆ°èƒ½é•¿æ—¶é—´ä¿æŒæ‹¥å¡žçª—å£æœ€å¤§å€¼ï¼ŒLinuxå†…æ ¸åœ¨2.6.8è‡³2.6.18ä½¿ç”¨è¯¥ç®—æ³•ä½œä¸ºé»˜è®¤TCPæ‹¥å¡žç®—æ³•ã€‚</p>
<p>CUBICåˆ™æ˜¯æ¯”BICæ›´æ¸©å’Œå’Œç³»ç»ŸåŒ–çš„åˆ†æ”¯ç‰ˆæœ¬ï¼Œå…¶ä½¿ç”¨ä¸‰æ¬¡å‡½æ•°ä»£æ›¿äºŒåˆ†ç®—æ³•ä½œä¸ºå…¶æ‹¥å¡žçª—å£ç®—æ³•ï¼Œå¹¶ä¸”ä½¿ç”¨å‡½æ•°æ‹ç‚¹ä½œä¸ºæ‹¥å¡žçª—å£çš„è®¾ç½®å€¼ï¼ŒLinuxå†…æ ¸åœ¨2.6.19åŽä½¿ç”¨è¯¥ç®—æ³•ä½œä¸ºé»˜è®¤TCPæ‹¥å¡žç®—æ³•ã€‚</p>
<p><strong>TCP PRR</strong></p>
<p>TCP PRRæ˜¯æ—¨åœ¨æ¢å¤æœŸé—´æé«˜å‘é€æ•°æ®çš„å‡†ç¡®æ€§ï¼Œè¯¥ç®—æ³•ç¡®ä¿æ¢å¤åŽçš„æ‹¥å¡žçª—å£å¤§å°å°½å¯èƒ½æŽ¥è¿‘æ…¢å¯åŠ¨é˜ˆå€¼ã€‚åœ¨Googleè¿›è¡Œçš„æµ‹è¯•ä¸­ï¼Œèƒ½å°†å¹³å‡å»¶è¿Ÿé™ä½Ž3~10%æ¢å¤è¶…æ—¶å‡å°‘5%ï¼ŒPRRç®—æ³•åŽä½œä¸ºLinuxå†…æ ¸3.2ç‰ˆæœ¬é»˜è®¤æ‹¥å¡žç®—æ³•ã€‚</p>
<p>TCP BBRæ˜¯ç”±Googleè®¾è®¡äºŽ2016å¹´å‘å¸ƒçš„æ‹¥å¡žç®—æ³•ï¼Œè¯¥ç®—æ³•è®¤ä¸ºéšç€ç½‘ç»œæŽ¥å£æŽ§åˆ¶å™¨é€æ¸è¿›å…¥åƒå…†é€Ÿåº¦æ—¶ï¼Œåˆ†ç»„ä¸¢å¤±ä¸åº”è¯¥è¢«è®¤ä¸ºæ˜¯è¯†åˆ«æ‹¥å¡žçš„ä¸»è¦å†³å®šå› ç´ ï¼Œæ‰€ä»¥åŸºäºŽæ¨¡åž‹çš„æ‹¥å¡žæŽ§åˆ¶ç®—æ³•èƒ½æœ‰æ›´é«˜çš„åžåé‡å’Œæ›´ä½Žçš„å»¶è¿Ÿï¼Œå¯ä»¥ç”¨BBRæ¥æ›¿ä»£å…¶ä»–æµè¡Œçš„æ‹¥å¡žç®—æ³•ã€‚</p>
<p>Googleåœ¨YouTubeä¸Šåº”ç”¨è¯¥ç®—æ³•ï¼Œå°†å…¨çƒå¹³å‡çš„YouTubeç½‘ç»œåžåé‡æé«˜äº†4%ï¼ŒBBRä¹‹åŽç§»æ¤å…¥Linuxå†…æ ¸4.9ç‰ˆæœ¬ã€‚</p>
<p>å…¶ä¸­æ¯”è¾ƒæœ‰åçš„Vegasç®—æ³•æ˜¯å¤§çº¦åœ¨1995å¹´ç”±äºšåˆ©æ¡‘é‚£å¤§å­¦çš„ç ”ç©¶äººå‘˜æ‹‰é‡ŒÂ·å½¼å¾—æ£®å’ŒåŠ³ä¼¦æ–¯Â·å¸ƒæ‹‰ç§‘å¤«æå‡ºï¼Œè¿™ä¸ªæ–°çš„TCPæ‹¥å¡žç®—æ³•ä»¥å†…åŽè¾¾å·žæœ€å¤§çš„åŸŽå¸‚æ‹‰æ–¯ç»´åŠ æ–¯å‘½åï¼ŒåŽæˆä¸ºTCP Vegasç®—æ³•ã€‚</p>
<p>å…³äºŽåŸºäºŽRTTçš„TCP Vegasç®—æ³•çš„è¯¦ç»†ä»‹ç»å¯ä»¥æŸ¥é˜…æ–‡æ¡£ï¼š</p>
<blockquote>
<p><a href="http://www.cs.cmu.edu/~srini/15-744/F02/readings/BP95.pdf">http://www.cs.cmu.edu/~srini/15-744/F02/readings/BP95.pdf</a></p>
</blockquote>
<p>æ–‡æ¡£å¯¹Vegasç®—æ³•å’ŒNew Renoåšäº†ä¸€äº›å¯¹æ¯”ï¼Œæˆ‘ä»¬ä»Žç›´è§‚å›¾å½¢ä¸Šå¯ä»¥çœ‹åˆ°Vegasç®—æ³•æ›´åŠ å¹³æ»‘ï¼Œç›¸åNew Renoåˆ™è¡¨çŽ°é™¤äº†è¾ƒå¤§çš„æ³¢åŠ¨å‘ˆé”¯é½¿çŠ¶ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://i.loli.net/2020/11/12/8QRwet2NGb9Orcs.jpg" alt="img" /></p>
<p>å®žé™…ä¸Šè¿˜æœ‰æ›´ç»†ç²’åº¦çš„åˆ†ç±»ï¼Œç”±äºŽä¸æ˜¯ä»Šå¤©çš„é‡ç‚¹ï¼Œå°±ä¸å†æ·±å…¥å±•å¼€äº†ï¼Œå½“å‰ä½¿ç”¨çš„æ‹¥å¡žæŽ§åˆ¶ç®—æ³•è¿˜æ˜¯åŸºäºŽä¸¢åŒ…Loss-Basedä½œä¸ºä¸»æµã€‚</p>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://my.oschina.net/u/3872630/blog/4434563">ä¸‡å­—é•¿æ–‡|å…¨ç½‘æœ€å¼º TCP/IP æ‹¥å¡žæŽ§åˆ¶æ€»ç»“&hellip;</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/144273871">ä¸‡å­—è¯¦æ–‡ï¼šTCP æ‹¥å¡žæŽ§åˆ¶è¯¦è§£</a></li>
</ol>
<h1 id="ä¸€æ³¡å°¿çš„æ—¶é—´å¿«é€Ÿè¯»æ‡‚quicåè®®httpsjuejinimpost6844903985262903304"><a href="https://juejin.im/post/6844903985262903304">ä¸€æ³¡å°¿çš„æ—¶é—´ï¼Œå¿«é€Ÿè¯»æ‡‚QUICåè®®</a></h1>
<p>å¦‚ä½•è®©ç½‘ç»œæ•°æ®ä¼ è¾“åœ°æ›´å¿«ï¼Ÿ(åˆå¹¶ä¸€äº›å±‚)</p>
<p><img src="https://i.loli.net/2020/11/12/McdVSu7AgFUaTRb.png" alt="å¦‚ä½•ä¼ è¾“çš„æ›´å¿«" /></p>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦quic">ä¸ºä»€ä¹ˆéœ€è¦QUICï¼Ÿ</h3>
<ol>
<li>
<p>ä¸­é—´è®¾å¤‡çš„åƒµåŒ–</p>
<p>å¯èƒ½æ˜¯ TCP åè®®ä½¿ç”¨å¾—å¤ªä¹…ï¼Œä¹Ÿéžå¸¸å¯é ã€‚æ‰€ä»¥æˆ‘ä»¬å¾ˆå¤šä¸­é—´è®¾å¤‡ï¼ŒåŒ…æ‹¬é˜²ç«å¢™ã€NAT ç½‘å…³ï¼Œæ•´æµå™¨ç­‰å‡ºçŽ°äº†ä¸€äº›çº¦å®šä¿—æˆçš„åŠ¨ä½œã€‚</p>
</li>
<li>
<p>ä¾èµ–äºŽæ“ä½œç³»ç»Ÿçš„å®žçŽ°å¯¼è‡´åè®®åƒµåŒ–</p>
<p>TCP æ˜¯ç”±æ“ä½œç³»ç»Ÿåœ¨å†…æ ¸è¥¿æ–¹æ ˆå±‚é¢å®žçŽ°çš„ï¼Œåº”ç”¨ç¨‹åºåªèƒ½ä½¿ç”¨ï¼Œä¸èƒ½ç›´æŽ¥ä¿®æ”¹ã€‚è™½ç„¶åº”ç”¨ç¨‹åºçš„æ›´æ–°è¿­ä»£éžå¸¸å¿«é€Ÿå’Œç®€å•ã€‚ä½†æ˜¯ TCP çš„è¿­ä»£å´éžå¸¸ç¼“æ…¢ï¼ŒåŽŸå› å°±æ˜¯æ“ä½œç³»ç»Ÿå‡çº§å¾ˆéº»çƒ¦ã€‚</p>
</li>
<li>
<p>å»ºç«‹è¿žæŽ¥çš„æ¡æ‰‹å»¶è¿Ÿå¤§</p>
<p>ä¸ç®¡æ˜¯ HTTP1.0/1.1 è¿˜æ˜¯ HTTPSï¼ŒHTTP2ï¼Œéƒ½ä½¿ç”¨äº† TCP è¿›è¡Œä¼ è¾“ã€‚HTTPS å’Œ HTTP2 è¿˜éœ€è¦ä½¿ç”¨ TLS åè®®æ¥è¿›è¡Œå®‰å…¨ä¼ è¾“ã€‚è¿™å°±å‡ºçŽ°äº†ä¸¤ä¸ªæ¡æ‰‹å»¶è¿Ÿï¼š</p>
<ol>
<li>
<p>TCP ä¸‰æ¬¡æ¡æ‰‹å¯¼è‡´çš„ TCP è¿žæŽ¥å»ºç«‹çš„å»¶è¿Ÿã€‚</p>
</li>
<li>
<p>TLS å®Œå…¨æ¡æ‰‹éœ€è¦è‡³å°‘ 2 ä¸ª RTT æ‰èƒ½å»ºç«‹ï¼Œç®€åŒ–æ¡æ‰‹éœ€è¦ 1 ä¸ª RTT çš„æ¡æ‰‹å»¶è¿Ÿã€‚</p>
</li>
</ol>
<p>å¯¹äºŽå¾ˆå¤šçŸ­è¿žæŽ¥åœºæ™¯ï¼Œè¿™æ ·çš„æ¡æ‰‹å»¶è¿Ÿå½±å“å¾ˆå¤§ï¼Œä¸”æ— æ³•æ¶ˆé™¤ã€‚</p>
</li>
<li>
<p>é˜Ÿå¤´é˜»å¡ž</p>
<p>é˜Ÿå¤´é˜»å¡žä¸»è¦æ˜¯ TCP åè®®çš„å¯é æ€§æœºåˆ¶å¼•å…¥çš„ã€‚TCP ä½¿ç”¨åºåˆ—å·æ¥æ ‡è¯†æ•°æ®çš„é¡ºåºï¼Œæ•°æ®å¿…é¡»æŒ‰ç…§é¡ºåºå¤„ç†ï¼Œå¦‚æžœå‰é¢çš„æ•°æ®ä¸¢å¤±ï¼ŒåŽé¢çš„æ•°æ®å°±ç®—åˆ°è¾¾äº†ä¹Ÿä¸ä¼šé€šçŸ¥åº”ç”¨å±‚æ¥å¤„ç†ã€‚</p>
<p>å¦å¤– TLS åè®®å±‚é¢ä¹Ÿæœ‰ä¸€ä¸ªé˜Ÿå¤´é˜»å¡žï¼Œå› ä¸º TLS åè®®éƒ½æ˜¯æŒ‰ç…§ record æ¥å¤„ç†æ•°æ®çš„ï¼Œå¦‚æžœä¸€ä¸ª record ä¸­ä¸¢å¤±äº†æ•°æ®ï¼Œä¹Ÿä¼šå¯¼è‡´æ•´ä¸ª record æ— æ³•æ­£ç¡®å¤„ç†ã€‚</p>
</li>
</ol>
<p>QUIC åè®®é€‰æ‹©äº† UDPï¼Œå› ä¸º UDP æœ¬èº«æ²¡æœ‰è¿žæŽ¥çš„æ¦‚å¿µï¼Œä¸éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¼˜åŒ–äº†è¿žæŽ¥å»ºç«‹çš„æ¡æ‰‹å»¶è¿Ÿï¼ŒåŒæ—¶åœ¨åº”ç”¨ç¨‹åºå±‚é¢å®žçŽ°äº† TCP çš„å¯é æ€§ï¼ŒTLS çš„å®‰å…¨æ€§å’Œ HTTP2 çš„å¹¶å‘æ€§ï¼Œåªéœ€è¦ç”¨æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åº”ç”¨ç¨‹åºæ”¯æŒ QUIC åè®®ï¼Œå®Œå…¨é¿å¼€äº†æ“ä½œç³»ç»Ÿå’Œä¸­é—´è®¾å¤‡çš„é™åˆ¶ã€‚</p>
<p>QUIC æ˜¯ Quick UDP Internet Connections çš„ç¼©å†™ï¼Œè°·æ­Œå‘æ˜Žçš„æ–°ä¼ è¾“åè®®ã€‚</p>
<blockquote>
<p>ä¸Ž TCP ç›¸æ¯”ï¼ŒQUIC å¯ä»¥å‡å°‘å»¶è¿Ÿã€‚</p>
</blockquote>
<p>QUIC åè®®å¯ä»¥åœ¨ 1 åˆ° 2 ä¸ªæ•°æ®åŒ…ï¼ˆå–å†³äºŽè¿žæŽ¥çš„æœåŠ¡å™¨æ˜¯æ–°çš„è¿˜æ˜¯å·²çŸ¥çš„ï¼‰å†…ï¼Œå®Œæˆè¿žæŽ¥çš„åˆ›å»ºï¼ˆåŒ…æ‹¬ TLSï¼‰ã€‚</p>
<p><img src="https://i.loli.net/2020/11/12/Do24kg6HWaR8lVi.png" alt="QUICæ¡æ‰‹" /></p>
<p>QUIC ä¸ŽçŽ°æœ‰ TCP + TLS + HTTP/2 æ–¹æ¡ˆç›¸æ¯”ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹ä¸»è¦ç‰¹å¾ï¼š</p>
<ol>
<li>åˆ©ç”¨ç¼“å­˜ï¼Œæ˜¾è‘—å‡å°‘è¿žæŽ¥å»ºç«‹æ—¶é—´ï¼›(å‡å°‘äº† TCP ä¸‰æ¬¡æ¡æ‰‹åŠ TLS æ¡æ‰‹æ—¶é—´)</li>
<li>æ”¹å–„æ‹¥å¡žæŽ§åˆ¶ï¼Œæ‹¥å¡žæŽ§åˆ¶ä»Žå†…æ ¸ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´ï¼›</li>
<li>æ²¡æœ‰ head of line é˜»å¡žçš„å¤šè·¯å¤ç”¨ï¼›</li>
<li>å‰å‘çº é”™ï¼Œå‡å°‘é‡ä¼ ï¼›</li>
<li>è¿žæŽ¥å¹³æ»‘è¿ç§»ï¼Œç½‘ç»œçŠ¶æ€çš„å˜æ›´ä¸ä¼šå½±å“è¿žæŽ¥æ–­çº¿ã€‚</li>
</ol>
<p>æ‹¥å¡žæŽ§åˆ¶ã€åŠ å¯†å’Œä¸€äº›HTTP/2çš„ç‰¹æ€§éƒ½ç§»åŠ¨åˆ°QUICå±‚åŽ»äº†</p>
<p><img src="https://i.loli.net/2020/11/12/u8RbdLX1hwEQTlN.png" alt="QUICå±‚" /></p>
<p>ä»Žå›¾ä¸Šå¯ä»¥çœ‹å‡ºï¼ŒQUIC åº•å±‚é€šè¿‡ UDP åè®®æ›¿ä»£äº† TCPï¼Œä¸Šå±‚åªéœ€è¦ä¸€å±‚ç”¨äºŽå’Œè¿œç¨‹æœåŠ¡å™¨äº¤äº’çš„ HTTP/2 APIã€‚è¿™æ˜¯å› ä¸º QUIC åè®®å·²ç»åŒ…å«äº†å¤šè·¯å¤ç”¨å’Œè¿žæŽ¥ç®¡ç†ï¼ŒHTTP API åªéœ€è¦å®Œæˆ HTTP åè®®çš„è§£æžå³å¯ã€‚</p>
<p>QUICä¹Ÿåˆå¹¶äº†TLSæ¡æ‰‹è¿‡ç¨‹åˆ°å®ƒçš„è¿žæŽ¥è¿‡ç¨‹ä¹‹ä¸­</p>
<p><img src="https://i.loli.net/2020/11/12/W5U3wNFbjzIcgG1.png" alt="image-20201112155241502" /></p>
<h4 id="ç›®æ ‡">ç›®æ ‡</h4>
<p>QUIC åè®®çš„ä¸»è¦ç›®çš„ï¼Œæ˜¯ä¸ºäº†æ•´åˆ TCP åè®®çš„å¯é æ€§å’Œ UDP åè®®çš„é€Ÿåº¦å’Œæ•ˆçŽ‡ã€‚</p>
<h3 id="quicè¿žæŽ¥è¿‡ç¨‹">QUICè¿žæŽ¥è¿‡ç¨‹</h3>
<p><strong>Step1</strong>ï¼šé¦–æ¬¡è¿žæŽ¥æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€ Inchoate Client Hello ç»™æœåŠ¡ç«¯ï¼Œç”¨äºŽè¯·æ±‚è¿žæŽ¥ï¼›</p>
<p><strong>Step2</strong>ï¼šæœåŠ¡ç«¯ç”Ÿæˆ gã€pã€aï¼Œæ ¹æ® gã€p å’Œ a ç®—å‡º Aï¼Œç„¶åŽå°† gã€pã€A æ”¾åˆ° Server Config ä¸­å†å‘é€ Rejection æ¶ˆæ¯ç»™å®¢æˆ·ç«¯ï¼›</p>
<p><strong>Step3</strong>ï¼šå®¢æˆ·ç«¯æŽ¥æ”¶åˆ° gã€pã€A åŽï¼Œè‡ªå·±å†ç”Ÿæˆ bï¼Œæ ¹æ® gã€pã€b ç®—å‡º Bï¼Œæ ¹æ® Aã€pã€b ç®—å‡ºåˆå§‹å¯†é’¥ Kã€‚B å’Œ K ç®—å¥½åŽï¼Œå®¢æˆ·ç«¯ä¼šç”¨ K åŠ å¯† HTTP æ•°æ®ï¼Œè¿žåŒ B ä¸€èµ·å‘é€ç»™æœåŠ¡ç«¯ï¼›</p>
<p><strong>Step4</strong>ï¼šæœåŠ¡ç«¯æŽ¥æ”¶åˆ° B åŽï¼Œæ ¹æ® aã€pã€B ç”Ÿæˆä¸Žå®¢æˆ·ç«¯åŒæ ·çš„å¯†é’¥ï¼Œå†ç”¨è¿™å¯†é’¥è§£å¯†æ”¶åˆ°çš„ HTTP æ•°æ®ã€‚ä¸ºäº†è¿›ä¸€æ­¥çš„å®‰å…¨ï¼ˆå‰å‘å®‰å…¨æ€§ï¼‰ï¼ŒæœåŠ¡ç«¯ä¼šæ›´æ–°è‡ªå·±çš„éšæœºæ•° a å’Œå…¬é’¥ï¼Œå†ç”Ÿæˆæ–°çš„å¯†é’¥ Sï¼Œç„¶åŽæŠŠå…¬é’¥é€šè¿‡ Server Hello å‘é€ç»™å®¢æˆ·ç«¯ã€‚è¿žåŒ Server Hello æ¶ˆæ¯ï¼Œè¿˜æœ‰ HTTP è¿”å›žæ•°æ®ï¼›</p>
<p><strong>Step5</strong>ï¼šå®¢æˆ·ç«¯æ”¶åˆ° Server Hello åŽï¼Œç”Ÿæˆä¸ŽæœåŠ¡ç«¯ä¸€è‡´çš„æ–°å¯†é’¥ Sï¼ŒåŽé¢çš„ä¼ è¾“éƒ½ä½¿ç”¨ S åŠ å¯†ã€‚</p>
<p>è¿™æ ·ï¼ŒQUIC ä»Žè¯·æ±‚è¿žæŽ¥åˆ°æ­£å¼æŽ¥å‘ HTTP æ•°æ®ä¸€å…±èŠ±äº† 1 RTTï¼Œè¿™ 1 ä¸ª RTT ä¸»è¦æ˜¯ä¸ºäº†èŽ·å– Server Configï¼ŒåŽé¢çš„è¿žæŽ¥å¦‚æžœå®¢æˆ·ç«¯ç¼“å­˜äº† Server Configï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æŽ¥å‘é€ HTTP æ•°æ®ï¼Œå®žçŽ° 0 RTT å»ºç«‹è¿žæŽ¥ã€‚</p>
<p><img src="https://i.loli.net/2020/11/12/p8Fb3w2WTICJsAG.png" alt="image-20201112192246347" /></p>
<p>è¿™é‡Œä½¿ç”¨çš„æ˜¯ DH å¯†é’¥äº¤æ¢ç®—æ³•ï¼ŒDH ç®—æ³•çš„æ ¸å¿ƒå°±æ˜¯æœåŠ¡ç«¯ç”Ÿæˆ aã€gã€p 3 ä¸ªéšæœºæ•°ï¼Œa è‡ªå·±æŒæœ‰ï¼Œg å’Œ p è¦ä¼ è¾“ç»™å®¢æˆ·ç«¯ï¼Œè€Œå®¢æˆ·ç«¯ä¼šç”Ÿæˆ b è¿™ 1 ä¸ªéšæœºæ•°ï¼Œé€šè¿‡ DH ç®—æ³•å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯ä»¥ç®—å‡ºåŒæ ·çš„å¯†é’¥ã€‚åœ¨è¿™è¿‡ç¨‹ä¸­ a å’Œ b å¹¶ä¸å‚ä¸Žç½‘ç»œä¼ è¾“ï¼Œå®‰å…¨æ€§å¤§å¤§æé«˜ã€‚å› ä¸º p å’Œ g æ˜¯å¤§æ•°ï¼Œæ‰€ä»¥å³ä½¿åœ¨ç½‘ç»œä¸­ä¼ è¾“çš„ pã€gã€Aã€B éƒ½è¢«åŠ«æŒï¼Œé‚£ä¹ˆé çŽ°åœ¨çš„è®¡ç®—æœºç®—åŠ›ä¹Ÿæ²¡æ³•ç ´è§£å¯†é’¥ã€‚</p>
<h3 id="quicè¿žæŽ¥è¿ç§»">QUICè¿žæŽ¥è¿ç§»</h3>
<blockquote>
<p>å½“æ‰‹æœºä»Žæ•°æ®ä¿¡å·åˆ‡æ¢åˆ°WIFIä¿¡å·æ—¶éœ€è¦å¯ä»¥çµæ´»çš„è¿›è¡Œè¿žæŽ¥çš„åˆ‡æ¢ã€‚</p>
</blockquote>
<p>TCP è¿žæŽ¥åŸºäºŽå››å…ƒç»„ï¼ˆæº IPã€æºç«¯å£ã€ç›®çš„ IPã€ç›®çš„ç«¯å£ï¼‰ï¼Œåˆ‡æ¢ç½‘ç»œæ—¶è‡³å°‘ä¼šæœ‰ä¸€ä¸ªå› ç´ å‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´è¿žæŽ¥å‘ç”Ÿå˜åŒ–ã€‚å½“è¿žæŽ¥å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¦‚æžœè¿˜ä½¿ç”¨åŽŸæ¥çš„ TCP è¿žæŽ¥ï¼Œåˆ™ä¼šå¯¼è‡´è¿žæŽ¥å¤±è´¥ï¼Œå°±å¾—ç­‰åŽŸæ¥çš„è¿žæŽ¥è¶…æ—¶åŽé‡æ–°å»ºç«‹è¿žæŽ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰æ—¶å€™å‘çŽ°åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°ç½‘ç»œæ—¶ï¼Œå³ä½¿æ–°ç½‘ç»œçŠ¶å†µè‰¯å¥½ï¼Œä½†å†…å®¹è¿˜æ˜¯éœ€è¦åŠ è½½å¾ˆä¹…ã€‚å¦‚æžœå®žçŽ°å¾—å¥½ï¼Œå½“æ£€æµ‹åˆ°ç½‘ç»œå˜åŒ–æ—¶ç«‹åˆ»å»ºç«‹æ–°çš„ TCP è¿žæŽ¥ï¼Œå³ä½¿è¿™æ ·ï¼Œå»ºç«‹æ–°çš„è¿žæŽ¥è¿˜æ˜¯éœ€è¦å‡ ç™¾æ¯«ç§’çš„æ—¶é—´ã€‚</p>
<p>QUIC çš„è¿žæŽ¥ä¸å—å››å…ƒç»„çš„å½±å“ï¼Œå½“è¿™å››ä¸ªå…ƒç´ å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒåŽŸè¿žæŽ¥ä¾ç„¶ç»´æŒã€‚é‚£è¿™æ˜¯æ€Žä¹ˆåšåˆ°çš„å‘¢ï¼Ÿé“ç†å¾ˆç®€å•ï¼Œ<strong>QUIC è¿žæŽ¥ä¸ä»¥å››å…ƒç»„ä½œä¸ºæ ‡è¯†ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸€ä¸ª 64 ä½çš„éšæœºæ•°ï¼Œè¿™ä¸ªéšæœºæ•°è¢«ç§°ä¸º Connection IDï¼Œå³ä½¿ IP æˆ–è€…ç«¯å£å‘ç”Ÿå˜åŒ–ï¼Œåªè¦ Connection ID æ²¡æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆè¿žæŽ¥ä¾ç„¶å¯ä»¥ç»´æŒã€‚</strong></p>
<p>æ˜¯ä¸æ˜¯å¾ˆå¼º~</p>
<p><img src="https://i.loli.net/2020/11/12/TrGfclm1XwJbkOx.png" alt="è¿žæŽ¥è¿ç§»" /></p>
<h3 id="quicè§£å†³é˜Ÿå¤´é˜»å¡žé—®é¢˜">QUICè§£å†³é˜Ÿå¤´é˜»å¡žé—®é¢˜</h3>
<p><img src="https://i.loli.net/2020/11/12/J9C7YKflUqSGTQP.png" alt="é˜Ÿå¤´é˜»å¡ž" /></p>
<p>HTTP ä¸€èˆ¬åˆå…è®¸æ¯ä¸ªä¸»æœºå»ºç«‹ 6 ä¸ª TCP è¿žæŽ¥ï¼Œè¿™æ ·å¯ä»¥æ›´åŠ å……åˆ†åœ°åˆ©ç”¨å¸¦å®½èµ„æºï¼Œä½†æ¯ä¸ªè¿žæŽ¥ä¸­é˜Ÿå¤´é˜»å¡žçš„é—®é¢˜è¿˜æ˜¯å­˜åœ¨ã€‚</p>
<p>HTTP/2 çš„å¤šè·¯å¤ç”¨è§£å†³äº†ä¸Šè¿°çš„é˜Ÿå¤´é˜»å¡žé—®é¢˜ã€‚ä¸åƒ HTTP/1.1 ä¸­åªæœ‰ä¸Šä¸€ä¸ªè¯·æ±‚çš„æ‰€æœ‰æ•°æ®åŒ…è¢«ä¼ è¾“å®Œæ¯•ä¸‹ä¸€ä¸ªè¯·æ±‚çš„æ•°æ®åŒ…æ‰å¯ä»¥è¢«ä¼ è¾“ï¼ŒHTTP/2 ä¸­æ¯ä¸ªè¯·æ±‚éƒ½è¢«æ‹†åˆ†æˆå¤šä¸ª Frame é€šè¿‡ä¸€æ¡ TCP è¿žæŽ¥åŒæ—¶è¢«ä¼ è¾“ï¼Œè¿™æ ·å³ä½¿ä¸€ä¸ªè¯·æ±‚è¢«é˜»å¡žï¼Œä¹Ÿä¸ä¼šå½±å“å…¶ä»–çš„è¯·æ±‚ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸åŒé¢œè‰²ä»£è¡¨ä¸åŒçš„è¯·æ±‚ï¼Œç›¸åŒé¢œè‰²çš„è‰²å—ä»£è¡¨è¯·æ±‚è¢«åˆ‡åˆ†çš„ Frameã€‚</p>
<p><img src="https://i.loli.net/2020/11/12/FSCO4jJ2ueU51km.png" alt="image-20201112193653271" /></p>
<p>äº‹æƒ…è¿˜æ²¡å®Œï¼ŒHTTP/2 è™½ç„¶å¯ä»¥è§£å†³â€œè¯·æ±‚â€è¿™ä¸ªç²’åº¦çš„é˜»å¡žï¼Œä½† HTTP/2 çš„åŸºç¡€ TCP åè®®æœ¬èº«å´ä¹Ÿå­˜åœ¨ç€é˜Ÿå¤´é˜»å¡žçš„é—®é¢˜ã€‚HTTP/2 çš„æ¯ä¸ªè¯·æ±‚éƒ½ä¼šè¢«æ‹†åˆ†æˆå¤šä¸ª Frameï¼Œä¸åŒè¯·æ±‚çš„ Frame ç»„åˆæˆ Streamï¼ŒStream æ˜¯ TCP ä¸Šçš„é€»è¾‘ä¼ è¾“å•å…ƒï¼Œè¿™æ · HTTP/2 å°±è¾¾åˆ°äº†ä¸€æ¡è¿žæŽ¥åŒæ—¶å‘é€å¤šæ¡è¯·æ±‚çš„ç›®æ ‡ï¼Œè¿™å°±æ˜¯å¤šè·¯å¤ç”¨çš„åŽŸç†ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼Œåœ¨ä¸€æ¡ TCP è¿žæŽ¥ä¸ŠåŒæ—¶å‘é€ 4 ä¸ª Streamï¼Œå…¶ä¸­ Stream1 å·²æ­£ç¡®é€è¾¾ï¼ŒStream2 ä¸­çš„ç¬¬ 3 ä¸ª Frame ä¸¢å¤±ï¼ŒTCP å¤„ç†æ•°æ®æ—¶æœ‰ä¸¥æ ¼çš„å‰åŽé¡ºåºï¼Œå…ˆå‘é€çš„ Frame è¦å…ˆè¢«å¤„ç†ï¼Œè¿™æ ·å°±ä¼šè¦æ±‚å‘é€æ–¹é‡æ–°å‘é€ç¬¬ 3 ä¸ª Frameï¼ŒStream3 å’Œ Stream4 è™½ç„¶å·²åˆ°è¾¾ä½†å´ä¸èƒ½è¢«å¤„ç†ï¼Œé‚£ä¹ˆè¿™æ—¶æ•´æ¡è¿žæŽ¥éƒ½è¢«é˜»å¡žã€‚</p>
<p><img src="https://i.loli.net/2020/11/12/YGdVE3y1nHi86Dk.png" alt="image-20201112193827513" /></p>
<p>ä¸ä»…å¦‚æ­¤ï¼Œç”±äºŽ HTTP/2 å¿…é¡»ä½¿ç”¨ HTTPSï¼Œè€Œ HTTPS ä½¿ç”¨çš„ TLS åè®®ä¹Ÿå­˜åœ¨é˜Ÿå¤´é˜»å¡žé—®é¢˜ã€‚TLS åŸºäºŽ Record ç»„ç»‡æ•°æ®ï¼Œå°†ä¸€å †æ•°æ®æ”¾åœ¨ä¸€èµ·ï¼ˆå³ä¸€ä¸ª Recordï¼‰åŠ å¯†ï¼ŒåŠ å¯†å®ŒåŽåˆæ‹†åˆ†æˆå¤šä¸ª TCP åŒ…ä¼ è¾“ã€‚ä¸€èˆ¬æ¯ä¸ª Record 16Kï¼ŒåŒ…å« 12 ä¸ª TCP åŒ…ï¼Œè¿™æ ·å¦‚æžœ 12 ä¸ª TCP åŒ…ä¸­æœ‰ä»»ä½•ä¸€ä¸ªåŒ…ä¸¢å¤±ï¼Œé‚£ä¹ˆæ•´ä¸ª Record éƒ½æ— æ³•è§£å¯†ã€‚</p>
<p><img src="https://i.loli.net/2020/11/12/3vDl4FKuRtSifkE.png" alt="image-20201112194051260" /></p>
<p>é‚£ QUIC æ˜¯å¦‚ä½•è§£å†³é˜Ÿå¤´é˜»å¡žé—®é¢˜çš„å‘¢ï¼Ÿä¸»è¦æœ‰ä¸¤ç‚¹ã€‚</p>
<ul>
<li>QUIC çš„ä¼ è¾“å•å…ƒæ˜¯ Packetï¼ŒåŠ å¯†å•å…ƒä¹Ÿæ˜¯ Packetï¼Œæ•´ä¸ªåŠ å¯†ã€ä¼ è¾“ã€è§£å¯†éƒ½åŸºäºŽ Packetï¼Œè¿™æ ·å°±èƒ½é¿å… TLS çš„é˜Ÿå¤´é˜»å¡žé—®é¢˜ï¼›</li>
<li>QUIC åŸºäºŽ UDPï¼ŒUDP çš„æ•°æ®åŒ…åœ¨æŽ¥æ”¶ç«¯æ²¡æœ‰å¤„ç†é¡ºåºï¼Œå³ä½¿ä¸­é—´ä¸¢å¤±ä¸€ä¸ªåŒ…ï¼Œä¹Ÿä¸ä¼šé˜»å¡žæ•´æ¡è¿žæŽ¥ï¼Œå…¶ä»–çš„èµ„æºä¼šè¢«æ­£å¸¸å¤„ç†ã€‚</li>
</ul>
<p><img src="https://i.loli.net/2020/11/12/w7DFB2ojmCJlk98.png" alt="image-20201112193253455" /></p>
<h3 id="quicçš„æ‹¥å¡žæŽ§åˆ¶">QUICçš„æ‹¥å¡žæŽ§åˆ¶</h3>
<p>æ‹¥å¡žæŽ§åˆ¶çš„ç›®çš„æ˜¯é¿å…è¿‡å¤šçš„æ•°æ®ä¸€ä¸‹å­æ¶Œå…¥ç½‘ç»œï¼Œå¯¼è‡´ç½‘ç»œè¶…å‡ºæœ€å¤§è´Ÿè·ã€‚QUIC çš„æ‹¥å¡žæŽ§åˆ¶ä¸Ž TCP ç±»ä¼¼ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šåšäº†æ”¹è¿›ã€‚</p>
<p>QUIC é‡æ–°å®žçŽ°äº† TCP åè®®çš„ Cubic ç®—æ³•è¿›è¡Œæ‹¥å¡žæŽ§åˆ¶ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šåšäº†ä¸å°‘æ”¹è¿›ã€‚</p>
<p><strong>çƒ­æ‹”æ’</strong></p>
<p>TCP ä¸­å¦‚æžœè¦ä¿®æ”¹æ‹¥å¡žæŽ§åˆ¶ç­–ç•¥ï¼Œéœ€è¦åœ¨ç³»ç»Ÿå±‚é¢è¿›è¡Œæ“ä½œã€‚QUIC ä¿®æ”¹æ‹¥å¡žæŽ§åˆ¶ç­–ç•¥åªéœ€è¦åœ¨åº”ç”¨å±‚æ“ä½œï¼Œå¹¶ä¸” QUIC ä¼šæ ¹æ®ä¸åŒçš„ç½‘ç»œçŽ¯å¢ƒã€ç”¨æˆ·æ¥åŠ¨æ€é€‰æ‹©æ‹¥å¡žæŽ§åˆ¶ç®—æ³•ã€‚</p>
<p><img src="https://i.loli.net/2020/11/12/Gf4xhmKiTnlyWLj.png" alt="image-20201112194918754" /></p>
<h3 id="quicå‰å‘çº é”™fec">QUICå‰å‘çº é”™FEC</h3>
<p>QUIC ä½¿ç”¨å‰å‘çº é”™(FECï¼ŒForward Error Correction)æŠ€æœ¯å¢žåŠ åè®®çš„å®¹é”™æ€§ã€‚ä¸€æ®µæ•°æ®è¢«åˆ‡åˆ†ä¸º 10 ä¸ªåŒ…åŽï¼Œä¾æ¬¡å¯¹æ¯ä¸ªåŒ…è¿›è¡Œå¼‚æˆ–è¿ç®—ï¼Œè¿ç®—ç»“æžœä¼šä½œä¸º FEC åŒ…ä¸Žæ•°æ®åŒ…ä¸€èµ·è¢«ä¼ è¾“ï¼Œå¦‚æžœä¸å¹¸åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æœ‰ä¸€ä¸ªæ•°æ®åŒ…ä¸¢å¤±ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ ¹æ®å‰©ä½™ 9 ä¸ªåŒ…ä»¥åŠ FEC åŒ…æŽ¨ç®—å‡ºä¸¢å¤±çš„é‚£ä¸ªåŒ…çš„æ•°æ®ï¼Œè¿™æ ·å°±å¤§å¤§å¢žåŠ äº†åè®®çš„å®¹é”™æ€§ã€‚</p>
<p>è¿™æ˜¯ç¬¦åˆçŽ°é˜¶æ®µç½‘ç»œæŠ€æœ¯çš„ä¸€ç§æ–¹æ¡ˆï¼ŒçŽ°é˜¶æ®µå¸¦å®½å·²ç»ä¸æ˜¯ç½‘ç»œä¼ è¾“çš„ç“¶é¢ˆï¼Œå¾€è¿”æ—¶é—´æ‰æ˜¯ï¼Œæ‰€ä»¥æ–°çš„ç½‘ç»œä¼ è¾“åè®®å¯ä»¥é€‚å½“å¢žåŠ æ•°æ®å†—ä½™ï¼Œå‡å°‘é‡ä¼ æ“ä½œã€‚</p>
<p><img src="https://i.loli.net/2020/11/12/ejmniVGcFlTrRsf.png" alt="image-20201112194343219" /></p>
<h3 id="quicé‡ä¼ åºåˆ—å·å•è°ƒé€’å¢ž">QUICé‡ä¼ åºåˆ—å·å•è°ƒé€’å¢ž</h3>
<p>TCP ä¸ºäº†ä¿è¯å¯é æ€§ï¼Œä½¿ç”¨ Sequence Number å’Œ ACK æ¥ç¡®è®¤æ¶ˆæ¯æ˜¯å¦æœ‰åºåˆ°è¾¾ï¼Œä½†è¿™æ ·çš„è®¾è®¡å­˜åœ¨ç¼ºé™·ã€‚</p>
<p>è¶…æ—¶å‘ç”ŸåŽå®¢æˆ·ç«¯å‘èµ·é‡ä¼ ï¼ŒåŽæ¥æŽ¥æ”¶åˆ°äº† ACK ç¡®è®¤æ¶ˆæ¯ï¼Œä½†å› ä¸ºåŽŸå§‹è¯·æ±‚å’Œé‡ä¼ è¯·æ±‚æŽ¥æ”¶åˆ°çš„ ACK æ¶ˆæ¯ä¸€æ ·ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯å°±éƒé—·äº†ï¼Œä¸çŸ¥é“è¿™ä¸ª ACK å¯¹åº”çš„æ˜¯åŽŸå§‹è¯·æ±‚è¿˜æ˜¯é‡ä¼ è¯·æ±‚ã€‚å¦‚æžœå®¢æˆ·ç«¯è®¤ä¸ºæ˜¯åŽŸå§‹è¯·æ±‚çš„ ACKï¼Œä½†å®žé™…ä¸Šæ˜¯å·¦å›¾çš„æƒ…å½¢ï¼Œåˆ™è®¡ç®—çš„é‡‡æ · RTT åå¤§ï¼›å¦‚æžœå®¢æˆ·ç«¯è®¤ä¸ºæ˜¯é‡ä¼ è¯·æ±‚çš„ ACKï¼Œä½†å®žé™…ä¸Šæ˜¯å³å›¾çš„æƒ…å½¢ï¼Œåˆä¼šå¯¼è‡´é‡‡æ · RTT åå°ã€‚å›¾ä¸­æœ‰å‡ ä¸ªæœ¯è¯­ï¼ŒRTO æ˜¯æŒ‡è¶…æ—¶é‡ä¼ æ—¶é—´ï¼ˆRetransmission TimeOutï¼‰ï¼Œè·Ÿæˆ‘ä»¬ç†Ÿæ‚‰çš„ RTTï¼ˆRound Trip Timeï¼Œå¾€è¿”æ—¶é—´ï¼‰å¾ˆé•¿å¾—å¾ˆåƒã€‚é‡‡æ · RTT ä¼šå½±å“ RTO è®¡ç®—ï¼Œè¶…æ—¶æ—¶é—´çš„å‡†ç¡®æŠŠæ¡å¾ˆé‡è¦ï¼Œé•¿äº†çŸ­äº†éƒ½ä¸åˆé€‚ã€‚</p>
<p><img src="https://i.loli.net/2020/11/12/M4Smbkgu1aI3LpN.png" alt="image-20201112195439072" /></p>
<p>QUIC è§£å†³äº†ä¸Šé¢çš„æ­§ä¹‰é—®é¢˜ã€‚ä¸Ž Sequence Number ä¸åŒçš„æ˜¯ï¼ŒPacket Number ä¸¥æ ¼å•è°ƒé€’å¢žï¼Œå¦‚æžœ Packet N ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆé‡ä¼ æ—¶ Packet çš„æ ‡è¯†ä¸ä¼šæ˜¯ Nï¼Œè€Œæ˜¯æ¯” N å¤§çš„æ•°å­—ï¼Œæ¯”å¦‚ N + Mï¼Œè¿™æ ·å‘é€æ–¹æŽ¥æ”¶åˆ°ç¡®è®¤æ¶ˆæ¯æ—¶å°±èƒ½æ–¹ä¾¿åœ°çŸ¥é“ ACK å¯¹åº”çš„æ˜¯åŽŸå§‹è¯·æ±‚è¿˜æ˜¯é‡ä¼ è¯·æ±‚ã€‚</p>
<p><img src="https://i.loli.net/2020/11/12/EhqmK85PY9oFA3V.png" alt="image-20201112195456998" /></p>
<h3 id="ack-delay">ACK Delay</h3>
<p>TCP è®¡ç®— RTT æ—¶æ²¡æœ‰è€ƒè™‘æŽ¥æ”¶æ–¹æŽ¥æ”¶åˆ°æ•°æ®åˆ°å‘é€ç¡®è®¤æ¶ˆæ¯ä¹‹é—´çš„å»¶è¿Ÿï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿™æ®µå»¶è¿Ÿå³ ACK Delayã€‚QUIC è€ƒè™‘äº†è¿™æ®µå»¶è¿Ÿï¼Œä½¿å¾— RTT çš„è®¡ç®—æ›´åŠ å‡†ç¡®ã€‚</p>
<p><img src="https://i.loli.net/2020/11/12/k9djmq3NFlOoAtg.png" alt="image-20201112195628088" /></p>
<h3 id="æ›´å¤šçš„-ack-å—">æ›´å¤šçš„ ACK å—</h3>
<p>ä¸€èˆ¬æ¥è¯´ï¼ŒæŽ¥æ”¶æ–¹æ”¶åˆ°å‘é€æ–¹çš„æ¶ˆæ¯åŽéƒ½åº”è¯¥å‘é€ä¸€ä¸ª ACK å›žå¤ï¼Œè¡¨ç¤ºæ”¶åˆ°äº†æ•°æ®ã€‚ä½†æ¯æ”¶åˆ°ä¸€ä¸ªæ•°æ®å°±è¿”å›žä¸€ä¸ª ACK å›žå¤å¤ªéº»çƒ¦ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šç«‹å³å›žå¤ï¼Œè€Œæ˜¯æŽ¥æ”¶åˆ°å¤šä¸ªæ•°æ®åŽå†å›žå¤ï¼ŒTCP SACK æœ€å¤šæä¾› 3 ä¸ª ACK blockã€‚ä½†æœ‰äº›åœºæ™¯ä¸‹ï¼Œæ¯”å¦‚ä¸‹è½½ï¼Œåªéœ€è¦æœåŠ¡å™¨è¿”å›žæ•°æ®å°±å¥½ï¼Œä½†æŒ‰ç…§ TCP çš„è®¾è®¡ï¼Œæ¯æ”¶åˆ° 3 ä¸ªæ•°æ®åŒ…å°±è¦â€œç¤¼è²Œæ€§â€åœ°è¿”å›žä¸€ä¸ª ACKã€‚è€Œ QUIC æœ€å¤šå¯ä»¥æŽå¸¦ 256 ä¸ª ACK blockã€‚åœ¨ä¸¢åŒ…çŽ‡æ¯”è¾ƒä¸¥é‡çš„ç½‘ç»œä¸‹ï¼Œæ›´å¤šçš„ ACK block å¯ä»¥å‡å°‘é‡ä¼ é‡ï¼Œæå‡ç½‘ç»œæ•ˆçŽ‡ã€‚</p>
<p><img src="https://i.loli.net/2020/11/12/Da2AnVZRCgBHWIi.png" alt="image-20201112195654062" /></p>
<h3 id="quicæµé‡æŽ§åˆ¶">QUICæµé‡æŽ§åˆ¶</h3>
<p>ä¼¼ä¹Žä¸€æ ·ã€‚</p>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://medium.com/cloudflare-blog/the-road-to-quic-9f100dc57d9d">The Road to QUIC</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/32553477">ç§‘æ™®ï¼šQUICåè®®åŽŸç†åˆ†æž</a></li>
<li><a href="https://blog.csdn.net/jeffrey11223/article/details/84382123">Quicåè®®ä»‹ç»å’Œæµ…æž</a></li>
</ol>
<h1 id="å‚è€ƒä¸Žæ›´å¤š">å‚è€ƒä¸Žæ›´å¤šâž•</h1>
<ol>
<li><a href="https://blog.csdn.net/chenchaofuck1/article/details/51980794">è®¡ç®—æœºç½‘ç»œé¢è¯•æ€»ç»“</a></li>
</ol>
<hr />
<p align="center">
    <a href="https://www.jiahongw.com">
        <img width="200" src="https://i.loli.net/2020/11/13/vqTDSPc7hj5LzlC.jpg">
    </a>
    <br >
    <a href="https://hugo.jiahongw.com/"><img src="https://img.shields.io/badge/%3E-HOME-green.svg"></a>
    <a href="https://hugo.jiahongw.com/"><img src="https://img.shields.io/badge/%3E-ABOUT-green.svg"></a>
    <a href="mailto:1427298682@qq.com"><img src="https://img.shields.io/badge/%3E-Email-green.svg"></a>
</p>
<h1 align="center">Interview OS</h1>
<p><img src="https://i.loli.net/2020/10/30/1mE9onuwc3AlgaG.png" alt="OSæ¿å—" /></p>
<p><a href="https://blog.nowcoder.net/n/49211c67aaaa49eb8842f7e979c79498">é«˜é¢‘çŸ¥è¯†â€”â€”æ“ä½œç³»ç»Ÿé¢è¯•é—®é¢˜æ•´ç†</a></p>
<p><img src="https://img2020.cnblogs.com/blog/1515111/202007/1515111-20200716085222492-1986911087.png" alt="img" /></p>
<p><a href="https://www.cnblogs.com/cxuanBlog/p/13320810.html">å°ç™½å¦‚ä½•å­¦ä¹ æ“ä½œç³»ç»Ÿï¼Ÿ</a></p>
<h4 id="è¿›ç¨‹çº¿ç¨‹åç¨‹åŒºåˆ«">è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹åŒºåˆ«ðŸ’ </h4>
<h5 id="è¿›ç¨‹ä¸Žçº¿ç¨‹çš„æ¥ç”±">è¿›ç¨‹ä¸Žçº¿ç¨‹çš„æ¥ç”±â˜„ï¸</h5>
<p>è¿›ç¨‹çš„ä½œç”¨ä¸Žå®šä¹‰ï¼šæ˜¯ä¸ºäº†æé«˜CPUçš„æ‰§è¡Œæ•ˆçŽ‡ï¼Œä¸ºäº†é¿å…å› ç­‰å¾…è€Œé€ æˆCPUç©ºè½¬ä»¥åŠå…¶ä»–è®¡ç®—æœºç¡¬ä»¶èµ„æºçš„æµªè´¹è€Œæå‡ºæ¥çš„ã€‚</p>
<p>çº¿ç¨‹çš„å¼•å…¥ï¼šä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªWebæœåŠ¡å™¨è¦è¿›ç¨‹çš„æ–¹å¼å¹¶å‘åœ°å¤„ç†æ¥è‡ªä¸åŒç”¨æˆ·çš„ç½‘é¡µè®¿é—®è¯·æ±‚çš„è¯ï¼Œå¯ä»¥åˆ›å»ºçˆ¶è¿›ç¨‹å’Œå¤šä¸ªå­è¿›ç¨‹çš„æ–¹å¼æ¥è¿›è¡Œå¤„ç†ï¼Œä½†æ˜¯åˆ›å»ºä¸€ä¸ªè¿›ç¨‹è¦èŠ±è´¹è¾ƒå¤§çš„<strong>ç³»ç»Ÿå¼€é”€</strong>å’Œå ç”¨è¾ƒå¤šçš„<strong>èµ„æº</strong>ã€‚é™¤å¤–ï¼Œè¿™äº›ä¸åŒçš„ç”¨æˆ·å­è¿›ç¨‹åœ¨æ‰§è¡Œçš„æ—¶å€™æ¶‰åŠåˆ°<strong>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä¸€ä¸ªå¤æ‚çš„è¿‡ç¨‹ã€‚æ‰€ä»¥ï¼Œä¸ºäº†å‡å°‘è¿›ç¨‹åˆ‡æ¢å’Œåˆ›å»ºçš„å¼€é”€ï¼Œæé«˜æ‰§è¡Œæ•ˆçŽ‡å’ŒèŠ‚çœèµ„æºï¼Œäººä»¬åœ¨æ“ä½œç³»ç»Ÿä¸­å¼•å…¥äº†&quot;çº¿ç¨‹ï¼ˆthreadï¼‰&ldquo;çš„æ¦‚å¿µã€‚</p>
<p>(è¿›ç¨‹çš„æ¶ˆè€—å¤ªå¤§ï¼Œæ‰€ä»¥å¼•å…¥çº¿ç¨‹)</p>
<h5 id="è¿›ç¨‹ä¸Žçº¿ç¨‹çš„æ•°æ®">è¿›ç¨‹ä¸Žçº¿ç¨‹çš„æ•°æ®ðŸ—¡</h5>
<p>è¿›ç¨‹æ˜¯ç³»ç»Ÿèµ„æºåˆ†é…çš„æœ€å°å•ä½, ç³»ç»Ÿç”±ä¸€ä¸ªä¸ªè¿›ç¨‹(ç¨‹åº)ç»„æˆ ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒåŒ…æ‹¬<strong>æ–‡æœ¬åŒºåŸŸ</strong>ï¼ˆtext regionï¼‰ã€<strong>æ•°æ®åŒºåŸŸ</strong>ï¼ˆdata regionï¼‰å’Œ<strong>å †æ ˆ</strong>ï¼ˆstack regionï¼‰ã€‚</p>
<ul>
<li>æ–‡æœ¬åŒºåŸŸå­˜å‚¨å¤„ç†å™¨æ‰§è¡Œçš„ä»£ç </li>
<li>æ•°æ®åŒºåŸŸå­˜å‚¨å˜é‡å’Œè¿›ç¨‹æ‰§è¡ŒæœŸé—´ä½¿ç”¨çš„åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼›</li>
<li>å †æ ˆåŒºåŸŸå­˜å‚¨ç€æ´»åŠ¨è¿‡ç¨‹è°ƒç”¨çš„æŒ‡ä»¤å’Œæœ¬åœ°å˜é‡ã€‚</li>
</ul>
<blockquote>
<p>ä¸Žè¿›ç¨‹çš„æŽ§åˆ¶è¡¨<strong>PCB</strong>ç›¸ä¼¼ï¼Œçº¿ç¨‹ä¹Ÿæœ‰è‡ªå·±çš„æŽ§åˆ¶è¡¨<strong>TCB</strong>ï¼Œä½†æ˜¯TCBä¸­æ‰€ä¿å­˜çš„çº¿ç¨‹çŠ¶æ€æ¯”PCBè¡¨å°‘å¾—å¤šã€‚</p>
</blockquote>
<img src="https://i.loli.net/2020/09/06/s6AoJexnj2XV9pm.png" alt="è¿›ç¨‹ä¸Žçº¿ç¨‹" style="zoom:50%;" />
<p><strong>çº¿ç¨‹å±žäºŽè¿›ç¨‹ï¼Œå¹¶ä¸”å…±äº«è¿›ç¨‹çš„å†…å­˜åœ°å€ç©ºé—´</strong></p>
<p><strong>çº¿ç¨‹å‡ ä¹Žä¸å æœ‰ç³»ç»Ÿèµ„æºé€šä¿¡é—®é¢˜:</strong>  è¿›ç¨‹ç›¸å½“äºŽä¸€ä¸ªå®¹å™¨,è€Œçº¿ç¨‹è€Œæ˜¯è¿è¡Œåœ¨å®¹å™¨é‡Œé¢çš„,å› æ­¤<strong>å¯¹äºŽå®¹å™¨å†…çš„ä¸œè¥¿,çº¿ç¨‹æ˜¯å…±åŒäº«æœ‰çš„</strong>,å› æ­¤çº¿ç¨‹é—´çš„é€šä¿¡å¯ä»¥ç›´æŽ¥é€šè¿‡å…¨å±€å˜é‡è¿›è¡Œé€šä¿¡,ä½†æ˜¯ç”±æ­¤å¸¦æ¥çš„ä¾‹å¦‚å¤šä¸ªçº¿ç¨‹è¯»å†™åŒä¸€ä¸ªåœ°å€å˜é‡çš„æ—¶å€™åˆ™å°†å¸¦æ¥ä¸å¯é¢„æœŸçš„åŽæžœ,å› æ­¤è¿™æ—¶å€™å¼•å…¥äº†å„ç§é”çš„ä½œç”¨,ä¾‹å¦‚äº’æ–¥é”ç­‰ã€‚</p>
<blockquote>
<p><strong>åŒæ—¶å¤šçº¿ç¨‹æ˜¯ä¸å®‰å…¨çš„,å½“ä¸€ä¸ªçº¿ç¨‹å´©æºƒäº†,ä¼šå¯¼è‡´æ•´ä¸ªè¿›ç¨‹ä¹Ÿå´©æºƒäº†,å³å…¶ä»–çº¿ç¨‹ä¹ŸæŒ‚äº†, ä½†å¤šè¿›ç¨‹è€Œä¸ä¼š,ä¸€ä¸ªè¿›ç¨‹æŒ‚äº†,å¦ä¸€ä¸ªè¿›ç¨‹ä¾ç„¶ç…§æ ·è¿è¡Œã€‚</strong></p>
</blockquote>
<h5 id="ä¸Šä¸‹æ–‡åˆ‡æ¢">ä¸Šä¸‹æ–‡åˆ‡æ¢ðŸ“Š</h5>
<p>è¿›ç¨‹åˆ‡æ¢åˆ†3æ­¥:</p>
<ol>
<li>åˆ‡æ¢é¡µç›®å½•ä»¥ä½¿ç”¨æ–°çš„åœ°å€ç©ºé—´</li>
<li>åˆ‡æ¢å†…æ ¸æ ˆ</li>
<li>åˆ‡æ¢ç¡¬ä»¶ä¸Šä¸‹æ–‡</li>
</ol>
<p>è€Œçº¿ç¨‹åˆ‡æ¢åªéœ€è¦ç¬¬2ã€3æ­¥,å› æ­¤è¿›ç¨‹çš„åˆ‡æ¢ä»£ä»·æ¯”è¾ƒå¤§</p>
<p>**åç¨‹ï¼Œè‹±æ–‡Coroutinesï¼Œæ˜¯ä¸€ç§æ¯”çº¿ç¨‹æ›´åŠ è½»é‡çº§çš„å­˜åœ¨ã€‚**æ­£å¦‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ä¸€æ ·ï¼Œä¸€ä¸ªçº¿ç¨‹ä¹Ÿå¯ä»¥æ‹¥æœ‰å¤šä¸ªåç¨‹ã€‚</p>
<p>åç¨‹æ˜¯å±žäºŽçº¿ç¨‹çš„ã€‚åç¨‹ç¨‹åºæ˜¯åœ¨çº¿ç¨‹é‡Œé¢è·‘çš„ï¼Œå› æ­¤åç¨‹åˆç§°å¾®çº¿ç¨‹å’Œçº¤ç¨‹ç­‰</p>
<p><strong>åæ²¡æœ‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¶ˆè€—ã€‚åç¨‹çš„è°ƒåº¦åˆ‡æ¢æ˜¯ç”¨æˆ·(ç¨‹åºå‘˜)æ‰‹åŠ¨åˆ‡æ¢çš„,å› æ­¤æ›´åŠ çµæ´»,å› æ­¤åˆå«ç”¨æˆ·ç©ºé—´çº¿ç¨‹.</strong></p>
<p><strong>åŽŸå­æ“ä½œæ€§ã€‚ç”±äºŽåç¨‹æ˜¯ç”¨æˆ·è°ƒåº¦çš„ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºçŽ°æ‰§è¡Œä¸€åŠçš„ä»£ç ç‰‡æ®µè¢«å¼ºåˆ¶ä¸­æ–­äº†ï¼Œå› æ­¤æ— éœ€åŽŸå­æ“ä½œé”ã€‚</strong></p>
<img src="https://i.loli.net/2020/09/06/d3EBGfPmD6Titc1.png" alt="è¿›ç¨‹-çº¿ç¨‹-åç¨‹" style="zoom:50%;" />
<blockquote>
<p>åç¨‹ä¸æ˜¯è¢«æ“ä½œç³»ç»Ÿå†…æ ¸æ‰€ç®¡ç†ï¼Œè€Œå®Œå…¨æ˜¯ç”±ç¨‹åºæ‰€æŽ§åˆ¶ï¼ˆä¹Ÿå°±æ˜¯åœ¨ç”¨æˆ·æ€æ‰§è¡Œï¼‰ã€‚<strong>åç¨‹çš„æš‚åœå®Œå…¨ç”±ç¨‹åºæŽ§åˆ¶ï¼Œçº¿ç¨‹çš„é˜»å¡žçŠ¶æ€æ˜¯ç”±æ“ä½œç³»ç»Ÿå†…æ ¸æ¥è¿›è¡Œåˆ‡æ¢ã€‚</strong></p>
<p>å¥½å¤„ï¼š</p>
<p>â€‹		æ€§èƒ½å¾—åˆ°äº†å¾ˆå¤§çš„æå‡ï¼Œä¸ä¼šåƒçº¿ç¨‹åˆ‡æ¢é‚£æ ·æ¶ˆè€—èµ„æºã€‚</p>
</blockquote>
<p>å¦‚æžœè¯´æ“ä½œç³»ç»Ÿå¼•å…¥è¿›ç¨‹çš„ç›®çš„æ˜¯ä¸ºäº†æé«˜ç¨‹åºå¹¶å‘æ‰§è¡Œï¼Œä»¥æé«˜èµ„æºåˆ©ç”¨çŽ‡å’Œç³»ç»Ÿåžåé‡ã€‚é‚£ä¹ˆæ“ä½œç³»ç»Ÿä¸­å¼•å…¥çº¿ç¨‹çš„ç›®çš„ï¼Œåˆ™æ˜¯ä¸ºäº†å‡å°‘è¿›ç¨‹å¹¶å‘æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€ä»˜å‡ºçš„æ—¶ç©ºå¼€é”€ï¼Œä½¿æ“ä½œç³»ç»Ÿèƒ½å¾ˆå¥½çš„å¹¶å‘æ‰§è¡Œã€‚</p>
<p>ã€€ã€€è¿›ç¨‹processå®šä¹‰äº†ä¸€ä¸ª<strong>æ‰§è¡ŒçŽ¯å¢ƒ</strong>ï¼ŒåŒ…æ‹¬å®ƒè‡ªå·±ç§æœ‰çš„åœ°å€ç©ºé—´ã€ä¸€ä¸ªå¥æŸ„è¡¨ï¼Œä»¥åŠä¸€ä¸ªå®‰å…¨çŽ¯å¢ƒï¼›çº¿ç¨‹åˆ™æ˜¯ä¸€ä¸ª<strong>æŽ§åˆ¶æµ</strong>ï¼Œæœ‰ä»–è‡ªå·±çš„è°ƒç”¨æ ˆcall stackï¼Œè®°å½•äº†å®ƒçš„æ‰§è¡ŒåŽ†å²ã€‚</p>
<p>ã€€ã€€çº¿ç¨‹ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼š1ï¼‰<strong>çº¿ç¨‹çš„å†…æ ¸å¯¹è±¡</strong>ï¼Œæ“ä½œç³»ç»Ÿç”¨å®ƒæ¥å¯¹çº¿ç¨‹å®žæ–½ç®¡ç†ã€‚å†…æ ¸å¯¹è±¡ä¹Ÿæ˜¯ç³»ç»Ÿç”¨æ¥å­˜æ”¾çº¿ç¨‹ç»Ÿè®¡ä¿¡æ¯çš„åœ°æ–¹ã€‚2ï¼‰<strong>çº¿ç¨‹å †æ ˆ</strong>ï¼Œå®ƒç”¨äºŽç»´æŠ¤çº¿ç¨‹åœ¨æ‰§è¡Œä»£ç æ—¶éœ€è¦çš„æ‰€æœ‰å‚æ•°å’Œå±€éƒ¨å˜é‡ã€‚å½“åˆ›å»ºçº¿ç¨‹æ—¶ï¼Œç³»ç»Ÿåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å†…æ ¸å¯¹è±¡ã€‚è¯¥çº¿ç¨‹å†…æ ¸å¯¹è±¡ä¸æ˜¯çº¿ç¨‹æœ¬èº«ï¼Œè€Œæ˜¯æ“ä½œç³»ç»Ÿç”¨æ¥ç®¡ç†çº¿ç¨‹çš„è¾ƒå°çš„æ•°æ®ç»“æž„ã€‚å¯ä»¥å°†çº¿ç¨‹å†…æ ¸å¯¹è±¡è§†ä¸ºç”±å…³äºŽçº¿ç¨‹çš„ç»Ÿè®¡ä¿¡æ¯ç»„æˆçš„ä¸€ä¸ªå°åž‹æ•°æ®ç»“æž„ã€‚</p>
<hr />
<p>å‚è€ƒé“¾æŽ¥ï¼š</p>
<ol>
<li><a href="https://blog.csdn.net/ai2000ai/article/details/104125442">çº¿ç¨‹ï¼Œè¿›ç¨‹ï¼Œåç¨‹è¯¦ç»†è§£é‡Š</a></li>
<li><a href="https://juejin.im/post/6844903607892967432">è¿›ç¨‹ã€çº¿ç¨‹å’Œåç¨‹çš„æ¦‚å¿µ</a></li>
</ol>
<h4 id="è¿›ç¨‹çš„å‡ ç§çŠ¶æ€">è¿›ç¨‹çš„å‡ ç§çŠ¶æ€</h4>
<img src="https://i.loli.net/2020/10/15/vbltYRN2jw1GCTQ.png" alt="ä¸‰ç§è¿›ç¨‹çŠ¶æ€" style="zoom: 33%;" />
<ol>
<li>
<p><strong>å°±ç»ª(Ready)çŠ¶æ€</strong></p>
<p>å½“è¿›ç¨‹å·²åˆ†é…åˆ°é™¤CPUä»¥å¤–çš„æ‰€æœ‰å¿…è¦èµ„æºåŽï¼Œåªè¦å†èŽ·å¾—CPUï¼Œä¾¿å¯ç«‹å³æ‰§è¡Œï¼Œè¿›ç¨‹è¿™æ—¶çš„çŠ¶æ€ç§°ä¸ºå°±ç»ªçŠ¶æ€ã€‚åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­å¤„äºŽå°±ç»ªçŠ¶æ€çš„è¿›ç¨‹å¯èƒ½æœ‰å¤šä¸ªï¼Œé€šå¸¸å°†å®ƒä»¬æŽ’æˆä¸€ä¸ªé˜Ÿåˆ—ï¼Œç§°ä¸ºå°±ç»ªé˜Ÿåˆ—ã€‚</p>
</li>
<li>
<p><strong>æ‰§è¡ŒçŠ¶æ€</strong></p>
<p>è¿›ç¨‹å·²èŽ·å¾—CPUï¼Œå…¶ç¨‹åºæ­£åœ¨æ‰§è¡Œã€‚åœ¨å•å¤„ç†æœºç³»ç»Ÿä¸­ï¼Œåªæœ‰ä¸€ä¸ªè¿›ç¨‹å¤„äºŽæ‰§è¡ŒçŠ¶æ€ï¼› åœ¨å¤šå¤„ç†æœºç³»ç»Ÿä¸­ï¼Œåˆ™æœ‰å¤šä¸ªè¿›ç¨‹å¤„äºŽæ‰§è¡ŒçŠ¶æ€ã€‚</p>
</li>
<li>
<p><strong>é˜»å¡žçŠ¶æ€</strong></p>
<p>æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ç”±äºŽå‘ç”ŸæŸäº‹ä»¶è€Œæš‚æ—¶æ— æ³•ç»§ç»­æ‰§è¡Œæ—¶ï¼Œä¾¿æ”¾å¼ƒå¤„ç†æœºè€Œå¤„äºŽæš‚åœçŠ¶æ€ï¼Œäº¦å³è¿›ç¨‹çš„æ‰§è¡Œå—åˆ°é˜»å¡žï¼ŒæŠŠè¿™ç§æš‚åœçŠ¶æ€ç§°ä¸ºé˜»å¡žçŠ¶æ€ï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸ºç­‰å¾…çŠ¶æ€æˆ–å°é”çŠ¶æ€ã€‚è‡´ä½¿è¿›ç¨‹é˜»å¡žçš„å…¸åž‹äº‹ä»¶æœ‰ï¼šè¯·æ±‚I/Oï¼Œç”³è¯·ç¼“å†²ç©ºé—´ç­‰ã€‚é€šå¸¸å°†è¿™ç§å¤„äºŽé˜»å¡žçŠ¶æ€çš„è¿›ç¨‹ä¹ŸæŽ’æˆä¸€ä¸ªé˜Ÿåˆ—ã€‚æœ‰çš„ç³»ç»Ÿåˆ™æ ¹æ®é˜»å¡žåŽŸå› çš„ä¸åŒè€ŒæŠŠå¤„äºŽé˜»å¡žçŠ¶æ€çš„è¿›ç¨‹æŽ’æˆå¤šä¸ªé˜Ÿåˆ—ã€‚</p>
</li>
</ol>
<h4 id="æ­»é”æ´»é”å’Œé¥¥é¥¿httpswwwcnblogscomktgup3529143html"><a href="https://www.cnblogs.com/ktgu/p/3529143.html">æ­»é”ï¼Œæ´»é”å’Œé¥¥é¥¿</a>ðŸ”</h4>
<p>æ­»é”ðŸ”ï¼šæ˜¯æŒ‡<strong>ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰<strong>åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› </strong>äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„çŽ°è±¡</strong>ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æŽ¨è¿›ä¸‹åŽ»ã€‚æ­¤æ—¶ç§°ç³»ç»Ÿå¤„äºŽæ­»é”çŠ¶æ€æˆ–ç³»ç»Ÿäº§ç”Ÿäº†æ­»é”ï¼Œè¿™äº›æ°¸è¿œåœ¨äº’ç›¸ç­‰å¾…çš„è¿›ç¨‹ç§°ä¸ºæ­»é”è¿›ç¨‹ã€‚</p>
<p>æ­»é”çš„æ¡ä»¶:</p>
<ol>
<li>äº’æ–¥</li>
<li>è¯·æ±‚å’Œä¿æŒ</li>
<li>ä¸å‰¥å¤ºåŽŸåˆ™</li>
<li>çŽ¯è·¯ç­‰å¾…</li>
</ol>
<p>å¦‚ä½•é¿å…æ­»é”ï¼ŸðŸƒâ€â™‚ï¸</p>
<p><a href="https://interview.huihut.com/#/?id=%E9%A2%84%E9%98%B2">é¢„é˜²</a></p>
<ul>
<li>æ‰“ç ´äº’æ–¥æ¡ä»¶ï¼šæ”¹é€ ç‹¬å æ€§èµ„æºä¸ºè™šæ‹Ÿèµ„æºï¼Œå¤§éƒ¨åˆ†èµ„æºå·²æ— æ³•æ”¹é€ ã€‚</li>
<li><strong>æ‰“ç ´ä¸å¯æŠ¢å æ¡ä»¶ï¼šå½“ä¸€è¿›ç¨‹å æœ‰ä¸€ç‹¬å æ€§èµ„æºåŽåˆç”³è¯·ä¸€ç‹¬å æ€§èµ„æºè€Œæ— æ³•æ»¡è¶³ï¼Œåˆ™é€€å‡ºåŽŸå æœ‰çš„èµ„æºã€‚</strong></li>
<li><strong>æ‰“ç ´å æœ‰ä¸”ç”³è¯·æ¡ä»¶ï¼šé‡‡ç”¨èµ„æºé¢„å…ˆåˆ†é…ç­–ç•¥ï¼Œå³è¿›ç¨‹è¿è¡Œå‰ç”³è¯·å…¨éƒ¨èµ„æºï¼Œæ»¡è¶³åˆ™è¿è¡Œï¼Œä¸ç„¶å°±ç­‰å¾…ï¼Œè¿™æ ·å°±ä¸ä¼šå æœ‰ä¸”ç”³è¯·ã€‚</strong></li>
<li><strong>æ‰“ç ´å¾ªçŽ¯ç­‰å¾…æ¡ä»¶ï¼šå®žçŽ°èµ„æºæœ‰åºåˆ†é…ç­–ç•¥ï¼Œå¯¹æ‰€æœ‰è®¾å¤‡å®žçŽ°åˆ†ç±»ç¼–å·ï¼Œæ‰€æœ‰è¿›ç¨‹åªèƒ½é‡‡ç”¨æŒ‰åºå·é€’å¢žçš„å½¢å¼ç”³è¯·èµ„æºã€‚</strong></li>
<li>æœ‰åºèµ„æºåˆ†é…æ³•</li>
<li>é“¶è¡Œå®¶ç®—æ³•</li>
</ul>
<p>æ´»é”ðŸš›ï¼š**æ˜¯æŒ‡çº¿ç¨‹1å¯ä»¥ä½¿ç”¨èµ„æºï¼Œä½†å®ƒå¾ˆç¤¼è²Œï¼Œè®©å…¶ä»–çº¿ç¨‹å…ˆä½¿ç”¨èµ„æºï¼Œçº¿ç¨‹2ä¹Ÿå¯ä»¥ä½¿ç”¨èµ„æºï¼Œä½†å®ƒå¾ˆç»…å£«ï¼Œä¹Ÿè®©å…¶ä»–çº¿ç¨‹å…ˆä½¿ç”¨èµ„æºã€‚**è¿™æ ·ä½ è®©æˆ‘ï¼Œæˆ‘è®©ä½ ï¼Œæœ€åŽä¸¤ä¸ªçº¿ç¨‹éƒ½æ— æ³•ä½¿ç”¨èµ„æºã€‚</p>
<p>é¥¥é¥¿ðŸ‡­ðŸ‡º :æ˜¯æŒ‡å¦‚æžœçº¿ç¨‹T1å ç”¨äº†èµ„æºRï¼Œçº¿ç¨‹T2åˆè¯·æ±‚å°é”Rï¼ŒäºŽæ˜¯T2ç­‰å¾…ã€‚T3ä¹Ÿè¯·æ±‚èµ„æºRï¼Œå½“T1é‡Šæ”¾äº†Rä¸Šçš„å°é”åŽï¼Œç³»ç»Ÿé¦–å…ˆæ‰¹å‡†äº†T3çš„è¯·æ±‚ï¼ŒT2ä»ç„¶ç­‰å¾…ã€‚ç„¶åŽT4åˆè¯·æ±‚å°é”Rï¼Œå½“T3é‡Šæ”¾äº†Rä¸Šçš„å°é”ä¹‹åŽï¼Œç³»ç»Ÿåˆæ‰¹å‡†äº†T4çš„è¯·æ±‚&hellip;&hellip;ï¼ŒT2å¯èƒ½æ°¸è¿œç­‰å¾…ã€‚</p>
<h5 id="å¦‚ä½•æ£€æµ‹æ­»é”">å¦‚ä½•æ£€æµ‹æ­»é”</h5>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œç”±äºŽæ“ä½œç³»ç»Ÿæœ‰å¹¶å‘ï¼Œå…±äº«ä»¥åŠéšæœºæ€§ç­‰ç‰¹ç‚¹ï¼Œé€šè¿‡é¢„é˜²å’Œé¿å…çš„æ‰‹æ®µè¾¾åˆ°æŽ’é™¤æ­»é”çš„ç›®çš„æ˜¯å¾ˆå›°éš¾çš„ã€‚è¿™éœ€è¦è¾ƒå¤§çš„ç³»ç»Ÿå¼€é”€ï¼Œè€Œä¸”ä¸èƒ½å……åˆ†åˆ©ç”¨èµ„æºã€‚ä¸ºæ­¤ï¼Œä¸€ç§ç®€ä¾¿çš„æ–¹æ³•æ˜¯ç³»ç»Ÿä¸ºè¿›ç¨‹åˆ†é…èµ„æºæ—¶ï¼Œä¸é‡‡å–ä»»ä½•é™åˆ¶æ€§æŽªæ–½ï¼Œä½†æ˜¯æä¾›äº†æ£€æµ‹å’Œè§£è„±æ­»é”çš„æ‰‹æ®µï¼šèƒ½å‘çŽ°æ­»é”å¹¶ä»Žæ­»é”çŠ¶æ€ä¸­æ¢å¤å‡ºæ¥ã€‚å› æ­¤ï¼Œåœ¨å®žé™…çš„æ“ä½œç³»ç»Ÿä¸­å¾€å¾€é‡‡ç”¨æ­»é”çš„æ£€æµ‹ä¸Žæ¢å¤æ–¹æ³•æ¥æŽ’é™¤æ­»é”ã€‚å¸¸åˆ©ç”¨èµ„æºåˆ†é…å›¾ã€è¿›ç¨‹ç­‰å¾…å›¾æ¥ååŠ©è¿™ç§æ£€æµ‹ã€‚</p>
<p>æ ¸å¿ƒæ˜¯ï¼š<strong>ä¸è¯•å›¾é˜»æ­¢æ­»é”ï¼Œè€Œæ˜¯å½“æ£€æµ‹åˆ°æ­»é”å‘ç”Ÿæ—¶ï¼Œé‡‡å–æŽªæ–½è¿›è¡Œæ¢å¤ã€‚</strong></p>
<p>å¯ä»¥å¯¹è¿›ç¨‹ - èµ„æºåˆ†é…å›¾è¿›è¡Œæ£€æµ‹(æŒ‰å‘¨æœŸè¿›è¡Œæ£€æµ‹)ï¼š</p>
<ul>
<li>å¦‚æžœè¿›ç¨‹ - èµ„æºåˆ†é…å›¾ä¸­æ— çŽ¯è·¯ï¼Œæ­¤æ—¶ç³»ç»Ÿæ²¡æœ‰å‘ç”Ÿæ­»é”ã€‚</li>
<li>å¦‚æžœè¿›ç¨‹ - èµ„æºåˆ†é…å›¾ä¸­æœ‰çŽ¯è·¯ï¼Œåˆ™å¯åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š
<ol>
<li>æ¯ç§èµ„æºç±»ä¸­ä»…æœ‰ä¸€ä¸ªèµ„æºï¼Œåˆ™ç³»ç»Ÿå‘ç”Ÿäº†æ­»é”ã€‚æ­¤æ—¶ï¼ŒçŽ¯è·¯æ˜¯ç³»ç»Ÿå‘ç”Ÿæ­»é”çš„å……åˆ†å¿…è¦æ¡ä»¶ï¼ŒçŽ¯è·¯ä¸­çš„è¿›ç¨‹å°±æ˜¯æ­»é”è¿›ç¨‹</li>
<li>æ¯ç§èµ„æºç±»ä¸­æœ‰å¤šä¸ªèµ„æºï¼Œåˆ™çŽ¯è·¯çš„å­˜åœ¨åªæ˜¯äº§ç”Ÿæ­»é”çš„<strong>å¿…è¦ä¸å……åˆ†æ¡ä»¶</strong>ï¼Œç³»ç»Ÿæœªå¿…ä¼šå‘ç”Ÿæ­»é”ã€‚</li>
</ol>
</li>
</ul>
<h5 id="æ­»é”æ¢å¤">æ­»é”æ¢å¤</h5>
<ul>
<li>
<p>èµ„æºå‰¥å¤ºæ³•<br />
å‰¥å¤ºé™·äºŽæ­»é”çš„è¿›ç¨‹æ‰€å ç”¨çš„èµ„æºï¼Œä½†å¹¶ä¸æ’¤é”€æ­¤è¿›ç¨‹ï¼Œç›´è‡³æ­»é”è§£é™¤ã€‚</p>
</li>
<li>
<p>è¿›ç¨‹å›žé€€æ³•<br />
æ ¹æ®ç³»ç»Ÿä¿å­˜çš„æ£€æŸ¥ç‚¹è®©æ‰€æœ‰çš„è¿›ç¨‹å›žé€€ï¼Œç›´åˆ°è¶³ä»¥è§£é™¤æ­»é”ï¼Œè¿™ç§æŽªæ–½è¦æ±‚ç³»ç»Ÿå»ºç«‹ä¿å­˜æ£€æŸ¥ç‚¹ã€å›žé€€åŠé‡å¯æœºåˆ¶ã€‚</p>
</li>
<li>
<p>è¿›ç¨‹æ’¤é”€æ³•</p>
</li>
<li>
<ul>
<li>æ’¤é”€é™·å…¥æ­»é”çš„æ‰€æœ‰è¿›ç¨‹ï¼Œè§£é™¤æ­»é”ï¼Œç»§ç»­è¿è¡Œã€‚</li>
<li>é€ä¸ªæ’¤é”€é™·å…¥æ­»é”çš„è¿›ç¨‹ï¼Œå›žæ”¶å…¶èµ„æºå¹¶é‡æ–°åˆ†é…ï¼Œç›´è‡³æ­»é”è§£é™¤ã€‚</li>
</ul>
</li>
</ul>
<p>å¯é€‰æ‹©ç¬¦åˆä¸‹é¢æ¡ä»¶ä¹‹ä¸€çš„å…ˆæ’¤é”€ï¼š 1.CPUæ¶ˆè€—æ—¶é—´æœ€å°‘è€… 2.äº§ç”Ÿçš„è¾“å‡ºé‡æœ€å°è€…<br />
3.é¢„è®¡å‰©ä½™æ‰§è¡Œæ—¶é—´æœ€é•¿è€… 4.åˆ†å¾—çš„èµ„æºæ•°é‡æœ€å°‘è€…åŽä¼˜å…ˆçº§æœ€ä½Žè€…</p>
<ul>
<li>ç³»ç»Ÿé‡å¯æ³•<br />
ç»“æŸæ‰€æœ‰è¿›ç¨‹çš„æ‰§è¡Œå¹¶é‡æ–°å¯åŠ¨æ“ä½œç³»ç»Ÿã€‚è¿™ç§æ–¹æ³•å¾ˆç®€å•ï¼Œä½†å…ˆå‰çš„å·¥ä½œå…¨éƒ¨ä½œåºŸï¼ŒæŸå¤±å¾ˆå¤§ã€‚</li>
</ul>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://patents.google.com/patent/CN103399818B/zh">æ“ä½œç³»ç»Ÿä¸­çš„æ­»é”æ£€æµ‹æ–¹æ³•</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/61221667">æ­»é”çš„äº§ç”Ÿã€é˜²æ­¢ã€é¿å…ã€æ£€æµ‹å’Œè§£é™¤</a></li>
</ol>
<h4 id="ä»€ä¹ˆæ˜¯å®ˆæŠ¤è¿›ç¨‹">ä»€ä¹ˆæ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼Ÿ</h4>
<p><strong>å®ˆæŠ¤è¿›ç¨‹å°±æ˜¯åœ¨åŽå°è¿è¡Œ,ä¸ä¸Žä»»ä½•ç»ˆç«¯å…³è”çš„è¿›ç¨‹</strong>,é€šå¸¸æƒ…å†µä¸‹å®ˆæŠ¤è¿›ç¨‹åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å°±åœ¨è¿è¡Œ,å®ƒä»¬ä»¥rootç”¨æˆ·æˆ–è€…å…¶ä»–ç‰¹æ®Šç”¨æˆ·(apacheå’Œpostfix)è¿è¡Œ,å¹¶èƒ½å¤„ç†ä¸€äº›ç³»ç»Ÿçº§çš„ä»»åŠ¡.ä¹ æƒ¯ä¸Šå®ˆæŠ¤è¿›ç¨‹çš„åå­—é€šå¸¸ä»¥dç»“å°¾(sshd),ä½†è¿™äº›ä¸æ˜¯å¿…é¡»çš„.</p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://www.zhihu.com/question/38609004">ä»€ä¹ˆæ˜¯å®ˆæŠ¤è¿›ç¨‹</a></li>
</ol>
<h4 id="linuxè¿è¡Œå†…å­˜åˆ†åŒº">Linuxè¿è¡Œå†…å­˜åˆ†åŒºðŸš©</h4>
<p>è™šæ‹Ÿå†…å­˜æ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µ ï¼Œ<strong>å®ƒä¸º æ¯ä¸ªè¿›ç¨‹æä¾›äº†ä¸€ä¸ªå‡è±¡ï¼Œ å³æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç‹¬å åœ°ä½¿ç”¨ä¸»å­˜ ã€‚</strong></p>
<p>è™šæ‹Ÿåœ°å€ç©ºé—´(å’ŒCç¨‹åºç©ºé—´ä¸€è‡´)å¦‚ä¸‹ï¼š</p>
<img src="https://i.loli.net/2020/08/13/j2f7mTU9u8YLSOA.png" alt="è™šæ‹Ÿåœ°å€ç©ºé—´" style="zoom: 80%;" />
<p><strong>åœ¨ Linuxä¸­ ï¼Œåœ°å€ç©ºé—´æœ€ä¸Šé¢çš„åŒºåŸŸæ˜¯ä¿ç•™ç»™æ“ä½œç³»ç»Ÿä¸­çš„ä»£ç å’Œæ•°æ®çš„</strong> ï¼Œè¿™å¯¹æ‰€æœ‰è¿›ç¨‹æ¥è¯´éƒ½æ˜¯ä¸€æ · ã€‚<strong>åœ°å€ç©ºé—´çš„åº•éƒ¨åŒºåŸŸå­˜æ”¾ç”¨æˆ·è¿›ç¨‹å®šä¹‰çš„ä»£ç å’Œæ•°æ®</strong> ã€‚</p>
<img src="https://i.loli.net/2020/08/13/pietcT9bzVwFQaY.png" alt="è§£é‡Š" style="zoom:80%;" />
<h4 id="è¿›ç¨‹é—´é€šä¿¡">è¿›ç¨‹é—´é€šä¿¡ðŸ¦…</h4>
<ol>
<li>
<p><strong>ç®¡é“(PIPE) / FIFO(æœ‰åç®¡é“)</strong></p>
<p>ç®¡é“å¯ç”¨äºŽå…·æœ‰äº²ç¼˜å…³ç³»è¿›ç¨‹é—´çš„é€šä¿¡ï¼Œæœ‰åç®¡é“å…‹æœäº†ç®¡é“æ²¡æœ‰åå­—çš„é™åˆ¶ï¼Œå› æ­¤ï¼Œé™¤å…·æœ‰ç®¡é“æ‰€å…·æœ‰çš„åŠŸèƒ½å¤–ï¼Œå®ƒè¿˜å…è®¸æ— äº²ç¼˜å…³ç³»è¿›ç¨‹é—´çš„é€šä¿¡ï¼›æ— åç®¡é“ä½¿ç”¨forkå®žçŽ°ã€‚</p>
</li>
<li>
<p><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong></p>
<p>æ¶ˆæ¯é˜Ÿåˆ—æ˜¯æ¶ˆæ¯çš„é“¾æŽ¥è¡¨ï¼ŒåŒ…æ‹¬<code>Posix</code>æ¶ˆæ¯é˜Ÿåˆ—<code>system V</code>æ¶ˆæ¯é˜Ÿåˆ—ã€‚æœ‰è¶³å¤Ÿæƒé™çš„è¿›ç¨‹å¯ä»¥å‘é˜Ÿåˆ—ä¸­æ·»åŠ æ¶ˆæ¯ï¼Œè¢«èµ‹äºˆè¯»æƒé™çš„è¿›ç¨‹åˆ™å¯ä»¥è¯»èµ°é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚<strong>æ¶ˆæ¯é˜Ÿåˆ—å…‹æœäº†ä¿¡å·æ‰¿è½½ä¿¡æ¯é‡å°‘ï¼Œç®¡é“åªèƒ½æ‰¿è½½æ— æ ¼å¼å­—èŠ‚æµä»¥åŠç¼“å†²åŒºå¤§å°å—é™ç­‰ç¼ºç‚¹ã€‚</strong></p>
</li>
<li>
<p><strong>ä¿¡å·é‡</strong></p>
<p>è¦ä½œä¸ºè¿›ç¨‹é—´ä»¥åŠåŒä¸€è¿›ç¨‹ä¸åŒçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥æ‰‹æ®µã€‚</p>
</li>
<li>
<p><strong>å…±äº«å†…å­˜</strong></p>
<p>ä½¿å¾—å¤šä¸ªè¿›ç¨‹å¯ä»¥è®¿é—®åŒä¸€å—å†…å­˜ç©ºé—´ï¼Œæ˜¯æœ€å¿«çš„å¯ç”¨<code>IPC</code>å½¢å¼ã€‚æ˜¯é’ˆå¯¹å…¶ä»–é€šä¿¡æœºåˆ¶è¿è¡Œæ•ˆçŽ‡è¾ƒä½Žè€Œè®¾è®¡çš„ã€‚å¾€å¾€ä¸Žå…¶å®ƒé€šä¿¡æœºåˆ¶ï¼Œå¦‚ä¿¡å·é‡ç»“åˆä½¿ç”¨ï¼Œæ¥è¾¾åˆ°è¿›ç¨‹é—´çš„åŒæ­¥åŠäº’æ–¥ã€‚</p>
<ul>
<li>ä¼˜ç‚¹ï¼šæ— é¡»å¤åˆ¶ï¼Œå¿«æ·ï¼Œä¿¡æ¯é‡å¤§</li>
<li>ç¼ºç‚¹ï¼š
<ol>
<li>é€šä¿¡æ˜¯é€šè¿‡å°†å…±äº«ç©ºé—´ç¼“å†²åŒºç›´æŽ¥é™„åŠ åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­æ¥å®žçŽ°çš„ï¼Œå› æ­¤è¿›ç¨‹é—´çš„è¯»å†™æ“ä½œçš„åŒæ­¥é—®é¢˜</li>
<li>åˆ©ç”¨å†…å­˜ç¼“å†²åŒºç›´æŽ¥äº¤æ¢ä¿¡æ¯ï¼Œå†…å­˜çš„å®žä½“å­˜åœ¨äºŽè®¡ç®—æœºä¸­ï¼Œåªèƒ½åŒä¸€ä¸ªè®¡ç®—æœºç³»ç»Ÿä¸­çš„è¯¸å¤šè¿›ç¨‹å…±äº«ï¼Œä¸æ–¹ä¾¿ç½‘ç»œé€šä¿¡</li>
</ol>
</li>
</ul>
</li>
<li>
<p><strong>åŸŸå¥—æŽ¥å­—(Domain Socket)</strong></p>
<p>æ›´ä¸ºä¸€èˆ¬çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ï¼Œå¯ç”¨äºŽä¸åŒæœºå™¨ä¹‹é—´çš„è¿›ç¨‹é—´é€šä¿¡ã€‚èµ·åˆæ˜¯ç”±Unixç³»ç»Ÿçš„BSDåˆ†æ”¯å¼€å‘å‡ºæ¥çš„ï¼Œä½†çŽ°åœ¨ä¸€èˆ¬å¯ä»¥ç§»æ¤åˆ°å…¶å®ƒç±»Unixç³»ç»Ÿä¸Šï¼šLinuxå’ŒSystem Vçš„å˜ç§éƒ½æ”¯æŒå¥—æŽ¥å­—ã€‚</p>
</li>
<li>
<p><strong>ä¿¡å·(Signal)</strong></p>
<p>ä¿¡å·æ˜¯æ¯”è¾ƒå¤æ‚çš„é€šä¿¡æ–¹å¼ï¼Œç”¨äºŽé€šçŸ¥æŽ¥å—è¿›ç¨‹æœ‰æŸç§äº‹ä»¶å‘ç”Ÿï¼Œé™¤äº†ç”¨äºŽè¿›ç¨‹é—´é€šä¿¡å¤–ï¼Œè¿›ç¨‹è¿˜å¯ä»¥å‘é€ä¿¡å·ç»™è¿›ç¨‹æœ¬èº«ï¼›Linuxé™¤äº†æ”¯æŒUnixæ—©æœŸä¿¡å·è¯­ä¹‰å‡½æ•°sigalå¤–ï¼Œè¿˜æ”¯æŒè¯­ä¹‰ç¬¦åˆPosix.1æ ‡å‡†çš„ä¿¡å·å‡½æ•°sigactionï¼ˆå®žé™…ä¸Šï¼Œè¯¥å‡½æ•°æ˜¯åŸºäºŽBSDçš„ï¼ŒBSDä¸ºäº†å®žçŽ°å¯é ä¿¡å·æœºåˆ¶ï¼Œåˆèƒ½å¤Ÿç»Ÿä¸€å¯¹å¤–æŽ¥å£ï¼Œç”¨sigactionå‡½æ•°é‡æ–°å®žçŽ°äº†signalå‡½æ•°ï¼‰ï¼›</p>
<blockquote>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œsignalæ˜¯å¯¹â€œä¸­æ–­&quot;è¿™ç§æ¦‚å¿µåœ¨è½¯ä»¶å±‚é¢ä¸Šçš„æ¨¡æ‹Ÿï¼Œä¹Ÿç§°â€è½¯ä¸­æ–­â€œï¼Œå…¶ä¸­ä¿¡å·çš„å‘é€è€…ç›¸å½“äºŽä¸­æ–­æºï¼Œè€ŒæŽ¥æ”¶è€…ç›¸å½“äºŽå¤„ç†å™¨ï¼Œæ‰€ä»¥å¿…é¡»æ˜¯ä¸€ä¸ªè¿›ç¨‹ã€‚</p>
</blockquote>
</li>
</ol>
<p>å¦‚æžœè¯´â€œå‘½åç®¡é“â€æŠŠâ€œç®¡é“â€è¿™ç§åŽŸæ¥åªé€‚ç”¨è¿‘äº²çš„æ‰‹æ®µæŽ¨å¹¿åˆ°äº†åŒä¸€å°è®¡ç®—æœºä¸­çš„ä»»æ„è¿›ç¨‹ä¹‹é—´ï¼Œåˆ™Socketåˆè¿›ä¸€æ­¥å°†å…¶æŽ¨å¹¿è‡³è®¡ç®—æœºç½‘ç»œä¸­çš„ä»»æ„è¿›ç¨‹ä¹‹é—´ã€‚ä»Žè¿™ä¸ªæ„ä¹‰ä¸Šè®²ï¼ŒSocketæˆäº†æœ€ä¸€èˆ¬ã€æœ€æ™®éé€‚ç”¨çš„è¿›ç¨‹é—´é€šä¿¡æ‰‹æ®µå’Œæœºåˆ¶ã€‚äº‹å®žä¸Šï¼ŒçŽ°åœ¨æœ‰äº›Unixç³»ç»Ÿä¸­çš„ç®¡é“æœºåˆ¶ä¹Ÿåè¿‡æ¥æ”¹æˆé€šè¿‡Socketæ¥å®žçŽ°ã€‚</p>
<h5 id="ä¸ºä»€ä¹ˆå…±äº«å†…å­˜æ›´å¿«">ä¸ºä»€ä¹ˆå…±äº«å†…å­˜æ›´å¿«ï¼Ÿ</h5>
<p><strong>æ‹·è´4æ¬¡</strong>(ä¸€èˆ¬è¿›ç¨‹é€šä¿¡æ–¹å¼)</p>
<p>1ï¼Œç”±ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºä¸­å°†æ•°æ®æ‹·è´åˆ°å†…æ ¸ç©ºé—´ç¼“å†²åŒºä¸­<br />
2ï¼Œå†…æ ¸ç©ºé—´ç¼“å†²åŒºå°†æ•°æ®æ‹·è´åˆ°å†…å­˜ä¸­<br />
3ï¼Œå†…å­˜å°†æ•°æ®æ‹·è´åˆ°åˆ°å†…æ ¸ç¼“å†²åŒº<br />
4ï¼Œå†…æ ¸ç©ºé—´ç¼“å†²åŒºåˆ°ç”¨æˆ·ç©ºé—´ç¼“å†²åŒº.</p>
<p><strong>æ‹·è´2æ¬¡</strong>(å…±äº«å†…å­˜é€šä¿¡)</p>
<p>1ï¼Œç”¨æˆ·ç©ºé—´åˆ°å†…å­˜ã€‚<br />
2ï¼Œå†…å­˜åˆ°ç”¨æˆ·ç©ºé—´ã€‚</p>
<h4 id="çº¿ç¨‹é—´é€šä¿¡">çº¿ç¨‹é—´é€šä¿¡ðŸ‘‚</h4>
<ul>
<li>é”æœºåˆ¶ï¼šåŒ…æ‹¬äº’æ–¥é”/é‡ï¼ˆmutexï¼‰ã€è¯»å†™é”ï¼ˆreader-writer lockï¼‰ã€è‡ªæ—‹é”ï¼ˆspin lockï¼‰ã€æ¡ä»¶å˜é‡ï¼ˆconditionï¼‰
<ul>
<li>äº’æ–¥é”/é‡ï¼ˆmutexï¼‰ï¼šæä¾›äº†ä»¥æŽ’ä»–æ–¹å¼é˜²æ­¢æ•°æ®ç»“æž„è¢«å¹¶å‘ä¿®æ”¹çš„æ–¹æ³•ã€‚</li>
<li>è¯»å†™é”ï¼ˆreader-writer lockï¼‰ï¼šå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å…±äº«æ•°æ®ï¼Œè€Œå¯¹å†™æ“ä½œæ˜¯äº’æ–¥çš„ã€‚</li>
<li>è‡ªæ—‹é”ï¼ˆspin lockï¼‰ä¸Žäº’æ–¥é”ç±»ä¼¼ï¼Œéƒ½æ˜¯ä¸ºäº†ä¿æŠ¤å…±äº«èµ„æºã€‚äº’æ–¥é”æ˜¯å½“èµ„æºè¢«å ç”¨ï¼Œç”³è¯·è€…è¿›å…¥ç¡çœ çŠ¶æ€ï¼›è€Œè‡ªæ—‹é”åˆ™å¾ªçŽ¯æ£€æµ‹ä¿æŒè€…æ˜¯å¦å·²ç»é‡Šæ”¾é”ã€‚</li>
<li>æ¡ä»¶å˜é‡ï¼ˆconditionï¼‰ï¼šå¯ä»¥ä»¥åŽŸå­çš„æ–¹å¼é˜»å¡žè¿›ç¨‹ï¼Œç›´åˆ°æŸä¸ªç‰¹å®šæ¡ä»¶ä¸ºçœŸä¸ºæ­¢ã€‚å¯¹æ¡ä»¶çš„æµ‹è¯•æ˜¯åœ¨äº’æ–¥é”çš„ä¿æŠ¤ä¸‹è¿›è¡Œçš„ã€‚æ¡ä»¶å˜é‡å§‹ç»ˆä¸Žäº’æ–¥é”ä¸€èµ·ä½¿ç”¨ã€‚</li>
</ul>
</li>
<li>ä¿¡å·é‡æœºåˆ¶(Semaphore)
<ul>
<li>æ— åçº¿ç¨‹ä¿¡å·é‡</li>
<li>å‘½åçº¿ç¨‹ä¿¡å·é‡</li>
</ul>
</li>
<li>ä¿¡å·æœºåˆ¶(Signal)ï¼šç±»ä¼¼è¿›ç¨‹é—´çš„ä¿¡å·å¤„ç†</li>
<li>å±éšœï¼ˆbarrierï¼‰ï¼šå±éšœå…è®¸æ¯ä¸ªçº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çš„åˆä½œçº¿ç¨‹éƒ½è¾¾åˆ°æŸä¸€ç‚¹ï¼Œç„¶åŽä»Žè¯¥ç‚¹ç»§ç»­æ‰§è¡Œã€‚</li>
</ul>
<p>çº¿ç¨‹é—´çš„é€šä¿¡ç›®çš„ä¸»è¦æ˜¯ç”¨äºŽçº¿ç¨‹åŒæ­¥ï¼Œæ‰€ä»¥çº¿ç¨‹æ²¡æœ‰åƒè¿›ç¨‹é€šä¿¡ä¸­çš„ç”¨äºŽæ•°æ®äº¤æ¢çš„é€šä¿¡æœºåˆ¶</p>
<h4 id="ä»€ä¹ˆæ˜¯å­¤å„¿è¿›ç¨‹åƒµå°¸è¿›ç¨‹">ä»€ä¹ˆæ˜¯å­¤å„¿è¿›ç¨‹ã€åƒµå°¸è¿›ç¨‹ï¼Ÿ</h4>
<p>åœ¨<code>unix/linux</code>ä¸­ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå­è¿›ç¨‹æ˜¯é€šè¿‡çˆ¶è¿›ç¨‹åˆ›å»ºçš„ï¼Œå­è¿›ç¨‹åœ¨åˆ›å»ºæ–°çš„è¿›ç¨‹ã€‚å­è¿›ç¨‹çš„ç»“æŸå’Œçˆ¶è¿›ç¨‹çš„è¿è¡Œæ˜¯ä¸€ä¸ªå¼‚æ­¥è¿‡ç¨‹,å³çˆ¶è¿›ç¨‹æ°¸è¿œæ— æ³•é¢„æµ‹å­è¿›ç¨‹ åˆ°åº•ä»€ä¹ˆæ—¶å€™ç»“æŸã€‚ å½“ä¸€ä¸ª è¿›ç¨‹å®Œæˆå®ƒçš„å·¥ä½œç»ˆæ­¢ä¹‹åŽï¼Œå®ƒçš„çˆ¶è¿›ç¨‹éœ€è¦è°ƒç”¨wait()æˆ–è€…waitpid()ç³»ç»Ÿè°ƒç”¨å–å¾—å­è¿›ç¨‹çš„ç»ˆæ­¢çŠ¶æ€ã€‚</p>
<p><strong>å­¤å„¿è¿›ç¨‹</strong>:</p>
<p>ä¸€ä¸ªçˆ¶è¿›ç¨‹é€€å‡ºï¼Œè€Œå®ƒçš„ä¸€ä¸ªæˆ–å¤šä¸ªå­è¿›ç¨‹è¿˜åœ¨è¿è¡Œï¼Œé‚£ä¹ˆé‚£äº›å­è¿›ç¨‹å°†æˆä¸ºå­¤å„¿è¿›ç¨‹ã€‚å­¤å„¿è¿›ç¨‹å°†è¢«<code>init</code>è¿›ç¨‹(è¿›ç¨‹å·ä¸º1)æ‰€æ”¶å…»ï¼Œå¹¶ç”±<code>init</code>è¿›ç¨‹å¯¹å®ƒä»¬å®ŒæˆçŠ¶æ€æ”¶é›†å·¥ä½œã€‚</p>
<p><strong>åƒµå°¸è¿›ç¨‹ï¼š</strong></p>
<p>ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨forkåˆ›å»ºå­è¿›ç¨‹ï¼Œ<strong>å¦‚æžœå­è¿›ç¨‹é€€å‡ºï¼Œè€Œçˆ¶è¿›ç¨‹å¹¶æ²¡æœ‰è°ƒç”¨<code>wait</code>æˆ–<code>waitpid</code>èŽ·å–å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯</strong>ï¼Œé‚£ä¹ˆå­è¿›ç¨‹çš„è¿›ç¨‹æè¿°ç¬¦ä»ç„¶ä¿å­˜åœ¨ç³»ç»Ÿä¸­ã€‚è¿™ç§è¿›ç¨‹ç§°ä¹‹ä¸ºåƒµæ­»è¿›ç¨‹ã€‚</p>
<p><strong>å¤„ç†åƒµå°¸è¿›ç¨‹</strong>ï¼š</p>
<ol>
<li>
<p><strong>å¹²æŽ‰çˆ¶è¿›ç¨‹</strong>ï»¿</p>
<p>å¹²æŽ‰çˆ¶è¿›ç¨‹åŽï¼Œè®©å‰©ä¸‹çš„å­è¿›ç¨‹æˆä¸ºå­¤å„¿è¿›ç¨‹ï¼Œæˆä¸ºå­¤å„¿è¿›ç¨‹åŽå°±å’Œæˆ‘ä»¬ä¸Šé¢è¯´çš„ä¸€æ ·äº†ï¼Œç”±<code>init</code>è¿›ç¨‹æ¥é¢†å…»è¿™äº›è¿›ç¨‹ï¼Œå¹¶ä¸”æ¥å¤„ç†è¿™äº›è¿›ç¨‹çš„èµ„æºé‡Šæ”¾ç­‰å·¥ä½œã€‚</p>
</li>
<li>
<p><strong>çˆ¶è¿›ç¨‹è°ƒç”¨<code>wait</code>æˆ–<code>waitpid</code></strong></p>
<p>ç­‰å‡½æ•°ç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼Œè¿™ä¼šå¯¼è‡´çˆ¶è¿›ç¨‹æŒ‚èµ·ã€‚</p>
<p>æ‰§è¡Œ<code>waitï¼ˆï¼‰</code>æˆ– <code>waitpidï¼ˆï¼‰</code>ç³»ç»Ÿè°ƒç”¨ï¼Œ<strong>åˆ™å­è¿›ç¨‹åœ¨ç»ˆæ­¢åŽä¼šç«‹å³æŠŠå®ƒåœ¨è¿›ç¨‹è¡¨ä¸­çš„æ•°æ®è¿”å›žç»™çˆ¶è¿›ç¨‹ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šç«‹å³åˆ é™¤è¯¥è¿›å…¥ç‚¹</strong>ã€‚åœ¨è¿™ç§æƒ…å½¢ä¸‹å°±ä¸ä¼šäº§ç”Ÿdefunctè¿›ç¨‹ã€‚</p>
</li>
<li>
<p><strong><code>fork</code>ä¸¤æ¬¡</strong></p>
<p>ç¬¬ä¸€æ¬¡ fork : çˆ¶è¿›ç¨‹forkä¸€ä¸ªå­è¿›ç¨‹</p>
<p>ç¬¬äºŒæ¬¡ fork : å­è¿›ç¨‹forkä¸€ä¸ªå­™è¿›ç¨‹åŽé€€å‡º</p>
<p>é‚£ä¹ˆå­™è¿›ç¨‹è¢«<code>init</code>æŽ¥ç®¡ï¼Œå½“å­™è¿›ç¨‹ç»“æŸåŽï¼Œ<code>init</code>ä¼šå›žæ”¶ã€‚</p>
<p>ä½†å­è¿›ç¨‹çš„å›žæ”¶è¿˜è¦è‡ªå·±åšã€‚</p>
</li>
<li>
<p><strong><code>signal</code>å‡½æ•°</strong></p>
<p>çˆ¶è¿›ç¨‹æ¥å¤„ç†ï¼šç”¨signalå‡½æ•°ä¸º<code>SIGCHLD</code>å®‰è£…<code>handler</code>ï¼Œåœ¨å­è¿›ç¨‹ç»“æŸåŽï¼Œçˆ¶è¿›ç¨‹ä¼šæ”¶åˆ°è¯¥ä¿¡å·ï¼Œå¯ä»¥åœ¨<code>handler</code>ä¸­è°ƒç”¨<code>wait</code>å›žæ”¶ã€‚</p>
<p>å†…æ ¸æ¥å¤„ç†:</p>
<p>å¦‚æžœçˆ¶è¿›ç¨‹ä¸å…³å¿ƒå­è¿›ç¨‹ä»€ä¹ˆæ—¶å€™ç»“æŸï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•°é€šçŸ¥å†…æ ¸è‡ªå·±ä¸æ„Ÿå…´è¶£å­è¿›ç¨‹çš„ç»“æŸï¼Œæ­¤æ—¶ï¼Œå­è¿›ç¨‹ç»“æŸåŽï¼Œå†…æ ¸ä¼šå›žæ”¶å¹¶ä¸å†ç»™ä½ çˆ¶è¿›ç¨‹å‘ä¿¡å·ã€‚</p>
<ul>
<li><code>signalï¼ˆSIGCLD, SIG_IGNï¼‰</code></li>
<li><code>signalï¼ˆSIGCHLD, SIG_IGNï¼‰</code></li>
</ul>
</li>
</ol>
<p>ï»¿</p>
<p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/Anker/p/3271773.html">å­¤å„¿è¿›ç¨‹ä¸Žåƒµå°¸è¿›ç¨‹æ€»ç»“</a></p>
<h4 id="å†…æ ¸æ€å’Œç”¨æˆ·æ€">å†…æ ¸æ€å’Œç”¨æˆ·æ€ðŸ’</h4>
<p>ä¸ºäº†å®‰å…¨ï¼Œç”¨æˆ·è¿›ç¨‹æ˜¯å—é™çš„ï¼Œå®ƒä¸èƒ½éšæ„è®¿é—®èµ„æºã€èŽ·å–èµ„æºã€‚æ‰€ä»¥ï¼Œç”±å†…æ ¸è¿›ç¨‹è´Ÿè´£ç®¡ç†å’Œåˆ†é…èµ„æºï¼Œå®ƒå…·æœ‰æœ€é«˜æƒé™ï¼Œè€Œç”¨æˆ·è¿›ç¨‹ä½¿ç”¨è¢«åˆ†é…çš„èµ„æºã€‚<strong>ç”¨æˆ·æ€çš„ç¨‹åºä¸èƒ½ éšæ„æ“ä½œå†…æ ¸åœ°å€ç©ºé—´ï¼Œå…·æœ‰ä¸€å®šçš„å®‰å…¨ä¿æŠ¤ä½œç”¨ã€‚</strong></p>
<p>è€Œä¸”ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»èƒ½å¤Ÿåœ¨æœ‰éœ€è¦çš„æ—¶å€™èƒ½ç«‹å³åˆ‡æ¢å›žå†…æ ¸è¿›ç¨‹(é€šè¿‡ä¸­æ–­)ï¼Œåªæœ‰è¿™æ ·ï¼Œæ“ä½œç³»ç»Ÿæ‰èƒ½æœ‰å®‰å…¨æ„Ÿã€‚</p>
<h5 id="ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€çš„3ç§æ–¹å¼">ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€çš„3ç§æ–¹å¼</h5>
<ul>
<li>
<p>ç³»ç»Ÿè°ƒç”¨</p>
<p>è¿™æ˜¯ç”¨æˆ·æ€è¿›ç¨‹ä¸»åŠ¨è¦æ±‚åˆ‡æ¢åˆ°å†…æ ¸æ€çš„ä¸€ç§æ–¹å¼ï¼Œç”¨æˆ·æ€è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨ç”³è¯·ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„æœåŠ¡ç¨‹åºå®Œæˆå·¥ä½œï¼Œæ¯”å¦‚fork()å®žé™…ä¸Šå°±æ˜¯æ‰§è¡Œäº†ä¸€ä¸ªåˆ›å»ºæ–°è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ã€‚è€Œç³»ç»Ÿè°ƒç”¨çš„æœºåˆ¶å…¶æ ¸å¿ƒè¿˜æ˜¯ä½¿ç”¨äº†æ“ä½œç³»ç»Ÿä¸ºç”¨æˆ·ç‰¹åˆ«å¼€æ”¾çš„ä¸€ä¸ªä¸­æ–­æ¥å®žçŽ°ï¼Œä¾‹å¦‚Linuxçš„int 80hä¸­æ–­ã€‚</p>
</li>
<li>
<p>ä¸­æ–­</p>
<p>å½“å¤–å›´è®¾å¤‡å®Œæˆç”¨æˆ·è¯·æ±‚çš„æ“ä½œåŽï¼Œä¼šå‘CPUå‘å‡ºç›¸åº”çš„ä¸­æ–­ä¿¡å·ï¼Œè¿™æ—¶CPUä¼šæš‚åœæ‰§è¡Œä¸‹ä¸€æ¡å³å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤è½¬è€ŒåŽ»æ‰§è¡Œä¸Žä¸­æ–­ä¿¡å·å¯¹åº”çš„å¤„ç†ç¨‹åºï¼Œå¦‚æžœå…ˆå‰æ‰§è¡Œçš„æŒ‡ä»¤æ˜¯ç”¨æˆ·æ€ä¸‹çš„ç¨‹åºï¼Œé‚£ä¹ˆè¿™ä¸ªè½¬æ¢çš„è¿‡ç¨‹è‡ªç„¶ä¹Ÿå°±å‘ç”Ÿäº†ç”±ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ã€‚æ¯”å¦‚ç¡¬ç›˜è¯»å†™æ“ä½œå®Œæˆï¼Œç³»ç»Ÿä¼šåˆ‡æ¢åˆ°ç¡¬ç›˜è¯»å†™çš„ä¸­æ–­å¤„ç†ç¨‹åºä¸­æ‰§è¡ŒåŽç»­æ“ä½œç­‰ã€‚</p>
</li>
<li>
<p>å¼‚å¸¸</p>
<p>å½“CPUåœ¨æ‰§è¡Œè¿è¡Œåœ¨ç”¨æˆ·æ€ä¸‹çš„ç¨‹åºæ—¶ï¼Œå‘ç”Ÿäº†æŸäº›äº‹å…ˆä¸å¯çŸ¥çš„å¼‚å¸¸ï¼Œè¿™æ—¶ä¼šè§¦å‘ç”±å½“å‰è¿è¡Œè¿›ç¨‹åˆ‡æ¢åˆ°å¤„ç†æ­¤å¼‚å¸¸çš„å†…æ ¸ç›¸å…³ç¨‹åºä¸­ï¼Œä¹Ÿå°±è½¬åˆ°äº†å†…æ ¸æ€ï¼Œæ¯”å¦‚ç¼ºé¡µå¼‚å¸¸ã€‚</p>
</li>
</ul>
<h4 id="freeå‡½æ•°å¦‚ä½•çŸ¥é“è¦é‡Šæ”¾çš„ç©ºé—´å¤§å°">free()å‡½æ•°å¦‚ä½•çŸ¥é“è¦é‡Šæ”¾çš„ç©ºé—´å¤§å°â“</h4>
<p>mallocæœ‰å¤šç§å®žçŽ°ï¼Œæœ‰ä½¿ç”¨é“¾è¡¨çš„ï¼Œä¹Ÿæœ‰æ˜¯ç”±åœ¨ç”³è¯·å†…å­˜å¤´éƒ¨è®°å½•ä¿¡æ¯çš„ï¼Œè¿˜æœ‰ä½¿ç”¨ä¼™ä¼´çš„ç®—æ³•ã€‚æ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„mallocç®—æ³•ã€‚</p>
<p>å‚è€ƒï¼šhttps://www.zhihu.com/question/302440083</p>
<h4 id="ä¸­æ–­å’Œè½®è¯¢çš„ç‰¹ç‚¹">ä¸­æ–­å’Œè½®è¯¢çš„ç‰¹ç‚¹ðŸ¥š</h4>
<p>å¯¹I/Oè®¾å¤‡çš„ç¨‹åºè½®è¯¢çš„æ–¹å¼ï¼Œæ˜¯æ—©æœŸçš„è®¡ç®—æœºç³»ç»Ÿå¯¹I/Oè®¾å¤‡çš„ä¸€ç§ç®¡ç†æ–¹å¼ã€‚å®ƒå®šæ—¶å¯¹å„ç§è®¾å¤‡è½®æµè¯¢é—®ä¸€éæœ‰æ— å¤„ç†è¦æ±‚ã€‚è½®æµè¯¢é—®ä¹‹åŽï¼Œæœ‰è¦æ±‚çš„ï¼Œåˆ™åŠ ä»¥å¤„ç†ã€‚åœ¨å¤„ç†I/Oè®¾å¤‡çš„è¦æ±‚ä¹‹åŽï¼Œå¤„ç†æœºè¿”å›žç»§ç»­å·¥ä½œã€‚å°½ç®¡è½®è¯¢éœ€è¦æ—¶é—´ï¼Œä½†è½®è¯¢è¦æ¯”I/Oè®¾å¤‡çš„é€Ÿåº¦è¦å¿«å¾—å¤šï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šå‘ç”Ÿä¸èƒ½åŠæ—¶å¤„ç†çš„é—®é¢˜ã€‚å½“ç„¶ï¼Œå†å¿«çš„å¤„ç†æœºï¼Œèƒ½å¤„ç†çš„è¾“å…¥è¾“å‡ºè®¾å¤‡çš„æ•°é‡ä¹Ÿæ˜¯æœ‰ä¸€å®šé™åº¦çš„ã€‚è€Œä¸”ï¼Œç¨‹åºè½®è¯¢æ¯•ç«Ÿå æ®äº†CPUç›¸å½“ä¸€éƒ¨åˆ†å¤„ç†æ—¶é—´ï¼Œå› æ­¤ï¼Œç¨‹åº<strong>è½®è¯¢</strong>æ˜¯ä¸€ç§<strong>æ•ˆçŽ‡è¾ƒä½Ž</strong>çš„æ–¹å¼ï¼Œåœ¨çŽ°ä»£è®¡ç®—æœºç³»ç»Ÿä¸­å·²å¾ˆå°‘åº”ç”¨ã€‚</p>
<p>ã€€ã€€ç¨‹åºä¸­æ–­é€šå¸¸ç®€ç§°<strong>ä¸­æ–­</strong>ï¼Œæ˜¯æŒ‡CPUåœ¨æ­£å¸¸è¿è¡Œç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œç”±äºŽé¢„å…ˆå®‰æŽ’æˆ–å‘ç”Ÿäº†å„ç§éšæœºçš„å†…éƒ¨æˆ–å¤–éƒ¨äº‹ä»¶ï¼Œä½¿CPUä¸­æ–­æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼Œè€Œè½¬åˆ°ä¸ºå“åº”çš„æœåŠ¡ç¨‹åºåŽ»å¤„ç†ã€‚</p>
<p>ã€€ã€€è½®è¯¢â€”â€”æ•ˆçŽ‡ä½Žï¼Œç­‰å¾…æ—¶é—´å¾ˆé•¿ï¼ŒCPUåˆ©ç”¨çŽ‡ä¸é«˜ã€‚</p>
<p>ã€€ã€€ä¸­æ–­â€”â€”å®¹æ˜“é—æ¼ä¸€äº›é—®é¢˜ï¼ŒCPUåˆ©ç”¨çŽ‡é«˜ã€‚</p>
<blockquote>
<p>ä¸­æ–­æ˜¯æŒ‡åœ¨è®¡ç®—æœºæ‰§è¡ŒæœŸé—´ï¼Œç³»ç»Ÿå†…å‘ç”Ÿä»»ä½•éžå¯»å¸¸çš„æˆ–éžé¢„æœŸçš„æ€¥éœ€å¤„ç†äº‹ä»¶ï¼Œä½¿å¾—CPU<strong>æš‚æ—¶ä¸­æ–­</strong>å½“å‰æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºè€Œè½¬åŽ»æ‰§è¡Œç›¸åº”çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚å¾…<strong>å¤„ç†å®Œæ¯•åŽåˆè¿”å›ž</strong>åŽŸæ¥è¢«ä¸­æ–­å¤„ç»§ç»­æ‰§è¡Œæˆ–è°ƒåº¦æ–°çš„è¿›ç¨‹æ‰§è¡Œçš„è¿‡ç¨‹ã€‚</p>
</blockquote>
<p><strong>ä¸­æ–­å‘é‡è¡¨</strong></p>
<p>å¤–éƒ¨è®¾å¤‡çš„ä¸­æ–­å¸¸å¸¸å¯¹åº”å‘é‡è¡¨ä¸­çš„æŸä¸€é¡¹ï¼Œè¿™æ˜¯é€šç”¨æ¡†æž¶çš„å¤–éƒ¨ä¸­æ–­å¤„ç†å‡½æ•°å…¥å£ï¼Œå› æ­¤åœ¨è¿›å…¥é€šç”¨çš„ä¸­æ–­å¤„ç†å‡½æ•°ä¹‹åŽï¼Œç³»ç»Ÿå¿…é¡»çŸ¥é“æ­£åœ¨å¤„ç†çš„ä¸­æ–­æ˜¯å“ªä¸€ä¸ªè®¾å¤‡äº§ç”Ÿçš„ï¼Œè€Œè¿™æ­£æ˜¯ç”±è½¯ä»¶ä¸­æ–­å·irqå®šçš„å†³ã€‚ä¸­æ–­å‘é‡è¡¨çš„å†…å®¹æ˜¯ç”±æ“ä½œç³»ç»Ÿåœ¨åˆå§‹åŒ–é˜¶æ®µæ¥å¡«å†™ï¼Œå¯¹äºŽå¤–éƒ¨ä¸­æ–­ï¼Œæ“ä½œç³»ç»Ÿè´Ÿè´£å®žçŽ°ä¸€ä¸ªé€šç”¨çš„å¤–éƒ¨ä¸­æ–­å¤„ç†å‡½æ•°ï¼Œç„¶åŽæŠŠè¿™ä¸ªå‡½æ•°çš„å…¥å£åœ°å€æ”¾åˆ°ä¸­æ–­å‘é‡è¡¨ä¸­çš„å¯¹åº”ä½ç½®ã€‚ç”¨æˆ·æ³¨å†Œè®¾å¤‡é©±åŠ¨ISRï¼Œå®žé™…ä¸Šå°±æ˜¯æŒ‚æŽ¥åˆ°ä¸­æ–­å‘é‡è¡¨ä¸­ï¼Œè¦†ç›–æŸä¸€é¡¹çš„é»˜è®¤å¤„ç†å®žçŽ°ç‰¹åŒ–ã€‚</p>
<h4 id="åˆ†æ®µä¸Žåˆ†é¡µ">åˆ†æ®µä¸Žåˆ†é¡µðŸ‘“</h4>
<p>æ®µå¼å­˜å‚¨ç®¡ç†æ˜¯ä¸€ç§ç¬¦åˆç”¨æˆ·è§†è§’çš„å†…å­˜åˆ†é…ç®¡ç†æ–¹æ¡ˆã€‚åœ¨æ®µå¼å­˜å‚¨ç®¡ç†ä¸­ï¼Œå°†ç¨‹åºçš„åœ°å€ç©ºé—´åˆ’åˆ†ä¸ºè‹¥å¹²æ®µï¼ˆsegmentï¼‰ï¼Œå¦‚ä»£ç æ®µï¼Œæ•°æ®æ®µï¼Œå †æ ˆæ®µï¼›è¿™æ ·æ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ª<strong>äºŒç»´åœ°å€ç©ºé—´</strong>ï¼Œç›¸äº’ç‹¬ç«‹ï¼Œäº’ä¸å¹²æ‰°ã€‚æ®µå¼ç®¡ç†çš„ä¼˜ç‚¹æ˜¯ï¼š<strong>æ²¡æœ‰å†…ç¢Žç‰‡</strong>ï¼ˆå› ä¸ºæ®µå¤§å°å¯å˜ï¼Œæ”¹å˜æ®µå¤§å°æ¥æ¶ˆé™¤å†…ç¢Žç‰‡ï¼‰ã€‚ä½†<strong>æ®µæ¢å…¥æ¢å‡ºæ—¶ï¼Œä¼šäº§ç”Ÿå¤–ç¢Žç‰‡</strong>ï¼ˆæ¯”å¦‚4kçš„æ®µæ¢5kçš„æ®µï¼Œä¼šäº§ç”Ÿ1kçš„å¤–ç¢Žç‰‡ï¼‰</p>
<p>é¡µå¼å­˜å‚¨ç®¡ç†æ–¹æ¡ˆæ˜¯ä¸€ç§ç”¨æˆ·è§†è§’å†…å­˜ä¸Žç‰©ç†å†…å­˜ç›¸åˆ†ç¦»çš„å†…å­˜åˆ†é…ç®¡ç†æ–¹æ¡ˆã€‚åœ¨é¡µå¼å­˜å‚¨ç®¡ç†ä¸­ï¼Œå°†ç¨‹åºçš„<strong>é€»è¾‘åœ°å€åˆ’åˆ†ä¸ºå›ºå®šå¤§å°çš„é¡µï¼ˆpageï¼‰</strong>ï¼Œè€Œ<strong>ç‰©ç†å†…å­˜</strong>åˆ’åˆ†ä¸ºåŒæ ·å¤§å°çš„<strong>å¸§</strong>ï¼Œç¨‹åºåŠ è½½æ—¶ï¼Œå¯ä»¥å°†ä»»æ„ä¸€é¡µæ”¾å…¥å†…å­˜ä¸­ä»»æ„ä¸€ä¸ªå¸§ï¼Œè¿™äº›å¸§ä¸å¿…è¿žç»­ï¼Œä»Žè€Œå®žçŽ°äº†ç¦»æ•£åˆ†ç¦»ã€‚é¡µå¼å­˜å‚¨ç®¡ç†çš„ä¼˜ç‚¹æ˜¯ï¼š<strong>æ²¡æœ‰å¤–ç¢Žç‰‡</strong>ï¼ˆå› ä¸ºé¡µçš„å¤§å°å›ºå®šï¼‰ï¼Œä½†<strong>ä¼šäº§ç”Ÿå†…ç¢Žç‰‡</strong>ï¼ˆä¸€ä¸ªé¡µå¯èƒ½å¡«å……ä¸æ»¡ï¼‰ã€‚</p>
<p>ä¸¤è€…çš„ä¸åŒç‚¹ï¼š</p>
<p>ç›®çš„ä¸åŒï¼šåˆ†é¡µæ˜¯ç”±äºŽç³»ç»Ÿç®¡ç†çš„éœ€è¦è€Œä¸æ˜¯ç”¨æˆ·çš„éœ€è¦ï¼Œå®ƒæ˜¯<strong>ä¿¡æ¯çš„ç‰©ç†å•ä½</strong>ï¼›åˆ†æ®µçš„ç›®çš„æ˜¯ä¸ºäº†èƒ½æ›´å¥½åœ°æ»¡è¶³ç”¨æˆ·çš„éœ€è¦ï¼Œå®ƒæ˜¯<strong>ä¿¡æ¯çš„é€»è¾‘å•ä½</strong>ï¼Œå®ƒå«æœ‰ä¸€ç»„å…¶<strong>æ„ä¹‰ç›¸å¯¹å®Œæ•´</strong>çš„ä¿¡æ¯ï¼›</p>
<p>å¤§å°ä¸åŒï¼šé¡µçš„<strong>å¤§å°å›ºå®š</strong>ä¸”ç”±ç³»ç»Ÿå†³å®šï¼Œè€Œæ®µçš„é•¿åº¦å´<strong>ä¸å›ºå®š</strong>ï¼Œç”±å…¶æ‰€å®Œæˆçš„åŠŸèƒ½å†³å®šï¼›</p>
<p>åœ°å€ç©ºé—´ä¸åŒï¼š æ®µå‘ç”¨æˆ·æä¾›<strong>äºŒç»´åœ°å€ç©ºé—´</strong>ï¼›é¡µå‘ç”¨æˆ·æä¾›çš„æ˜¯<strong>ä¸€ç»´åœ°å€ç©ºé—´</strong>ï¼›</p>
<p>ä¿¡æ¯å…±äº«ï¼šæ®µæ˜¯ä¿¡æ¯çš„é€»è¾‘å•ä½ï¼Œä¾¿äºŽå­˜å‚¨ä¿æŠ¤å’Œä¿¡æ¯çš„å…±äº«ï¼Œé¡µçš„ä¿æŠ¤å’Œå…±äº«å—åˆ°é™åˆ¶ï¼›</p>
<p>å†…å­˜ç¢Žç‰‡ï¼šé¡µå¼å­˜å‚¨ç®¡ç†çš„ä¼˜ç‚¹æ˜¯æ²¡æœ‰å¤–ç¢Žç‰‡ï¼ˆå› ä¸ºé¡µçš„å¤§å°å›ºå®šï¼‰ï¼Œä½†ä¼šäº§ç”Ÿå†…ç¢Žç‰‡ï¼ˆä¸€ä¸ªé¡µå¯èƒ½å¡«å……ä¸æ»¡ï¼‰ï¼›è€Œæ®µå¼ç®¡ç†çš„ä¼˜ç‚¹æ˜¯æ²¡æœ‰å†…ç¢Žç‰‡ï¼ˆå› ä¸ºæ®µå¤§å°å¯å˜ï¼Œæ”¹å˜æ®µå¤§å°æ¥æ¶ˆé™¤å†…ç¢Žç‰‡ï¼‰ã€‚ä½†æ®µæ¢å…¥æ¢å‡ºæ—¶ï¼Œä¼šäº§ç”Ÿå¤–ç¢Žç‰‡ï¼ˆæ¯”å¦‚4kçš„æ®µæ¢5kçš„æ®µï¼Œä¼šäº§ç”Ÿ1kçš„å¤–ç¢Žç‰‡ï¼‰ã€‚</p>
<ul>
<li>æ®µæ˜¯ä¿¡æ¯çš„<strong>é€»è¾‘å•ä½</strong>ï¼Œå®ƒæ˜¯æ ¹æ®<strong>ç”¨æˆ·çš„éœ€è¦</strong>åˆ’åˆ†çš„ï¼Œå› æ­¤æ®µå¯¹ç”¨æˆ·æ˜¯å¯è§çš„ ï¼›é¡µæ˜¯ä¿¡æ¯çš„<strong>ç‰©ç†å•ä½</strong>ï¼Œæ˜¯ä¸ºäº†<strong>ç®¡ç†ä¸»å­˜</strong>çš„æ–¹ä¾¿è€Œåˆ’åˆ†çš„ï¼Œå¯¹ç”¨æˆ·æ˜¯é€æ˜Žçš„ã€‚</li>
<li>æ®µçš„å¤§å°<strong>ä¸å›ºå®š</strong>ï¼Œæœ‰å®ƒæ‰€å®Œæˆçš„åŠŸèƒ½å†³å®šï¼›é¡µå¤§å¤§å°<strong>å›ºå®š</strong>ï¼Œç”±ç³»ç»Ÿå†³å®š</li>
<li>æ®µå‘ç”¨æˆ·æä¾›<strong>äºŒç»´åœ°å€ç©ºé—´</strong>ï¼›é¡µå‘ç”¨æˆ·æä¾›çš„æ˜¯<strong>ä¸€ç»´åœ°å€ç©ºé—´</strong></li>
<li>æ®µæ˜¯ä¿¡æ¯çš„é€»è¾‘å•ä½ï¼Œä¾¿äºŽ<strong>å­˜å‚¨ä¿æŠ¤å’Œä¿¡æ¯çš„å…±äº«</strong>ï¼Œé¡µçš„ä¿æŠ¤å’Œå…±äº«<strong>å—åˆ°é™åˆ¶</strong>ã€‚</li>
</ul>
<p>é¡µæ˜¯ä¿¡æ¯çš„ç‰©ç†å•ä½ï¼Œåˆ†é¡µæ˜¯ä¸ºå®žçŽ°ç¦»æ•£åˆ†é…æ–¹å¼ï¼Œä»¥æ¶ˆå‡å†…å­˜çš„å¤–é›¶å¤´ï¼Œæé«˜å†…å­˜çš„åˆ©ç”¨çŽ‡ï¼›æˆ–è€…è¯´ï¼Œåˆ†é¡µä»…ä»…æ˜¯ç”±äºŽç³»ç»Ÿç®¡ç†çš„éœ€è¦ï¼Œè€Œä¸æ˜¯ç”¨æˆ·çš„éœ€è¦ã€‚</p>
<p>æ®µæ˜¯ä¿¡æ¯çš„é€»è¾‘å•ä½ï¼Œå®ƒå«æœ‰ä¸€ç»„å…¶æ„ä¹‰ç›¸å¯¹å®Œæ•´çš„ä¿¡æ¯ã€‚åˆ†æ®µçš„ç›®çš„æ˜¯ä¸ºäº†èƒ½æ›´å¥½çš„æ»¡è¶³ç”¨æˆ·çš„éœ€è¦ã€‚</p>
<p>é¡µçš„å¤§å°å›ºå®šä¸”ç”±ç³»ç»Ÿç¡®å®šï¼ŒæŠŠé€»è¾‘åœ°å€åˆ’åˆ†ä¸ºé¡µå·å’Œé¡µå†…åœ°å€ä¸¤éƒ¨åˆ†ï¼Œæ˜¯ç”±æœºå™¨ç¡¬ä»¶å®žçŽ°çš„ï¼Œå› è€Œä¸€ä¸ªç³»ç»Ÿåªèƒ½æœ‰ä¸€ç§å¤§å°çš„é¡µé¢ã€‚æ®µçš„é•¿åº¦å´ä¸å›ºå®šï¼Œå†³å®šäºŽç”¨æˆ·æ‰€ç¼–å†™çš„ç¨‹åºï¼Œé€šå¸¸ç”±ç¼–è¾‘ç¨‹åºåœ¨å¯¹æºç¨‹åºè¿›è¡Œç¼–è¾‘æ—¶ï¼Œæ ¹æ®ä¿¡æ¯çš„æ€§è´¨æ¥åˆ’åˆ†ã€‚</p>
<p>åˆ†é¡µçš„ä½œä¸šåœ°å€ç©ºé—´æ˜¯ä¸€ç»´çš„ï¼Œå³å•ä¸€çš„çº¿æ€§ç©ºé—´ï¼Œç¨‹åºå‘˜åªé¡»åˆ©ç”¨ä¸€ä¸ªè®°å¿†ç¬¦ï¼Œå³å¯è¡¨ç¤ºä¸€åœ°å€ã€‚åˆ†æ®µçš„ä½œä¸šåœ°å€ç©ºé—´æ˜¯äºŒç»´çš„ï¼Œç¨‹åºå‘˜åœ¨æ ‡è¯†ä¸€ä¸ªåœ°å€æ—¶ï¼Œæ—¢éœ€ç»™å‡ºæ®µåï¼Œåˆéœ€ç»™å‡ºæ®µå†…åœ°å€ã€‚</p>
<h5 id="å†…å­˜åˆ†æ®µ">å†…å­˜åˆ†æ®µ</h5>
<p>ç¨‹åºæ˜¯ç”±è‹¥å¹²ä¸ªé€»è¾‘åˆ†æ®µç»„æˆçš„ï¼Œå¦‚å¯ç”±ä»£ç åˆ†æ®µã€æ•°æ®åˆ†æ®µã€æ ˆæ®µã€å †æ®µç»„æˆã€‚<strong>ä¸åŒçš„æ®µæ˜¯æœ‰ä¸åŒçš„å±žæ€§çš„ï¼Œæ‰€ä»¥å°±ç”¨åˆ†æ®µï¼ˆ<em>Segmentation</em>ï¼‰çš„å½¢å¼æŠŠè¿™äº›æ®µåˆ†ç¦»å‡ºæ¥ã€‚</strong></p>
<blockquote>
<p>åˆ†æ®µæœºåˆ¶ä¸‹ï¼Œè™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€æ˜¯å¦‚ä½•æ˜ å°„çš„ï¼Ÿ</p>
</blockquote>
<p>åˆ†æ®µæœºåˆ¶ä¸‹çš„è™šæ‹Ÿåœ°å€ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œ<strong>æ®µé€‰æ‹©å­</strong>å’Œ<strong>æ®µå†…åç§»é‡</strong>ã€‚</p>
<img src="https://i.loli.net/2020/10/30/21VWRnugyxidceb.jpg" alt="preview" style="zoom:80%;" />
<ul>
<li><strong>æ®µé€‰æ‹©å­</strong>å°±ä¿å­˜åœ¨æ®µå¯„å­˜å™¨é‡Œé¢ã€‚æ®µé€‰æ‹©å­é‡Œé¢æœ€é‡è¦çš„æ˜¯<strong>æ®µå·</strong>ï¼Œç”¨ä½œæ®µè¡¨çš„ç´¢å¼•ã€‚<strong>æ®µè¡¨</strong>é‡Œé¢ä¿å­˜çš„æ˜¯è¿™ä¸ª<strong>æ®µçš„åŸºåœ°å€ã€æ®µçš„ç•Œé™å’Œç‰¹æƒç­‰çº§</strong>ç­‰ã€‚</li>
<li>è™šæ‹Ÿåœ°å€ä¸­çš„<strong>æ®µå†…åç§»é‡</strong>åº”è¯¥ä½äºŽ 0 å’Œæ®µç•Œé™ä¹‹é—´ï¼Œå¦‚æžœæ®µå†…åç§»é‡æ˜¯åˆæ³•çš„ï¼Œå°±å°†æ®µåŸºåœ°å€åŠ ä¸Šæ®µå†…åç§»é‡å¾—åˆ°ç‰©ç†å†…å­˜åœ°å€ã€‚</li>
</ul>
<p>ç”±ä¸Šé¢å¯ä»¥çŸ¥é“è™šæ‹Ÿåœ°å€æ˜¯é€šè¿‡<strong>æ®µè¡¨</strong>ä¸Žç‰©ç†åœ°å€è¿›è¡Œæ˜ å°„çš„ï¼Œåˆ†æ®µæœºåˆ¶ä¼šæŠŠç¨‹åºçš„è™šæ‹Ÿåœ°å€åˆ†æˆ 4 ä¸ªæ®µï¼Œæ¯ä¸ªæ®µåœ¨æ®µè¡¨ä¸­æœ‰ä¸€ä¸ªé¡¹ï¼Œåœ¨è¿™ä¸€é¡¹æ‰¾åˆ°æ®µçš„åŸºåœ°å€ï¼Œå†åŠ ä¸Šåç§»é‡ï¼ŒäºŽæ˜¯å°±èƒ½æ‰¾åˆ°ç‰©ç†å†…å­˜ä¸­çš„åœ°å€ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://i.loli.net/2020/10/30/KR8tmxrAbYBeFhi.jpg" alt="åˆ†æ®µ" /></p>
<p>åˆ†æ®µçš„åŠžæ³•å¾ˆå¥½ï¼Œè§£å†³äº†ç¨‹åºæœ¬èº«ä¸éœ€è¦å…³å¿ƒå…·ä½“çš„ç‰©ç†å†…å­˜åœ°å€çš„é—®é¢˜ï¼Œä½†å®ƒä¹Ÿæœ‰ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå°±æ˜¯<strong>å†…å­˜ç¢Žç‰‡</strong>çš„é—®é¢˜ã€‚</li>
<li>ç¬¬äºŒä¸ªå°±æ˜¯<strong>å†…å­˜äº¤æ¢çš„æ•ˆçŽ‡ä½Ž</strong>çš„é—®é¢˜ã€‚</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå†…å­˜ç¢Žç‰‡ï¼Ÿ</strong></p>
<p>å‡è®¾æˆ‘ä»¬æ‰§è¡Œäº†ä¸‹é¢å‡ ä¸ªç¨‹åºï¼š</p>
<ul>
<li>æ¸¸æˆå ç”¨äº† 512MB å†…å­˜</li>
<li>æµè§ˆå™¨å ç”¨äº† 128MB å†…å­˜</li>
<li>éŸ³ä¹å ç”¨äº† 256 MB å†…å­˜ã€‚</li>
</ul>
<p>å‡è®¾æœ‰ 1G çš„ç‰©ç†å†…å­˜ï¼Œåˆ™ç©ºé—²å†…å­˜è¿˜æœ‰ 1024 - 512 - 256 = 256MBã€‚å¦‚æžœè¿™ä¸ª 256MB ä¸æ˜¯è¿žç»­çš„ï¼Œè¢«åˆ†æˆäº†ä¸¤æ®µ 128 MB å†…å­˜ï¼Œè¿™å°±ä¼šå¯¼è‡´æ²¡æœ‰ç©ºé—´å†æ‰“å¼€ä¸€ä¸ª 200MB çš„ç¨‹åºã€‚</p>
<p><img src="https://i.loli.net/2020/10/30/gxjOFMUrShLnPc1.jpg" alt="å†…å­˜ç¢Žç‰‡" /></p>
<p>è¿™é‡Œçš„å†…å­˜ç¢Žç‰‡çš„é—®é¢˜å…±æœ‰ä¸¤å¤„åœ°æ–¹ï¼š</p>
<ul>
<li>å¤–éƒ¨å†…å­˜ç¢Žç‰‡ï¼Œä¹Ÿå°±æ˜¯äº§ç”Ÿäº†å¤šä¸ªä¸è¿žç»­çš„å°ç‰©ç†å†…å­˜ï¼Œå¯¼è‡´æ–°çš„ç¨‹åºæ— æ³•è¢«è£…è½½ï¼›</li>
<li>å†…éƒ¨å†…å­˜ç¢Žç‰‡ï¼Œç¨‹åºæ‰€æœ‰çš„å†…å­˜éƒ½è¢«è£…è½½åˆ°äº†ç‰©ç†å†…å­˜ï¼Œä½†æ˜¯è¿™ä¸ªç¨‹åºæœ‰éƒ¨åˆ†çš„å†…å­˜å¯èƒ½å¹¶ä¸æ˜¯å¾ˆå¸¸ä½¿ç”¨ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´å†…å­˜çš„æµªè´¹ï¼›</li>
</ul>
<p>è§£å†³å¤–éƒ¨å†…å­˜ç¢Žç‰‡çš„é—®é¢˜å°±æ˜¯<strong>å†…å­˜äº¤æ¢</strong>ã€‚</p>
<p>å¯ä»¥æŠŠéŸ³ä¹ç¨‹åºå ç”¨çš„é‚£ 256MB å†…å­˜å†™åˆ°ç¡¬ç›˜ä¸Šï¼Œç„¶åŽå†ä»Žç¡¬ç›˜ä¸Šè¯»å›žæ¥åˆ°å†…å­˜é‡Œã€‚ä¸è¿‡å†è¯»å›žçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸èƒ½è£…è½½å›žåŽŸæ¥çš„ä½ç½®ï¼Œè€Œæ˜¯ç´§ç´§è·Ÿç€é‚£å·²ç»è¢«å ç”¨äº†çš„ 512MB å†…å­˜åŽé¢ã€‚è¿™æ ·å°±èƒ½ç©ºç¼ºå‡ºè¿žç»­çš„ 256MB ç©ºé—´ï¼ŒäºŽæ˜¯æ–°çš„ 200MB ç¨‹åºå°±å¯ä»¥è£…è½½è¿›æ¥ã€‚</p>
<p>è¿™ä¸ªå†…å­˜äº¤æ¢ç©ºé—´ï¼Œåœ¨ Linux ç³»ç»Ÿé‡Œï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸çœ‹åˆ°çš„ Swap ç©ºé—´ï¼Œè¿™å—ç©ºé—´æ˜¯ä»Žç¡¬ç›˜åˆ’åˆ†å‡ºæ¥çš„ï¼Œç”¨äºŽå†…å­˜ä¸Žç¡¬ç›˜çš„ç©ºé—´äº¤æ¢ã€‚</p>
<p><strong>åˆ†æ®µä¸ºä»€ä¹ˆå¯¼è‡´æ•ˆçŽ‡ä½Žï¼Ÿ</strong></p>
<p>å¯¹äºŽå¤šè¿›ç¨‹çš„ç³»ç»Ÿæ¥è¯´ï¼Œç”¨åˆ†æ®µçš„æ–¹å¼ï¼Œå†…å­˜ç¢Žç‰‡æ˜¯å¾ˆå®¹æ˜“äº§ç”Ÿçš„ï¼Œäº§ç”Ÿäº†å†…å­˜ç¢Žç‰‡ï¼Œé‚£ä¸å¾—ä¸é‡æ–° <code>Swap</code> å†…å­˜åŒºåŸŸï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šäº§ç”Ÿæ€§èƒ½ç“¶é¢ˆã€‚</p>
<p>å› ä¸ºç¡¬ç›˜çš„è®¿é—®é€Ÿåº¦è¦æ¯”å†…å­˜æ…¢å¤ªå¤šäº†ï¼Œæ¯ä¸€æ¬¡å†…å­˜äº¤æ¢ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æŠŠä¸€å¤§æ®µè¿žç»­çš„å†…å­˜æ•°æ®å†™åˆ°ç¡¬ç›˜ä¸Šã€‚</p>
<p>æ‰€ä»¥ï¼Œ<strong>å¦‚æžœå†…å­˜äº¤æ¢çš„æ—¶å€™ï¼Œäº¤æ¢çš„æ˜¯ä¸€ä¸ªå å†…å­˜ç©ºé—´å¾ˆå¤§çš„ç¨‹åºï¼Œè¿™æ ·æ•´ä¸ªæœºå™¨éƒ½ä¼šæ˜¾å¾—å¡é¡¿ã€‚</strong></p>
<h5 id="å†…å­˜åˆ†é¡µ">å†…å­˜åˆ†é¡µ</h5>
<p>å†…å­˜åˆ†é¡µå°±æ˜¯ä¸ºäº†è§£å†³åˆ†æ®µçš„å†…å­˜ç¢Žç‰‡ä»¥åŠæ•ˆçŽ‡ä½Žè€Œæå‡ºæ¥çš„ã€‚</p>
<p><strong>åˆ†é¡µæ˜¯æŠŠæ•´ä¸ªè™šæ‹Ÿå’Œç‰©ç†å†…å­˜ç©ºé—´åˆ‡æˆä¸€æ®µæ®µå›ºå®šå°ºå¯¸çš„å¤§å°</strong>ã€‚è¿™æ ·ä¸€ä¸ªè¿žç»­å¹¶ä¸”å°ºå¯¸å›ºå®šçš„å†…å­˜ç©ºé—´ï¼Œæˆ‘ä»¬å«<strong>é¡µ</strong>ï¼ˆ<em>Page</em>ï¼‰ã€‚åœ¨ Linux ä¸‹ï¼Œæ¯ä¸€é¡µçš„å¤§å°ä¸º <code>4KB</code>ã€‚</p>
<p>è™šæ‹Ÿåœ°å€ä¸Žç‰©ç†åœ°å€ä¹‹é—´é€šè¿‡<strong>é¡µè¡¨</strong>æ¥æ˜ å°„ï¼š</p>
<img src="https://pic3.zhimg.com/80/v2-e63c20d1bace757600fccb051a29eaf6_1440w.jpg" alt="img" style="zoom:50%;" />
<p>ç”±äºŽå†…å­˜ç©ºé—´éƒ½æ˜¯é¢„å…ˆåˆ’åˆ†å¥½çš„ï¼Œä¹Ÿå°±ä¸ä¼šåƒåˆ†æ®µä¼šäº§ç”Ÿé—´éš™éžå¸¸å°çš„å†…å­˜ï¼Œè¿™æ­£æ˜¯åˆ†æ®µä¼šäº§ç”Ÿå†…å­˜ç¢Žç‰‡çš„åŽŸå› ã€‚è€Œ<strong>é‡‡ç”¨äº†åˆ†é¡µï¼Œé‚£ä¹ˆé‡Šæ”¾çš„å†…å­˜éƒ½æ˜¯ä»¥é¡µä¸ºå•ä½é‡Šæ”¾çš„ï¼Œä¹Ÿå°±ä¸ä¼šäº§ç”Ÿæ— æ³•ç»™è¿›ç¨‹ä½¿ç”¨çš„å°å†…å­˜ã€‚</strong></p>
<p>å¦‚æžœå†…å­˜ç©ºé—´ä¸å¤Ÿï¼Œæ“ä½œç³»ç»Ÿä¼šæŠŠå…¶ä»–æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ä¸­çš„ã€Œæœ€è¿‘æ²¡è¢«ä½¿ç”¨ã€çš„å†…å­˜é¡µé¢ç»™é‡Šæ”¾æŽ‰ï¼Œä¹Ÿå°±æ˜¯æš‚æ—¶å†™åœ¨ç¡¬ç›˜ä¸Šï¼Œç§°ä¸º<strong>æ¢å‡º</strong>ï¼ˆ<em>Swap Out</em>ï¼‰ã€‚ä¸€æ—¦éœ€è¦çš„æ—¶å€™ï¼Œå†åŠ è½½è¿›æ¥ï¼Œç§°ä¸º<strong>æ¢å…¥</strong>ï¼ˆ<em>Swap In</em>ï¼‰ã€‚æ‰€ä»¥ï¼Œä¸€æ¬¡æ€§å†™å…¥ç£ç›˜çš„ä¹Ÿåªæœ‰å°‘æ•°çš„ä¸€ä¸ªé¡µæˆ–è€…å‡ ä¸ªé¡µï¼Œä¸ä¼šèŠ±å¤ªå¤šæ—¶é—´ï¼Œ<strong>å†…å­˜äº¤æ¢çš„æ•ˆçŽ‡å°±ç›¸å¯¹æ¯”è¾ƒé«˜</strong>ã€‚</p>
<img src="https://i.loli.net/2020/10/30/FBlnX4AzjZKEh5I.jpg" alt="img" style="zoom:50%;" />
<p>åœ¨åˆ†é¡µæœºåˆ¶ä¸‹ï¼Œè™šæ‹Ÿåœ°å€åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œ<strong>é¡µå·</strong>å’Œ<strong>é¡µå†…åç§»</strong>ã€‚é¡µå·ä½œä¸ºé¡µè¡¨çš„ç´¢å¼•ï¼Œ<strong>é¡µè¡¨</strong>åŒ…å«ç‰©ç†é¡µæ¯é¡µæ‰€åœ¨<strong>ç‰©ç†å†…å­˜çš„åŸºåœ°å€</strong>ï¼Œè¿™ä¸ªåŸºåœ°å€ä¸Žé¡µå†…åç§»çš„ç»„åˆå°±å½¢æˆäº†ç‰©ç†å†…å­˜åœ°å€ï¼Œè§ä¸‹å›¾ã€‚</p>
<img src="https://pic1.zhimg.com/80/v2-f81afcda08a62df36ae13be04b0ea020_1440w.jpg" alt="img" style="zoom:50%;" />
<h5 id="æ®µé¡µå¼ç®¡ç†">æ®µé¡µå¼ç®¡ç†</h5>
<p>å†…å­˜åˆ†æ®µå’Œå†…å­˜åˆ†é¡µå¹¶ä¸æ˜¯å¯¹ç«‹çš„ï¼Œå®ƒä»¬æ˜¯å¯ä»¥ç»„åˆèµ·æ¥åœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­ä½¿ç”¨çš„ï¼Œé‚£ä¹ˆç»„åˆèµ·æ¥åŽï¼Œé€šå¸¸ç§°ä¸º<strong>æ®µé¡µå¼å†…å­˜ç®¡ç†</strong>ã€‚</p>
<p>æ®µé¡µå¼å†…å­˜ç®¡ç†å®žçŽ°çš„æ–¹å¼ï¼š</p>
<ul>
<li>å…ˆå°†ç¨‹åºåˆ’åˆ†ä¸ºå¤šä¸ªæœ‰é€»è¾‘æ„ä¹‰çš„æ®µï¼Œä¹Ÿå°±æ˜¯å‰é¢æåˆ°çš„åˆ†æ®µæœºåˆ¶ï¼›</li>
<li>æŽ¥ç€å†æŠŠæ¯ä¸ªæ®µåˆ’åˆ†ä¸ºå¤šä¸ªé¡µï¼Œä¹Ÿå°±æ˜¯å¯¹åˆ†æ®µåˆ’åˆ†å‡ºæ¥çš„è¿žç»­ç©ºé—´ï¼Œå†åˆ’åˆ†å›ºå®šå¤§å°çš„é¡µï¼›</li>
</ul>
<p>è¿™æ ·ï¼Œåœ°å€ç»“æž„å°±ç”±<strong>æ®µå·ã€æ®µå†…é¡µå·å’Œé¡µå†…ä½ç§»</strong>ä¸‰éƒ¨åˆ†ç»„æˆã€‚</p>
<p>ç”¨äºŽæ®µé¡µå¼åœ°å€å˜æ¢çš„æ•°æ®ç»“æž„æ˜¯æ¯ä¸€ä¸ªç¨‹åºä¸€å¼ æ®µè¡¨ï¼Œæ¯ä¸ªæ®µåˆå»ºç«‹ä¸€å¼ é¡µè¡¨ï¼Œæ®µè¡¨ä¸­çš„åœ°å€æ˜¯é¡µè¡¨çš„èµ·å§‹åœ°å€ï¼Œè€Œé¡µè¡¨ä¸­çš„åœ°å€åˆ™ä¸ºæŸé¡µçš„ç‰©ç†é¡µå·ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://i.loli.net/2020/10/30/PDgKsZNzp3HRGEe.jpg" alt="æ®µé¡µå¼" /></p>
<p>æ®µé¡µå¼åœ°å€å˜æ¢ä¸­è¦å¾—åˆ°ç‰©ç†åœ°å€é¡»ç»è¿‡ä¸‰æ¬¡å†…å­˜è®¿é—®ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ¬¡è®¿é—®æ®µè¡¨ï¼Œå¾—åˆ°é¡µè¡¨èµ·å§‹åœ°å€ï¼›</li>
<li>ç¬¬äºŒæ¬¡è®¿é—®é¡µè¡¨ï¼Œå¾—åˆ°ç‰©ç†é¡µå·ï¼›</li>
<li>ç¬¬ä¸‰æ¬¡å°†ç‰©ç†é¡µå·ä¸Žé¡µå†…ä½ç§»ç»„åˆï¼Œå¾—åˆ°ç‰©ç†åœ°å€ã€‚</li>
</ul>
<p>å¯ç”¨è½¯ã€ç¡¬ä»¶ç›¸ç»“åˆçš„æ–¹æ³•å®žçŽ°æ®µé¡µå¼åœ°å€å˜æ¢ï¼Œè¿™æ ·è™½ç„¶å¢žåŠ äº†ç¡¬ä»¶æˆæœ¬å’Œç³»ç»Ÿå¼€é”€ï¼Œä½†æé«˜äº†å†…å­˜çš„åˆ©ç”¨çŽ‡ã€‚</p>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://zhuanlan.zhihu.com/p/152119007">20 å¼ å›¾æ­å¼€ã€Œå†…å­˜ç®¡ç†ã€çš„è¿·é›¾</a></li>
</ol>
<h4 id="è¿›ç¨‹è°ƒåº¦ç®—æ³•">è¿›ç¨‹è°ƒåº¦ç®—æ³•ðŸ”Œ</h4>
<p><strong>FCFS</strong>(å…ˆæ¥å…ˆæœåŠ¡)ï¼Œ<strong>ä¼˜å…ˆçº§</strong>ï¼Œ<strong>æ—¶é—´ç‰‡</strong>è½®è½¬ï¼Œ<strong>å¤šçº§åé¦ˆ</strong></p>
<ul>
<li>
<p><strong>FCFS</strong>(å…ˆæ¥å…ˆæœåŠ¡ï¼Œé˜Ÿåˆ—å®žçŽ°ï¼ŒéžæŠ¢å çš„)</p>
<p>å…ˆè¯·æ±‚CPUçš„è¿›ç¨‹å…ˆåˆ†é…åˆ°CPU</p>
</li>
<li>
<p><strong>SJF(æœ€çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•)</strong></p>
<p>å¹³å‡ç­‰å¾…æ—¶é—´æœ€çŸ­ï¼Œä½†éš¾ä»¥çŸ¥é“ä¸‹ä¸€ä¸ªCPUåŒºé—´é•¿åº¦</p>
</li>
<li>
<p>**ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•(**å¯ä»¥æ˜¯æŠ¢å çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯éžæŠ¢å çš„)ï¼š</p>
<p><strong>ä¼˜å…ˆçº§è¶Šé«˜è¶Šå…ˆåˆ†é…åˆ°CPU</strong>ï¼Œç›¸åŒä¼˜å…ˆçº§å…ˆåˆ°å…ˆæœåŠ¡ï¼Œå­˜åœ¨çš„ä¸»è¦é—®é¢˜æ˜¯ï¼šä½Žä¼˜å…ˆçº§è¿›ç¨‹æ— ç©·ç­‰å¾…CPUï¼Œä¼šå¯¼è‡´æ— ç©·é˜»å¡žæˆ–é¥¥é¥¿ï¼›è§£å†³æ–¹æ¡ˆï¼šè€åŒ–</p>
</li>
<li>
<p><strong>é«˜å“åº”æ¯”ä¼˜å…ˆè°ƒåº¦ç®—æ³•</strong></p>
<p>æ ¹æ®â€œå“åº”æ¯”=ï¼ˆè¿›ç¨‹æ‰§è¡Œæ—¶é—´+è¿›ç¨‹ç­‰å¾…æ—¶é—´ï¼‰/ è¿›ç¨‹æ‰§è¡Œæ—¶é—´â€è¿™ä¸ªå…¬å¼å¾—åˆ°çš„å“åº”æ¯”æ¥è¿›è¡Œè°ƒåº¦ã€‚é«˜å“åº”æ¯”ä¼˜å…ˆç®—æ³•åœ¨ç­‰å¾…æ—¶é—´ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œä½œä¸šæ‰§è¡Œçš„æ—¶é—´è¶ŠçŸ­ï¼Œå“åº”æ¯”è¶Šé«˜ï¼Œæ»¡è¶³æ®µä»»åŠ¡ä¼˜å…ˆï¼ŒåŒæ—¶å“åº”æ¯”ä¼šéšç€ç­‰å¾…æ—¶é—´å¢žåŠ è€Œå˜å¤§ï¼Œä¼˜å…ˆçº§ä¼šæé«˜ï¼Œèƒ½å¤Ÿé¿å…é¥¥é¥¿çŽ°è±¡ã€‚ä¼˜ç‚¹æ˜¯å…¼é¡¾é•¿çŸ­ä½œä¸šï¼Œç¼ºç‚¹æ˜¯è®¡ç®—å“åº”æ¯”å¼€é”€å¤§ï¼Œé€‚ç”¨äºŽæ‰¹å¤„ç†ç³»ç»Ÿã€‚</p>
</li>
<li>
<p><strong>æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•</strong>(å¯æŠ¢å çš„)</p>
<p>é˜Ÿåˆ—ä¸­**æ²¡æœ‰è¿›ç¨‹è¢«åˆ†é…è¶…è¿‡ä¸€ä¸ªæ—¶é—´ç‰‡çš„CPUæ—¶é—´ï¼Œé™¤éžå®ƒæ˜¯å”¯ä¸€å¯è¿è¡Œçš„è¿›ç¨‹ã€‚**å¦‚æžœè¿›ç¨‹çš„CPUåŒºé—´è¶…è¿‡äº†ä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹å°±è¢«æŠ¢å å¹¶æ”¾å›žå°±ç»ªé˜Ÿåˆ—ã€‚</p>
</li>
<li>
<p><strong>å¤šçº§é˜Ÿåˆ—è°ƒåº¦ç®—æ³•</strong></p>
<p>å°†å°±ç»ªé˜Ÿåˆ—åˆ†æˆå¤šä¸ªç‹¬ç«‹çš„é˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—éƒ½æœ‰è‡ªå·±çš„è°ƒåº¦ç®—æ³•ï¼Œé˜Ÿåˆ—ä¹‹é—´é‡‡ç”¨å›ºå®šä¼˜å…ˆçº§æŠ¢å è°ƒåº¦ã€‚å…¶ä¸­ï¼Œä¸€ä¸ªè¿›ç¨‹æ ¹æ®è‡ªèº«å±žæ€§è¢«æ°¸ä¹…åœ°åˆ†é…åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ã€‚</p>
</li>
<li>
<p><strong>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•</strong></p>
<p>ä¸Žå¤šçº§é˜Ÿåˆ—è°ƒåº¦ç®—æ³•ç›¸æ¯”ï¼Œå…¶<strong>å…è®¸è¿›ç¨‹åœ¨é˜Ÿåˆ—ä¹‹é—´ç§»åŠ¨</strong>ï¼šè‹¥è¿›ç¨‹ä½¿ç”¨è¿‡å¤šCPUæ—¶é—´ï¼Œé‚£ä¹ˆå®ƒä¼šè¢«è½¬ç§»åˆ°æ›´ä½Žçš„ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼›åœ¨è¾ƒä½Žä¼˜å…ˆçº§é˜Ÿåˆ—ç­‰å¾…æ—¶é—´è¿‡é•¿çš„è¿›ç¨‹ä¼šè¢«è½¬ç§»åˆ°æ›´é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œä»¥é˜²æ­¢é¥¥é¥¿å‘ç”Ÿã€‚</p>
</li>
</ul>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://www.jianshu.com/p/ecfddbc0af2d">äº”ç§è¿›ç¨‹è°ƒåº¦ç®—æ³•çš„æ€»ç»“</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/225162322">å¤§åŽ‚é¢è¯•çˆ±é—®çš„ã€Œè°ƒåº¦ç®—æ³•ã€ï¼Œ20 å¼ å›¾ä¸€ä¸¾æ‹¿ä¸‹</a></li>
</ol>
<h4 id="é¡µé¢ç½®æ¢ç®—æ³•">é¡µé¢ç½®æ¢ç®—æ³•ðŸ’±</h4>
<h5 id="ä»€ä¹ˆæ˜¯é¡µé¢ç½®æ¢ç®—æ³•">ä»€ä¹ˆæ˜¯é¡µé¢ç½®æ¢ç®—æ³•ï¼Ÿ</h5>
<p>è¿›ç¨‹è¿è¡Œæ—¶ï¼Œè‹¥å…¶è®¿é—®çš„é¡µé¢ä¸åœ¨å†…å­˜è€Œéœ€å°†å…¶è°ƒå…¥ï¼Œä½†å†…å­˜å·²æ— ç©ºé—²ç©ºé—´æ—¶ï¼Œå°±éœ€è¦ä»Žå†…å­˜ä¸­è°ƒå‡ºä¸€é¡µç¨‹åºæˆ–æ•°æ®ï¼Œé€å…¥ç£ç›˜çš„å¯¹æ¢åŒºï¼Œå…¶ä¸­é€‰æ‹©è°ƒå‡ºé¡µé¢çš„ç®—æ³•å°±ç§°ä¸º<strong>é¡µé¢ç½®æ¢ç®—æ³•</strong>ã€‚</p>
<h5 id="å¸¸è§çš„é¡µé¢ç½®æ¢ç®—æ³•">å¸¸è§çš„é¡µé¢ç½®æ¢ç®—æ³•</h5>
<ul>
<li>
<p><strong>FIFOå…ˆè¿›å…ˆå‡ºç®—æ³•</strong></p>
<p>ï¼ˆä¼˜å…ˆæ·˜æ±°æœ€æ—©è¿›å…¥å†…å­˜çš„é¡µé¢ï¼‰</p>
<p>åœ¨æ“ä½œç³»ç»Ÿä¸­ç»å¸¸è¢«ç”¨åˆ°ï¼Œæ¯”å¦‚ä½œä¸šè°ƒåº¦ï¼ˆä¸»è¦å®žçŽ°ç®€å•ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°ï¼‰ï¼›</p>
</li>
<li>
<p>OPTï¼ˆOptimal replacementï¼‰<strong>æœ€ä¼˜ç½®æ¢ç®—æ³•</strong></p>
<p>ï¼ˆæ·˜æ±°ä»¥åŽä¸ä¼šä½¿ç”¨çš„é¡µé¢ï¼‰</p>
<p>ç†è®ºçš„æœ€ä¼˜ï¼Œç†è®ºï¼›å°±æ˜¯è¦ä¿è¯ç½®æ¢å‡ºåŽ»çš„æ˜¯ä¸å†è¢«ä½¿ç”¨çš„é¡µï¼Œæˆ–è€…æ˜¯åœ¨å®žé™…å†…å­˜ä¸­æœ€æ™šä½¿ç”¨çš„ç®—æ³•ã€‚</p>
<blockquote>
<p>FIFO å’Œ OPT ç®—æ³•çš„åŒºåˆ«åœ¨äºŽï¼šé™¤äº†åœ¨æ—¶é—´ä¸Šå‘åŽæˆ–å‘å‰çœ‹ä¹‹å¤–ï¼ŒFIFO ç®—æ³•ä½¿ç”¨çš„æ˜¯é¡µé¢è°ƒå…¥å†…å­˜çš„æ—¶é—´ï¼ŒOPT ç®—æ³•ä½¿ç”¨çš„æ˜¯é¡µé¢å°†æ¥ä½¿ç”¨çš„æ—¶é—´</p>
</blockquote>
</li>
<li>
<p>LRUï¼ˆLeast recently useï¼‰<strong>æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•</strong></p>
<p>ï¼ˆæ·˜æ±°æœ€è¿‘æ²¡æœ‰ä½¿ç”¨çš„é¡µé¢ï¼‰</p>
<p>é€‰æ‹©æœ€è¿‘æœ€é•¿æ—¶é—´æœªè®¿é—®è¿‡çš„é¡µé¢äºˆä»¥æ·˜æ±°ï¼Œå®ƒè®¤ä¸ºè¿‡åŽ»ä¸€æ®µæ—¶é—´å†…æœªè®¿é—®è¿‡çš„é¡µé¢ï¼Œåœ¨æœ€è¿‘çš„å°†æ¥å¯èƒ½ä¹Ÿä¸ä¼šè¢«è®¿é—®ã€‚è¯¥ç®—æ³•ä¸ºæ¯ä¸ªé¡µé¢è®¾ç½®ä¸€ä¸ªè®¿é—®å­—æ®µï¼Œæ¥è®°å½•é¡µé¢è‡ªä¸Šæ¬¡è¢«è®¿é—®ä»¥æ¥æ‰€ç»åŽ†çš„æ—¶é—´ï¼Œæ·˜æ±°é¡µé¢æ—¶é€‰æ‹©çŽ°æœ‰é¡µé¢ä¸­å€¼æœ€å¤§çš„äºˆä»¥æ·˜æ±°ã€‚</p>
<blockquote>
<p>OPT å’Œ LRU ç®—æ³•çš„åŒºåˆ«åœ¨äºŽï¼šLRU ç®—æ³•æ ¹æ®å„é¡µä»¥å‰çš„æƒ…å†µï¼Œæ˜¯â€œå‘å‰çœ‹â€çš„ï¼Œè€Œæœ€ä½³ç½®æ¢ç®—æ³•åˆ™æ ¹æ®å„é¡µä»¥åŽçš„ä½¿ç”¨æƒ…å†µï¼Œæ˜¯â€œå‘åŽçœ‹â€çš„<br />
LRU æ€§èƒ½è¾ƒå¥½ï¼Œä½†éœ€è¦å¯„å­˜å™¨å’Œæ ˆçš„ç¡¬ä»¶æ”¯æŒ</p>
</blockquote>
<p>LRU æ˜¯å †æ ˆç±»çš„ç®—æ³•ï¼Œç†è®ºä¸Šå¯ä»¥è¯æ˜Žï¼Œå †æ ˆç±»ç®—æ³•ä¸å¯èƒ½å‡ºçŽ° Belady å¼‚å¸¸</p>
</li>
<li>
<p>LFUï¼ˆLeast frequently use**ï¼‰æœ€å°‘ä½¿ç”¨æ¬¡æ•°ç®—æ³•**</p>
<p>ï¼ˆæ ¹æ®ä½¿ç”¨æ¬¡æ•°æ¥åˆ¤æ–­ï¼‰</p>
<p>æœ€ä¸ç»å¸¸ä½¿ç”¨ï¼ˆLFUï¼‰é¡µé¢ç½®æ¢ç®—æ³•è¦æ±‚ç½®æ¢å…·æœ‰æœ€å°è®¡æ•°çš„é¡µé¢ã€‚</p>
<p>è¿™ç§é€‰æ‹©çš„åŽŸå› æ˜¯ï¼Œç§¯æžä½¿ç”¨çš„é¡µé¢åº”å½“å…·æœ‰å¤§çš„å¼•ç”¨è®¡æ•°ã€‚ç„¶è€Œï¼Œå½“ä¸€ä¸ªé¡µé¢åœ¨è¿›ç¨‹çš„åˆå§‹é˜¶æ®µå¤§é‡ä½¿ç”¨ä½†æ˜¯éšåŽä¸å†ä½¿ç”¨æ—¶ï¼Œä¼šå‡ºçŽ°é—®é¢˜ã€‚ç”±äºŽè¢«å¤§é‡ä½¿ç”¨ï¼Œå®ƒæœ‰ä¸€ä¸ªå¤§çš„è®¡æ•°ï¼Œå³ä½¿ä¸å†éœ€è¦å´ä»ä¿ç•™åœ¨å†…å­˜ä¸­ã€‚ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œå®šæœŸåœ°å°†è®¡æ•°å³ç§» 1 ä½ï¼Œä»¥å½¢æˆæŒ‡æ•°è¡°å‡çš„å¹³å‡ä½¿ç”¨è®¡æ•°ã€‚</p>
</li>
<li>
<p>Clockï¼ˆ<strong>æ—¶é’Ÿç½®æ¢ç®—æ³•</strong>ï¼‰</p>
<p>ç®€å•çš„ CLOCK ç®—æ³•æ˜¯ç»™æ¯ä¸€å¸§å…³è”ä¸€ä¸ªé™„åŠ ä½ï¼Œç§°ä¸ºä½¿ç”¨ä½ã€‚</p>
<p>å½“æŸä¸€é¡µé¦–æ¬¡è£…å…¥ä¸»å­˜æ—¶ï¼Œè¯¥å¸§çš„ä½¿ç”¨ä½è®¾ç½®ä¸º1;</p>
<p>å½“è¯¥é¡µéšåŽå†è¢«è®¿é—®åˆ°æ—¶ï¼Œå®ƒçš„ä½¿ç”¨ä½ä¹Ÿè¢«ç½®ä¸º1ã€‚</p>
<p>å¯¹äºŽé¡µæ›¿æ¢ç®—æ³•ï¼Œç”¨äºŽæ›¿æ¢çš„å€™é€‰å¸§é›†åˆçœ‹åšä¸€ä¸ªå¾ªçŽ¯ç¼“å†²åŒºï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªæŒ‡é’ˆä¸Žä¹‹ç›¸å…³è”ã€‚</p>
<p>å½“æŸä¸€é¡µè¢«æ›¿æ¢æ—¶ï¼Œè¯¥æŒ‡é’ˆè¢«è®¾ç½®æˆæŒ‡å‘ç¼“å†²åŒºä¸­çš„ä¸‹ä¸€å¸§ã€‚</p>
<p>å½“éœ€è¦æ›¿æ¢ä¸€é¡µæ—¶ï¼Œæ“ä½œç³»ç»Ÿæ‰«æç¼“å†²åŒºï¼Œä»¥æŸ¥æ‰¾ä½¿ç”¨ä½è¢«ç½®ä¸º0çš„ä¸€å¸§ã€‚</p>
<p>æ¯å½“é‡åˆ°ä¸€ä¸ªä½¿ç”¨ä½ä¸º1çš„å¸§æ—¶ï¼Œæ“ä½œç³»ç»Ÿå°±å°†è¯¥ä½é‡æ–°ç½®ä¸º0ï¼›</p>
<p>å¦‚æžœåœ¨è¿™ä¸ªè¿‡ç¨‹å¼€å§‹æ—¶ï¼Œç¼“å†²åŒºä¸­æ‰€æœ‰å¸§çš„ä½¿ç”¨ä½å‡ä¸º0ï¼Œåˆ™é€‰æ‹©é‡åˆ°çš„ç¬¬ä¸€ä¸ªå¸§æ›¿æ¢ï¼›</p>
<p>å¦‚æžœæ‰€æœ‰å¸§çš„ä½¿ç”¨ä½å‡ä¸º1,åˆ™æŒ‡é’ˆåœ¨ç¼“å†²åŒºä¸­å®Œæ•´åœ°å¾ªçŽ¯ä¸€å‘¨ï¼ŒæŠŠæ‰€æœ‰ä½¿ç”¨ä½éƒ½ç½®ä¸º0ï¼Œå¹¶ä¸”åœç•™åœ¨æœ€åˆçš„ä½ç½®ä¸Šï¼Œæ›¿æ¢è¯¥å¸§ä¸­çš„é¡µã€‚</p>
<p>ç”±äºŽè¯¥ç®—æ³•å¾ªçŽ¯åœ°æ£€æŸ¥å„é¡µé¢çš„æƒ…å†µï¼Œæ•…ç§°ä¸º CLOCK ç®—æ³•ï¼Œåˆç§°ä¸ºæœ€è¿‘æœªç”¨( Not Recently Used, NRU )ç®—æ³•ã€‚</p>
<img src="https://i.loli.net/2020/10/30/rqkp6NxsbQOU4ho.png" alt="img" style="zoom: 33%;" />
</li>
</ul>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://www.cnblogs.com/Leophen/p/11397699.html">é¡µé¢ç½®æ¢ç®—æ³•è¯¦è§£</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/225162322">å¤§åŽ‚é¢è¯•çˆ±é—®çš„ã€Œè°ƒåº¦ç®—æ³•ã€ï¼Œ20 å¼ å›¾ä¸€ä¸¾æ‹¿ä¸‹</a></li>
</ol>
<h4 id="ç£ç›˜è°ƒåº¦ç®—æ³•">ç£ç›˜è°ƒåº¦ç®—æ³•ðŸ’¾</h4>
<p>ç£ç›˜çš„ç»“æž„ï¼š</p>
<p><img src="https://i.loli.net/2020/10/30/QSF9WpB3ngTYPHu.jpg" alt="ç£ç›˜ç»“æž„" />ç£ç›˜è°ƒåº¦ç®—æ³•çš„ç›®çš„å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸ºäº†æé«˜ç£ç›˜çš„è®¿é—®æ€§èƒ½ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¼˜åŒ–ç£ç›˜çš„è®¿é—®è¯·æ±‚é¡ºåºæ¥åšåˆ°çš„ã€‚</p>
<p>å¯»é“çš„æ—¶é—´æ˜¯ç£ç›˜è®¿é—®æœ€è€—æ—¶çš„éƒ¨åˆ†ï¼Œå¦‚æžœè¯·æ±‚é¡ºåºä¼˜åŒ–çš„å¾—å½“ï¼Œå¿…ç„¶å¯ä»¥èŠ‚çœä¸€äº›ä¸å¿…è¦çš„å¯»é“æ—¶é—´ï¼Œä»Žè€Œæé«˜ç£ç›˜çš„è®¿é—®æ€§èƒ½ã€‚</p>
<p>å¸¸è§çš„ç£ç›˜è°ƒåº¦ç®—æ³•ï¼š</p>
<ul>
<li>
<p>å…ˆæ¥å…ˆæœåŠ¡ç®—æ³•</p>
</li>
<li>
<p>æœ€çŸ­å¯»é“æ—¶é—´ä¼˜å…ˆç®—æ³•</p>
</li>
<li>
<p>æ‰«æç®—æ³•ç®—æ³•</p>
</li>
<li>
<p>å¾ªçŽ¯æ‰«æç®—æ³•</p>
<p>åªæœ‰ç£å¤´æœæŸä¸ªç‰¹å®šæ–¹å‘ç§»åŠ¨æ—¶ï¼Œæ‰å¤„ç†ç£é“è®¿é—®è¯·æ±‚ï¼Œè€Œè¿”å›žæ—¶ç›´æŽ¥å¿«é€Ÿç§»åŠ¨è‡³æœ€é è¾¹ç¼˜çš„ç£é“ï¼Œä¹Ÿå°±æ˜¯å¤ä½ç£å¤´ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ˆå¿«çš„ï¼Œå¹¶ä¸”è¿”å›žä¸­é€”ä¸å¤„ç†ä»»ä½•è¯·æ±‚ï¼Œè¯¥ç®—æ³•çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯ç£é“åªå“åº”ä¸€ä¸ªæ–¹å‘ä¸Šçš„è¯·æ±‚ã€‚</p>
</li>
<li>
<p>LOOK ä¸Ž C-LOOK ç®—æ³•</p>
<p>æˆ‘ä»¬å‰é¢è¯´åˆ°çš„æ‰«æç®—æ³•å’Œå¾ªçŽ¯æ‰«æç®—æ³•ï¼Œéƒ½æ˜¯ç£å¤´ç§»åŠ¨åˆ°ç£ç›˜ã€Œæœ€å§‹ç«¯æˆ–æœ€æœ«ç«¯ã€æ‰å¼€å§‹è°ƒæ¢æ–¹å‘ã€‚</p>
<p>é‚£è¿™å…¶å®žæ˜¯å¯ä»¥ä¼˜åŒ–çš„ï¼Œä¼˜åŒ–çš„æ€è·¯å°±æ˜¯ç£å¤´åœ¨ç§»åŠ¨åˆ°ã€Œæœ€è¿œçš„è¯·æ±‚ã€ä½ç½®ï¼Œç„¶åŽç«‹å³åå‘ç§»åŠ¨ã€‚</p>
<p>é‚£é’ˆå¯¹ SCAN ç®—æ³•çš„ä¼˜åŒ–åˆ™å« LOOK ç®—æ³•ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼ï¼Œç£å¤´åœ¨æ¯ä¸ªæ–¹å‘ä¸Šä»…ä»…ç§»åŠ¨åˆ°æœ€è¿œçš„è¯·æ±‚ä½ç½®ï¼Œç„¶åŽç«‹å³åå‘ç§»åŠ¨ï¼Œè€Œä¸éœ€è¦ç§»åŠ¨åˆ°ç£ç›˜çš„æœ€å§‹ç«¯æˆ–æœ€æœ«ç«¯ï¼Œåå‘ç§»åŠ¨çš„é€”ä¸­ä¼šå“åº”è¯·æ±‚</p>
<p>è€Œé’ˆ C-SCAN ç®—æ³•çš„ä¼˜åŒ–åˆ™å« C-LOOKï¼Œå®ƒçš„å·¥ä½œæ–¹å¼ï¼Œç£å¤´åœ¨æ¯ä¸ªæ–¹å‘ä¸Šä»…ä»…ç§»åŠ¨åˆ°æœ€è¿œçš„è¯·æ±‚ä½ç½®ï¼Œç„¶åŽç«‹å³åå‘ç§»åŠ¨ï¼Œè€Œä¸éœ€è¦ç§»åŠ¨åˆ°ç£ç›˜çš„æœ€å§‹ç«¯æˆ–æœ€æœ«ç«¯ï¼Œ<strong>åå‘ç§»åŠ¨çš„é€”ä¸­ä¸ä¼šå“åº”è¯·æ±‚</strong>ã€‚</p>
</li>
</ul>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://zhuanlan.zhihu.com/p/225162322">å¤§åŽ‚é¢è¯•çˆ±é—®çš„ã€Œè°ƒåº¦ç®—æ³•ã€ï¼Œ20 å¼ å›¾ä¸€ä¸¾æ‹¿ä¸‹</a></li>
</ol>
<h4 id="å†…å­˜åˆ†é…ç®—æ³•">å†…å­˜åˆ†é…ç®—æ³•</h4>
<h5 id="é¦–æ¬¡é€‚åº”ç®—æ³•first-fit">é¦–æ¬¡é€‚åº”ç®—æ³•ï¼ˆFirst Fitï¼‰</h5>
<p>ä»Žç©ºé—²åˆ†åŒºè¡¨çš„ç¬¬ä¸€ä¸ªè¡¨ç›®èµ·æŸ¥æ‰¾è¯¥è¡¨ï¼ŒæŠŠæœ€å…ˆèƒ½å¤Ÿæ»¡è¶³è¦æ±‚çš„ç©ºé—²åŒºåˆ†é…ç»™ä½œä¸šï¼Œè¿™ç§æ–¹æ³•çš„ç›®çš„åœ¨äºŽå‡å°‘æŸ¥æ‰¾æ—¶é—´ã€‚ä¸ºé€‚åº”è¿™ç§ç®—æ³•ï¼Œç©ºé—²åˆ†åŒºè¡¨ï¼ˆç©ºé—²åŒºé“¾ï¼‰ä¸­çš„ç©ºé—²åˆ†åŒºè¦æŒ‰åœ°å€ç”±ä½Žåˆ°é«˜è¿›è¡ŒæŽ’åºã€‚è¯¥ç®—æ³•ä¼˜å…ˆä½¿ç”¨ä½Žå€éƒ¨åˆ†ç©ºé—²åŒºï¼Œåœ¨ä½Žå€ç©ºé—´é€ æˆè®¸å¤šå°çš„ç©ºé—²åŒºï¼Œåœ¨é«˜åœ°å€ç©ºé—´ä¿ç•™å¤§çš„ç©ºé—²åŒºã€‚</p>
<h5 id="æœ€ä½³é€‚åº”ç®—æ³•best-fit">æœ€ä½³é€‚åº”ç®—æ³•ï¼ˆBest Fit)</h5>
<p>ä»Žå…¨éƒ¨ç©ºé—²åŒºä¸­æ‰¾å‡ºèƒ½æ»¡è¶³ä½œä¸šè¦æ±‚çš„ã€ä¸”å¤§å°æœ€å°çš„ç©ºé—²åˆ†åŒºï¼Œè¿™ç§æ–¹æ³•èƒ½ä½¿ç¢Žç‰‡å°½é‡å°ã€‚ä¸ºé€‚åº”æ­¤ç®—æ³•ï¼Œç©ºé—²åˆ†åŒºè¡¨ï¼ˆç©ºé—²åŒºé“¾ï¼‰ä¸­çš„ç©ºé—²åˆ†åŒºè¦æŒ‰ä»Žå°åˆ°å¤§è¿›è¡ŒæŽ’åºï¼Œè‡ªè¡¨å¤´å¼€å§‹æŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„è‡ªç”±åˆ†åŒºåˆ†é…ã€‚è¯¥ç®—æ³•ä¿ç•™å¤§çš„ç©ºé—²åŒºï¼Œä½†é€ æˆè®¸å¤šå°çš„ç©ºé—²åŒºã€‚</p>
<h5 id="æœ€å·®é€‚åº”ç®—æ³•worst-fit">æœ€å·®é€‚åº”ç®—æ³•ï¼ˆWorst Fit)</h5>
<p>ä»Žå…¨éƒ¨ç©ºé—²åŒºä¸­æ‰¾å‡ºèƒ½æ»¡è¶³ä½œä¸šè¦æ±‚çš„ã€ä¸”å¤§å°æœ€å¤§çš„ç©ºé—²åˆ†åŒºï¼Œä»Žè€Œä½¿é“¾è¡¨ä¸­çš„ç»“ç‚¹å¤§å°è¶‹äºŽå‡åŒ€ï¼Œé€‚ç”¨äºŽè¯·æ±‚åˆ†é…çš„å†…å­˜å¤§å°èŒƒå›´è¾ƒçª„çš„ç³»ç»Ÿã€‚ä¸ºé€‚åº”æ­¤ç®—æ³•ï¼Œç©ºé—²åˆ†åŒºè¡¨ï¼ˆç©ºé—²åŒºé“¾ï¼‰ä¸­çš„ç©ºé—²åˆ†åŒºæŒ‰å¤§å°ä»Žå¤§åˆ°å°è¿›è¡ŒæŽ’åºï¼Œè‡ªè¡¨å¤´å¼€å§‹æŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„è‡ªç”±åˆ†åŒºåˆ†é…ã€‚è¯¥ç®—æ³•ä¿ç•™å°çš„ç©ºé—²åŒºï¼Œå°½é‡å‡å°‘å°çš„ç¢Žç‰‡äº§ç”Ÿã€‚</p>
<h5 id="ä¼™ä¼´ç®—æ³•buddy">ä¼™ä¼´ç®—æ³•ï¼ˆbuddyï¼‰</h5>
<p>ä½¿ç”¨äºŒè¿›åˆ¶ä¼˜åŒ–çš„æ€æƒ³ï¼Œå°†å†…å­˜ä»¥2çš„å¹‚ä¸ºå•ä½è¿›è¡Œåˆ†é…ï¼Œåˆå¹¶æ—¶åªèƒ½åˆå¹¶æ˜¯ä¼™ä¼´çš„å†…å­˜å—ï¼Œä¸¤ä¸ªå†…å­˜å—æ˜¯ä¼™ä¼´çš„ä¸‰ä¸ªæ¡ä»¶æ˜¯ï¼š</p>
<p>1.å¤§å°ç›¸ç­‰ï¼ˆå¾ˆå¥½åˆ¤æ–­ï¼‰</p>
<p>2.åœ°å€è¿žç»­ï¼ˆä¹Ÿå¾ˆå¥½åˆ¤æ–­ï¼‰</p>
<p>3.ä¸¤ä¸ªå†…å­˜å—åˆ†è£‚è‡ªåŒä¸€ä¸ªçˆ¶å—ï¼ˆå…¶å®žåªè¦åˆ¤æ–­ä½Žåœ°å€çš„å†…å­˜å—é¦–åœ°å€æ˜¯å¦æ˜¯ä¸Žçˆ¶å—åœ°å€å¯¹é½ï¼Œå³åˆå¹¶åŽçš„é¦–åœ°å€ä¸ºçˆ¶å—å¤§å°çš„æ•´æ•°å€ï¼‰ä½¿ç”¨lowbitç­‰ä½è¿ç®—å¯ä»¥o(1)åˆ¤æ–­ã€‚</p>
<p>ä¼™ä¼´ç®—æ³•åœ¨å®žçŽ°çš„æ—¶å€™å¯ä»¥ä½¿ç”¨æ•°ç»„+é“¾è¡¨çš„å½¢å¼ï¼ˆæœ‰ç‚¹åƒé‚»æŽ¥è¡¨é‚£ç§ï¼‰ï¼Œå› ä¸ºå†…å­˜ä¸Šé™æ˜¯å›ºå®šçš„ï¼Œæ¯”è¾ƒå®¹æ˜“ç¡®å®šã€‚ä¸‹åˆ—ä»£ç ä½¿ç”¨çš„æ˜¯äºŒç»´é“¾è¡¨ï¼ˆå†™èµ·æ¥å°±æ²¡æœ‰æ•°ç»„åŠ é“¾è¡¨ç®€æ´ï¼‰ã€‚åœ¨åˆ†é…è°ƒæ•´å†…å­˜å—æ—¶ä½¿ç”¨äº†é€’å½’ï¼Œå¦‚æžœéœ€è¦æé«˜æ•ˆçŽ‡å¯ä»¥æ”¹ä¸ºå¾ªçŽ¯ï¼ˆé€’å½’æ›´èƒ½ä½“çŽ°å‡ºæ€æƒ³ä¸”ä»£ç ç®€å•ï¼Œå¾ªçŽ¯æ•ˆçŽ‡æ›´é«˜ä½†æ˜¯å¤æ‚ä¸€ä¸¢ä¸¢ï¼Œè‡ªè¡Œé€‰å–ï¼‰ã€‚</p>
<h5 id="slabåˆ†é…ç®—æ³•">Slabåˆ†é…ç®—æ³•</h5>
<h5 id="cmaç®—æ³•">CMAç®—æ³•</h5>
<p>åº”ç”¨ç¨‹åºä¸­ç”³è¯·ä¸€å—å†…å­˜ï¼Œåœ¨åº”ç”¨ç¨‹åºçœ‹æ¥æ˜¯è¿žç»­çš„ï¼Œå› ä¸ºè™šæ‹Ÿåœ°å€æœ¬èº«æ˜¯è¿žç»­çš„ï¼Œä½†å®žé™…çš„å†…å­˜ç©ºé—´ä¸­ï¼Œæ‰€ç”³è¯·çš„è¿™ç‰‡å†…å­˜æœªå¿…æ˜¯è¿žç»­çš„ï¼Œä¸è¿‡è¿™å¯¹åº”ç”¨ç¨‹åºæ¥è¯´æ˜¯æ²¡å…³ç³»çš„ï¼Œå› ä¸ºåº”ç”¨ç¨‹åºä¸éœ€è¦å…³å¿ƒå®žé™…çš„å†…å­˜æƒ…å†µï¼Œåªè¦MMUæŠŠç‰©ç†åœ°å€æ˜ å°„æˆè™šæ‹Ÿåœ°å€å°±å¥½äº†ã€‚ä½†æ˜¯å¦‚æžœæ²¡æœ‰MMUçš„æƒ…å†µå‘¢ï¼Œæˆ‘ä»¬åˆéœ€è¦ä¸€ç‰‡è¿žç»­çš„å†…å­˜ç©ºé—´ï¼Œæ¯”å¦‚è®¾å¤‡é€šè¿‡DMAç›´æŽ¥è®¿é—®å†…å­˜ï¼Œè¿™ç§æƒ…å†µä¸‹åº”è¯¥æ€Žä¹ˆåŠžå‘¢ï¼Ÿ</p>
<p>CMAæœºåˆ¶å°±æ˜¯ä¸ºäº†è§£å†³ä¸Šé¢æåˆ°çš„é—®é¢˜è€Œäº§ç”Ÿçš„ã€‚DMA zoneå¹¶ä¸æ˜¯DMAä¸“å±žï¼Œå…¶å®ƒçš„ç¨‹åºä¹Ÿå¯ä»¥ç”³è¯·è¯¥zoneçš„å†…å­˜ï¼Œå¦‚æžœå½“è®¾å¤‡è¦ç”³è¯·DMA zoneç©ºé—´çš„ä¸€å¤§ç‰‡è¿žç»­çš„å†…å­˜æ—¶å€™ï¼Œå·²ç»æ²¡æœ‰è¿žç»­çš„å¤§ç‰‡å†…å­˜äº†ï¼Œåªæœ‰1é¡µï¼Œ2é¡µï¼Œ4é¡µçš„è¿™ç§è¿žç»­çš„å°å†…å­˜ã€‚è§£å†³åŠžæ³•å°±æ˜¯æˆ‘ä»¬æ ‡è®°æŸä¸€ç‰‡è¿žç»­åŒºåŸŸä¸ºCMAåŒºåŸŸï¼Œè¿™éƒ¨åˆ†åŒºåŸŸåœ¨æ²¡æœ‰å¤§ç‰‡è¿žç»­å†…å­˜ç”³è¯·çš„æ—¶å€™åªç»™moveableçš„ç¨‹åºä½¿ç”¨ï¼Œå½“å¤§ç‰‡è¿žç»­å†…å­˜è¯·æ±‚æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬åŽ»è¿™ç‰‡åŒºåŸŸï¼ŒæŠŠæ‰€æœ‰moveableçš„å°ç‰‡å†…å­˜ç§»åŠ¨åˆ°å…¶å®ƒçš„éžCMAåŒºåŸŸï¼Œæ›´æ”¹å¯¹åº”çš„ç¨‹åºçš„é¡µè¡¨ï¼Œç„¶åŽå†æŠŠç©ºå‡ºæ¥çš„CMAåŒºåŸŸç»™è®¾å¤‡ï¼Œä»Žè€Œå®žçŽ°äº†DMAå¤§ç‰‡è¿žç»­å†…å­˜çš„åˆ†é…ã€‚</p>
<p>CMAæœºåˆ¶å¹¶ä¸æ˜¯å•ç‹¬å­˜åœ¨çš„ï¼Œå®ƒé€šå¸¸æœåŠ¡äºŽDMAè®¾å¤‡ï¼Œåœ¨è®¾å¤‡è°ƒç”¨dma_alloc_coherentå‡½æ•°ç”³è¯·ä¸€å—å†…å­˜åŽï¼Œä¸ºäº†å¾—åˆ°ä¸€ç‰‡è¿žç»­çš„å†…å­˜ï¼ŒCMAæœºåˆ¶è¢«è°ƒç”¨ï¼Œå®ƒä¿è¯äº†ç”³è¯·çš„å†…å­˜çš„è¿žç»­æ€§ã€‚</p>
<p>å¦å¤–CMAåŒºåŸŸé€šå¸¸è¢«åˆ†é…åœ¨é«˜ç«¯å†…å­˜ã€‚</p>
<p><img src="https://upload-images.jianshu.io/upload_images/2828107-ebcd8491916f38d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/554/format/webp" alt="img" /></p>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://blog.csdn.net/GreyBtfly/article/details/84646981">å†…å­˜åˆ†é…ç®—æ³•â€”â€”FFã€BFã€WFã€buddyï¼ˆä¼™ä¼´ç®—æ³•ï¼‰</a></li>
<li><a href="https://www.jianshu.com/p/271c316b53ef">Linuxå­¦ä¹ -å†…å­˜ç®¡ç†ç¯‡ï¼ˆå››ï¼‰-å†…å­˜åˆ†é…ç®—æ³•</a></li>
</ol>
<h4 id="ä¼™ä¼´ç®—æ³•å’Œslabç®—æ³•">ä¼™ä¼´ç®—æ³•å’Œslabç®—æ³•</h4>
<h5 id="ä¼™ä¼´ç®—æ³•buddyåˆ†é…ç®—æ³•">ä¼™ä¼´ç®—æ³•(Buddyåˆ†é…ç®—æ³•)</h5>
<p><strong>ä½œç”¨</strong></p>
<p>å®ƒè¦è§£å†³çš„é—®é¢˜æ˜¯<strong>é¢‘ç¹åœ°è¯·æ±‚å’Œé‡Šæ”¾ä¸åŒå¤§å°çš„ä¸€ç»„è¿žç»­é¡µæ¡†ï¼Œå¿…ç„¶å¯¼è‡´åœ¨å·²åˆ†é…é¡µæ¡†çš„å—å†…åˆ†æ•£äº†è®¸å¤šå°å—çš„ç©ºé—²é¡µé¢</strong>ï¼Œç”±æ­¤å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œ<strong>å³ä½¿æœ‰è¶³å¤Ÿçš„ç©ºé—²é¡µæ¡†å¯ä»¥æ»¡è¶³è¯·æ±‚ï¼Œä½†è¦åˆ†é…ä¸€ä¸ªå¤§å—çš„è¿žç»­é¡µæ¡†å¯èƒ½æ— æ³•æ»¡è¶³è¯·æ±‚</strong>ã€‚(<em>è§£å†³ç¢Žç‰‡é—®é¢˜</em>)</p>
<p><strong>æµç¨‹</strong></p>
<p>ä¼™ä¼´ç®—æ³•ï¼ˆBuddy systemï¼‰æŠŠæ‰€æœ‰çš„ç©ºé—²é¡µæ¡†åˆ†ä¸º11ä¸ªå—é“¾è¡¨ï¼Œæ¯å—é“¾è¡¨ä¸­åˆ†å¸ƒåŒ…å«ç‰¹å®šçš„è¿žç»­é¡µæ¡†åœ°å€ç©ºé—´ï¼Œæ¯”å¦‚ç¬¬0ä¸ªå—é“¾è¡¨åŒ…å«å¤§å°ä¸º2^0ä¸ªè¿žç»­çš„é¡µæ¡†ï¼Œç¬¬1ä¸ªå—é“¾è¡¨ä¸­ï¼Œæ¯ä¸ªé“¾è¡¨å…ƒç´ åŒ…å«2ä¸ªé¡µæ¡†å¤§å°çš„è¿žç»­åœ°å€ç©ºé—´ï¼Œâ€¦.ï¼Œç¬¬10ä¸ªå—é“¾è¡¨ä¸­ï¼Œæ¯ä¸ªé“¾è¡¨å…ƒç´ ä»£è¡¨4Mçš„è¿žç»­åœ°å€ç©ºé—´ã€‚æ¯ä¸ªé“¾è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°åœ¨ç³»ç»Ÿåˆå§‹åŒ–æ—¶å†³å®šï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒåŠ¨æ€å˜åŒ–ã€‚</p>
<p>ä¼™ä¼´ç®—æ³•æ¯æ¬¡åªèƒ½åˆ†é…2çš„å¹‚æ¬¡é¡µçš„ç©ºé—´ï¼Œæ¯”å¦‚ä¸€æ¬¡åˆ†é…1é¡µï¼Œ2é¡µï¼Œ4é¡µï¼Œ8é¡µï¼Œâ€¦ï¼Œ1024é¡µ(2^10)ç­‰ç­‰ï¼Œæ¯é¡µå¤§å°ä¸€èˆ¬ä¸º4Kï¼Œå› æ­¤ï¼Œä¼™ä¼´ç®—æ³•æœ€å¤šä¸€æ¬¡èƒ½å¤Ÿåˆ†é…4Mçš„å†…å­˜ç©ºé—´ã€‚</p>
<img src="https://i.loli.net/2020/11/02/4YEQR5vUJkciONW.png" alt="image" style="zoom: 67%;" />
<p><strong>ç”³è¯·å’Œå›žæ”¶è¿‡ç¨‹</strong></p>
<p>æ¯”å¦‚ï¼Œæˆ‘è¦åˆ†é…4(2^2)é¡µï¼ˆ16kï¼‰çš„å†…å­˜ç©ºé—´ï¼Œç®—æ³•ä¼šå…ˆä»Žfree_area[2]ä¸­æŸ¥çœ‹nr_freeæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æžœæœ‰ç©ºé—²å—ï¼Œåˆ™ä»Žä¸­åˆ†é…ï¼Œå¦‚æžœæ²¡æœ‰ç©ºé—²å—ï¼Œå°±ä»Žå®ƒçš„ä¸Šä¸€çº§free_area[3]ï¼ˆæ¯å—32Kï¼‰ä¸­åˆ†é…å‡º16Kï¼Œå¹¶å°†å¤šä½™çš„å†…å­˜ï¼ˆ16Kï¼‰åŠ å…¥åˆ°free_area[2]ä¸­åŽ»ã€‚å¦‚æžœfree_area[3]ä¹Ÿæ²¡æœ‰ç©ºé—²ï¼Œåˆ™ä»Žæ›´ä¸Šä¸€çº§ç”³è¯·ç©ºé—´ï¼Œä¾æ¬¡é€’æŽ¨ï¼Œç›´åˆ°free_area[max_order]ï¼Œå¦‚æžœé¡¶çº§éƒ½æ²¡æœ‰ç©ºé—´ï¼Œé‚£ä¹ˆå°±æŠ¥å‘Šåˆ†é…å¤±è´¥ã€‚</p>
<p>é‡Šæ”¾æ˜¯ç”³è¯·çš„é€†è¿‡ç¨‹ï¼Œå½“é‡Šæ”¾ä¸€ä¸ªå†…å­˜å—æ—¶ï¼Œå…ˆåœ¨å…¶å¯¹äºŽçš„free_areaé“¾è¡¨ä¸­æŸ¥æ‰¾æ˜¯å¦æœ‰ä¼™ä¼´å­˜åœ¨ï¼Œå¦‚æžœæ²¡æœ‰ä¼™ä¼´å—ï¼Œç›´æŽ¥å°†é‡Šæ”¾çš„å—æ’å…¥é“¾è¡¨å¤´ã€‚å¦‚æžœæœ‰æˆ–æ¿å—çš„å­˜åœ¨ï¼Œåˆ™å°†å…¶ä»Žé“¾è¡¨æ‘˜ä¸‹ï¼Œåˆå¹¶æˆä¸€ä¸ªå¤§å—ï¼Œç„¶åŽç»§ç»­æŸ¥æ‰¾åˆå¹¶åŽçš„å—åœ¨æ›´å¤§ä¸€çº§é“¾è¡¨ä¸­æ˜¯å¦æœ‰ä¼™ä¼´çš„å­˜åœ¨ï¼Œç›´è‡³ä¸èƒ½åˆå¹¶æˆ–è€…å·²ç»åˆå¹¶è‡³æœ€å¤§å—2^10ä¸ºæ­¢ã€‚</p>
<p>å†…æ ¸è¯•å›¾å°†å¤§å°ä¸ºbçš„ä¸€å¯¹ç©ºé—²å—ï¼ˆä¸€ä¸ªæ˜¯çŽ°æœ‰ç©ºé—²é“¾è¡¨ä¸Šçš„ï¼Œä¸€ä¸ªæ˜¯å¾…å›žæ”¶çš„ï¼‰ï¼Œåˆå¹¶ä¸ºä¸€ä¸ªå¤§å°ä¸º2Bçš„å•ç‹¬å—ï¼Œå¦‚æžœå®ƒæˆåŠŸåˆå¹¶æ‰€é‡Šæ”¾çš„å—ï¼Œå®ƒä¼šè¯•å›¾åˆå¹¶2bå¤§å°çš„å—ï¼Œ</p>
<p><strong>ä¼™ä¼´ç®—æ³•çš„ä¼˜ç¼ºç‚¹</strong></p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>è¾ƒå¥½çš„è§£å†³å¤–éƒ¨ç¢Žç‰‡é—®é¢˜</li>
<li>å½“éœ€è¦åˆ†é…è‹¥å¹²ä¸ªå†…å­˜é¡µé¢æ—¶ï¼Œç”¨äºŽDMAçš„å†…å­˜é¡µé¢å¿…é¡»è¿žç»­ï¼Œä¼™ä¼´ç®—æ³•å¾ˆå¥½çš„æ»¡è¶³äº†è¿™ä¸ªè¦æ±‚</li>
<li>åªè¦è¯·æ±‚çš„å—ä¸è¶…è¿‡512ä¸ªé¡µé¢(2K)ï¼Œå†…æ ¸å°±å°½é‡åˆ†é…è¿žç»­çš„é¡µé¢ã€‚</li>
<li>é’ˆå¯¹å¤§å†…å­˜åˆ†é…è®¾è®¡ã€‚</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>åˆå¹¶çš„è¦æ±‚å¤ªè¿‡ä¸¥æ ¼ï¼Œåªèƒ½æ˜¯æ»¡è¶³ä¼™ä¼´å…³ç³»çš„å—æ‰èƒ½åˆå¹¶ï¼Œæ¯”å¦‚ç¬¬1å—å’Œç¬¬2å—å°±ä¸èƒ½åˆå¹¶ã€‚</li>
<li>ç¢Žç‰‡é—®é¢˜ï¼šä¸€ä¸ªè¿žç»­çš„å†…å­˜ä¸­ä»…ä»…ä¸€ä¸ªé¡µé¢è¢«å ç”¨ï¼Œå¯¼è‡´æ•´å—å†…å­˜åŒºéƒ½ä¸å…·å¤‡åˆå¹¶çš„æ¡ä»¶(å†…éƒ¨ç¢Žç‰‡é—®é¢˜)</li>
<li>æµªè´¹é—®é¢˜ï¼šä¼™ä¼´ç®—æ³•åªèƒ½åˆ†é…2çš„å¹‚æ¬¡æ–¹å†…å­˜åŒºï¼Œå½“éœ€è¦8Kï¼ˆ2é¡µï¼‰æ—¶ï¼Œå¥½è¯´ï¼Œå½“éœ€è¦9Kæ—¶ï¼Œé‚£å°±éœ€è¦åˆ†é…16Kï¼ˆ4é¡µï¼‰çš„å†…å­˜ç©ºé—´ï¼Œä½†æ˜¯å®žé™…åªç”¨åˆ°9Kç©ºé—´ï¼Œå¤šä½™çš„7Kç©ºé—´å°±è¢«æµªè´¹æŽ‰ã€‚</li>
<li>ç®—æ³•çš„æ•ˆçŽ‡é—®é¢˜ï¼š ä¼™ä¼´ç®—æ³•æ¶‰åŠäº†æ¯”è¾ƒå¤šçš„è®¡ç®—è¿˜æœ‰é“¾è¡¨å’Œä½å›¾çš„æ“ä½œï¼Œå¼€é”€è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œå¦‚æžœæ¯æ¬¡2^nå¤§å°çš„ä¼™ä¼´å—å°±ä¼šåˆå¹¶åˆ°2^(n+1)çš„é“¾è¡¨é˜Ÿåˆ—ä¸­ï¼Œé‚£ä¹ˆ2^nå¤§å°é“¾è¡¨ä¸­çš„å—å°±ä¼šå› ä¸ºåˆå¹¶æ“ä½œè€Œå‡å°‘ï¼Œä½†ç³»ç»ŸéšåŽç«‹å³æœ‰å¯èƒ½åˆæœ‰å¯¹è¯¥å¤§å°å—çš„éœ€æ±‚ï¼Œä¸ºæ­¤å¿…é¡»å†ä»Ž2^(n+1)å¤§å°çš„é“¾è¡¨ä¸­æ‹†åˆ†ï¼Œè¿™æ ·çš„åˆå¹¶åˆç«‹å³æ‹†åˆ†çš„è¿‡ç¨‹æ˜¯æ— æ•ˆçŽ‡çš„ã€‚</li>
</ul>
<p>Linuxé’ˆå¯¹å¤§å†…å­˜çš„ç‰©ç†åœ°å€åˆ†é…ï¼Œé‡‡ç”¨ä¼™ä¼´ç®—æ³•ï¼Œå¦‚æžœæ˜¯é’ˆå¯¹å°äºŽä¸€ä¸ªpageçš„å†…å­˜ï¼Œé¢‘ç¹çš„åˆ†é…å’Œé‡Šæ”¾ï¼Œæœ‰æ›´åŠ é€‚å®œçš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚slabå’Œ<code>kmem_cache</code>ç­‰ã€‚</p>
<h5 id="slabåˆ†é…ç®—æ³•-1">Slabåˆ†é…ç®—æ³•</h5>
<p>åœ¨Linuxä¸­ï¼Œä¼™ä¼´ç³»ç»Ÿï¼ˆbuddy systemï¼‰æ˜¯ä»¥é¡µä¸ºå•ä½ç®¡ç†å’Œåˆ†é…å†…å­˜ã€‚ä½†æ˜¯çŽ°å®žçš„éœ€æ±‚å´ä»¥å­—èŠ‚ä¸ºå•ä½ï¼Œå‡å¦‚æˆ‘ä»¬éœ€è¦ç”³è¯·20Bytesï¼Œæ€»ä¸èƒ½åˆ†é…ä¸€é¡µå§ï¼é‚£å²‚ä¸æ˜¯ä¸¥é‡æµªè´¹å†…å­˜ã€‚é‚£ä¹ˆè¯¥å¦‚ä½•åˆ†é…å‘¢ï¼Ÿslabåˆ†é…å™¨å°±åº”è¿è€Œç”Ÿäº†ï¼Œä¸“ä¸ºå°å†…å­˜åˆ†é…è€Œç”Ÿã€‚slabåˆ†é…å™¨åˆ†é…å†…å­˜ä»¥Byteä¸ºå•ä½ã€‚ä½†æ˜¯slabåˆ†é…å™¨å¹¶æ²¡æœ‰è„±ç¦»ä¼™ä¼´ç³»ç»Ÿï¼Œè€Œæ˜¯åŸºäºŽä¼™ä¼´ç³»ç»Ÿåˆ†é…çš„å¤§å†…å­˜è¿›ä¸€æ­¥ç»†åˆ†æˆå°å†…å­˜åˆ†é…ã€‚</p>
<p>linux æ‰€ä½¿ç”¨çš„ slab åˆ†é…å™¨çš„åŸºç¡€æ˜¯ Jeff Bonwick ä¸ºSunOS æ“ä½œç³»ç»Ÿé¦–æ¬¡å¼•å…¥çš„ä¸€ç§ç®—æ³•ã€‚Jeffçš„åˆ†é…å™¨æ˜¯å›´ç»•å¯¹è±¡ç¼“å­˜è¿›è¡Œçš„ã€‚åœ¨å†…æ ¸ä¸­ï¼Œä¼šä¸ºæœ‰é™çš„å¯¹è±¡é›†ï¼ˆä¾‹å¦‚æ–‡ä»¶æè¿°ç¬¦å’Œå…¶ä»–å¸¸è§ç»“æž„ï¼‰åˆ†é…å¤§é‡å†…å­˜ã€‚Jeffå‘çŽ°å¯¹å†…æ ¸ä¸­**æ™®é€šå¯¹è±¡è¿›è¡Œåˆå§‹åŒ–æ‰€éœ€çš„æ—¶é—´è¶…è¿‡äº†å¯¹å…¶è¿›è¡Œåˆ†é…å’Œé‡Šæ”¾æ‰€éœ€çš„æ—¶é—´ã€‚<strong>å› æ­¤ä»–çš„ç»“è®ºæ˜¯</strong>ä¸åº”è¯¥å°†å†…å­˜é‡Šæ”¾å›žä¸€ä¸ªå…¨å±€çš„å†…å­˜æ± ï¼Œè€Œæ˜¯å°†å†…å­˜ä¿æŒä¸ºé’ˆå¯¹ç‰¹å®šç›®è€Œåˆå§‹åŒ–çš„çŠ¶æ€ã€‚**ä¾‹å¦‚ï¼Œå¦‚æžœå†…å­˜è¢«åˆ†é…ç»™äº†ä¸€ä¸ªäº’æ–¥é”ï¼Œé‚£ä¹ˆåªéœ€åœ¨ä¸ºäº’æ–¥é”é¦–æ¬¡åˆ†é…å†…å­˜æ—¶æ‰§è¡Œä¸€æ¬¡äº’æ–¥é”åˆå§‹åŒ–å‡½æ•°ï¼ˆmutex_initï¼‰å³å¯ã€‚åŽç»­çš„å†…å­˜åˆ†é…ä¸éœ€è¦æ‰§è¡Œè¿™ä¸ªåˆå§‹åŒ–å‡½æ•°ï¼Œå› ä¸ºä»Žä¸Šæ¬¡é‡Šæ”¾å’Œè°ƒç”¨æžæž„ä¹‹åŽï¼Œå®ƒå·²ç»å¤„äºŽæ‰€éœ€çš„çŠ¶æ€ä¸­äº†ã€‚</p>
<p>slabå±‚ä¸»è¦èµ·åˆ°äº†ä¸¤ä¸ªæ–¹é¢çš„ä½œç”¨ï¼š</p>
<ol>
<li>
<p>slabå¯ä»¥å¯¹å°å¯¹è±¡è¿›è¡Œåˆ†é…ï¼Œè¿™æ ·å°±ä¸ç”¨ä¸ºæ¯ä¸ªå°å¯¹è±¡åˆ†é…ä¸€ä¸ªé¡µæ¡†ï¼ŒèŠ‚çœäº†ç©ºé—´ã€‚</p>
</li>
<li>
<p>å†…æ ¸ä¸­çš„ä¸€äº›å°å¯¹è±¡åˆ›å»ºæžæž„å¾ˆé¢‘ç¹ï¼Œslabå¯¹è¿™äº›å°å¯¹è±¡åšäº†ç¼“å­˜ï¼Œå¯ä»¥é‡å¤åˆ©ç”¨ä¸€äº›ç›¸åŒçš„å¯¹è±¡ï¼Œå‡å°‘å†…å­˜åˆ†é…æ¬¡æ•°ã€‚</p>
</li>
</ol>
<img src="https://i.loli.net/2020/11/02/YhZXSNgnlsdBIA1.jpg" alt="Slabç®—æ³•" style="zoom:150%;" />
<p>å›¾ä¸­ç»™å‡ºäº† slabç»“æž„çš„é«˜å±‚ç»„ç»‡ç»“æž„ã€‚åœ¨æœ€é«˜å±‚æ˜¯ cache_chainï¼Œè¿™æ˜¯ä¸€ä¸ª slab ç¼“å­˜çš„é“¾æŽ¥åˆ—è¡¨ã€‚cache_chain çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ª <code>kmem_cache</code> ç»“æž„çš„å¼•ç”¨ï¼ˆç§°ä¸ºä¸€ä¸ª cacheï¼‰ã€‚å®ƒå®šä¹‰äº†ä¸€ä¸ªè¦ç®¡ç†çš„ç»™å®šå¤§å°çš„å¯¹è±¡æ± ã€‚</p>
<p>æ¯ä¸ªç¼“å­˜éƒ½åŒ…å«äº†ä¸€ä¸ª slabs åˆ—è¡¨ï¼Œè¿™æ˜¯ä¸€æ®µè¿žç»­çš„å†…å­˜å—ï¼ˆé€šå¸¸éƒ½æ˜¯é¡µé¢ï¼‰ã€‚å­˜åœ¨3 ç§ slabï¼š</p>
<p><strong>slabs_full</strong>:å®Œå…¨åˆ†é…çš„slab</p>
<p><strong>slabs_partial</strong>:éƒ¨åˆ†åˆ†é…çš„slab</p>
<p><strong>slabs_empty</strong>:ç©ºslabï¼Œæˆ–è€…æ²¡æœ‰å¯¹è±¡è¢«åˆ†é…</p>
<p>slab åˆ—è¡¨ä¸­çš„æ¯ä¸ª slabéƒ½æ˜¯ä¸€ä¸ªè¿žç»­çš„å†…å­˜å—ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªè¿žç»­é¡µï¼‰ï¼Œå®ƒä»¬è¢«åˆ’åˆ†æˆä¸€ä¸ªä¸ªå¯¹è±¡ã€‚è¿™äº›å¯¹è±¡æ˜¯ä»Žç‰¹å®šç¼“å­˜ä¸­è¿›è¡Œåˆ†é…å’Œé‡Šæ”¾çš„åŸºæœ¬å…ƒç´ ã€‚æ³¨æ„ slab æ˜¯ slabåˆ†é…å™¨è¿›è¡Œæ“ä½œçš„æœ€å°åˆ†é…å•ä½ï¼Œå› æ­¤å¦‚æžœéœ€è¦å¯¹ slab è¿›è¡Œæ‰©å±•ï¼Œè¿™ä¹Ÿå°±æ˜¯æ‰€æ‰©å±•çš„æœ€å°å€¼ã€‚é€šå¸¸æ¥è¯´ï¼Œæ¯ä¸ª slab è¢«åˆ†é…ä¸ºå¤šä¸ªå¯¹è±¡ã€‚</p>
<p>ç”±äºŽå¯¹è±¡æ˜¯ä»Ž slab ä¸­è¿›è¡Œåˆ†é…å’Œé‡Šæ”¾çš„ï¼Œå› æ­¤å•ä¸ª slab å¯ä»¥åœ¨ slabåˆ—è¡¨ä¹‹é—´è¿›è¡Œç§»åŠ¨ã€‚ä¾‹å¦‚ï¼Œ<strong>å½“ä¸€ä¸ª slabä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½è¢«ä½¿ç”¨å®Œæ—¶ï¼Œå°±ä»Žslabs_partial åˆ—è¡¨ä¸­ç§»åŠ¨åˆ° slabs_full åˆ—è¡¨ä¸­</strong>ã€‚<strong>å½“ä¸€ä¸ª slabå®Œå…¨è¢«åˆ†é…å¹¶ä¸”æœ‰å¯¹è±¡è¢«é‡Šæ”¾åŽï¼Œå°±ä»Ž slabs_full åˆ—è¡¨ä¸­ç§»åŠ¨åˆ°slabs_partial åˆ—è¡¨ä¸­</strong>ã€‚å½“æ‰€æœ‰å¯¹è±¡éƒ½è¢«é‡Šæ”¾ä¹‹åŽï¼Œå°±ä»Ž slabs_partial åˆ—è¡¨ç§»åŠ¨åˆ° slabs_empty åˆ—è¡¨ä¸­ã€‚</p>
<p><strong>slabèƒŒåŽçš„åŠ¨æœº</strong></p>
<p>â€‹	ä¸Žä¼ ç»Ÿçš„å†…å­˜ç®¡ç†æ¨¡å¼ç›¸æ¯”ï¼Œ slabç¼“å­˜åˆ†é…å™¨æä¾›äº†å¾ˆå¤šä¼˜ç‚¹ã€‚é¦–å…ˆï¼Œå†…æ ¸é€šå¸¸ä¾èµ–äºŽå¯¹å°å¯¹è±¡çš„åˆ†é…ï¼Œå®ƒä»¬ä¼šåœ¨ç³»ç»Ÿç”Ÿå‘½å‘¨æœŸå†…è¿›è¡Œæ— æ•°æ¬¡åˆ†é…ã€‚slabç¼“å­˜åˆ†é…å™¨é€šè¿‡å¯¹ç±»ä¼¼å¤§å°çš„å¯¹è±¡è¿›è¡Œç¼“å­˜è€Œæä¾›è¿™ç§åŠŸèƒ½ï¼Œä»Žè€Œé¿å…äº†å¸¸è§çš„ç¢Žç‰‡é—®é¢˜ã€‚slabåˆ†é…å™¨è¿˜æ”¯æŒé€šç”¨å¯¹è±¡çš„åˆå§‹åŒ–ï¼Œä»Žè€Œé¿å…äº†ä¸ºåŒä¸€ç›®è€Œå¯¹ä¸€ä¸ªå¯¹è±¡é‡å¤è¿›è¡Œåˆå§‹åŒ–ã€‚</p>
<p><strong>slabæè¿°ç¬¦</strong></p>
<p><img src="https://i.loli.net/2020/11/02/aW8B47R12zAwQPt.png" alt="img" /></p>
<p>æ—¢ç„¶æ˜¯å¯¹å¯¹è±¡è¿›è¡Œç®¡ç†ï¼Œé‚£ä¹ˆå°±æœ‰ä¸€ä¸ªå†…å­˜çš„æŒ‡é’ˆæŒ‡å‘å®ƒæ‰€ç®¡ç†çš„å¯¹è±¡ï¼švoid* s_memã€‚å¹¶ä¸”å®ƒè¿˜éœ€è¦è®°å½•å“ªäº›å¯¹è±¡è¢«ä½¿ç”¨äº†ï¼Œå“ªäº›æ˜¯ç©ºé—²çš„ã€‚è¿™æ—¶å°±éœ€è¦æœ‰ä¸€ä¸ªæ•°ç»„è®°å½•è¿™ä¸ªä¸œè¥¿ï¼Œè¿™å°±æ˜¯freeå˜é‡ã€‚ä½ å¯èƒ½ä¼šå¥‡æ€ªå®ƒçš„ç±»åž‹æ˜¯ä¸€ä¸ªunsigned intï¼š</p>
<p><img src="https://images2015.cnblogs.com/blog/646262/201707/646262-20170704153228940-417998395.png" alt="img" /></p>
<p>å®ƒæ˜¯å¦‚ä½•è®°å½•è¿™ä¸ªæ•°ç»„çš„å‘¢ï¼Ÿäº‹å®žä¸Šæ˜¯è®°å½•åœ¨slabæè¿°ç¬¦åŽé¢çš„æ•°ç»„ä¸­ï¼Œè¿™ä¸ªæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ è®°å½•ç€ä¸‹ä¸€ä¸ªç©ºé—²çš„å†…å­˜å¯¹è±¡çš„ä½ç½®ã€‚è€Œfreeè®°å½•çš„å°±æ˜¯ç¬¬ä¸€ä¸ªç©ºé—²çš„å¯¹è±¡ã€‚è¿™æ ·å°±å¯ä»¥ä»Žfreeå¼€å§‹éåŽ†æ‰€æœ‰ç©ºé—²çš„å¯¹è±¡ã€‚</p>
<p>ä¸‹å›¾æ˜¾ç¤ºäº†slabå¯¹è±¡çš„å†…å­˜åˆ†å¸ƒï¼Œè¿™é‡Œéœ€è¦è§£é‡Šä¸€ä¸‹çš„æ˜¯slab descriptorä¼šæ ¹æ®æƒ…å†µè¢«å­˜æ”¾åœ¨å½“å‰slabçš„å†…å­˜ä¸­æˆ–è€…å­˜æ”¾åœ¨é€šç”¨çš„é«˜é€Ÿç¼“å­˜ä¸­ã€‚</p>
<p><img src="https://i.loli.net/2020/11/02/2UGgpLHXZR89i3E.png" alt="Slabå¯¹è±¡åˆ†å¸ƒ" /></p>
<h5 id="slabä¸Žbuddyçš„å…³ç³»">Slabä¸ŽBuddyçš„å…³ç³»</h5>
<ul>
<li>slabä¸ŽBuddyéƒ½æ˜¯å†…å­˜åˆ†é…å™¨ã€‚</li>
<li>slabçš„å†…å­˜æ¥è‡ªBuddy</li>
<li>slabä¸ŽBuddyåœ¨ç®—æ³•ä¸Šçº§åˆ«å¯¹ç­‰ã€‚BuddyæŠŠå†…å­˜æ¡å½“ä½œä¸€ä¸ªæ± å­æ¥ç®¡ç†ï¼Œslabæ˜¯æŠŠä»ŽBuddyæ‹¿</li>
<li>åˆ°çš„å†…å­˜å½“ä½œä¸€ä¸ªæ± å­æ¥ç®¡ç†çš„</li>
</ul>
<hr />
<p>å‚è€ƒé“¾æŽ¥ï¼š</p>
<ol>
<li><a href="https://www.cnblogs.com/cherishui/p/4246133.html">Linux ä¼™ä¼´ç®—æ³•ç®€ä»‹</a></li>
<li><a href="https://www.cnblogs.com/ljygoodgoodstudydaydayup/p/7116858.html">ä¼™ä¼´ç®—æ³•ä¸Žslabç®—æ³•</a></li>
</ol>
<h4 id="mmapå’Œbrkçš„åŒºåˆ«">mmapå’Œbrkçš„åŒºåˆ«</h4>
<p>ä»Žæ“ä½œç³»ç»Ÿè§’åº¦æ¥çœ‹ï¼Œè¿›ç¨‹åˆ†é…å†…å­˜æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«ç”±ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨å®Œæˆï¼š<code>brk</code>å’Œ<code>mmap</code>ï¼ˆä¸è€ƒè™‘å…±äº«å†…å­˜ï¼‰ã€‚</p>
<ol>
<li>**<code>brk</code>**æ˜¯å°†æ•°æ®æ®µ(.<code>data</code>)çš„æœ€é«˜åœ°å€æŒ‡é’ˆ<code>_edata</code>å¾€é«˜åœ°å€æŽ¨ï¼›<br />
è¿™æ˜¯ <code>brk</code> çš„å†…å­˜åˆ†é…æ–¹å¼ï¼Œå¯ä»¥çœ‹åˆ°Aã€Bæ–°ç”³è¯·çš„å†…å­˜éƒ½ä»Žå †çš„åº•éƒ¨ï¼ˆå †çš„åœ°å€ç”Ÿé•¿æ˜¯ä»Žä½Žåˆ°é«˜çš„ï¼‰å¼€å§‹å‘ä¸Šç”Ÿé•¿ã€‚<br />
å¦‚æžœæ­¤æ—¶ free(A)ï¼ŒAçš„å†…å­˜å¹¶ä¸ä¼šè¢«é‡Šæ”¾ï¼Œè€Œæ˜¯ä¼šè¢«å›žæ”¶ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡çš„åˆ©ç”¨ï¼Œæˆ–è€…è¯´æ˜¯ç­‰å¾…Bçš„å›žæ”¶ã€‚<br />
<img src="https://i.loli.net/2020/11/02/yALVmbhPgFrc4TC.png" alt="brk" /></li>
<li>**<code>mmap</code>**æ˜¯åœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼ˆå †å’Œæ ˆä¸­é—´ï¼Œç§°ä¸ºæ–‡ä»¶æ˜ å°„åŒºåŸŸçš„åœ°æ–¹ï¼‰æ‰¾ä¸€å—ç©ºé—²çš„è™šæ‹Ÿå†…å­˜ã€‚<br />
<code>mmap</code>ç›´æŽ¥ä»Žå †å’Œæ ˆä¹‹é—´çš„åŒºåŸŸå–å‡ºäº†ä¸€å—åŒºåŸŸï¼Œå½“å›žæ”¶è¿™å—å†…å­˜æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¹Ÿä¼šç›´æŽ¥å°†è¿™å—å†…å­˜é‡Šæ”¾ã€‚<br />
ä½†æ˜¯ç³»ç»Ÿè°ƒç”¨å’Œç¼ºé¡µä¸­æ–­æ¯”è¾ƒæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œä¸ºäº†CPUçš„æ‰§è¡Œæ•ˆçŽ‡ï¼Œ<code>malloc</code>åªåœ¨ç”³è¯·çš„å†…å­˜å¤§äºŽ<code>128K</code>æ—¶æ‰ä¼šè°ƒç”¨<code>mmap</code>è¿›è¡Œåˆ†é…å†…å­˜ã€‚<br />
<img src="https://i.loli.net/2020/06/23/cexoML3Jib1kEFu.png" alt="mmap" /></li>
</ol>
<p>å¦‚æžœå°† <code>brk</code> æ¯”å–»ä¸ºæ‰¹å‘çš„è¯ï¼Œé‚£ä¹ˆ <code>mmap</code> å°±æ˜¯é›¶å”®ã€‚</p>
<p><strong>è¿™ä¸¤ç§æ–¹å¼åˆ†é…çš„éƒ½æ˜¯è™šæ‹Ÿå†…å­˜ï¼Œæ²¡æœ‰åˆ†é…ç‰©ç†å†…å­˜ã€‚åœ¨ç¬¬ä¸€æ¬¡è®¿é—®å·²åˆ†é…çš„è™šæ‹Ÿåœ°å€ç©ºé—´çš„æ—¶å€™ï¼Œå‘ç”Ÿç¼ºé¡µä¸­æ–­ï¼Œæ“ä½œç³»ç»Ÿè´Ÿè´£åˆ†é…ç‰©ç†å†…å­˜ï¼Œç„¶åŽå»ºç«‹è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚</strong></p>
<hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://mrh1s.top/archives/561">æ“ä½œç³»ç»Ÿä¸­ brk å’Œ mmap çš„åŒºåˆ«</a></li>
<li><a href="https://blog.csdn.net/Helloguoke/article/details/21644473">linuxä¸‹brkã€mmapã€mallocå’Œnewçš„åŒºåˆ«</a></li>
<li><a href="https://blog.csdn.net/yusiguyuan/article/details/39496057">è¿›ç¨‹åˆ†é…å†…å­˜çš„ä¸¤ç§æ–¹å¼&ndash;brk() å’Œmmap()ï¼ˆä¸è®¾è®¡å…±äº«å†…å­˜ï¼‰</a></li>
</ol>
<h4 id="å¦‚ä½•æŸ¥çœ‹ç«¯å£æ˜¯å¦è¢«å ç”¨">å¦‚ä½•æŸ¥çœ‹ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼Ÿ</h4>
<ol>
<li>
<p>ä½¿ç”¨<code>netstat</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">netstat anp <span class="p">|</span> grep <span class="m">80</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>ä½¿ç”¨<code>lsof</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">lsof -i:80
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h4 id="linuxçš„forkå®žçŽ°">Linuxçš„forkå®žçŽ°</h4>
<p>forkçš„ç®€å•ä¾‹å­å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">pid</span> <span class="o">=</span> <span class="nf">fork</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">pid</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">pid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;I am father, my pid is %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;I am child, my pid is %d</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="nf">getpid</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>I am father, my pid is 466
I am child, my pid is 469
</code></pre><p>çœ‹åˆ°è¿™ä¸ªç»“æžœæ˜¯ä¸æ˜¯å¾ˆå¥‡æ€ªï¼Œä¸ºä»€ä¹ˆifçš„åˆ†æ”¯æ‰§è¡Œåˆ°äº†ï¼Œelseçš„åˆ†æ”¯ä¹Ÿæ‰§è¡Œåˆ°äº†â“</p>
<p>å¯¹äºŽå‡½æ•°åŽŸåž‹<code>pid_t fork();</code>ï¼Œå®ƒæœ‰ä¸‰ä¸ªè¿”å›žå€¼</p>
<ul>
<li>è¯¥è¿›ç¨‹ä¸ºçˆ¶è¿›ç¨‹æ—¶ï¼Œè¿”å›žå­è¿›ç¨‹çš„<code>pid</code></li>
<li>è¯¥è¿›ç¨‹ä¸ºå­è¿›ç¨‹æ—¶ï¼Œè¿”å›ž</li>
<li>forkæ‰§è¡Œå¤±è´¥ï¼Œè¿”å›ž-1</li>
</ul>
<p><strong>forkå®ƒæ˜¯å¦‚ä½•çŸ¥é“ä¸€ä¸ªè¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹è¿˜æ˜¯å­è¿›ç¨‹çš„â“</strong></p>
<p>forkæœ¬èº«çš„åŠŸèƒ½æ˜¯å…‹éš†è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯å°†åŽŸå…ˆçš„ä¸€ä¸ªè¿›ç¨‹å†å…‹éš†å‡ºä¸€ä¸ªæ¥ï¼Œå…‹éš†å‡ºçš„è¿™ä¸ªè¿›ç¨‹å°±æ˜¯åŽŸè¿›ç¨‹çš„å­è¿›ç¨‹ï¼Œè¿™ä¸ªå­è¿›ç¨‹å’Œå…¶ä»–çš„è¿›ç¨‹æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼ŒåŒæ ·æ‹¥æœ‰è‡ªå·±çš„ç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€‚<strong>ä¸åŒçš„æ˜¯å­è¿›ç¨‹æ˜¯åœ¨forkè¿”å›žä¹‹åŽæ‰å¼€å§‹æ‰§è¡Œçš„ï¼Œå°±åƒä¸€æŠŠå‰å­ä¸€æ ·ï¼Œæ‰§è¡Œforkä¹‹åŽï¼Œçˆ¶å­è¿›ç¨‹å°±åˆ†é“æ‰¬é•³äº†ï¼Œæ‰€ä»¥forkè¿™ä¸ªåå­—å°±å¾ˆå½¢è±¡</strong></p>
<p><strong>forkæœ¬è´¨</strong>(ä¸¤ä¸ªè¿›ç¨‹+æ—¶é—´ç‰‡è½®è½¬)</p>
<p>forkåœ¨æ‰§è¡Œä¹‹åŽï¼Œä¼š<strong>åˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œè¿™ä¸ªæ–°çš„è¿›ç¨‹å†…éƒ¨çš„æ•°æ®æ˜¯åŽŸè¿›ç¨‹æ‰€æœ‰æ•°æ®çš„ä¸€ä»½æ‹·è´</strong>ã€‚å› æ­¤forkå°±ç›¸å½“äºŽæŠŠæŸä¸ªè¿›ç¨‹çš„å…¨éƒ¨èµ„æºå¤åˆ¶äº†ä¸€éï¼Œç„¶åŽè®©<code>csï¼šeip</code>æŒ‡å‘æ–°è¿›ç¨‹çš„æŒ‡ä»¤éƒ¨åˆ†ã€‚</p>
<p>forkç»™çˆ¶è¿›ç¨‹è¿”å›žå­è¿›ç¨‹<code>pid</code>ï¼Œç»™å…¶æ‹·è´å‡ºæ¥çš„å­è¿›ç¨‹è¿”å›ž0ï¼Œè¿™ä¹Ÿæ˜¯ä»–çš„ç‰¹ç‚¹ä¹‹ä¸€ï¼Œä¸€æ¬¡è°ƒç”¨ï¼Œä¸¤æ¬¡è¿”å›žã€‚ä¸¤æ¬¡è¿”å›žçœ‹ä¸ŠåŽ»æœ‰ç‚¹ç¥žç§˜ï¼Œ<strong>å®žè´¨æ˜¯åœ¨å­è¿›ç¨‹çš„æ ˆä¸­æž„é€ å¥½æ•°æ®åŽï¼Œå­è¿›ç¨‹ä»Žæ ˆä¸­èŽ·å–åˆ°çš„è¿”å›žå€¼</strong>ã€‚</p>
<p>forkçš„å®žçŽ°åˆ†ä¸ºä»¥ä¸‹ä¸¤æ­¥</p>
<ol>
<li>å¤åˆ¶è¿›ç¨‹èµ„æº</li>
<li>æ‰§è¡Œè¯¥è¿›ç¨‹</li>
</ol>
<p>å¤åˆ¶è¿›ç¨‹çš„èµ„æºåŒ…æ‹¬ä»¥ä¸‹å‡ æ­¥</p>
<ol>
<li>è¿›ç¨‹<code>pcb</code></li>
<li>ç¨‹åºä½“ï¼Œå³ä»£ç æ®µæ•°æ®æ®µç­‰</li>
<li>ç”¨æˆ·æ ˆ</li>
<li>å†…æ ¸æ ˆ</li>
<li>è™šæ‹Ÿå†…å­˜æ± </li>
<li>é¡µè¡¨</li>
</ol>
<p>è¿›è¡Œè¿›ç¨‹çš„è¯å°±æ¯”è¾ƒç®€å•äº†ï¼Œåªéœ€è¦å°†å…¶åŠ å…¥åˆ°å°±ç»ªé˜Ÿåˆ—å³å¯ï¼ŒæŽ¥ä¸‹æ¥å°±ç­‰å¾…<code>cpu</code>çš„è°ƒåº¦äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">pid</span><span class="o">=</span><span class="nf">fork</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ“ä½œç³»ç»Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹(å­è¿›ç¨‹)ï¼Œå¹¶ä¸”åœ¨è¿›ç¨‹è¡¨ä¸­ç›¸åº”ä¸ºå®ƒå»ºç«‹ä¸€ä¸ªæ–°çš„è¡¨é¡¹ã€‚æ–°è¿›ç¨‹å’ŒåŽŸæœ‰è¿›ç¨‹çš„å¯æ‰§è¡Œç¨‹åºæ˜¯åŒä¸€ä¸ªç¨‹åºï¼›ä¸Šä¸‹æ–‡å’Œæ•°æ®ï¼Œç»å¤§éƒ¨åˆ†å°±æ˜¯åŽŸè¿›ç¨‹ï¼ˆçˆ¶è¿›ç¨‹ï¼‰çš„æ‹·è´ï¼Œä½†å®ƒä»¬æ˜¯ä¸¤ä¸ªç›¸äº’ç‹¬ç«‹çš„è¿›ç¨‹!æ­¤æ—¶ç¨‹åºå¯„å­˜å™¨pcï¼Œåœ¨çˆ¶ã€å­è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­éƒ½å£°ç§°ï¼Œè¿™ä¸ªè¿›ç¨‹ç›®å‰æ‰§è¡Œåˆ°forkè°ƒç”¨å³å°†è¿”å›ž(æ­¤æ—¶å­è¿›ç¨‹ä¸å æœ‰CPUï¼Œå­è¿›ç¨‹çš„pcä¸æ˜¯çœŸæ­£ä¿å­˜åœ¨å¯„å­˜å™¨ä¸­ï¼Œè€Œæ˜¯ä½œä¸ºè¿›ç¨‹ä¸Šä¸‹æ–‡ä¿å­˜åœ¨è¿›ç¨‹è¡¨ä¸­çš„å¯¹åº”è¡¨é¡¹å†…)ã€‚é—®é¢˜æ˜¯æ€Žä¹ˆè¿”å›žï¼Œåœ¨çˆ¶å­è¿›ç¨‹ä¸­å°±åˆ†é“æ‰¬é•³ã€‚<br />
<strong>çˆ¶è¿›ç¨‹ç»§ç»­æ‰§è¡Œï¼Œæ“ä½œç³»ç»Ÿå¯¹forkçš„å®žçŽ°ï¼Œä½¿è¿™ä¸ªè°ƒç”¨åœ¨çˆ¶è¿›ç¨‹ä¸­è¿”å›žåˆšåˆšåˆ›å»ºçš„å­è¿›ç¨‹çš„pid(ä¸€ä¸ªæ­£æ•´æ•°)</strong>ï¼Œæ‰€ä»¥ä¸‹é¢çš„ifè¯­å¥ä¸­pid&lt;0, <code>pid==0</code>çš„ä¸¤ä¸ªåˆ†æ”¯éƒ½ä¸ä¼šæ‰§è¡Œã€‚<br />
<strong>å­è¿›ç¨‹åœ¨ä¹‹åŽçš„æŸä¸ªæ—¶å€™å¾—åˆ°è°ƒåº¦ï¼Œå®ƒçš„ä¸Šä¸‹æ–‡è¢«æ¢å…¥ï¼Œå æ® CPU</strong>ï¼Œæ“ä½œç³»ç»Ÿå¯¹forkçš„å®žçŽ°ï¼Œä½¿å¾—å­è¿›ç¨‹ä¸­forkè°ƒç”¨è¿”å›ž0ã€‚æ‰€ä»¥åœ¨è¿™ä¸ªè¿›ç¨‹ï¼ˆæ³¨æ„è¿™ä¸æ˜¯çˆ¶è¿›ç¨‹äº†ï¼Œè™½ç„¶æ˜¯åŒä¸€ä¸ªç¨‹åºï¼Œä½†æ˜¯è¿™æ˜¯åŒä¸€ä¸ªç¨‹åºçš„å¦å¤–ä¸€æ¬¡æ‰§è¡Œï¼Œåœ¨æ“ä½œç³»ç»Ÿä¸­è¿™æ¬¡æ‰§è¡Œæ˜¯ç”±å¦å¤–ä¸€ä¸ªè¿›ç¨‹è¡¨ç¤ºçš„ï¼Œä»Žæ‰§è¡Œçš„è§’åº¦è¯´å’Œçˆ¶è¿›ç¨‹ç›¸äº’ç‹¬ç«‹ï¼‰ä¸­pid=0ã€‚<strong>è¿™ä¸ªè¿›ç¨‹ç»§ç»­æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œifè¯­å¥ä¸­ pid&lt;0ä¸æ»¡è¶³ï¼Œä½†æ˜¯<code>pid==0</code>æ˜¯true</strong>ã€‚</p>
<p><strong>ç›¸å…³ä»£ç </strong></p>
<p>å°†çˆ¶è¿›ç¨‹çš„pcbã€è™šæ‹Ÿåœ°å€ä½å›¾æ‹·è´ç»™å­è¿›ç¨‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">int32_t</span> <span class="nf">copy_pcb_vaddrbitmap_stack0</span><span class="p">(</span><span class="n">task_struct</span> <span class="o">*</span><span class="n">child_thread</span><span class="p">,</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">parent_thread</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="cm">/* a å¤åˆ¶pcbæ‰€åœ¨çš„æ•´ä¸ªé¡µ,é‡Œé¢åŒ…å«è¿›ç¨‹pcbä¿¡æ¯åŠç‰¹çº§0æžçš„æ ˆ,é‡Œé¢åŒ…å«äº†è¿”å›žåœ°å€, ç„¶åŽå†å•ç‹¬ä¿®æ”¹ä¸ªåˆ«éƒ¨åˆ† */</span>
</span></span><span class="line"><span class="cl">      <span class="nf">memcpy</span><span class="p">(</span><span class="n">child_thread</span><span class="p">,</span> <span class="n">parent_thread</span><span class="p">,</span> <span class="n">PG_SIZE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">pid</span> <span class="o">=</span> <span class="nf">fork_pid</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">elapsed_ticks</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">=</span> <span class="n">TASK_READY</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">ticks</span> <span class="o">=</span> <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">priority</span><span class="p">;</span> <span class="c1">// ä¸ºæ–°è¿›ç¨‹æŠŠæ—¶é—´ç‰‡å……æ»¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">parent_pid</span> <span class="o">=</span> <span class="n">parent_thread</span><span class="o">-&gt;</span><span class="n">pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">general_tag</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">general_tag</span><span class="p">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">all_list_tag</span><span class="p">.</span><span class="n">prev</span> <span class="o">=</span> <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">all_list_tag</span><span class="p">.</span><span class="n">next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nf">block_desc_init</span><span class="p">(</span><span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">u_block_desc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="cm">/* b å¤åˆ¶çˆ¶è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€æ± çš„ä½å›¾ */</span>
</span></span><span class="line"><span class="cl">      <span class="kt">uint32_t</span> <span class="n">bitmap_pg_cnt</span> <span class="o">=</span> <span class="nf">DIV_ROUND_UP</span><span class="p">((</span><span class="mh">0xc0000000</span> <span class="o">-</span> <span class="n">USER_VADDR_START</span><span class="p">)</span> <span class="o">/</span> <span class="n">PG_SIZE</span> <span class="o">/</span> <span class="mi">8</span><span class="p">,</span> <span class="n">PG_SIZE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="kt">void</span> <span class="o">*</span><span class="n">vaddr_btmp</span> <span class="o">=</span> <span class="nf">get_kernel_pages</span><span class="p">(</span><span class="n">bitmap_pg_cnt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">vaddr_btmp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="cm">/* æ­¤æ—¶child_thread-&gt;userprog_vaddr.vaddr_bitmap.bitsè¿˜æ˜¯æŒ‡å‘çˆ¶è¿›ç¨‹è™šæ‹Ÿåœ°å€çš„ä½å›¾åœ°å€
</span></span></span><span class="line"><span class="cl"><span class="cm">    * ä¸‹é¢å°†child_thread-&gt;userprog_vaddr.vaddr_bitmap.bitsæŒ‡å‘è‡ªå·±çš„ä½å›¾vaddr_btmp */</span>
</span></span><span class="line"><span class="cl">      <span class="nf">memcpy</span><span class="p">(</span><span class="n">vaddr_btmp</span><span class="p">,</span> <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">userprog_vaddr</span><span class="p">.</span><span class="n">vaddr_bitmap</span><span class="p">.</span><span class="n">bits</span><span class="p">,</span> <span class="n">bitmap_pg_cnt</span> <span class="o">*</span> <span class="n">PG_SIZE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">userprog_vaddr</span><span class="p">.</span><span class="n">vaddr_bitmap</span><span class="p">.</span><span class="n">bits</span> <span class="o">=</span> <span class="n">vaddr_btmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nf">ASSERT</span><span class="p">(</span><span class="nf">strlen</span><span class="p">(</span><span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">);</span> <span class="c1">// pcb.nameçš„é•¿åº¦æ˜¯16,ä¸ºé¿å…ä¸‹é¢strcatè¶Šç•Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">strcat</span><span class="p">(</span><span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="s">&#34;_fork&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¤åˆ¶å­è¿›ç¨‹çš„è¿›ç¨‹ä½“(ä»£ç å’Œæ•°æ®)åŠç”¨æˆ·æ ˆ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">void</span> <span class="nf">copy_body_stack3</span><span class="p">(</span><span class="n">task_struct</span> <span class="o">*</span><span class="n">child_thread</span><span class="p">,</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">parent_thread</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf_page</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">vaddr_btmp</span> <span class="o">=</span> <span class="n">parent_thread</span><span class="o">-&gt;</span><span class="n">userprog_vaddr</span><span class="p">.</span><span class="n">vaddr_bitmap</span><span class="p">.</span><span class="n">bits</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="kt">uint32_t</span> <span class="n">btmp_bytes_len</span> <span class="o">=</span> <span class="n">parent_thread</span><span class="o">-&gt;</span><span class="n">userprog_vaddr</span><span class="p">.</span><span class="n">vaddr_bitmap</span><span class="p">.</span><span class="n">btmp_bytes_len</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="kt">uint32_t</span> <span class="n">vaddr_start</span> <span class="o">=</span> <span class="n">parent_thread</span><span class="o">-&gt;</span><span class="n">userprog_vaddr</span><span class="p">.</span><span class="n">vaddr_start</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="kt">uint32_t</span> <span class="n">idx_byte</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="kt">uint32_t</span> <span class="n">idx_bit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="kt">uint32_t</span> <span class="n">prog_vaddr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="cm">/* åœ¨çˆ¶è¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´ä¸­æŸ¥æ‰¾å·²æœ‰æ•°æ®çš„é¡µ */</span>
</span></span><span class="line"><span class="cl">      <span class="k">while</span> <span class="p">(</span><span class="n">idx_byte</span> <span class="o">&lt;</span> <span class="n">btmp_bytes_len</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">vaddr_btmp</span><span class="p">[</span><span class="n">idx_byte</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="n">idx_bit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                  <span class="k">while</span> <span class="p">(</span><span class="n">idx_bit</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="p">((</span><span class="n">BITMAP_MASK</span> <span class="o">&lt;&lt;</span> <span class="n">idx_bit</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">vaddr_btmp</span><span class="p">[</span><span class="n">idx_byte</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">                        <span class="p">{</span>
</span></span><span class="line"><span class="cl">                              <span class="n">prog_vaddr</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx_byte</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">idx_bit</span><span class="p">)</span> <span class="o">*</span> <span class="n">PG_SIZE</span> <span class="o">+</span> <span class="n">vaddr_start</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                              <span class="cm">/* ä¸‹é¢çš„æ“ä½œæ˜¯å°†çˆ¶è¿›ç¨‹ç”¨æˆ·ç©ºé—´ä¸­çš„æ•°æ®é€šè¿‡å†…æ ¸ç©ºé—´åšä¸­è½¬,æœ€ç»ˆå¤åˆ¶åˆ°å­è¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´ */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                              <span class="cm">/* a å°†çˆ¶è¿›ç¨‹åœ¨ç”¨æˆ·ç©ºé—´ä¸­çš„æ•°æ®å¤åˆ¶åˆ°å†…æ ¸ç¼“å†²åŒºbuf_page,
</span></span></span><span class="line"><span class="cl"><span class="cm">           ç›®çš„æ˜¯ä¸‹é¢åˆ‡æ¢åˆ°å­è¿›ç¨‹çš„é¡µè¡¨åŽ,è¿˜èƒ½è®¿é—®åˆ°çˆ¶è¿›ç¨‹çš„æ•°æ®*/</span>
</span></span><span class="line"><span class="cl">                              <span class="nf">memcpy</span><span class="p">(</span><span class="n">buf_page</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">prog_vaddr</span><span class="p">,</span> <span class="n">PG_SIZE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                              <span class="cm">/* b å°†é¡µè¡¨åˆ‡æ¢åˆ°å­è¿›ç¨‹,ç›®çš„æ˜¯é¿å…ä¸‹é¢ç”³è¯·å†…å­˜çš„å‡½æ•°å°†pteåŠpdeå®‰è£…åœ¨çˆ¶è¿›ç¨‹çš„é¡µè¡¨ä¸­ */</span>
</span></span><span class="line"><span class="cl">                              <span class="nf">page_dir_activate</span><span class="p">(</span><span class="n">child_thread</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                              <span class="cm">/* c ç”³è¯·è™šæ‹Ÿåœ°å€prog_vaddr */</span>
</span></span><span class="line"><span class="cl">                              <span class="nf">get_a_page_without_opvaddrbitmap</span><span class="p">(</span><span class="n">PF_USER</span><span class="p">,</span> <span class="n">prog_vaddr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                              <span class="cm">/* d ä»Žå†…æ ¸ç¼“å†²åŒºä¸­å°†çˆ¶è¿›ç¨‹æ•°æ®å¤åˆ¶åˆ°å­è¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´ */</span>
</span></span><span class="line"><span class="cl">                              <span class="nf">memcpy</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">prog_vaddr</span><span class="p">,</span> <span class="n">buf_page</span><span class="p">,</span> <span class="n">PG_SIZE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                              <span class="cm">/* e æ¢å¤çˆ¶è¿›ç¨‹é¡µè¡¨ */</span>
</span></span><span class="line"><span class="cl">                              <span class="nf">page_dir_activate</span><span class="p">(</span><span class="n">parent_thread</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                        <span class="n">idx_bit</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">idx_byte</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸ºå­è¿›ç¨‹æž„å»ºthread_stackå’Œä¿®æ”¹è¿”å›žå€¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">int32_t</span> <span class="nf">build_child_stack</span><span class="p">(</span><span class="n">task_struct</span> <span class="o">*</span><span class="n">child_thread</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="cm">/* a ä½¿å­è¿›ç¨‹pidè¿”å›žå€¼ä¸º0 */</span>
</span></span><span class="line"><span class="cl">      <span class="cm">/* èŽ·å–å­è¿›ç¨‹0çº§æ ˆæ ˆé¡¶ */</span>
</span></span><span class="line"><span class="cl">      <span class="n">intr_stack</span> <span class="o">*</span><span class="n">intr_0_stack</span> <span class="o">=</span> <span class="p">(</span><span class="n">intr_stack</span> <span class="o">*</span><span class="p">)((</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">child_thread</span> <span class="o">+</span> <span class="n">PG_SIZE</span> <span class="o">-</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">intr_stack</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="cm">/* ä¿®æ”¹å­è¿›ç¨‹çš„è¿”å›žå€¼ä¸º0 */</span>
</span></span><span class="line"><span class="cl">      <span class="n">intr_0_stack</span><span class="o">-&gt;</span><span class="n">eax</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="cm">/* b ä¸ºswitch_to æž„å»º struct thread_stack,å°†å…¶æž„å»ºåœ¨ç´§ä¸´intr_stackä¹‹ä¸‹çš„ç©ºé—´*/</span>
</span></span><span class="line"><span class="cl">      <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">ret_addr_in_thread_stack</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="o">*</span><span class="p">)</span><span class="n">intr_0_stack</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="cm">/* ebpåœ¨thread_stackä¸­çš„åœ°å€ä¾¿æ˜¯å½“æ—¶çš„esp(0çº§æ ˆçš„æ ˆé¡¶),
</span></span></span><span class="line"><span class="cl"><span class="cm">   å³espä¸º&#34;(uint32_t*)intr_0_stack - 5&#34; */</span>
</span></span><span class="line"><span class="cl">      <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">ebp_ptr_in_thread_stack</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span> <span class="o">*</span><span class="p">)</span><span class="n">intr_0_stack</span> <span class="o">-</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="cm">/* switch_toçš„è¿”å›žåœ°å€æ›´æ–°ä¸ºintr_exit,ç›´æŽ¥ä»Žä¸­æ–­è¿”å›ž */</span>
</span></span><span class="line"><span class="cl">      <span class="o">*</span><span class="n">ret_addr_in_thread_stack</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">intr_exit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="cm">/* æŠŠæž„å»ºçš„thread_stackçš„æ ˆé¡¶åšä¸ºswitch_toæ¢å¤æ•°æ®æ—¶çš„æ ˆé¡¶ */</span>
</span></span><span class="line"><span class="cl">      <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">self_kstack</span> <span class="o">=</span> <span class="n">ebp_ptr_in_thread_stack</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‹·è´çˆ¶è¿›ç¨‹æœ¬èº«æ‰€å èµ„æºç»™å­è¿›ç¨‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">static</span> <span class="kt">int32_t</span> <span class="nf">copy_process</span><span class="p">(</span><span class="n">task_struct</span> <span class="o">*</span><span class="n">child_thread</span><span class="p">,</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">parent_thread</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="cm">/* å†…æ ¸ç¼“å†²åŒº,ä½œä¸ºçˆ¶è¿›ç¨‹ç”¨æˆ·ç©ºé—´çš„æ•°æ®å¤åˆ¶åˆ°å­è¿›ç¨‹ç”¨æˆ·ç©ºé—´çš„ä¸­è½¬ */</span>
</span></span><span class="line"><span class="cl">      <span class="kt">void</span> <span class="o">*</span><span class="n">buf_page</span> <span class="o">=</span> <span class="nf">get_kernel_pages</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">buf_page</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="cm">/* a å¤åˆ¶çˆ¶è¿›ç¨‹çš„pcbã€è™šæ‹Ÿåœ°å€ä½å›¾ã€å†…æ ¸æ ˆåˆ°å­è¿›ç¨‹ */</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nf">copy_pcb_vaddrbitmap_stack0</span><span class="p">(</span><span class="n">child_thread</span><span class="p">,</span> <span class="n">parent_thread</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="cm">/* b ä¸ºå­è¿›ç¨‹åˆ›å»ºé¡µè¡¨,æ­¤é¡µè¡¨ä»…åŒ…æ‹¬å†…æ ¸ç©ºé—´ */</span>
</span></span><span class="line"><span class="cl">      <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">pgdir</span> <span class="o">=</span> <span class="nf">create_page_dir</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">pgdir</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="cm">/* c å¤åˆ¶çˆ¶è¿›ç¨‹è¿›ç¨‹ä½“åŠç”¨æˆ·æ ˆç»™å­è¿›ç¨‹ */</span>
</span></span><span class="line"><span class="cl">      <span class="nf">copy_body_stack3</span><span class="p">(</span><span class="n">child_thread</span><span class="p">,</span> <span class="n">parent_thread</span><span class="p">,</span> <span class="n">buf_page</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="cm">/* d æž„å»ºå­è¿›ç¨‹thread_stackå’Œä¿®æ”¹è¿”å›žå€¼pid */</span>
</span></span><span class="line"><span class="cl">      <span class="nf">build_child_stack</span><span class="p">(</span><span class="n">child_thread</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="cm">/* e æ›´æ–°æ–‡ä»¶inodeçš„æ‰“å¼€æ•° */</span>
</span></span><span class="line"><span class="cl">      <span class="nf">update_inode_open_cnts</span><span class="p">(</span><span class="n">child_thread</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nf">mfree_page</span><span class="p">(</span><span class="n">PF_KERNEL</span><span class="p">,</span> <span class="n">buf_page</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸»ç³»ç»ŸAPIè°ƒç”¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/* forkå­è¿›ç¨‹,å†…æ ¸çº¿ç¨‹ä¸å¯ç›´æŽ¥è°ƒç”¨ */</span>
</span></span><span class="line"><span class="cl"><span class="kt">pid_t</span> <span class="nf">sys_fork</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">task_struct</span> <span class="o">*</span><span class="n">parent_thread</span> <span class="o">=</span> <span class="nf">running_thread</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="n">task_struct</span> <span class="o">*</span><span class="n">child_thread</span> <span class="o">=</span> <span class="nf">get_kernel_pages</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// ä¸ºå­è¿›ç¨‹åˆ›å»ºpcb(task_structç»“æž„)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="n">child_thread</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="nf">ASSERT</span><span class="p">(</span><span class="n">INTR_OFF</span> <span class="o">==</span> <span class="nf">intr_get_status</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">parent_thread</span><span class="o">-&gt;</span><span class="n">pgdir</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nf">copy_process</span><span class="p">(</span><span class="n">child_thread</span><span class="p">,</span> <span class="n">parent_thread</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="cm">/* æ·»åŠ åˆ°å°±ç»ªçº¿ç¨‹é˜Ÿåˆ—å’Œæ‰€æœ‰çº¿ç¨‹é˜Ÿåˆ—,å­è¿›ç¨‹ç”±è°ƒè¯•å™¨å®‰æŽ’è¿è¡Œ */</span>
</span></span><span class="line"><span class="cl">      <span class="nf">ASSERT</span><span class="p">(</span><span class="o">!</span><span class="nf">elem_find</span><span class="p">(</span><span class="o">&amp;</span><span class="n">thread_ready_list</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">general_tag</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="nf">list_append</span><span class="p">(</span><span class="o">&amp;</span><span class="n">thread_ready_list</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">general_tag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nf">ASSERT</span><span class="p">(</span><span class="o">!</span><span class="nf">elem_find</span><span class="p">(</span><span class="o">&amp;</span><span class="n">thread_all_list</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">all_list_tag</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="nf">list_append</span><span class="p">(</span><span class="o">&amp;</span><span class="n">thread_all_list</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">all_list_tag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">child_thread</span><span class="o">-&gt;</span><span class="n">pid</span><span class="p">;</span> <span class="c1">// çˆ¶è¿›ç¨‹è¿”å›žå­è¿›ç¨‹çš„pid
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr />
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://zhuanlan.zhihu.com/p/36872365">åä¹. forkçš„åŽŸç†åŠå®žçŽ°</a></li>
<li><a href="https://www.xuebuyuan.com/2213549.html">forkè¿›ç¨‹çš„è¿‡ç¨‹</a></li>
</ol>
<h4 id="mallocåŽŸç†">MallocåŽŸç†ðŸš´â€â™‚ï¸</h4>
<blockquote>
<p>å†…å­˜ç®¡ç†æ¨¡å—ä¸­æ˜¯é€šè¿‡bitmapå¯¹å†…å­˜è¿›è¡Œç®¡ç†çš„ï¼Œbitmapä¸­çš„æ¯ä¸€ä¸ªbitä½å°±ä»£è¡¨ä¸€é¡µå¤§å°çš„å†…å­˜ï¼Œè¯¥ä½ä¸º1æ—¶è¡¨ç¤ºè¿™é¡µå·²ç»åˆ†é…å‡ºåŽ»äº†ã€‚é‚£ä¹ˆå¯¹å°å—å†…å­˜è¿›è¡Œåˆ†é…çš„æ—¶å€™ï¼ŒåŒæ ·éœ€è¦ä¸€ä¸ªç»“æž„æ¥è®°å½•è¿™å—å†…å­˜çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¦é€šè¿‡ä¸€ç§ç»“æž„æ¥å¯¹å†…å­˜çš„åˆ†é…ä¸Žé‡Šæ”¾è¿›è¡Œç®¡ç†ã€‚</p>
</blockquote>
<p>ä»»ä½•å®žé™…çš„åˆ†é…å™¨éƒ½éœ€è¦ä¸€äº›æ•°æ®ç»“æž„ï¼Œå…è®¸å®ƒæ¥åŒºåˆ«å—è¾¹ç•Œï¼Œä»¥åŠåŒºåˆ«å·²åˆ†é…å—å’Œç©ºé—²å— ã€‚å¤§å¤šæ•°åˆ†é…å™¨å°†è¿™äº›ä¿¡æ¯åµŒäººå—æœ¬èº«ã€‚ä¸€ä¸ªç®€å•çš„ç»“æž„å¦‚ä¸‹ï¼š</p>
<p><img src="../AppData/Roaming/Typora/typora-user-images/image-20201101225827154.png" alt="image-20201101225827154" /></p>
<h5 id="linuxè¿›ç¨‹å †ç®¡ç†">Linuxè¿›ç¨‹å †ç®¡ç†</h5>
<p>Linuxç»´æŠ¤ä¸€ä¸ªbreakæŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘å †ç©ºé—´çš„æŸä¸ªåœ°å€ã€‚ä»Žå †èµ·å§‹åœ°å€åˆ°breakä¹‹é—´çš„åœ°å€ç©ºé—´ä¸ºæ˜ å°„å¥½çš„ï¼Œå¯ä»¥ä¾›è¿›ç¨‹è®¿é—®ï¼›è€Œä»Žbreakå¾€ä¸Šï¼Œæ˜¯æœªæ˜ å°„çš„åœ°å€ç©ºé—´ï¼Œå¦‚æžœè®¿é—®è¿™æ®µç©ºé—´åˆ™ç¨‹åºä¼šæŠ¥é”™ã€‚</p>
<h5 id="brkä¸Žsbrk">brkä¸Žsbrk</h5>
<p>è¦å¢žåŠ ä¸€ä¸ªè¿›ç¨‹å®žé™…çš„å¯ç”¨å †å¤§å°ï¼Œå°±éœ€è¦å°†breakæŒ‡é’ˆå‘é«˜åœ°å€ç§»åŠ¨ã€‚Linuxé€šè¿‡brkå’Œsbrkç³»ç»Ÿè°ƒç”¨æ“ä½œbreakæŒ‡é’ˆã€‚ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨çš„åŽŸåž‹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">brk</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="nf">sbrk</span><span class="p">(</span><span class="kt">intptr_t</span> <span class="n">increment</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>brkå°†breakæŒ‡é’ˆç›´æŽ¥è®¾ç½®ä¸ºæŸä¸ªåœ°å€ï¼Œè€Œsbrkå°†breakä»Žå½“å‰ä½ç½®ç§»åŠ¨incrementæ‰€æŒ‡å®šçš„å¢žé‡ã€‚brkåœ¨æ‰§è¡ŒæˆåŠŸæ—¶è¿”å›ž0ï¼Œå¦åˆ™è¿”å›ž-1å¹¶è®¾ç½®errnoä¸ºENOMEMï¼›sbrkæˆåŠŸæ—¶è¿”å›žbreakç§»åŠ¨ä¹‹å‰æ‰€æŒ‡å‘çš„åœ°å€ï¼Œå¦åˆ™è¿”å›ž(void *)-1ã€‚</p>
<p>ä¸€ä¸ªå°æŠ€å·§æ˜¯ï¼Œå¦‚æžœå°†incrementè®¾ç½®ä¸º0ï¼Œåˆ™å¯ä»¥èŽ·å¾—å½“å‰breakçš„åœ°å€ã€‚</p>
<h5 id="ç®€å•å®žçŽ°malloc">ç®€å•å®žçŽ°malloc</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cm">/* ä¸€ä¸ªçŽ©å…·malloc */</span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="o">*</span><span class="nf">malloc</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span> <span class="o">=</span> <span class="nf">sbrk</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nf">sbrk</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªmallocæ¯æ¬¡éƒ½åœ¨å½“å‰breakçš„åŸºç¡€ä¸Šå¢žåŠ sizeæ‰€æŒ‡å®šçš„å­—èŠ‚æ•°ï¼Œå¹¶å°†ä¹‹å‰breakçš„åœ°å€è¿”å›žã€‚è¿™ä¸ªmallocç”±äºŽå¯¹æ‰€åˆ†é…çš„å†…å­˜ç¼ºä¹è®°å½•ï¼Œä¸ä¾¿äºŽå†…å­˜é‡Šæ”¾ï¼Œæ‰€ä»¥æ— æ³•ç”¨äºŽçœŸå®žåœºæ™¯ã€‚</p>
<h5 id="æ­£å¼å®žçŽ°malloc">æ­£å¼å®žçŽ°malloc</h5>
<p><strong>æ•°æ®ç»“æž„</strong></p>
<p>ä¸€ä¸ªç®€å•å¯è¡Œæ–¹æ¡ˆæ˜¯å°†å †å†…å­˜ç©ºé—´ä»¥å—ï¼ˆBlockï¼‰çš„å½¢å¼ç»„ç»‡èµ·æ¥ï¼Œæ¯ä¸ªå—ç”±metaåŒºå’Œæ•°æ®åŒºç»„æˆï¼ŒmetaåŒºè®°å½•æ•°æ®å—çš„å…ƒä¿¡æ¯ï¼ˆæ•°æ®åŒºå¤§å°ã€ç©ºé—²æ ‡å¿—ä½ã€æŒ‡é’ˆç­‰ç­‰ï¼‰ï¼Œæ•°æ®åŒºæ˜¯çœŸå®žåˆ†é…çš„å†…å­˜åŒºåŸŸï¼Œå¹¶ä¸”æ•°æ®åŒºçš„ç¬¬ä¸€ä¸ªå­—èŠ‚åœ°å€å³ä¸ºmallocè¿”å›žçš„åœ°å€ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">s_block</span> <span class="o">*</span><span class="n">t_block</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">s_block</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">size_t</span> <span class="n">size</span><span class="p">;</span>  <span class="cm">/* æ•°æ®åŒºå¤§å° 8å­—èŠ‚*/</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_block</span> <span class="n">next</span><span class="p">;</span> <span class="cm">/* æŒ‡å‘ä¸‹ä¸ªå—çš„æŒ‡é’ˆ 8å­—èŠ‚*/</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">free</span><span class="p">;</span>     <span class="cm">/* æ˜¯å¦æ˜¯ç©ºé—²å— 4å­—èŠ‚*/</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">padding</span><span class="p">;</span>  <span class="cm">/* å¡«å……4å­—èŠ‚ï¼Œä¿è¯metaå—é•¿åº¦ä¸º8çš„å€æ•° 4å­—èŠ‚*/</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="cm">/* è¿™æ˜¯ä¸€ä¸ªè™šæ‹Ÿå­—æ®µï¼Œè¡¨ç¤ºæ•°æ®å—çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œé•¿åº¦ä¸åº”è®¡å…¥meta */</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span> <span class="c1">// æ€»å…±32å­—èŠ‚
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç”±äºŽæˆ‘ä»¬åªè€ƒè™‘64ä½æœºå™¨ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬åœ¨ç»“æž„ä½“æœ€åŽå¡«å……ä¸€ä¸ªintï¼Œä½¿å¾—ç»“æž„ä½“æœ¬èº«çš„é•¿åº¦ä¸º8çš„å€æ•°ï¼Œä»¥ä¾¿å†…å­˜å¯¹é½ã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2020/10/30/EJpAVGhvB5xX7Yw.png" alt="Blockç»“æž„" /></p>
<p><strong>å¯»æ‰¾åˆé€‚çš„block</strong></p>
<p>ã€€çŽ°åœ¨è€ƒè™‘å¦‚ä½•åœ¨blocké“¾ä¸­æŸ¥æ‰¾åˆé€‚çš„blockã€‚ä¸€èˆ¬æ¥è¯´æœ‰ä¸¤ç§æŸ¥æ‰¾ç®—æ³•ï¼š</p>
<ul>
<li><strong>First fit</strong>ï¼šä»Žå¤´å¼€å§‹ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªæ•°æ®åŒºå¤§å°å¤§äºŽè¦æ±‚sizeçš„å—æ‰€è°“æ­¤æ¬¡åˆ†é…çš„å—</li>
<li><strong>Best fit</strong>ï¼šä»Žå¤´å¼€å§‹ï¼ŒéåŽ†æ‰€æœ‰å—ï¼Œä½¿ç”¨æ•°æ®åŒºå¤§å°å¤§äºŽsizeä¸”å·®å€¼æœ€å°çš„å—ä½œä¸ºæ­¤æ¬¡åˆ†é…çš„å—</li>
</ul>
<p>ã€€ã€€ä¸¤ç§æ–¹æ³•å„æœ‰åƒç§‹ï¼Œbest fitå…·æœ‰è¾ƒé«˜çš„å†…å­˜ä½¿ç”¨çŽ‡ï¼ˆpayloadè¾ƒé«˜ï¼‰ï¼Œè€Œfirst fitå…·æœ‰æ›´å¥½çš„è¿è¡Œæ•ˆçŽ‡ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨first fitç®—æ³•ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="cm">/* First fit */</span>
</span></span><span class="line"><span class="cl"><span class="n">t_block</span> <span class="nf">find_block</span><span class="p">(</span><span class="n">t_block</span> <span class="o">*</span><span class="n">last</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_block</span> <span class="n">b</span> <span class="o">=</span> <span class="n">first_block</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span><span class="p">(</span><span class="n">b</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">free</span> <span class="o">&amp;&amp;</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="o">*</span><span class="n">last</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>find_blockä»Žfrist_blockå¼€å§‹ï¼ŒæŸ¥æ‰¾ç¬¬ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„blockå¹¶è¿”å›žblockèµ·å§‹åœ°å€ï¼Œå¦‚æžœæ‰¾ä¸åˆ°è¿™è¿”å›žNULLã€‚è¿™é‡Œåœ¨éåŽ†æ—¶ä¼šæ›´æ–°ä¸€ä¸ªå«lastçš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆå§‹ç»ˆæŒ‡å‘å½“å‰éåŽ†çš„blockã€‚è¿™æ˜¯ä¸ºäº†å¦‚æžœæ‰¾ä¸åˆ°åˆé€‚çš„blockè€Œå¼€è¾Ÿæ–°blockä½¿ç”¨çš„ã€‚</p>
<p><strong>å¼€è¾Ÿæ–°çš„block</strong></p>
<p>å¦‚æžœçŽ°æœ‰blockéƒ½ä¸èƒ½æ»¡è¶³sizeçš„è¦æ±‚ï¼Œåˆ™éœ€è¦åœ¨é“¾è¡¨æœ€åŽå¼€è¾Ÿä¸€ä¸ªæ–°çš„blockã€‚è¿™é‡Œå…³é”®æ˜¯å¦‚ä½•åªä½¿ç”¨sbrkåˆ›å»ºä¸€ä¸ªstructï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define BLOCK_SIZE 24 </span><span class="cm">/* ç”±äºŽå­˜åœ¨è™šæ‹Ÿçš„dataå­—æ®µï¼Œsizeofä¸èƒ½æ­£ç¡®è®¡ç®—metaé•¿åº¦ï¼Œè¿™é‡Œæ‰‹å·¥è®¾ç½® */</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span> 
</span></span><span class="line"><span class="cl"><span class="n">t_block</span> <span class="nf">extend_heap</span><span class="p">(</span><span class="n">t_block</span> <span class="n">last</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_block</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="o">=</span> <span class="nf">sbrk</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nf">sbrk</span><span class="p">(</span><span class="n">BLOCK_SIZE</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">last</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">last</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span><span class="o">-&gt;</span><span class="n">free</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>åˆ†è£‚block</strong></p>
<p>First fitæœ‰ä¸€ä¸ªæ¯”è¾ƒè‡´å‘½çš„ç¼ºç‚¹ï¼Œå°±æ˜¯å¯èƒ½ä¼šè®©å¾ˆå°çš„sizeå æ®å¾ˆå¤§çš„ä¸€å—blockï¼Œæ­¤æ—¶ï¼Œä¸ºäº†æé«˜payloadï¼Œåº”è¯¥åœ¨å‰©ä½™æ•°æ®åŒºè¶³å¤Ÿå¤§çš„æƒ…å†µä¸‹ï¼Œå°†å…¶åˆ†è£‚ä¸ºä¸€ä¸ªæ–°çš„blockï¼Œç¤ºæ„å¦‚ä¸‹ï¼š</p>
<p><img src="https://i.loli.net/2020/10/30/wmhYx15ESOszQUD.png" alt="åˆ†è£‚block" /></p>
<p>å®žçŽ°ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">split_block</span><span class="p">(</span><span class="n">t_block</span> <span class="n">b</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_block</span> <span class="n">new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">new</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">+</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">new</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">-</span> <span class="n">s</span> <span class="o">-</span> <span class="n">BLOCK_SIZE</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">new</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">new</span><span class="o">-&gt;</span><span class="n">free</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>mallocå®žçŽ°</strong></p>
<p>æ³¨æ„é¦–å…ˆæˆ‘ä»¬è¦å®šä¹‰ä¸ªblocké“¾è¡¨çš„å¤´first_blockï¼Œåˆå§‹åŒ–ä¸ºNULLï¼›å¦å¤–ï¼Œæˆ‘ä»¬éœ€è¦å‰©ä½™ç©ºé—´è‡³å°‘æœ‰BLOCK_SIZE + 8æ‰æ‰§è¡Œåˆ†è£‚æ“ä½œã€‚</p>
<p>ç”±äºŽæˆ‘ä»¬å¸Œæœ›mallocåˆ†é…çš„æ•°æ®åŒºæ˜¯æŒ‰8å­—èŠ‚å¯¹é½ï¼Œæ‰€ä»¥åœ¨sizeä¸ä¸º8çš„å€æ•°æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†sizeè°ƒæ•´ä¸ºå¤§äºŽsizeçš„æœ€å°çš„8çš„å€æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">size_t</span> <span class="nf">align8</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">s</span> <span class="o">&amp;</span> <span class="mh">0x7</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">((</span><span class="n">s</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>mallocä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define BLOCK_SIZE 24
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="kt">void</span> <span class="o">*</span><span class="n">first_block</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="cm">/* other functions... */</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="nf">malloc</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_block</span> <span class="n">b</span><span class="p">,</span> <span class="n">last</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">size_t</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* å¯¹é½åœ°å€ */</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="nf">align8</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">first_block</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* æŸ¥æ‰¾åˆé€‚çš„block */</span>
</span></span><span class="line"><span class="cl">        <span class="n">last</span> <span class="o">=</span> <span class="n">first_block</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">b</span> <span class="o">=</span> <span class="nf">find_block</span><span class="p">(</span><span class="o">&amp;</span><span class="n">last</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="cm">/* å¦‚æžœå¯ä»¥ï¼Œåˆ™åˆ†è£‚ */</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">((</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span> <span class="n">BLOCK_SIZE</span> <span class="o">+</span> <span class="mi">8</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="nf">split_block</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">b</span><span class="o">-&gt;</span><span class="n">free</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="cm">/* æ²¡æœ‰åˆé€‚çš„blockï¼Œå¼€è¾Ÿä¸€ä¸ªæ–°çš„ */</span>
</span></span><span class="line"><span class="cl">            <span class="n">b</span> <span class="o">=</span> <span class="nf">extend_heap</span><span class="p">(</span><span class="n">last</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">b</span> <span class="o">=</span> <span class="nf">extend_heap</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">first_block</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="callocçš„å®žçŽ°">callocçš„å®žçŽ°</h5>
<p>æœ‰äº†mallocï¼Œå®žçŽ°callocåªè¦ä¸¤æ­¥ï¼š</p>
<ol>
<li>mallocä¸€æ®µå†…å­˜</li>
<li>å°†æ•°æ®åŒºå†…å®¹ç½®ä¸º0</li>
</ol>
<p>ç”±äºŽæˆ‘ä»¬çš„æ•°æ®åŒºæ˜¯æŒ‰8å­—èŠ‚å¯¹é½çš„ï¼Œæ‰€ä»¥ä¸ºäº†æé«˜æ•ˆçŽ‡ï¼Œæˆ‘ä»¬å¯ä»¥æ¯8å­—èŠ‚ä¸€ç»„ç½®0ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªä¸€ä¸ªå­—èŠ‚è®¾ç½®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ–°å»ºä¸€ä¸ªsize_tæŒ‡é’ˆï¼Œå°†å†…å­˜åŒºåŸŸå¼ºåˆ¶çœ‹åšsize_tç±»åž‹æ¥å®žçŽ°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="nf">calloc</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">number</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">size_t</span> <span class="o">*</span><span class="n">new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">size_t</span> <span class="n">s8</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">new</span> <span class="o">=</span> <span class="nf">malloc</span><span class="p">(</span><span class="n">number</span> <span class="o">*</span> <span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">new</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">s8</span> <span class="o">=</span> <span class="nf">align8</span><span class="p">(</span><span class="n">number</span> <span class="o">*</span> <span class="n">size</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">new</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="freeçš„å®žçŽ°">freeçš„å®žçŽ°</h5>
<p>freeçš„å®žçŽ°å¹¶ä¸åƒçœ‹ä¸ŠåŽ»é‚£ä¹ˆç®€å•ï¼Œè¿™é‡Œæˆ‘ä»¬è¦è§£å†³ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼š</p>
<ol>
<li>å¦‚ä½•éªŒè¯æ‰€ä¼ å…¥çš„åœ°å€æ˜¯æœ‰æ•ˆåœ°å€ï¼Œå³ç¡®å®žæ˜¯é€šè¿‡mallocæ–¹å¼åˆ†é…çš„æ•°æ®åŒºé¦–åœ°å€</li>
<li>å¦‚ä½•è§£å†³ç¢Žç‰‡é—®é¢˜</li>
</ol>
<p>é¦–å…ˆæˆ‘ä»¬è¦ä¿è¯ä¼ å…¥freeçš„åœ°å€æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™ä¸ªæœ‰æ•ˆåŒ…æ‹¬ä¸¤æ–¹é¢ï¼š</p>
<ul>
<li>åœ°å€åº”è¯¥åœ¨ä¹‹å‰mallocæ‰€åˆ†é…çš„åŒºåŸŸå†…ï¼Œå³åœ¨first_blockå’Œå½“å‰breakæŒ‡é’ˆèŒƒå›´å†…</li>
<li>è¿™ä¸ªåœ°å€ç¡®å®žæ˜¯ä¹‹å‰é€šè¿‡æˆ‘ä»¬è‡ªå·±çš„mallocåˆ†é…çš„</li>
</ul>
<p>ç¬¬ä¸€ä¸ªé—®é¢˜æ¯”è¾ƒå¥½è§£å†³ï¼Œåªè¦è¿›è¡Œåœ°å€æ¯”è¾ƒå°±å¯ä»¥äº†ï¼Œå…³é”®æ˜¯ç¬¬äºŒä¸ªé—®é¢˜ã€‚è¿™é‡Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šä¸€æ˜¯åœ¨ç»“æž„ä½“å†…åŸ‹ä¸€ä¸ªmagic numberå­—æ®µï¼Œfreeä¹‹å‰é€šè¿‡ç›¸å¯¹åç§»æ£€æŸ¥ç‰¹å®šä½ç½®çš„å€¼æ˜¯å¦ä¸ºæˆ‘ä»¬è®¾ç½®çš„magic numberï¼Œå¦ä¸€ç§æ–¹æ³•æ˜¯åœ¨ç»“æž„ä½“å†…å¢žåŠ ä¸€ä¸ªmagic pointerï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘æ•°æ®åŒºçš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼ˆä¹Ÿå°±æ˜¯åœ¨åˆæ³•æ—¶freeæ—¶ä¼ å…¥çš„åœ°å€ï¼‰ï¼Œæˆ‘ä»¬åœ¨freeå‰æ£€æŸ¥magic pointeræ˜¯å¦æŒ‡å‘å‚æ•°æ‰€æŒ‡åœ°å€ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ç¬¬äºŒç§æ–¹æ¡ˆï¼š</p>
<p>é¦–å…ˆæˆ‘ä»¬åœ¨ç»“æž„ä½“ä¸­å¢žåŠ magic pointerï¼ˆåŒæ—¶è¦ä¿®æ”¹BLOCK_SIZEï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">s_block</span> <span class="o">*</span><span class="n">t_block</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">s_block</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">size_t</span> <span class="n">size</span><span class="p">;</span>  <span class="cm">/* æ•°æ®åŒºå¤§å° */</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_block</span> <span class="n">next</span><span class="p">;</span> <span class="cm">/* æŒ‡å‘ä¸‹ä¸ªå—çš„æŒ‡é’ˆ */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">free</span><span class="p">;</span>     <span class="cm">/* æ˜¯å¦æ˜¯ç©ºé—²å— */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">padding</span><span class="p">;</span>  <span class="cm">/* å¡«å……4å­—èŠ‚ï¼Œä¿è¯metaå—é•¿åº¦ä¸º8çš„å€æ•° */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>    <span class="cm">/* Magic pointerï¼ŒæŒ‡å‘data */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="cm">/* è¿™æ˜¯ä¸€ä¸ªè™šæ‹Ÿå­—æ®µï¼Œè¡¨ç¤ºæ•°æ®å—çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œé•¿åº¦ä¸åº”è®¡å…¥meta */</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åŽæˆ‘ä»¬å®šä¹‰æ£€æŸ¥åœ°å€åˆæ³•æ€§çš„å‡½æ•°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">t_block</span> <span class="nf">get_block</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">*</span><span class="n">tmp</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="n">tmp</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">(</span><span class="n">p</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">-=</span> <span class="n">BLOCK_SIZE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">valid_addr</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">first_block</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="n">first_block</span> <span class="o">&amp;&amp;</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="nf">sbrk</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">p</span> <span class="o">==</span> <span class="p">(</span><span class="nf">get_block</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“å¤šæ¬¡mallocå’ŒfreeåŽï¼Œæ•´ä¸ªå†…å­˜æ± å¯èƒ½ä¼šäº§ç”Ÿå¾ˆå¤šç¢Žç‰‡blockï¼Œè¿™äº›blockå¾ˆå°ï¼Œç»å¸¸æ— æ³•ä½¿ç”¨ï¼Œç”šè‡³å‡ºçŽ°è®¸å¤šç¢Žç‰‡è¿žåœ¨ä¸€èµ·ï¼Œè™½ç„¶æ€»ä½“èƒ½æ»¡è¶³æŸæ­¤mallocè¦æ±‚ï¼Œä½†æ˜¯ç”±äºŽåˆ†å‰²æˆäº†å¤šä¸ªå°blockè€Œæ— æ³•fitï¼Œè¿™å°±æ˜¯ç¢Žç‰‡é—®é¢˜ã€‚</p>
<p>ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹å¼æ—¶å½“freeæŸä¸ªblockæ—¶ï¼Œå¦‚æžœå‘çŽ°å®ƒç›¸é‚»çš„blockä¹Ÿæ˜¯freeçš„ï¼Œåˆ™å°†blockå’Œç›¸é‚»blockåˆå¹¶ã€‚ä¸ºäº†æ»¡è¶³è¿™ä¸ªå®žçŽ°ï¼Œéœ€è¦å°†s_blockæ”¹ä¸ºåŒå‘é“¾è¡¨ã€‚ä¿®æ”¹åŽçš„blockç»“æž„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">s_block</span> <span class="o">*</span><span class="n">t_block</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">s_block</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">size_t</span> <span class="n">size</span><span class="p">;</span>  <span class="cm">/* æ•°æ®åŒºå¤§å° */</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_block</span> <span class="n">prev</span><span class="p">;</span> <span class="cm">/* æŒ‡å‘ä¸Šä¸ªå—çš„æŒ‡é’ˆ */</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_block</span> <span class="n">next</span><span class="p">;</span> <span class="cm">/* æŒ‡å‘ä¸‹ä¸ªå—çš„æŒ‡é’ˆ */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">free</span><span class="p">;</span>     <span class="cm">/* æ˜¯å¦æ˜¯ç©ºé—²å— */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">padding</span><span class="p">;</span>  <span class="cm">/* å¡«å……4å­—èŠ‚ï¼Œä¿è¯metaå—é•¿åº¦ä¸º8çš„å€æ•° */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>    <span class="cm">/* Magic pointerï¼ŒæŒ‡å‘data */</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="cm">/* è¿™æ˜¯ä¸€ä¸ªè™šæ‹Ÿå­—æ®µï¼Œè¡¨ç¤ºæ•°æ®å—çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œé•¿åº¦ä¸åº”è®¡å…¥meta */</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åˆå¹¶æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">t_block</span> <span class="nf">fusion</span><span class="p">(</span><span class="n">t_block</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">&amp;&amp;</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">free</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">b</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">+=</span> <span class="n">BLOCK_SIZE</span> <span class="o">+</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">b</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">=</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">b</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ‰äº†ä¸Šè¿°æ–¹æ³•ï¼Œfreeçš„å®žçŽ°æ€è·¯å°±æ¯”è¾ƒæ¸…æ™°äº†ï¼šé¦–å…ˆæ£€æŸ¥å‚æ•°åœ°å€çš„åˆæ³•æ€§ï¼Œå¦‚æžœä¸åˆæ³•åˆ™ä¸åšä»»ä½•äº‹ï¼›å¦åˆ™ï¼Œå°†æ­¤blockçš„freeæ ‡ä¸º1ï¼Œå¹¶ä¸”åœ¨å¯ä»¥çš„æƒ…å†µä¸‹ä¸ŽåŽé¢çš„blockè¿›è¡Œåˆå¹¶ã€‚å¦‚æžœå½“å‰æ˜¯æœ€åŽä¸€ä¸ªblockï¼Œåˆ™å›žé€€breakæŒ‡é’ˆé‡Šæ”¾è¿›ç¨‹å†…å­˜ï¼Œå¦‚æžœå½“å‰blockæ˜¯æœ€åŽä¸€ä¸ªblockï¼Œåˆ™å›žé€€breakæŒ‡é’ˆå¹¶è®¾ç½®first_blockä¸ºNULLã€‚å®žçŽ°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">free</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_block</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nf">valid_addr</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">b</span> <span class="o">=</span> <span class="nf">get_block</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">b</span><span class="o">-&gt;</span><span class="n">free</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">&amp;&amp;</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">free</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">b</span> <span class="o">=</span> <span class="nf">fusion</span><span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nf">fusion</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">prev</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">b</span><span class="o">-&gt;</span><span class="n">prev</span><span class="o">-&gt;</span><span class="n">prev</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="cl">                <span class="n">first_block</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nf">brk</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="reallocçš„å®žçŽ°">reallocçš„å®žçŽ°</h5>
<p>ä¸ºäº†å®žçŽ°reallocï¼Œæˆ‘ä»¬é¦–å…ˆè¦å®žçŽ°ä¸€ä¸ªå†…å­˜å¤åˆ¶æ–¹æ³•ã€‚å¦‚åŒcallocä¸€æ ·ï¼Œä¸ºäº†æ•ˆçŽ‡ï¼Œæˆ‘ä»¬ä»¥8å­—èŠ‚ä¸ºå•ä½è¿›è¡Œå¤åˆ¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">copy_block</span><span class="p">(</span><span class="n">t_block</span> <span class="n">src</span><span class="p">,</span> <span class="n">t_block</span> <span class="n">dst</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">size_t</span> <span class="o">*</span><span class="n">sdata</span><span class="p">,</span> <span class="o">*</span><span class="n">ddata</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">size_t</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sdata</span> <span class="o">=</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ddata</span> <span class="o">=</span> <span class="n">dst</span><span class="o">-&gt;</span><span class="n">ptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">src</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">dst</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">ddata</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sdata</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åŽæˆ‘ä»¬å¼€å§‹å®žçŽ°reallocã€‚ä¸€ä¸ªç®€å•ï¼ˆä½†æ˜¯ä½Žæ•ˆï¼‰çš„æ–¹æ³•æ˜¯mallocä¸€æ®µå†…å­˜ï¼Œç„¶åŽå°†æ•°æ®å¤åˆ¶è¿‡åŽ»ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åšçš„æ›´é«˜æ•ˆï¼Œå…·ä½“å¯ä»¥è€ƒè™‘ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>å¦‚æžœå½“å‰blockçš„æ•°æ®åŒºå¤§äºŽç­‰äºŽreallocæ‰€è¦æ±‚çš„sizeï¼Œåˆ™ä¸åšä»»ä½•æ“ä½œ</li>
<li>å¦‚æžœæ–°çš„sizeå˜å°äº†ï¼Œè€ƒè™‘split</li>
<li>å¦‚æžœå½“å‰blockçš„æ•°æ®åŒºä¸èƒ½æ»¡è¶³sizeï¼Œä½†æ˜¯å…¶åŽç»§blockæ˜¯freeçš„ï¼Œå¹¶ä¸”åˆå¹¶åŽå¯ä»¥æ»¡è¶³ï¼Œåˆ™è€ƒè™‘åšåˆå¹¶</li>
</ul>
<p>ä¸‹é¢æ˜¯reallocçš„å®žçŽ°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="kt">void</span> <span class="o">*</span><span class="nf">realloc</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">size_t</span> <span class="n">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">t_block</span> <span class="n">b</span><span class="p">,</span> <span class="n">new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="o">*</span><span class="n">newp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="cm">/* æ ¹æ®æ ‡å‡†åº“æ–‡æ¡£ï¼Œå½“pä¼ å…¥NULLæ—¶ï¼Œç›¸å½“äºŽè°ƒç”¨malloc */</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nf">malloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nf">valid_addr</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">s</span> <span class="o">=</span> <span class="nf">align8</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">b</span> <span class="o">=</span> <span class="nf">get_block</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">-</span> <span class="n">s</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">BLOCK_SIZE</span> <span class="o">+</span> <span class="mi">8</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="nf">split_block</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="cm">/* çœ‹æ˜¯å¦å¯è¿›è¡Œåˆå¹¶ */</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">next</span> <span class="o">&amp;&amp;</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">free</span>
</span></span><span class="line"><span class="cl">                    <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">+</span> <span class="n">BLOCK_SIZE</span> <span class="o">+</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nf">fusion</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span><span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">-</span> <span class="n">s</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">BLOCK_SIZE</span> <span class="o">+</span> <span class="mi">8</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                    <span class="nf">split_block</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="cm">/* æ–°malloc */</span>
</span></span><span class="line"><span class="cl">                <span class="n">newp</span> <span class="o">=</span> <span class="nf">malloc</span> <span class="p">(</span><span class="n">s</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">newp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">new</span> <span class="o">=</span> <span class="nf">get_block</span><span class="p">(</span><span class="n">newp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nf">copy_block</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">new</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="nf">free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span><span class="p">(</span><span class="n">newp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="é—ç•™é—®é¢˜å’Œä¼˜åŒ–">é—ç•™é—®é¢˜å’Œä¼˜åŒ–</h5>
<p>ä»¥ä¸Šæ˜¯ä¸€ä¸ªè¾ƒä¸ºç®€é™‹ï¼Œä½†æ˜¯åˆæ­¥å¯ç”¨çš„mallocå®žçŽ°ã€‚è¿˜æœ‰å¾ˆå¤šé—ç•™çš„å¯èƒ½ä¼˜åŒ–ç‚¹ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>åŒæ—¶å…¼å®¹32ä½å’Œ64ä½ç³»ç»Ÿ</li>
<li>åœ¨åˆ†é…è¾ƒå¤§å¿«å†…å­˜æ—¶ï¼Œè€ƒè™‘ä½¿ç”¨mmapè€Œéžsbrkï¼Œè¿™é€šå¸¸æ›´é«˜æ•ˆ</li>
<li>å¯ä»¥è€ƒè™‘ç»´æŠ¤å¤šä¸ªé“¾è¡¨è€Œéžå•ä¸ªï¼Œæ¯ä¸ªé“¾è¡¨ä¸­çš„blockå¤§å°å‡ä¸ºä¸€ä¸ªèŒƒå›´å†…ï¼Œä¾‹å¦‚8å­—èŠ‚é“¾è¡¨ã€16å­—èŠ‚é“¾è¡¨ã€24-32å­—èŠ‚é“¾è¡¨ç­‰ç­‰ã€‚æ­¤æ—¶å¯ä»¥æ ¹æ®sizeåˆ°å¯¹åº”é“¾è¡¨ä¸­åšåˆ†é…ï¼Œå¯ä»¥æœ‰æ•ˆå‡å°‘ç¢Žç‰‡ï¼Œå¹¶æé«˜æŸ¥è¯¢blockçš„é€Ÿåº¦</li>
<li>å¯ä»¥è€ƒè™‘é“¾è¡¨ä¸­åªå­˜æ”¾freeçš„blockï¼Œè€Œä¸å­˜æ”¾å·²åˆ†é…çš„blockï¼Œå¯ä»¥å‡å°‘æŸ¥æ‰¾blockçš„æ¬¡æ•°ï¼Œæé«˜æ•ˆçŽ‡</li>
</ul>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://zhuanlan.zhihu.com/p/36550234">åå››. malloc&amp;freeçš„å®žçŽ°</a></li>
<li><a href="https://blog.codinglabs.org/articles/a-malloc-tutorial.html">å¦‚ä½•å®žçŽ°ä¸€ä¸ªmalloc</a></li>
<li><a href="https://blog.csdn.net/yusiguyuan/article/details/39496305">brk(ï¼‰å’Œsbrk()å‡½æ•°çš„ä½¿ç”¨</a></li>
</ol>
<h4 id="mmap">mmap()</h4>
<p>åˆ›å»ºè¿›ç¨‹æ—¶ï¼Œå»ºç«‹è™šå­˜ç©ºé—´å’Œå…·ä½“æ–‡ä»¶ä¹‹é—´çš„æ˜ å°„ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯å»ºç«‹æ˜ å°„çš„è¿‡ç¨‹ä¸­å®Œæˆå¾ˆå¤šå¤æ‚çš„éœ€æ±‚ï¼Œæ¯”å¦‚ç”¨å‡½æ•°æŒ‡é’ˆæ¥ç»‘å®šä¸€äº›å¯¹é¡µé¢çš„æ“ä½œã€‚è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨çš„å®žçŽ°è¿‡ç¨‹å…¶å®žå¹¶ä¸ç®€å•ï¼Œéžå¸¸å€¼å¾—ç ”ç©¶ï¼Œå…·ä½“è¿˜æ˜¯å‚çœ‹ä¹¦ç±ã€‚</p>
<p><strong>ç»“è®º</strong></p>
<p>1ï¼‰å½“å¼€è¾Ÿçš„ç©ºé—´å°äºŽ 128K æ—¶ï¼Œè°ƒç”¨ brkï¼ˆï¼‰å‡½æ•°ï¼Œmalloc çš„åº•å±‚å®žçŽ°æ˜¯ç³»ç»Ÿè°ƒç”¨å‡½æ•° brkï¼ˆï¼‰ï¼Œå…¶ä¸»è¦ç§»åŠ¨æŒ‡é’ˆ _enddata(æ­¤æ—¶çš„ _enddata æŒ‡çš„æ˜¯ Linux åœ°å€ç©ºé—´ä¸­å †æ®µçš„æœ«å°¾åœ°å€ï¼Œä¸æ˜¯æ•°æ®æ®µçš„æœ«å°¾åœ°å€)</p>
<p>2ï¼‰å½“å¼€è¾Ÿçš„ç©ºé—´å¤§äºŽ 128K æ—¶ï¼Œmmapï¼ˆï¼‰ç³»ç»Ÿè°ƒç”¨å‡½æ•°æ¥åœ¨è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼ˆå †å’Œæ ˆä¸­é—´ï¼Œç§°ä¸ºâ€œæ–‡ä»¶æ˜ å°„åŒºåŸŸâ€çš„åœ°æ–¹ï¼‰æ‰¾ä¸€å—ç©ºé—´æ¥å¼€è¾Ÿã€‚</p>
<hr />
<p>å‚è€ƒï¼š<a href="https://www.cnblogs.com/zpcoding/p/10808969.html">malloc åº•å±‚å®žçŽ°åŠåŽŸç†</a></p>
<h4 id="å†…å­˜ç®¡ç†çš„æœ¬è´¨">å†…å­˜ç®¡ç†çš„æœ¬è´¨</h4>
<p>å¯¹äºŽç¤¾ä¼šæ¥è®²ï¼Œâ€œç®¡ç†â€æ˜¯äººç±»å‘å±•åˆ°ä¸€å®šé˜¶æ®µæ‰äº§ç”Ÿçš„ã€‚æ‹¿æ—¶ä¸‹æœ€ç–¯ç‹‚çš„ä¸€ä»¶äº‹â€œä¹°æˆ¿â€æ¥ä¸¾ä¾‹ï¼Œå½“æˆ‘æŠµä¸Šæœªæ¥20å¹´çš„é’æ˜¥ä¹°åˆ°ä¸€å¥—æˆ¿å­åŽï¼Œå¹¶ä¸æ˜¯å°†æˆ¿å­ä»Žåœ°ä¸ŠæŒ–èµ·æ¥é€åˆ°æˆ‘é¢å‰ï¼Œè€Œåªæ˜¯åœ¨åˆæ³•éƒ¨é—¨å°†æˆ¿å­çš„æ‰€å±žæƒè·Ÿæˆ‘çš„**å·å…³è”èµ·æ¥ï¼Œæˆ‘å°±æœ‰æƒä½è¿›è¿™ä¸ªæˆ¿å­äº†ã€‚è…¿é•¿åœ¨æˆ‘è‡ªå·±èº«ä¸Šï¼ŒæŒ‰é“ç†æˆ‘æƒ³è¿›è°çš„æˆ¿å­å°±è¿›è°çš„æˆ¿å­å‘€ï¼Œä½†é™¤éžæ˜¯åœ¨åŽŸå§‹ç¤¾ä¼šï¼Œåœ¨æœ‰äº†â€œç®¡ç†â€çš„å½“ä»Šç¤¾ä¼šï¼Œä¹±è·‘å°±ä¼šè¢«æŠ“èµ·æ¥ï¼åŽŸå§‹ç¤¾ä¼šåªç”Ÿæ´»ç€ä¸€ä¸ªæˆ–å°‘é‡çŒ¿çŒ´ï¼ˆéœ€&laquo;æ±‚ï¼‰ï¼Œéšä¾¿æ‰¾ä¸ªæ´žç©´å°±æ˜¯æˆ¿å­ï¼Œä¸€æ–‡ä¸å€¼ï¼ŒçŒ¿çŒ´ä¸ä¼šå› ä¸ºæˆ¿å­è€Œå‘ç”Ÿå†²çªï¼Œæ‰€ä»¥æ‰ä¸éœ€è¦ç®¡ç†ã€‚</p>
<p>å¯¹è®¡ç®—æœºæ¥è®²ï¼Œä»ŽåŠ ç”µåˆ°å¯åŠ¨å®Œæˆï¼Œä¹Ÿç»åŽ†äº†â€œåŽŸå§‹ç¤¾ä¼šâ€åˆ°â€œå½“ä»Šç¤¾ä¼šâ€çš„è¿‡ç¨‹ï¼Œå³â€œå®žæ¨¡å¼â†’ä¿æŠ¤æ¨¡å¼â€ï¼Œå®žæ¨¡å¼æ—¶åªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªå·´æŽŒæ‹ä¸å“ï¼Œæ‰€ä»¥ä¸æ‹…å¿ƒå¹²æ‰°ï¼Œåªç®¡ä¸ºè¿›å…¥ä¿æŠ¤æ¨¡å¼ä½œå¥½å‡†å¤‡ï¼Œå¹¶åˆ‡æ¢åˆ°ä¿æŠ¤æ¨¡å¼ã€‚ä¸€æ—¦è¿›å…¥ä¿æŠ¤æ¨¡å¼ï¼Œå®žé™…ä¸Šå°±æ˜¯å¯åŠ¨ä¸€äº›é˜²æ­¢ç›¸äº’å¹²æ‰°çš„â€œç®¡ç†â€ï¼Œå…¶ä¸­å†…å­˜ç®¡ç†å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œä»Žè€Œå¤šä¸ªè¿›ç¨‹æ‰èƒ½å’Œè°å…±å¤„ã€‚</p>
<p>å†…æ ¸è¦ä¿è¯å„ä¸ªè¿›ç¨‹å¯¹ç‰©ç†å†…å­˜ï¼ˆç³»ç»ŸèŒƒå›´å”¯ä¸€ï¼‰çš„ä½¿ç”¨ä¸å‘ç”Ÿå¹²æ‰°ï¼Œä¹Ÿè¦ä¿è¯æ¯ä¸ªè¿›ç¨‹ä¸­ä¸åŒçš„ç¨‹åºç‰‡æ®µå¯¹è™šæ‹Ÿå†…å­˜ï¼ˆè¿›ç¨‹èŒƒå›´å”¯ä¸€ï¼‰çš„ä½¿ç”¨ä¸å‘ç”Ÿå¹²æ‰°ï¼š<br />
â‘  æ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±ç‹¬ç«‹çš„æ˜ å°„å…³ç³»è¡¨ï¼Œå†…æ ¸çš„è§†é‡Žèƒ½çœ‹è§ç³»ç»Ÿæ‰€æœ‰è¿›ç¨‹ï¼Œè‡ªç„¶ä¹Ÿèƒ½ä¿è¯å„ä¸ªè¿›ç¨‹å¯¹ç‰©ç†é¡µé¢çš„ä½¿ç”¨ä¸å†²çªã€‚<br />
â‘¡ ç¨‹åºä¸­çš„å…¨å±€å˜é‡ã€staticå˜é‡ã€å‡½æ•°åç­‰ï¼Œç”±ç¼–è¯‘å™¨å®‰æŽ’ä¸å†²çªçš„è™šæ‹Ÿåœ°å€ï¼ŒåŠ¨æ€åˆ†é…/é‡Šæ”¾æ—¶ï¼Œå¯¹è™šæ‹Ÿé¡µé¢çš„ä½¿ç”¨éƒ½å»ºç«‹è®°å½•ä¿¡æ¯ï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šå‘ç”Ÿå†²çªã€‚</p>
<p>æ‰€ä»¥å†…å­˜ç®¡ç†çš„æœ¬è´¨å°±æ˜¯ä¸ºé˜²æ­¢å¹²æ‰°ã€æ•ˆçŽ‡ã€æ¢å…¥æ¢å‡ºç­‰å»ºç«‹è®°å½•ä¿¡æ¯ï¼Œå¹¶åˆ©ç”¨è¿™äº›ä¿¡æ¯è¾¾åˆ°ç›¸åº”çš„ç›®çš„ã€‚<br />
ä»¥ä¸‹å°±æ˜¯åˆ†é…å†…å­˜æ—¶ï¼Œå»ºç«‹ç®¡ç†ä¿¡æ¯çš„å¤§è‡´ç¤ºæ„å›¾ï¼š</p>
<p><img src="https://i.loli.net/2020/10/16/IrLsGm5u2Pgqdih.png" alt="img" /></p>
<ul>
<li>
<p>brk()</p>
<p>ä»Žä¸Šå›¾ä¹Ÿå¯ä»¥çœ‹å‡ºLinuxå¯¹è™šæ‹Ÿç©ºé—´çš„ä½¿ç”¨å®‰æŽ’ï¼Œbrk()å°±æ˜¯æ“ä½œåŠ¨æ€åˆ†é…åŒºé—´çš„è™šæ‹Ÿåœ°å€ï¼ˆåˆ†é…/é‡Šæ”¾ï¼‰ã€‚glibcåº“ä¸­çš„malloc()å‡½æ•°ï¼Œå°±æ˜¯ç”¨brk()ç³»ç»Ÿè°ƒç”¨åˆ†é…/é‡Šæ”¾è™šæ‹Ÿé¡µé¢ã€‚<br />
æ³¨æ„ï¼š<br />
<em>char *p = malloc(); // ä¸èƒ½free(p+1)</em><br />
<em>brk()å¾—åˆ°çš„ä¸€ä¸ªè™šæ‹Ÿåœ°å€åŒºé—´ï¼ˆå›¾ä¸­ç°è‰²åŒºåŸŸï¼Œç”¨vm_area_structç»“æž„è¡¨ç¤ºï¼‰ï¼Œå¯ä»¥é‡Šæ”¾å½“ä¸­ä¸€éƒ¨åˆ†ï¼Œè€Œè£‚ä¸ºä¸¤ä¸ªåŒºåŸŸ</em></p>
</li>
</ul>
<h4 id="linuxç¼“å†²åŒº">Linuxç¼“å†²åŒºðŸƒ</h4>
<p>linuxä¸­æœ‰ä¸¤ä¸ªçº§åˆ«çš„ç¼“å†²ï¼šIOç¼“å†²ä¸Žå†…æ ¸ç¼“å†²</p>
<p>ï¼ˆ1ï¼‰IOç¼“å†²:å¯¹äºŽæ ‡å‡†IOæ“ä½œï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªç¼“å†²åŒºï¼Œå½“ç”¨æˆ·æƒ³è¦å†™æ•°æ®æ—¶ï¼Œé¦–å…ˆå°†æ•°æ®å†™å…¥ç¼“å†²åŒºï¼Œå¾…ç¼“å†²åŒºæ»¡ä¹‹åŽæ‰èƒ½è°ƒç”¨ç³»ç»Ÿå‡½æ•°å†™å…¥å†…æ ¸ç¼“å†²åŒºã€‚å½“ç”¨æˆ·æƒ³è¯»å–æ•°æ®æ—¶ï¼Œé¦–å…ˆå‘å†…æ ¸è¯»å–ä¸€å®šçš„æ•°æ®æ”¾å…¥IOç¼“å†²åŒºï¼Œè¯»æ“ä½œä»Žç¼“å†²åŒºä¸­è¯»æ•°æ®ï¼Œå½“è¯»å®ŒIOç¼“å†²åŒºçš„æ•°æ®æ—¶ï¼Œæ‰èƒ½å†è¯»å–æ•°æ®åˆ°IOç¼“å†²åŒºã€‚</p>
<p>ç›®çš„ï¼šå‡å°‘å¯¹ç£ç›˜çš„è¯»å†™æ¬¡æ•°ï¼Œæé«˜å·¥ä½œæ•ˆçŽ‡ã€‚</p>
<p>ï¼ˆ2ï¼‰å†…æ ¸ç¼“å†²åŒº:æ“ä½œç³»ç»Ÿå†…æ ¸éƒ¨åˆ†ä¹Ÿæœ‰ç¼“å†²ï¼Œå…¶ä¸ŽIOç¼“å†²åŒºæ˜¯ä¸åŒçš„ï¼Œå…¶ä¸»è¦åŒºåˆ«ç”¨ä¸€å¼ å›¾è¡¨ç¤ºï¼š</p>
<img src="https://i.loli.net/2020/10/26/74NzDaZK6rIxlpM.png" alt="Linuxä¸‹çš„æ–‡ä»¶I/Oç¼–ç¨‹Linuxä¸‹çš„æ–‡ä»¶I/Oç¼–ç¨‹" style="zoom: 67%;" />
<ul>
<li>æ“ä½œç³»ç»Ÿï¼ˆå†…æ ¸ï¼‰å…ˆä»Žç£ç›˜è¯»å–æ•°æ®åˆ°å†…æ ¸ç©ºé—´çš„å†…å­˜ï¼ˆreadâ‘ ï¼‰ï¼Œå†æŠŠæ•°æ®ä»Žå†…æ ¸ç©ºé—´å†…å­˜æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´å†…å­˜ï¼ˆreadâ‘¡ï¼‰ã€‚æ­¤åŽï¼Œç”¨æˆ·åº”ç”¨ç¨‹åºæ‰å¯ä»¥æ“ä½œæ­¤æ•°æ®ã€‚</li>
</ul>
<p><strong>é‚£ä¹ˆå†…æ ¸ç¼“å†²åšäº†ä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿ</strong></p>
<ol>
<li>è¯»ï¼šæ•°æ®é¢„è¯»</li>
<li>å†™ï¼šå»¶æ—¶å›žå†™</li>
</ol>
<hr />
<p>å‚è€ƒé“¾æŽ¥ï¼š</p>
<ol>
<li><a href="https://github.com/raxxarr/note/issues/2">https://github.com/raxxarr/note/issues/2</a></li>
</ol>
<h4 id="ä»€ä¹ˆæ˜¯rpc">ä»€ä¹ˆæ˜¯RPC</h4>
<p>RPCæ˜¯æŒ‡è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸¤å°æœåŠ¡å™¨Aï¼ŒBï¼Œä¸€ä¸ªåº”ç”¨éƒ¨ç½²åœ¨AæœåŠ¡å™¨ä¸Šï¼Œæƒ³è¦è°ƒç”¨BæœåŠ¡å™¨ä¸Šåº”ç”¨æä¾›çš„å‡½æ•°/æ–¹æ³•ï¼Œç”±äºŽä¸åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œä¸èƒ½ç›´æŽ¥è°ƒç”¨ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œæ¥è¡¨è¾¾è°ƒç”¨çš„è¯­ä¹‰å’Œä¼ è¾¾è°ƒç”¨çš„æ•°æ®ã€‚</p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://www.jianshu.com/p/eb66b0c4113d">ä»€ä¹ˆæ˜¯RPC? ä¸ºä»€ä¹ˆè¦ç”¨RPCï¼Ÿ</a></li>
<li><a href="https://www.jianshu.com/p/7d6853140e13">ä»€ä¹ˆæ˜¯RPCï¼Ÿ</a></li>
</ol>
<h4 id="çº¿ç¨‹åŒæ­¥çš„æ–¹å¼æœ‰å“ªäº›">çº¿ç¨‹åŒæ­¥çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</h4>
<ul>
<li><strong>äº’æ–¥é‡</strong>ï¼šé‡‡ç”¨äº’æ–¥å¯¹è±¡æœºåˆ¶ï¼Œåªæœ‰æ‹¥æœ‰äº’æ–¥å¯¹è±¡çš„çº¿ç¨‹æ‰æœ‰è®¿é—®å…¬å…±èµ„æºçš„æƒé™ã€‚å› ä¸ºäº’æ–¥å¯¹è±¡åªæœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯å…¬å…±èµ„æºä¸ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ã€‚</li>
<li><strong>ä¿¡å·é‡</strong>ï¼šå®ƒå…è®¸åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€èµ„æºï¼Œä½†æ˜¯éœ€è¦æŽ§åˆ¶åŒä¸€æ—¶åˆ»è®¿é—®æ­¤èµ„æºçš„æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚</li>
<li><strong>äº‹ä»¶ï¼ˆä¿¡å·ï¼‰</strong>ï¼šé€šè¿‡é€šçŸ¥æ“ä½œçš„æ–¹å¼æ¥ä¿æŒå¤šçº¿ç¨‹åŒæ­¥ï¼Œè¿˜å¯ä»¥æ–¹ä¾¿çš„å®žçŽ°å¤šçº¿ç¨‹ä¼˜å…ˆçº§çš„æ¯”è¾ƒæ“ä½œã€‚</li>
</ul>
<h4 id="ä¸­æ–­å’Œè½®è¯¢çš„ç‰¹ç‚¹-1">ä¸­æ–­å’Œè½®è¯¢çš„ç‰¹ç‚¹?</h4>
<p>å¯¹I/Oè®¾å¤‡çš„ç¨‹åºè½®è¯¢çš„æ–¹å¼ï¼Œæ˜¯æ—©æœŸçš„è®¡ç®—æœºç³»ç»Ÿå¯¹I/Oè®¾å¤‡çš„ä¸€ç§ç®¡ç†æ–¹å¼ã€‚å®ƒå®šæ—¶å¯¹å„ç§è®¾å¤‡è½®æµè¯¢é—®ä¸€éæœ‰æ— å¤„ç†è¦æ±‚ã€‚è½®æµè¯¢é—®ä¹‹åŽï¼Œæœ‰è¦æ±‚çš„ï¼Œåˆ™åŠ ä»¥å¤„ç†ã€‚åœ¨å¤„ç†I/Oè®¾å¤‡çš„è¦æ±‚ä¹‹åŽï¼Œå¤„ç†æœºè¿”å›žç»§ç»­å·¥ä½œã€‚å°½ç®¡è½®è¯¢éœ€è¦æ—¶é—´ï¼Œä½†è½®è¯¢è¦æ¯”I/Oè®¾å¤‡çš„é€Ÿåº¦è¦å¿«å¾—å¤šï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šå‘ç”Ÿä¸èƒ½åŠæ—¶å¤„ç†çš„é—®é¢˜ã€‚å½“ç„¶ï¼Œå†å¿«çš„å¤„ç†æœºï¼Œèƒ½å¤„ç†çš„è¾“å…¥è¾“å‡ºè®¾å¤‡çš„æ•°é‡ä¹Ÿæ˜¯æœ‰ä¸€å®šé™åº¦çš„ã€‚è€Œä¸”ï¼Œç¨‹åºè½®è¯¢æ¯•ç«Ÿå æ®äº†CPUç›¸å½“ä¸€éƒ¨åˆ†å¤„ç†æ—¶é—´ï¼Œå› æ­¤ï¼Œç¨‹åº<strong>è½®è¯¢</strong>æ˜¯ä¸€ç§<strong>æ•ˆçŽ‡è¾ƒä½Ž</strong>çš„æ–¹å¼ï¼Œåœ¨çŽ°ä»£è®¡ç®—æœºç³»ç»Ÿä¸­å·²å¾ˆå°‘åº”ç”¨ã€‚</p>
<p>ã€€ã€€ç¨‹åºä¸­æ–­é€šå¸¸ç®€ç§°<strong>ä¸­æ–­</strong>ï¼Œæ˜¯æŒ‡CPUåœ¨æ­£å¸¸è¿è¡Œç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œç”±äºŽé¢„å…ˆå®‰æŽ’æˆ–å‘ç”Ÿäº†å„ç§éšæœºçš„å†…éƒ¨æˆ–å¤–éƒ¨äº‹ä»¶ï¼Œä½¿CPUä¸­æ–­æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼Œè€Œè½¬åˆ°ä¸ºå“åº”çš„æœåŠ¡ç¨‹åºåŽ»å¤„ç†ã€‚</p>
<p>ã€€ã€€è½®è¯¢â€”â€”æ•ˆçŽ‡ä½Žï¼Œç­‰å¾…æ—¶é—´å¾ˆé•¿ï¼ŒCPUåˆ©ç”¨çŽ‡ä¸é«˜ã€‚</p>
<p>ã€€ã€€ä¸­æ–­â€”â€”å®¹æ˜“é—æ¼ä¸€äº›é—®é¢˜ï¼ŒCPUåˆ©ç”¨çŽ‡é«˜</p>
<h4 id="è¾“å…¥ä¸Žè¾“å‡º">è¾“å…¥ä¸Žè¾“å‡º</h4>
<p>è®¾å¤‡</p>
<ul>
<li>
<p>å—è®¾å¤‡</p>
<p>å—è®¾å¤‡å­˜å‚¨åœ¨å›ºå®šå¤§å°çš„å—ä¸­ï¼Œæ¯ä¸ªå—æœ‰è‡ªå·±çš„åœ°å€ã€‚å—è®¾å¤‡çš„åŸºæœ¬ç‰¹å¾æ˜¯æ¯ä¸ªå—éƒ½èƒ½ç‹¬ç«‹äºŽå…¶ä»–å—è€Œè¯»å†™ã€‚ç¡¬ç›˜ã€CD-ROM å’Œ USB ç›˜æ˜¯æœ€å¸¸è§çš„å—è®¾å¤‡ã€‚</p>
</li>
<li>
<p>å­—ç¬¦è®¾å¤‡</p>
<p>å­—ç¬¦è®¾å¤‡ä»¥å­—ç¬¦ä¸ºå•ä½å‘é€æˆ–æŽ¥æ”¶ä¸€ä¸ªå­—ç¬¦æµï¼Œè€Œä¸è€ƒè™‘ä»»ä½•å—ç»“æž„ã€‚å­—ç¬¦è®¾å¤‡æ˜¯ä¸å¯å¯»å€çš„ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•å¯»é“æ“ä½œã€‚æ‰“å°æœºã€ç½‘ç»œæŽ¥å£ã€é¼ æ ‡ï¼Œä»¥åŠå¤§å¤šæ•°ä¸Žç£ç›˜ä¸åŒçš„è®¾å¤‡éƒ½å¯çœ‹ä½œæ˜¯å­—ç¬¦è®¾å¤‡ã€‚</p>
</li>
</ul>
<p>IOæŽ§åˆ¶æ–¹å¼</p>
<ol>
<li>
<p><strong>ç¨‹åºç›´æŽ¥æŽ§åˆ¶æ–¹å¼</strong>ã€‚è®¡ç®—æœºä»Žå¤–éƒ¨è®¾å¤‡è¯»å–æ•°æ®åˆ°å­˜å‚¨å™¨ï¼Œæ¯æ¬¡è¯»ä¸€ä¸ªå­—çš„æ•°æ®ã€‚å¯¹è¯»å…¥çš„æ¯ä¸ªå­—ï¼ŒCPU éœ€è¦å¯¹å¤–è®¾çŠ¶æ€è¿›è¡Œå¾ªçŽ¯æ£€æŸ¥çŸ¥é“ç¡®å®šè¯¥å­—å·²ç»åœ¨ I/O æŽ§åˆ¶å™¨çš„æ•°æ®å¯„å­˜å™¨ä¸­ã€‚</p>
</li>
<li>
<p><strong>ä¸­æ–­é©±åŠ¨æ–¹å¼</strong>ã€‚å…è®¸ I/O è®¾å¤‡ä¸»åŠ¨æ‰“æ–­ CPU çš„è¿è¡Œå¹¶è¯·æ±‚æœåŠ¡ï¼Œä»Žè€Œâ€œè§£æ”¾â€ CPUï¼Œä½¿å¾—å…¶å‘ I/O æŽ§åˆ¶å™¨å‘é€è¯»å‘½ä»¤åŽå¯ä»¥ç»§ç»­åšå…¶ä»–æœ‰ç”¨çš„å·¥ä½œã€‚</p>
</li>
<li>
<p><strong>DMA æ–¹å¼</strong>ã€‚DMA(ç›´æŽ¥å­˜å‚¨å™¨)æ–¹å¼çš„åŸºæœ¬æ€æƒ³æ˜¯åœ¨ I/O è®¾å¤‡å’Œå†…å­˜ä¹‹é—´å¼€è¾Ÿç›´æŽ¥çš„æ•°æ®äº¤æ¢é€šè·¯ï¼Œå½»åº•â€œè§£æ”¾â€ CPUã€‚DMAç‰¹ç‚¹å¦‚ä¸‹ï¼šï¼ˆ1ï¼‰åŸºæœ¬å•ä½æ˜¯æ•°æ®å— ï¼ˆ2ï¼‰æ‰€ä¼ é€çš„æ•°æ®ï¼Œæ˜¯ä»Žè®¾å¤‡ç›´æŽ¥é€å…¥å†…å­˜çš„ï¼Œæˆ–è€…ç›¸å ï¼ˆ3ï¼‰ä»…åœ¨ä¼ é€ä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®å—çš„å¼€å§‹å’Œç»“æŸæ—¶ï¼Œæ‰éœ€ CPU å¹²é¢„ï¼Œæ•´å—æ•°æ®çš„ä¼ é€æ˜¯åœ¨ DMA æŽ§åˆ¶å™¨çš„æŽ§åˆ¶ä¸‹å®Œæˆçš„ã€‚</p>
<p>ä¸ºäº†åœ¨ä¸»æœºä¸ŽæŽ§åˆ¶å™¨ä¹‹é—´å®žçŽ°æˆå—æ•°æ®çš„ç›´æŽ¥äº¤æ¢ï¼Œå¿…é¡»åœ¨ DMA æŽ§åˆ¶å™¨ä¸­è®¾ç½®å¦‚ä¸‹4ç±»å¯„å­˜å™¨ï¼š</p>
<ul>
<li>å‘½ä»¤/çŠ¶æ€å¯„å­˜å™¨ï¼ˆCRï¼‰ã€‚ç”¨äºŽæŽ¥æ”¶ä»Ž CPU å‘æ¥çš„ I/O å‘½ä»¤æˆ–æœ‰å…³æŽ§åˆ¶ä¿¡æ¯ï¼Œæˆ–è®¾å¤‡çš„çŠ¶æ€ã€‚</li>
<li>å†…å­˜åœ°å€å¯„å­˜å™¨ï¼ˆMARï¼‰ã€‚åœ¨è¾“å…¥æ—¶ï¼Œå®ƒå­˜æ”¾æŠŠæ•°æ®ä»Žè®¾å¤‡ä¼ é€åˆ°å†…å­˜çš„èµ·å§‹ç›®æ ‡åœ°å€ï¼›åœ¨è¾“å‡ºæ—¶ï¼Œå®ƒå­˜æ”¾ç”±å†…å­˜åˆ°è®¾å¤‡çš„å†…å­˜æºåœ°å€ã€‚</li>
<li>æ•°æ®å¯„å­˜å™¨ï¼ˆDRï¼‰ã€‚ç”¨äºŽæš‚å­˜ä»Žè®¾å¤‡åˆ°å†…å­˜æˆ–ä»Žå†…å­˜åˆ°è®¾å¤‡çš„æ•°æ®ã€‚</li>
<li>æ•°æ®è®¡æ•°å™¨ï¼ˆDCï¼‰ã€‚å­˜æ”¾æœ¬æ¬¡è¦ä¼ é€çš„å­—ï¼ˆèŠ‚ï¼‰æ•°ã€‚</li>
</ul>
</li>
<li>
<p><strong>é€šé“æŽ§åˆ¶æ–¹å¼</strong>ã€‚I/O é€šé“æ˜¯æŒ‡ä¸“é—¨è´Ÿè´£è¾“å…¥/è¾“å‡ºçš„å¤„ç†æœºã€‚I/O é€šé“æ˜¯ DMA æ–¹å¼çš„å‘å±•,å®ƒå¯ä»¥è¿›ä¸€æ­¥å‡å°‘ CPU çš„å¹²é¢„ï¼Œå³æŠŠå¯¹ä¸€ä¸ªæ•°æ®å—çš„è¯»ï¼ˆæˆ–å†™ï¼‰ä¸ºå•ä½çš„å¹²é¢„ï¼Œå‡å°‘ä¸ºå¯¹ä¸€ç»„æ•°æ®å—çš„è¯»ï¼ˆæˆ–å†™ï¼‰åŠæœ‰å…³æŽ§åˆ¶å’Œç®¡ç†ä¸ºå•ä½çš„å¹²é¢„ã€‚I/O é€šé“ä¸Žä¸€èˆ¬å¤„ç†æœºçš„åŒºåˆ«æ˜¯ï¼šé€šé“æŒ‡ä»¤çš„ç±»åž‹å•ä¸€æ²¡æœ‰è‡ªå·±çš„å†…å­˜ï¼Œé€šé“æ‰€æ‰§è¡Œçš„é€šé“ç¨‹åºæ˜¯æ”¾åœ¨ä¸»æœºå†…å­˜ä¸­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´é€šé“ä¸Ž CPU å…±äº«å†…å­˜ã€‚I/O é€šé“ä¸Ž DMA æ–¹å¼çš„åŒºåˆ«æ˜¯ï¼šDMA æ–¹å¼éœ€è¦ CPU æ¥æŽ§åˆ¶ä¼ è¾“çš„æ•°æ®å—å¤§å°ã€ä¼ è¾“çš„å†…å­˜ä½ç½®ï¼Œè€Œé€šé“æ–¹å¼ä¸­è¿™äº›ä¿¡æ¯æ˜¯ç”±é€šé“æŽ§åˆ¶çš„ã€‚å¦å¤–ï¼Œ<strong>æ¯ä¸ª DMA æŽ§åˆ¶å™¨å¯¹åº”ä¸€å°è®¾å¤‡ä¸Žå†…å­˜ä¼ é€’æ•°æ®ï¼Œè€Œä¸€ä¸ªé€šé“å¯ä»¥æŽ§åˆ¶å¤šå°è®¾å¤‡ä¸Žå†…å­˜çš„æ•°æ®äº¤æ¢</strong>ã€‚</p>
</li>
</ol>
<p>IOç³»ç»Ÿå±‚æ¬¡ç»“æž„</p>
<p><img src="https://i.loli.net/2020/11/02/VybrTDuUgj1GLco.png" alt="img" /></p>
<p>å„å±‚æ¬¡åŠå…¶åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç”¨æˆ·å±‚ I/O è½¯ä»¶ã€‚å®žçŽ°ä¸Žç”¨æˆ·äº¤äº’çš„æŽ¥å£ï¼Œç”¨æˆ·å¯ç›´æŽ¥è°ƒç”¨åœ¨ç”¨æˆ·å±‚æä¾›çš„ã€ä¸Ž I/O æ“ä½œæœ‰å…³çš„åº“å‡½æ•°ï¼Œå¯¹è®¾å¤‡è¿›è¡Œæ“ä½œã€‚</li>
<li>è®¾å¤‡ç‹¬ç«‹æ€§è½¯ä»¶ã€‚ç”¨äºŽå®žçŽ°ç”¨æˆ·ç¨‹åºä¸Žè®¾å¤‡é©±åŠ¨å™¨çš„ç»Ÿä¸€æŽ¥å£ã€è®¾å¤‡å‘½ä»¤ã€è®¾å¤‡ä¿æŠ¤åŠè®¾å¤‡åˆ†é…ä¸Žé‡Šæ”¾ç­‰ï¼ŒåŒæ—¶ä¸ºè®¾å¤‡ç®¡ç†å’Œæ•°æ®ä¼ é€æä¾›å¿…è¦çš„å­˜å‚¨ç©ºé—´ã€‚</li>
<li>è®¾å¤‡é©±åŠ¨ç¨‹åºã€‚ä¸Žç¡¬ä»¶ç›´æŽ¥ç›¸å…³ï¼Œè´Ÿè´£å…·ä½“å®žçŽ°ç³»ç»Ÿå¯¹è®¾å¤‡å‘å‡ºçš„æ“ä½œæŒ‡ä»¤ï¼Œé©±åŠ¨ I/O è®¾å¤‡å·¥ä½œçš„é©±åŠ¨ç¨‹åºã€‚</li>
<li>ä¸­æ–­å¤„ç†ç¨‹åºã€‚ç”¨äºŽä¿æŠ¤è¢«ä¸­æ–­è¿›ç¨‹çš„ CPU çŽ¯å¢ƒï¼Œè½¬å…¥ç›¸åº”çš„ä¸­æ–­å¤„ç†ç¨‹åºè¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œå¹¶æ¢å¤è¢«ä¸­æ–­è¿›ç¨‹çš„çŽ°åœºåŽï¼Œè¿”å›žåˆ°è¢«ä¸­æ–­ç¨‹åºã€‚</li>
<li>ç¡¬ä»¶è®¾å¤‡ã€‚I/O è®¾å¤‡é€šå¸¸åŒ…æ‹¬ä¸€ä¸ªæœºæ¢°éƒ¨ä»¶å’Œä¸€ä¸ªç”µå­éƒ¨ä»¶ã€‚ä¸ºäº†è¾¾åˆ°è®¾è®¡çš„æ¨¡å—æ€§å’Œé€šç”¨æ€§ï¼Œä¸€èˆ¬å°†å…¶åˆ†å¼€ï¼šç”µå­éƒ¨ä»¶ç§°ä¸ºè®¾å¤‡æŽ§åˆ¶å™¨ï¼ˆæˆ–é€‚é…å™¨ï¼‰ï¼Œåœ¨ä¸ªäººè®¡ç®—æœºä¸­ï¼Œé€šå¸¸æ˜¯ä¸€å—æ’å…¥ä¸»æ¿æ‰©å……æ§½çš„å°åˆ¶ç”µè·¯æ¿ï¼›æœºæ¢°éƒ¨ä»¶åˆ™æ˜¯è®¾å¤‡æœ¬èº«ã€‚</li>
</ol>
<hr />
<p>å‚è€ƒ:</p>
<ol>
<li><a href="https://github.com/jx453331958/blog/issues/17">https://github.com/jx453331958/blog/issues/17</a></li>
<li><a href="https://my.oschina.net/u/4390999/blog/3418939">ã€æ“ä½œç³»ç»Ÿã€‘ è¾“å…¥/è¾“å‡ºï¼ˆI/Oï¼‰ç®¡ç†</a></li>
</ol>

    </article>
    
    
<script defer src="/js/clipboard.min.1626706afc88d95ebe1173b553ec732c6dc82a576989315fdf5e7779af738a44.js"></script>

<script defer src="/js/helper/prev.min.js"></script>

<script defer src="/js/helper/prop.min.js"></script>
<script>
  'use strict';
  document.addEventListener('DOMContentLoaded', function () {
    
    var clipInit = false;
    var preChromaElem = document.querySelectorAll('pre.chroma');
    var langCodeElem = document.querySelectorAll('.language-code');
    var dollarCodeElem = document.querySelectorAll('div.language-\\$');
    var gtCodeElem = document.querySelectorAll('div.language-\\>');

    var makeClipboard = function(elem) {
      var code = elem,
          text = elem.textContent;
        
      if (text.length > 15) {
        if (!clipInit) {
          var text, clip = new ClipboardJS('.copy-to-clipboard', {
            text: function (trigger) {
              var codeElem = prev(trigger).querySelectorAll('code');
              if (codeElem.length > 1) {
                text = prev(trigger).querySelector('code[class^="language-"]').textContent;
              } else {
                text = prev(trigger).querySelector('code').textContent;
              }

              return text.replace(/^\$\s/gm, '');
            }
          });

          var inPre;
          clip.on('success', function (e) {
            e.clearSelection();
            inPre = prop(e.trigger.parentNode, 'tagName') == 'PRE';
            e.trigger.setAttribute('aria-label', 'Copied to clipboard!');
            e.trigger.classList.add('tooltipped');
            e.trigger.classList.add('tooltipped-w');
          });

          clip.on('error', function (e) {
            inPre = prop(e.trigger.parentNode, 'tagName') == 'PRE';
            e.trigger.setAttribute('aria-label', e.action.toString());
            e.trigger.classList.add('tooltipped');
            e.trigger.classList.add('tooltipped-w');
          });

          clipInit = true;
        }

        var notAllowedClass = ['language-mermaid', 'language-viz', 'language-wave', 'language-chart', 'language-msc', 'language-flowchart'];
        var isNotAllowedIncluded = false;
        var curClassName = code.getAttribute('class');

        for (var i = 0; i < notAllowedClass.length; i++) {
          if (curClassName && curClassName.startsWith(notAllowedClass[i])) {
            isNotAllowedIncluded = true;
            break;
          }
        }

        if (!isNotAllowedIncluded) {
          if (curClassName) {
            var newClipboardElem = document.createElement('span');
            newClipboardElem.setAttribute('class', 'copy-to-clipboard');
            newClipboardElem.setAttribute('title', 'Copy to clipboard');
            elem.parentNode.parentNode.insertBefore(newClipboardElem, elem.parentNode.nextElementSibling);
          }
        }
      }
    }

    var makeSymbolClipboard = function(elem) {
      var clipboardSpan = document.createElement('span');
      clipboardSpan.setAttribute('class', 'copy-to-clipboard');
      clipboardSpan.setAttribute('title', 'Copy to clipboard');
      elem.parentNode.parentNode.insertBefore(clipboardSpan, elem.parentNode.nextElementSibling);
    }

    preChromaElem ? 
    preChromaElem.forEach(function(elem) {
      elem.querySelectorAll('code').forEach(function(codeElem) {
        makeClipboard(codeElem);
      });
    }) : null;
    
    langCodeElem ? 
    langCodeElem.forEach(function(elem) {
      elem.querySelectorAll('code').forEach(function (codeElem) {
        makeClipboard(codeElem);
      });
    }) : null;

    dollarCodeElem ? 
    dollarCodeElem.forEach(function(elem) {
      elem.querySelectorAll('code').forEach(function (codeElem) {
        makeSymbolClipboard(codeElem);
      });
    }) : null;

    gtCodeElem ?
    gtCodeElem.forEach(function(elem) {
      elem.querySelectorAll('code').forEach(function (codeElem) {
        makeSymbolClipboard(codeElem);
      });
    }) : null;
    
  });
</script>
    <script>
  'use strict';
  
  function wrap(el, wrapper) {
    el.parentNode.insertBefore(wrapper, el);
    wrapper.appendChild(el);
  }

  (function () {
    var singleContentsElem = document.querySelector('.single__contents');
    singleContentsElem ? 
    singleContentsElem.querySelectorAll('pre > code').forEach(function(elem) {
      var dataLang = elem.getAttribute('data-lang');
      var dataLangWrapper = document.createElement('div');
      var code = null;
      var codeTitle = null;

      if (dataLang && dataLang.includes(':')) {
        code = dataLang.split(':')[0];
        codeTitle = dataLang.split(':')[1];

        dataLangWrapper.className = 'language-' + code;
        dataLangWrapper.setAttribute('data-lang', codeTitle);

        elem.className = 'language-' + code;
        elem.setAttribute('data-lang', codeTitle);
        elem.setAttribute('id', codeTitle);
      } else if (!dataLang) {
        dataLangWrapper.setAttribute('data-lang', 'Code');
        dataLangWrapper.className = 'language-code';
      }

      if (!dataLang || codeTitle) {
        wrap(elem.parentNode, dataLangWrapper);
      }

    }) : null;
  })();

  var langCodeElem = document.querySelectorAll('.language-code');
  langCodeElem ? langCodeElem.forEach(function (elem) {
    var newElem = document.createElement('span');
    newElem.className = 'copy-to-clipboard';
    newElem.setAttribute('title', 'Copy to clipboard');
    elem.append(newElem);
  }) : null;
  

  

  
  var dollarCodeElem = document.querySelectorAll('div.language-\\$');
  var gtCodeElem = document.querySelectorAll('div.language-\\>');

  dollarCodeElem ?
  dollarCodeElem.forEach(function(elem) {
    var lnts = elem.parentNode.parentNode ? elem.parentNode.parentNode.querySelectorAll('.lnt') : null;
    lnts ? 
    lnts.forEach(function(lnt) {
      lnt.innerHTML = '$<br/>';
    }) : null;
  }) : null;

  gtCodeElem ?
  gtCodeElem.forEach(function(elem) {
    var lnts = elem.parentNode.parentNode ? elem.parentNode.parentNode.querySelectorAll('.lnt') : null;
    lnts ? 
    lnts.forEach(function(lnt) {
      lnt.innerHTML = '><br/>';
    }) : null;
  }) : null;
  
</script>
    
<div class="donation">
  <div class="donation__message">
    Share on
  </div>
  <div class="donation__icons">
    
    
    
      
        <a href="https://twitter.com/intent/tweet?text=interview&url=https%3a%2f%2fhugo.jiahongw.com%2fen%2fzh%2ftalks%2finterview%2f&hashtags=&via=" title="Twitter" aria-label="Twitter Share Button" class="donation__item" target="_blank" rel="noreferrer" data-type="share">
          <svg data-name="twitter" enable-background="new 0 0 24 24" viewBox="0 0 24 24" width="35" height="35" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="m21.534 7.113c.976-.693 1.797-1.558 2.466-2.554v-.001c-.893.391-1.843.651-2.835.777 1.02-.609 1.799-1.566 2.165-2.719-.951.567-2.001.967-3.12 1.191-.903-.962-2.19-1.557-3.594-1.557-2.724 0-4.917 2.211-4.917 4.921 0 .39.033.765.114 1.122-4.09-.2-7.71-2.16-10.142-5.147-.424.737-.674 1.58-.674 2.487 0 1.704.877 3.214 2.186 4.089-.791-.015-1.566-.245-2.223-.606v.054c0 2.391 1.705 4.377 3.942 4.835-.401.11-.837.162-1.29.162-.315 0-.633-.018-.931-.084.637 1.948 2.447 3.381 4.597 3.428-1.674 1.309-3.8 2.098-6.101 2.098-.403 0-.79-.018-1.177-.067 2.18 1.405 4.762 2.208 7.548 2.208 8.683 0 14.342-7.244 13.986-14.637z"/></svg>
        </a>
      
    
      
        <a href="https://www.reddit.com/submit?url=https%3a%2f%2fhugo.jiahongw.com%2fen%2fzh%2ftalks%2finterview%2f&amp;title=interview" target="_blank" rel="noreferrer" title="Reddit" aria-label="Reddit Share Button" onclick="window.open('http://www.reddit.com/submit?url=' + encodeURIComponent(document.URL) + '&amp;title=' +  encodeURIComponent(document.title)); return false;" class="donation__item" data-type="share">
          <svg data-name="reddit" enable-background="new 0 0 24 24" viewBox="0 0 24 24" width="35" height="35" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="m21.325 9.308c-.758 0-1.425.319-1.916.816-1.805-1.268-4.239-2.084-6.936-2.171l1.401-6.406 4.461 1.016c0 1.108.89 2.013 1.982 2.013 1.113 0 2.008-.929 2.008-2.038s-.889-2.038-2.007-2.038c-.779 0-1.451.477-1.786 1.129l-4.927-1.108c-.248-.067-.491.113-.557.365l-1.538 7.062c-2.676.113-5.084.928-6.895 2.197-.491-.518-1.184-.837-1.942-.837-2.812 0-3.733 3.829-1.158 5.138-.091.405-.132.837-.132 1.268 0 4.301 4.775 7.786 10.638 7.786 5.888 0 10.663-3.485 10.663-7.786 0-.431-.045-.883-.156-1.289 2.523-1.314 1.594-5.115-1.203-5.117zm-15.724 5.41c0-1.129.89-2.038 2.008-2.038 1.092 0 1.983.903 1.983 2.038 0 1.109-.89 2.013-1.983 2.013-1.113.005-2.008-.904-2.008-2.013zm10.839 4.798c-1.841 1.868-7.036 1.868-8.878 0-.203-.18-.203-.498 0-.703.177-.18.491-.18.668 0 1.406 1.463 6.07 1.488 7.537 0 .177-.18.491-.18.668 0 .207.206.207.524.005.703zm-.041-2.781c-1.092 0-1.982-.903-1.982-2.011 0-1.129.89-2.038 1.982-2.038 1.113 0 2.008.903 2.008 2.038-.005 1.103-.895 2.011-2.008 2.011z"/></svg>
        </a>
      
    
      
        <a href="javascript:void(function(){var d=document,e=encodeURIComponent,s1=window.getSelection,s2=d.getSelection,s3=d.selection,s=s1?s1():s2?s2():s3?s3.createRange().text:'',r='http://service.weibo.com/share/share.php?url='+e(d.location.href)+'&title='+e(d.title),x=function(){if(!window.open(r,'weibo','toolbar=0,resizable=1,scrollbars=yes,status=1,width=450,height=330'))location.href=r+'&r=1'};if(/Firefox/.test(navigator.userAgent)){setTimeout(x,0)}else{x()}})()" class="donation__item" target="_blank" rel="noreferrer" title="Weibo" aria-label="Weibo Share Button" data-type="share">
          <svg data-name="weibo" enable-background="new 0 0 24 24" viewBox="0 0 24 24" width="35" height="35" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="m23.977 8.171c.103 1.315-.123 2.891-1.006 2.969-1.442.127-.69-1.435-.671-2.375.053-2.725-2.312-4.618-4.629-4.618-.656 0-2.181.438-1.946-.924.106-.6.623-.592 1.14-.66 3.897-.51 6.838 2.125 7.112 5.608z"/><path d="m17.604 11.337c1.675.901 3.687 1.35 3.354 4.024-.614 4.929-11.054 8.24-17.575 4.618-1.788-.994-3.639-2.448-3.354-5.344.246-2.493 1.95-4.424 3.623-6.069 1.596-1.57 3.278-2.798 5.567-3.364 2.484-.614 3.218 1.422 2.549 3.43 1.439-.095 4.488-1.674 5.836-.132.594.68.367 1.897 0 2.837zm-1.811 6.333c.537-.598 1.076-1.51 1.073-2.572-.01-4.395-7.635-5.376-11.806-2.969-4.747 2.74-2.743 7.664 3.086 8.048 3.088.204 6.179-.868 7.647-2.507z"/><path d="m19.952 10.084c-.977.064-.612-.658-.671-1.517-.037-.529-.483-1.14-.872-1.32-.763-.352-1.945.256-1.945-.791 0-.778.686-.697 1.074-.726 3.555-.266 3.775 4.265 2.414 4.354z"/><path d="m12.842 14.768c1.429 4.248-6.017 6.223-7.379 2.573-.911-2.441 1.277-4.383 3.555-4.618 1.945-.201 3.395.775 3.824 2.045zm-3.422.726c.303.516 1 .145.939-.264-.073-.473-.945-.403-.939.264zm-1.207 2.243c1.252-.293 1.42-2.612-.47-2.177-1.587.364-1.28 2.586.47 2.177z"/></svg>
        </a>
      
    
  </div>
</div>


    
    
<div class="whoami__gutter"></div>
<hr class="hr-slash whoami-hr"/>
<section class="whoami">
  <div class="whoami__image-wrapper">
    
    
      
        <img data-src="/images/whoami/avatar.jpg" src="data:image/svg+xml,%0A%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='none' d='M0 0h24v24H0V0z'/%3E%3Cpath fill='%23aaa' d='M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 16H6c-.55 0-1-.45-1-1V6c0-.55.45-1 1-1h12c.55 0 1 .45 1 1v12c0 .55-.45 1-1 1zm-4.44-6.19l-2.35 3.02-1.56-1.88c-.2-.25-.58-.24-.78.01l-1.74 2.23c-.26.33-.02.81.39.81h8.98c.41 0 .65-.47.4-.8l-2.55-3.39c-.19-.26-.59-.26-.79 0z'/%3E%3C/svg%3E" alt="VictorHong" class="lazyload whoami__image"/>
      
    
  </div>
  <div class="whoami__contents">
    <div class="whoami__written-by">
      WRITTEN BY
    </div>
    <div class="whoami__title">
      
        VictorHong
      
    </div>
    <div class="whoami__desc">
      
        ðŸ“šLearnerðŸ¤“NerdðŸŒDeveloper
      
    </div>
    <div class="whoami__social">
      
      
      <a href="https://blog.csdn.net/weixin_41263449" title="csdn" aria-label="csdn">
        <svg fill="#000000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="25" height="25"><path fill="currentColor" d="M11.705 9.681l-.03.247c-.035.288-.3.484-.585.439-.47-.081-1.135-.151-1.64-.151-.765 0-1.16.267-1.19.56-.035.368.365.389 1.355.681 1.345.378 1.935.913 1.855 1.741C11.38 14.172 10.31 15 8.165 15c-.655 0-1.24-.096-1.675-.222-.24-.066-.395-.293-.37-.545l.035-.288c.045-.232.25-.404.49-.404.035 0 .065.005.095.01.01 0 1.057.237 1.61.202.808-.051 1.26-.247 1.3-.636.03-.353-.3-.404-1.22-.646-1.265-.343-2.075-.878-1.995-1.731C6.53 9.752 7.72 9 9.555 9 10.2 9 10.83 9.035 11.3 9.121 11.56 9.167 11.74 9.414 11.705 9.681zM18.79 9.814c.019-.223.184-.409.404-.45 4.533-.849 4.929.926 4.782 2.502l-.241 2.54c-.024.257-.24.453-.498.453h-.546c-.295 0-.526-.254-.498-.547l.207-2.182c.056-.601.405-1.776-1.281-1.732-.186.005-.343.017-.469.032-.235.027-.414.218-.433.455-.021.255-.05.595-.083.88l-.251 2.642c-.024.257-.24.453-.498.453h-.514c-.296 0-.527-.255-.498-.549l.247-2.501L18.79 9.814zM17.115 9.846c-.615-.5-1.611-.696-2.84-.735-.531-.017-1.087.024-1.265.05-.192.029-.345.19-.385.38-.01.035-.015.07-.015.11l-.43 4.635c-.03.275.17.52.44.545.425.045.91.065 1.41.065 1.205 0 2.005-.18 2.64-.59.695-.44 1.17-1.15 1.265-2.16C18.035 11.056 17.665 10.306 17.115 9.846zM16.435 12.106c-.085.935-.955 1.605-2.185 1.605-.305 0-.46-.025-.58-.05l.3-3.355c.125-.025.36-.025.525-.025C15.795 10.271 16.565 10.746 16.435 12.106zM5.367 14.461c-.021.227-.19.41-.415.448C4.623 14.966 4.163 15 3.595 15c-2.427 0-3.737-1.254-3.583-2.913C.198 10.112 2.139 9 4.264 9c.559 0 .961.034 1.304.093.259.045.437.286.408.547L5.941 9.965c-.031.283-.292.487-.573.439-.326-.055-.724-.093-1.071-.093-1.25 0-2.312.41-2.434 1.707-.109 1.16.637 1.714 2.044 1.714.271 0 .614-.024.922-.064.318-.041.592.222.562.541L5.367 14.461z"/></svg>
      </a>
      
      
      
      
      
      
      
      <a href="mailto:1427298682@qq.com" title="email" aria-label="email">
        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path fill="currentColor" d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-.4 4.25l-7.07 4.42c-.32.2-.74.2-1.06 0L4.4 8.25c-.25-.16-.4-.43-.4-.72 0-.67.73-1.07 1.3-.72L12 11l6.7-4.19c.57-.35 1.3.05 1.3.72 0 .29-.15.56-.4.72z"/></svg>
      </a>
      
      
      
      
      
      
      
      <a href="https://github.com/redisread/" title="github" aria-label="github">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewBox="0 0 24 24" version="1.1">
<g id="surface3680">
<path fill="currentColor" d="M 10.898438 2.101562 C 6.300781 2.601562 2.601562 6.300781 2.101562 10.800781 C 1.601562 15.5 4.300781 19.699219 8.398438 21.300781 C 8.699219 21.398438 9 21.199219 9 20.800781 L 9 19.199219 C 9 19.199219 8.601562 19.300781 8.101562 19.300781 C 6.699219 19.300781 6.101562 18.101562 6 17.398438 C 5.898438 17 5.699219 16.699219 5.398438 16.398438 C 5.101562 16.300781 5 16.300781 5 16.199219 C 5 16 5.300781 16 5.398438 16 C 6 16 6.5 16.699219 6.699219 17 C 7.199219 17.800781 7.800781 18 8.101562 18 C 8.5 18 8.800781 17.898438 9 17.800781 C 9.101562 17.101562 9.398438 16.398438 10 16 C 7.699219 15.5 6 14.199219 6 12 C 6 10.898438 6.5 9.800781 7.199219 9 C 7.101562 8.800781 7 8.300781 7 7.601562 C 7 7.199219 7 6.601562 7.300781 6 C 7.300781 6 8.699219 6 10.101562 7.300781 C 10.601562 7.101562 11.300781 7 12 7 C 12.699219 7 13.398438 7.101562 14 7.300781 C 15.300781 6 16.800781 6 16.800781 6 C 17 6.601562 17 7.199219 17 7.601562 C 17 8.398438 16.898438 8.800781 16.800781 9 C 17.5 9.800781 18 10.800781 18 12 C 18 14.199219 16.300781 15.5 14 16 C 14.601562 16.5 15 17.398438 15 18.300781 L 15 20.898438 C 15 21.199219 15.300781 21.5 15.699219 21.398438 C 19.398438 19.898438 22 16.300781 22 12.101562 C 22 6.101562 16.898438 1.398438 10.898438 2.101562 Z M 10.898438 2.101562 "/>
</g>
</svg>

      </a>
      
      
      
      
      
      
      
      <a href="https://www.instagram.com/jiahong.wu.581/" title="instagram" aria-label="instagram">
        <svg fill="#000000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="25" height="25"><path fill="currentColor" d="M 11.46875 5 C 7.917969 5 5 7.914063 5 11.46875 L 5 20.53125 C 5 24.082031 7.914063 27 11.46875 27 L 20.53125 27 C 24.082031 27 27 24.085938 27 20.53125 L 27 11.46875 C 27 7.917969 24.085938 5 20.53125 5 Z M 11.46875 7 L 20.53125 7 C 23.003906 7 25 8.996094 25 11.46875 L 25 20.53125 C 25 23.003906 23.003906 25 20.53125 25 L 11.46875 25 C 8.996094 25 7 23.003906 7 20.53125 L 7 11.46875 C 7 8.996094 8.996094 7 11.46875 7 Z M 21.90625 9.1875 C 21.402344 9.1875 21 9.589844 21 10.09375 C 21 10.597656 21.402344 11 21.90625 11 C 22.410156 11 22.8125 10.597656 22.8125 10.09375 C 22.8125 9.589844 22.410156 9.1875 21.90625 9.1875 Z M 16 10 C 12.699219 10 10 12.699219 10 16 C 10 19.300781 12.699219 22 16 22 C 19.300781 22 22 19.300781 22 16 C 22 12.699219 19.300781 10 16 10 Z M 16 12 C 18.222656 12 20 13.777344 20 16 C 20 18.222656 18.222656 20 16 20 C 13.777344 20 12 18.222656 12 16 C 12 13.777344 13.777344 12 16 12 Z"/></svg>
      </a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <a href="https://www.weibo.com/2587041797/" title="weibo" aria-label="weibo">
        <svg fill="#000000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="25" height="25"><path fill="currentColor" d="M 16.28125 3.8125 C 16.054688 3.828125 15.816406 3.859375 15.59375 3.90625 C 15.179688 3.996094 14.910156 4.402344 15 4.8125 C 15.085938 5.226563 15.492188 5.496094 15.90625 5.40625 C 17.179688 5.136719 18.566406 5.53125 19.5 6.5625 C 20.433594 7.597656 20.679688 9.011719 20.28125 10.25 C 20.152344 10.652344 20.378906 11.089844 20.78125 11.21875 C 21.183594 11.347656 21.617188 11.121094 21.75 10.71875 C 22.3125 8.976563 21.96875 7.015625 20.65625 5.5625 C 19.671875 4.46875 18.296875 3.875 16.9375 3.8125 C 16.710938 3.800781 16.507813 3.796875 16.28125 3.8125 Z M 10.0625 6.09375 C 8.667969 6.242188 6.699219 7.332031 4.96875 9.0625 C 3.082031 10.949219 2 12.957031 2 14.6875 C 2 17.996094 6.226563 20 10.375 20 C 15.8125 20 19.4375 16.820313 19.4375 14.3125 C 19.4375 12.796875 18.179688 11.949219 17.03125 11.59375 C 16.75 11.507813 16.539063 11.464844 16.6875 11.09375 C 17.007813 10.289063 17.066406 9.589844 16.71875 9.09375 C 16.070313 8.164063 14.253906 8.210938 12.21875 9.0625 C 12.21875 9.0625 11.585938 9.351563 11.75 8.84375 C 12.0625 7.835938 12.019531 6.988281 11.53125 6.5 C 11.1875 6.152344 10.695313 6.027344 10.0625 6.09375 Z M 16.8125 6.5 C 16.589844 6.488281 16.375 6.515625 16.15625 6.5625 C 15.800781 6.636719 15.578125 7.019531 15.65625 7.375 C 15.734375 7.730469 16.082031 7.953125 16.4375 7.875 C 16.863281 7.785156 17.34375 7.902344 17.65625 8.25 C 17.96875 8.597656 18.042969 9.054688 17.90625 9.46875 C 17.792969 9.816406 17.964844 10.199219 18.3125 10.3125 C 18.660156 10.421875 19.046875 10.253906 19.15625 9.90625 C 19.429688 9.058594 19.265625 8.085938 18.625 7.375 C 18.144531 6.84375 17.476563 6.53125 16.8125 6.5 Z M 10.8125 10.90625 C 13.582031 11.003906 15.8125 12.378906 16 14.28125 C 16.214844 16.457031 13.71875 18.484375 10.40625 18.8125 C 7.09375 19.140625 4.214844 17.640625 4 15.46875 C 3.785156 13.292969 6.316406 11.265625 9.625 10.9375 C 10.039063 10.898438 10.417969 10.890625 10.8125 10.90625 Z M 8.9375 13 C 7.804688 13.101563 6.734375 13.75 6.25 14.6875 C 5.589844 15.964844 6.242188 17.378906 7.75 17.84375 C 9.308594 18.324219 11.140625 17.597656 11.78125 16.21875 C 12.410156 14.871094 11.605469 13.472656 10.0625 13.09375 C 9.691406 13 9.316406 12.964844 8.9375 13 Z M 8.21875 15.0625 C 8.351563 15.066406 8.472656 15.109375 8.59375 15.15625 C 9.082031 15.355469 9.234375 15.878906 8.9375 16.34375 C 8.632813 16.804688 7.988281 17.027344 7.5 16.8125 C 7.019531 16.601563 6.882813 16.074219 7.1875 15.625 C 7.414063 15.289063 7.824219 15.058594 8.21875 15.0625 Z"/></svg>
      </a>
      
      
      
      
      
      
      
      
      
      
    </div>
  </div>
</section>
<hr class="hr-slash whoami-hr" />


    <section class="related">
    
    
    <h1 class="related__title">
      <hr class="hr-dots"/>
      <div>
        See Also
      </div>
      <hr class="hr-dots"/>
    </h1>
    <ul class="related-ul">
        
        <li>
          <a href="/en/zh/talks/leetcode-hot/" class="related__link">Leetcodeé«˜é¢‘</a>
        </li>
        
        <li>
          <a href="/en/zh/talks/ue4-talks/" class="related__link">UE4 Problems</a>
        </li>
        
        <li>
          <a href="/en/zh/gallery/hero/" class="related__link">Hero</a>
        </li>
        
        <li>
          <a href="/en/zh/talks/tools/" class="related__link">Tools</a>
        </li>
        
        <li>
          <a href="/en/zh/talks/github-lib/" class="related__link">Goodåº“</a>
        </li>
        
    </ul>
    
  </section>
    <div class="grow"></div>
<nav class="pagination-single">
  
    
      <a href="https://hugo.jiahongw.com/en/zh/talks/ue4-talks/" class="pagination-single__left">
        <div class="pagination-single__icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path fill="currentColor" d="M19 11H7.83l4.88-4.88c.39-.39.39-1.03 0-1.42-.39-.39-1.02-.39-1.41 0l-6.59 6.59c-.39.39-.39 1.02 0 1.41l6.59 6.59c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L7.83 13H19c.55 0 1-.45 1-1s-.45-1-1-1z"/></svg>
        </div>
        <div class="pagination-single__left-title">UE4 Problems</div>      
      </a>
    
    <div class="grow"></div>
    
      <a href="https://hugo.jiahongw.com/en/zh/talks/leetcode-hot/" class="pagination-single__right">      
        <div class="pagination-single__right-title">Leetcodeé«˜é¢‘</div>
        <div class="pagination-single__icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path fill="currentColor" d="M5 13h11.17l-4.88 4.88c-.39.39-.39 1.03 0 1.42.39.39 1.02.39 1.41 0l6.59-6.59c.39-.39.39-1.02 0-1.41l-6.58-6.6c-.39-.39-1.02-.39-1.41 0-.39.39-.39 1.02 0 1.41L16.17 11H5c-.55 0-1 .45-1 1s.45 1 1 1z"/></svg>
        </div>
      </a>
    
  
</nav>
    
  
    <div id="gitalk-container"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" crossorigin="anonymous"></script>
<script>
  var gitalk = new Gitalk({
    id: '2020-07-28 00:04:50 \u002b0900 \u002b0900',
    title: 'interview',
    clientID: '5880093503923d139adb',
    clientSecret: 'aa0741ecdc011069553c3c898e8e0f54915af0bb',
    repo: 'redisread.github.io',
    owner: 'redisread',
    admin: ['redisread'],
    body: decodeURI(location.href)
  });
  gitalk.render('gitalk-container');
</script>
<noscript>Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by gitalk.</a></noscript>
  

    <div class="modal micromodal-slide" id="modal" aria-hidden="true">
  <div class="modal__overlay" tabindex="-1" data-micromodal-close>
    <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      
      <div class="modal__content" id="modal-content">
        <div id="mySwipe" class="swipe">
          <div class="swipe-wrap">
          </div>
        </div>
      </div>

      <span class="modal__items">
        
        <span class="modal__header">
          <div class="modal__paging" title="Page Info" aria-label="Current Page">
          </div>
          <div class="modal__icon modal__toolbar modal__toolbar--close" title="Close" aria-label="Close Button" data-micromodal-close>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 26" width="25" height="25"><path fill="currentColor" d="M 21.734375 19.640625 L 19.636719 21.734375 C 19.253906 22.121094 18.628906 22.121094 18.242188 21.734375 L 13 16.496094 L 7.761719 21.734375 C 7.375 22.121094 6.746094 22.121094 6.363281 21.734375 L 4.265625 19.640625 C 3.878906 19.253906 3.878906 18.628906 4.265625 18.242188 L 9.503906 13 L 4.265625 7.761719 C 3.882813 7.371094 3.882813 6.742188 4.265625 6.363281 L 6.363281 4.265625 C 6.746094 3.878906 7.375 3.878906 7.761719 4.265625 L 13 9.507813 L 18.242188 4.265625 C 18.628906 3.878906 19.257813 3.878906 19.636719 4.265625 L 21.734375 6.359375 C 22.121094 6.746094 22.121094 7.375 21.738281 7.761719 L 16.496094 13 L 21.734375 18.242188 C 22.121094 18.628906 22.121094 19.253906 21.734375 19.640625 Z"/></svg>
          </div>
          <div class="modal__icon modal__toolbar modal__toolbar--full" title="Full Screen" aria-label="Full Screen Button">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="25" height="25"><path fill="currentColor" d="M 5 3 C 3.9069372 3 3 3.9069372 3 5 L 3 8 A 1.0001 1.0001 0 1 0 5 8 L 5 5 L 8 5 A 1.0001 1.0001 0 1 0 8 3 L 5 3 z M 16 3 A 1.0001 1.0001 0 1 0 16 5 L 19 5 L 19 8 A 1.0001 1.0001 0 1 0 21 8 L 21 5 C 21 3.9069372 20.093063 3 19 3 L 16 3 z M 3.984375 14.986328 A 1.0001 1.0001 0 0 0 3 16 L 3 19 C 3 20.093063 3.9069372 21 5 21 L 8 21 A 1.0001 1.0001 0 1 0 8 19 L 5 19 L 5 16 A 1.0001 1.0001 0 0 0 3.984375 14.986328 z M 19.984375 14.986328 A 1.0001 1.0001 0 0 0 19 16 L 19 19 L 16 19 A 1.0001 1.0001 0 1 0 16 21 L 19 21 C 20.093063 21 21 20.093063 21 19 L 21 16 A 1.0001 1.0001 0 0 0 19.984375 14.986328 z"/></svg>
          </div>
          <div class="modal__icon modal__toolbar modal__toolbar--normal" title="Normal Screen" aria-label="Normal Screen Button">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="25" height="25"><path fill="currentColor" d="M 16.96875 4.972656 C 15.867188 4.988281 14.984375 5.894531 15 7 L 15 15 L 7 15 C 6.277344 14.988281 5.609375 15.367188 5.246094 15.992188 C 4.878906 16.613281 4.878906 17.386719 5.246094 18.007813 C 5.609375 18.632813 6.277344 19.011719 7 19 L 19 19 L 19 7 C 19.007813 6.460938 18.796875 5.941406 18.414063 5.558594 C 18.03125 5.175781 17.511719 4.964844 16.96875 4.972656 Z M 32.96875 4.972656 C 31.921875 4.988281 31.0625 5.8125 31.003906 6.859375 C 31 6.90625 31 6.953125 31 7 L 31 19 L 43 19 C 43.066406 19 43.132813 19 43.199219 18.992188 C 44.269531 18.894531 45.070313 17.972656 45.015625 16.902344 C 44.964844 15.828125 44.074219 14.988281 43 15 L 35 15 L 35 7 C 35.007813 6.460938 34.796875 5.941406 34.414063 5.558594 C 34.03125 5.175781 33.511719 4.964844 32.96875 4.972656 Z M 7 31 C 6.277344 30.988281 5.609375 31.367188 5.246094 31.992188 C 4.878906 32.613281 4.878906 33.386719 5.246094 34.007813 C 5.609375 34.632813 6.277344 35.011719 7 35 L 15 35 L 15 43 C 14.988281 43.722656 15.367188 44.390625 15.992188 44.753906 C 16.613281 45.121094 17.386719 45.121094 18.007813 44.753906 C 18.632813 44.390625 19.011719 43.722656 19 43 L 19 31 Z M 31 31 L 31 43 C 30.988281 43.722656 31.367188 44.390625 31.992188 44.753906 C 32.613281 45.121094 33.386719 45.121094 34.007813 44.753906 C 34.632813 44.390625 35.011719 43.722656 35 43 L 35 35 L 43 35 C 43.722656 35.011719 44.390625 34.632813 44.753906 34.007813 C 45.121094 33.386719 45.121094 32.613281 44.753906 31.992188 C 44.390625 31.367188 43.722656 30.988281 43 31 Z"/></svg>
          </div>
        </span>
        
        <div class="modal__icon modal__arrow modal__arrow--left" title="Arrow Left" aria-label="Arrow Left Button">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 26" width="28" height="28"><path fill="currentColor" d="M 23.28125 11 L 10 10 L 10 6.851563 C 10 6.523438 9.839844 6.277344 9.519531 6.03125 C 9.199219 5.949219 8.878906 5.949219 8.640625 6.113281 C 5.359375 8.410156 2.238281 12.257813 2.160156 12.421875 C 2.082031 12.578125 2.007813 12.8125 2.003906 12.976563 C 2.003906 12.980469 2 12.988281 2 12.992188 C 2 13.15625 2.078125 13.402344 2.160156 13.484375 C 2.238281 13.648438 5.28125 17.507813 8.640625 19.804688 C 8.960938 19.96875 9.28125 20.050781 9.519531 19.886719 C 9.839844 19.722656 10 19.476563 10 19.148438 L 10 16 L 23.28125 15 C 23.679688 14.679688 24 13.875 24 12.992188 C 24 12.195313 23.761719 11.320313 23.28125 11 Z"/></svg>
        </div>
        
        <div class="modal__icon modal__arrow modal__arrow--right" title="Arrow Right" aria-label="Arrow Right Button">

          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 26 26" width="28" height="28"><path fill="currentColor" d="M 2.71875 11.023438 L 16 10.023438 L 16 6.875 C 16 6.546875 16.160156 6.300781 16.480469 6.054688 C 16.800781 5.972656 17.121094 5.972656 17.359375 6.136719 C 20.640625 8.433594 23.761719 12.28125 23.839844 12.445313 C 23.917969 12.601563 23.992188 12.835938 23.996094 13 C 23.996094 13.003906 24 13.011719 24 13.015625 C 24 13.179688 23.921875 13.425781 23.839844 13.507813 C 23.761719 13.671875 20.71875 17.53125 17.359375 19.828125 C 17.039063 19.992188 16.71875 20.074219 16.480469 19.910156 C 16.160156 19.746094 16 19.5 16 19.171875 L 16 16.023438 L 2.71875 15.023438 C 2.320313 14.703125 2 13.898438 2 13.015625 C 2 12.21875 2.238281 11.34375 2.71875 11.023438 Z"/></svg>
        </div>

        <div class="modal__caption">
          <div class="modal__caption--text">
          </div>
        </div>

      </span>
    </div>
  </div>
</div>


<script defer src="/js/swipe.min.feb438efb7ca009ecd7fc2ac3ad2fced4840990b2798d81f87137f2dc6281f05.js"></script>

<script defer src="/js/micromodal.min.de01b44b2f383056bbcaf6ee921fd385d79108ec1129afd0eb2f3f5a07e11f45.js"></script>

<script defer src="/js/helper/fadeinout.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  
   
  var docElem = document.documentElement;

   
  function openFullscreen() {
    if (docElem.requestFullscreen) {
      docElem.requestFullscreen();
    } else if (docElem.mozRequestFullScreen) {  
      docElem.mozRequestFullScreen();
    } else if (docElem.webkitRequestFullscreen) {  
      docElem.webkitRequestFullscreen();
    } else if (docElem.msRequestFullscreen) {  
      docElem.msRequestFullscreen();
    }
  }

   
  function closeFullscreen() {
    if (document.fullscreenElement ||
      document.webkitFullscreenElement ||
      document.mozFullScreenElement) {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.mozCancelFullScreen) {  
        document.mozCancelFullScreen();
      } else if (document.webkitExitFullscreen) {  
        document.webkitExitFullscreen();
      } else if (document.msExitFullscreen) {  
        document.msExitFullscreen();
      }
    }
  }

  var modal = document.getElementById('modal');
  var galleryContainerElem = document.querySelector('.gallery__container');
  var swipeWrapElem = document.querySelector('.swipe-wrap');
  var mySwipeElem = document.getElementById('mySwipe');
  var arrowLeftElem = document.querySelector('.modal__arrow--left');
  var arrowRightElem = document.querySelector('.modal__arrow--right');
  var closeElem = document.querySelector('.modal__toolbar--close');
  var fullElem = document.querySelector('.modal__toolbar--full');
  var normalElem = document.querySelector('.modal__toolbar--normal');
  var captionElem = document.querySelector('.modal__caption');
  var pagingElem = document.querySelector('.modal__paging');
  var itemsElem = document.querySelector('.modal__items');
  var imgTotalNum = null;
  var myFadeTimeout = null;
  var mySwipe = null;
  var keydownFunction = function (e) {
    if (e.key === 'ArrowRight') {
      if (modal && modal.classList.contains('is-open')) {
        mySwipe.next();
      }
    } else if (e.key === 'ArrowLeft') {
      if (modal && modal.classList.contains('is-open')) {
        mySwipe.prev();
      }
    }
  }

  if (galleryContainerElem) {
    imgTotalNum = galleryContainerElem.querySelectorAll('img').length;
  } else {
    galleryContainerElem = document.querySelector('.single__contents');
    imgTotalNum = galleryContainerElem.querySelectorAll('img').length;
  }

  MicroModal.init({
    onClose: function () {
      if (mySwipe) {
        mySwipe.kill();
        mySwipe = null;
        closeFullscreen();
      }
      window.removeEventListener('keydown', keydownFunction);
    },
    disableScroll: true,
    disableFocus: true,
    awaitOpenAnimation: false,
    awaitCloseAnimation: false,
    debugMode: false,
  });

  var imageLoad = function(src) {
    return new Promise(function(resolve, reject) {
      var newImg = new Image;
      newImg.onload = function() {
        resolve(newImg);
      }
      newImg.onerror = reject;
      newImg.src = src;
    });
  }

  galleryContainerElem.querySelectorAll('img').forEach(function (elem, idx) {
    elem.style.cursor = 'pointer';

    var clonedElem = elem.cloneNode(true);
    clonedElem.style.maxHeight = '100%';
    clonedElem.style.maxWidth = '100%';
    clonedElem.onclick = function (e) {
      e.stopPropagation();
    }

    var wrapper = document.createElement('div');
    wrapper.style.width = '100%';
    wrapper.style.height = '100vh';
    wrapper.setAttribute('data-micromodal-close', '');
    wrapper.onclick = function () {
      if (mySwipe) {
        mySwipe.kill();
        mySwipe = null;
      }
    }
    wrapper.onmouseenter = function () {
      clearTimeout(myFadeTimeout);
      fadeIn(itemsElem, 200);
    };
    wrapper.onmouseleave = function () {
      myFadeTimeout = setTimeout(function () {
        fadeOut(itemsElem, 200);
      }, 2500);
    }
    wrapper.ontouchstart = function() {
      fadeIn(itemsElem, 200);
    }
    wrapper.append(clonedElem);
    swipeWrapElem.append(wrapper);

    elem.addEventListener('click', async function (e) {
      MicroModal.show('modal');
      if (mySwipe) {
        mySwipe.kill();
        mySwipe = null;
      }

      var imgSrc = e.target.getAttribute('data-src') || e.target.getAttribute('src');
      var img = await imageLoad(imgSrc);
      clonedElem.style.width = img.width + 'px';
      clonedElem.style.height = img.height + 'px';
      
      
      mySwipe = new Swipe(mySwipeElem, {
        startSlide: idx,
        draggable: true,
        autoRestart: false,
        continuous: false,
        disableScroll: true,
        stopPropagation: true,
        callback: async function (index, element) {
          
          var imgElem = element.querySelector('img');
          var imgSrc = imgElem.getAttribute('data-src') || imgElem.getAttribute('src');
          var img = await imageLoad(imgSrc);
          imgElem.style.width = img.width + 'px';
          imgElem.style.height = img.height + 'px';

          
          if (captionElem && imgElem) {
            var caption = null;
            if (imgElem.getAttribute('data-caption')) {
              caption = imgElem.getAttribute('data-caption');
            } else if (imgElem.getAttribute('title')) {
              caption = imgElem.getAttribute('title');
            } else if (imgElem.getAttribute('alt')) {
              caption = imgElem.getAttribute('alt');
            } else {
              caption = imgElem.getAttribute('src');
            }

            captionElem.querySelector('.modal__caption--text').innerText = caption;
            pagingElem.innerText = (index + 1) + ' / ' + imgTotalNum;

            clearTimeout(myFadeTimeout);
            fadeIn(itemsElem, 200);
          }
        },
      });

      fadeIn(itemsElem);

      
      if (captionElem) {
        var caption = null;
        if (e.target.getAttribute('data-caption')) {
          caption = e.target.getAttribute('data-caption');
        } else if (e.target.getAttribute('title')) {
          caption = e.target.getAttribute('title');
        } else if (e.target.getAttribute('alt')) {
          caption = e.target.getAttribute('alt');
        } else {
          caption = e.target.getAttribute('src');
        }

        captionElem.querySelector('.modal__caption--text').innerText = caption;
        pagingElem.innerText = (idx + 1) + ' / ' + imgTotalNum;
      }

      if (normalElem && fullElem) {
        normalElem.style.zIndex = -1;
        normalElem.style.opacity = 0;
        fullElem.style.zIndex = 25;
        fullElem.style.opacity = 1;
      }
    });

    window.addEventListener('keydown', keydownFunction);
  });

  arrowLeftElem ?
    arrowLeftElem.addEventListener('click', function (e) {
      if (mySwipe) {
        mySwipe.prev();
      }
    }) : null;
  arrowRightElem ?
    arrowRightElem.addEventListener('click', function (e) {
      if (mySwipe) {
        mySwipe.next();
      }
    }) : null;

  closeElem ?
    closeElem.addEventListener('click', function () {
      if (mySwipe) {
        mySwipe.kill();
        mySwipe = null;
      }
      closeFullscreen();
      MicroModal.close('modal');
    }) : null;

  fullElem ?
    fullElem.addEventListener('click', function (e) {
      openFullscreen();
      if (normalElem) {
        normalElem.style.zIndex = 25;
        normalElem.style.opacity = 1;
        fullElem.style.zIndex = -1;
        fullElem.style.opacity = 0;
      }
    }) : null;

  normalElem ?
    normalElem.addEventListener('click', function (e) {
      closeFullscreen();
      if (fullElem) {
        fullElem.style.zIndex = 25;
        fullElem.style.opacity = 1;
        normalElem.style.zIndex = -1;
        normalElem.style.opacity = 0;
      }
    }) : null;
  
});
</script>

    <div class="hide">
      

<div class="search">
  <span class="icon">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M15.5 14h-.79l-.28-.27c1.2-1.4 1.82-3.31 1.48-5.34-.47-2.78-2.79-5-5.59-5.34-4.23-.52-7.79 3.04-7.27 7.27.34 2.8 2.56 5.12 5.34 5.59 2.03.34 3.94-.28 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
  </span>
  <input id="search" aria-label="Site Search" class="input" type="text" placeholder="Search" autocomplete="off">
  <div id="search-results" class="dropdown">
    <div id="search-menu" class="dropdown-menu" role="menu">
    </div>
  </div>
</div>


    </div>
  </div>
</main>


<aside class="single__side main-side">
  


<section class="sidebar hide">
  <script>document.querySelector('.sidebar').classList.remove('hide')</script>
  <div class="toc__flexbox" data-position="fixed">
    <h6 class="toc__title" data-ani="true">What&#39;s on this Page</h6>
    
      <label class="switch" data-ani="true">
        <input id="toggle-toc" aria-label="Toggle TOC" type="checkbox" checked>
        <span class="slider round"></span>
      </label>
    
  </div>
  <div class="toc " data-dir="ltr" data-folding="true" data-ani="true">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#é¢å‘å¯¹è±¡ä¸Žé¢å‘è¿‡ç¨‹">â­•é¢å‘å¯¹è±¡ä¸Žé¢å‘è¿‡ç¨‹</a></li>
        <li><a href="#cç¨‹åºè®¾è®¡æ¨¡åž‹">âž•C++ç¨‹åºè®¾è®¡æ¨¡åž‹</a></li>
        <li><a href="#å¤šæ€">âœ–ï¸å¤šæ€</a></li>
        <li><a href="#-c11æ–°ç‰¹æ€§">ðŸ–ï¸ C++11æ–°ç‰¹æ€§</a></li>
        <li><a href="#const">ðŸ“‡const</a></li>
        <li><a href="#static">ðŸ—½Static</a></li>
        <li><a href="#-extern-cä½œç”¨">ðŸ“¤ extern &ldquo;C&quot;ä½œç”¨</a></li>
        <li><a href="#inlineå†…è”å‡½æ•°-staticé™æ€å‡½æ•°-æ™®é€šå‡½æ•°åŒºåˆ«">ðŸ“Œinlineå†…è”å‡½æ•° staticé™æ€å‡½æ•° æ™®é€šå‡½æ•°åŒºåˆ«</a></li>
        <li><a href="#cå†…å­˜å¸ƒå±€">ðŸ’ŸC++å†…å­˜å¸ƒå±€</a></li>
        <li><a href="#-cç©ºç±»äº§ç”Ÿå“ªäº›æˆå‘˜å‡½æ•°">ðŸ’± C++ç©ºç±»äº§ç”Ÿå“ªäº›æˆå‘˜å‡½æ•°</a></li>
        <li><a href="#-æŒ‡é’ˆå¸¸è§é”™è¯¯">âœˆï¸ æŒ‡é’ˆå¸¸è§é”™è¯¯</a></li>
        <li><a href="#-cçš„å†…å­˜ç»“æž„">ðŸš™ Cçš„å†…å­˜ç»“æž„</a></li>
        <li><a href="#ç¨‹åºè¿è¡Œæ—¶å†…å­˜åˆ†é…">ðŸ—¡ç¨‹åºè¿è¡Œæ—¶å†…å­˜åˆ†é…</a></li>
        <li><a href="#structå­—èŠ‚å¯¹é½é—®é¢˜">ðŸ‘½structå­—èŠ‚å¯¹é½é—®é¢˜</a></li>
        <li><a href="#mallocä¸€æ¬¡æ€§æœ€å¤§èƒ½ç”³è¯·å¤šå¤§å†…å­˜ç©ºé—´">â“œï¸mallocä¸€æ¬¡æ€§æœ€å¤§èƒ½ç”³è¯·å¤šå¤§å†…å­˜ç©ºé—´ï¼Ÿ</a></li>
        <li><a href="#å­—èŠ‚åºäº†è§£å—è®²ä¸€ä¸‹å¤§ç«¯å¯¹é½å’Œå°ç«¯å¯¹é½">ðŸ”¶å­—èŠ‚åºäº†è§£å—ï¼Ÿè®²ä¸€ä¸‹å¤§ç«¯å¯¹é½å’Œå°ç«¯å¯¹é½</a></li>
        <li><a href="#å­—ç¬¦ä¸²ä¸Žå­—ç¬¦ä¸²æŒ‡é’ˆçš„å¤§å°">ðŸ“å­—ç¬¦ä¸²ä¸Žå­—ç¬¦ä¸²æŒ‡é’ˆçš„å¤§å°</a></li>
        <li><a href="#åŠ¨æ€é“¾æŽ¥å’Œé™æ€é“¾æŽ¥çš„åŒºåˆ«">ðŸ’ƒåŠ¨æ€é“¾æŽ¥å’Œé™æ€é“¾æŽ¥çš„åŒºåˆ«</a></li>
        <li><a href="#æ™ºèƒ½æŒ‡é’ˆçš„å¤šçº¿ç¨‹é—®é¢˜">ðŸ›©ï¸æ™ºèƒ½æŒ‡é’ˆçš„å¤šçº¿ç¨‹é—®é¢˜</a></li>
        <li><a href="#-å…³äºŽtemplateçš„ä¸‰ä¸ªé—®é¢˜">ðŸŽª å…³äºŽtemplateçš„ä¸‰ä¸ªé—®é¢˜</a></li>
        <li><a href="#cçš„å¼‚å¸¸å¤„ç†æœºåˆ¶">â—c++çš„å¼‚å¸¸å¤„ç†æœºåˆ¶</a></li>
        <li><a href="#æ‰§è¡ŒæœŸç±»åž‹è¯†åˆ«runtime-type-identificationrtti">ðŸƒâ€â™‚ï¸æ‰§è¡ŒæœŸç±»åž‹è¯†åˆ«ï¼ˆRuntime Type Identificationï¼ŒRTTIï¼‰</a></li>
        <li><a href="#cæž„é€ å‡½æ•°">ðŸš§C++æž„é€ å‡½æ•°</a></li>
        <li><a href="#cæ‹·è´æž„é€ å‡½æ•°">ðŸ‘®â€â™‚ï¸C++æ‹·è´æž„é€ å‡½æ•°</a>
          <ul>
            <li><a href="#default-memberwise-initialization">Default Memberwise Initialization</a></li>
            <li><a href="#bitwise-copy-semanticsä½é€æ¬¡æ‹·è´">Bitwise Copy Semantics(ä½é€æ¬¡æ‹·è´ï¼‰</a></li>
          </ul>
        </li>
        <li><a href="#ç¨‹åºè½¬åŒ–è¯­ä¹‰">ç¨‹åºè½¬åŒ–è¯­ä¹‰</a></li>
        <li><a href="#cdataè¯­ä¹‰">ðŸ’½C++â€”â€”dataè¯­ä¹‰</a></li>
        <li><a href="#å…³äºŽtypedefçš„ç”¨æ³•æ€»ç»“">å…³äºŽtypedefçš„ç”¨æ³•æ€»ç»“</a></li>
        <li><a href="#-æ™ºèƒ½æŒ‡é’ˆ">âœ’ï¸ æ™ºèƒ½æŒ‡é’ˆ</a>
          <ul>
            <li><a href="#unique_ptr">unique_ptr</a></li>
            <li><a href="#shared_ptr">shared_ptr</a></li>
            <li><a href="#weak_ptr">weak_ptr</a></li>
            <li><a href="#å¤šçº¿ç¨‹è¯»å†™shared_ptréœ€è¦åŠ é”">å¤šçº¿ç¨‹è¯»å†™<code>shared_ptr</code>éœ€è¦åŠ é”</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#cå†…å­˜åˆ†åŒº">C++å†…å­˜åˆ†åŒº</a></li>
    <li><a href="#ç¨‹åºåœ¨å†…å­˜ä¸­çš„åˆ†å¸ƒ">ç¨‹åºåœ¨å†…å­˜ä¸­çš„åˆ†å¸ƒ</a>
      <ul>
        <li><a href="#å †ä¸Žæ ˆ">å †ä¸Žæ ˆ</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#å†…å­˜æ³„æ¼">å†…å­˜æ³„æ¼</a>
      <ul>
        <li><a href="#æ£€æµ‹å†…å­˜æ³„æ¼çš„åŽŸç†">æ£€æµ‹å†…å­˜æ³„æ¼çš„åŽŸç†</a></li>
      </ul>
    </li>
    <li><a href="#æ£€æµ‹æ–¹æ³•">æ£€æµ‹æ–¹æ³•</a>
      <ul>
        <li><a href="#æœ€ç®€å•çš„">æœ€ç®€å•çš„</a></li>
      </ul>
    </li>
    <li><a href="#windowså¹³å°ä¸‹çš„å†…å­˜æ³„æ¼æ£€æµ‹">Windowså¹³å°ä¸‹çš„å†…å­˜æ³„æ¼æ£€æµ‹</a>
      <ul>
        <li><a href="#linuxå¹³å°ä¸‹çš„å†…å­˜æ³„æ¼æ£€æµ‹">Linuxå¹³å°ä¸‹çš„å†…å­˜æ³„æ¼æ£€æµ‹</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#å‡½æ•°æ¨¡æ¿">å‡½æ•°æ¨¡æ¿</a>
      <ul>
        <li>
          <ul>
            <li><a href="#å‡½æ•°æ¨¡æ¿æ ¼å¼">å‡½æ•°æ¨¡æ¿æ ¼å¼</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#ç±»æ¨¡æ¿">ç±»æ¨¡æ¿</a>
      <ul>
        <li>
          <ul>
            <li><a href="#ç±»æ¨¡æ¿æ ¼å¼">ç±»æ¨¡æ¿æ ¼å¼</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#åœ¨å †ä¸Šåˆ›å»ºç±»å¯¹è±¡">åœ¨å †ä¸Šåˆ›å»ºç±»å¯¹è±¡</a></li>
    <li><a href="#åœ¨æ ˆä¸Šåˆ›å»ºç±»å¯¹è±¡">åœ¨æ ˆä¸Šåˆ›å»ºç±»å¯¹è±¡</a></li>
  </ul>

  <ul>
    <li><a href="#åŠ æ³•">åŠ æ³•</a></li>
    <li><a href="#å¼‚æˆ–">å¼‚æˆ–</a></li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#memmoveä¸Žmemcpyçš„åŒºåˆ«">memmoveä¸Žmemcpyçš„åŒºåˆ«ï¼Ÿ</a></li>
        <li><a href="#strcpyä¸Žmencpyçš„åŒºåˆ«">strcpyä¸Žmencpyçš„åŒºåˆ«?</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#-ç½‘ç»œåˆ†å±‚">ðŸŽšï¸ ç½‘ç»œåˆ†å±‚</a></li>
        <li><a href="#-ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹">ðŸ¥‰ ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹</a></li>
        <li><a href="#-ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹">âœ‹ ä¸ºä»€ä¹ˆæ˜¯å››æ¬¡æŒ¥æ‰‹ï¼Ÿ</a></li>
        <li><a href="#-å¦‚æžœå·²ç»å»ºç«‹äº†è¿žæŽ¥ä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºçŽ°æ•…éšœäº†æ€Žä¹ˆåŠž">ðŸ‘ å¦‚æžœå·²ç»å»ºç«‹äº†è¿žæŽ¥ï¼Œä½†æ˜¯å®¢æˆ·ç«¯çªç„¶å‡ºçŽ°æ•…éšœäº†æ€Žä¹ˆåŠžï¼Ÿ</a></li>
        <li><a href="#-get-å’Œ-postçš„åŒºåˆ«">ðŸ“‰ â€‹GET å’Œ POSTçš„åŒºåˆ«</a></li>
        <li><a href="#-httpæŠ¥æ–‡">ðŸ‚ HTTPæŠ¥æ–‡</a>
          <ul>
            <li><a href="#è¯·æ±‚æŠ¥æ–‡">è¯·æ±‚æŠ¥æ–‡</a></li>
            <li><a href="#å“åº”æŠ¥æ–‡">å“åº”æŠ¥æ–‡</a></li>
          </ul>
        </li>
        <li><a href="#-httpçŠ¶æ€ç ">ðŸš‰ HTTPçŠ¶æ€ç ï¼š</a></li>
        <li><a href="#-httpçš„ä¸»è¦æ–¹æ³•">âœ‹ HTTPçš„ä¸»è¦æ–¹æ³•</a></li>
        <li><a href="#-http20ä¸Žhttp10çš„åŒºåˆ«">ðŸ’« HTTP2.0ä¸ŽHTTP1.0çš„åŒºåˆ«</a></li>
        <li><a href="#-ä»€ä¹ˆæ˜¯sqlæ³¨å…¥">ðŸ“¥ ä»€ä¹ˆæ˜¯<code>SQL</code>æ³¨å…¥ï¼Ÿ</a></li>
        <li><a href="#-cookieæŠ€æœ¯">ðŸª CookieæŠ€æœ¯</a></li>
        <li><a href="#-sessionæŠ€æœ¯">ðŸ’¬ SessionæŠ€æœ¯</a></li>
        <li><a href="#-sessionå’Œcookieçš„åŒºåˆ«">ðŸ“¸ Sessionå’ŒCookieçš„åŒºåˆ«</a></li>
        <li><a href="#-ipåè®®">Â©ï¸ <code>IP</code>åè®®</a>
          <ul>
            <li><a href="#æœ‰äº†-ip-åœ°å€ä¸ºä»€ä¹ˆè¿˜è¦ç”¨-mac-åœ°å€">æœ‰äº† IP åœ°å€ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨ MAC åœ°å€</a></li>
          </ul>
        </li>
        <li><a href="#-dnsåè®®">ðŸ›°ï¸ DNSåè®®</a></li>
        <li><a href="#heading"></a></li>
        <li><a href="#-ftpåè®®">ðŸ—ƒï¸ FTPåè®®</a></li>
      </ul>
    </li>
    <li><a href="#x509-æ•°å­—è¯ä¹¦">X.509 æ•°å­—è¯ä¹¦</a>
      <ul>
        <li><a href="#æ•°å­—è¯ä¹¦çš„ç­¾ç½²">æ•°å­—è¯ä¹¦çš„ç­¾ç½²</a>
          <ul>
            <li><a href="#æ ¹è®¤è¯æœºæž„çš„æž„å»º">æ ¹è®¤è¯æœºæž„çš„æž„å»º</a></li>
            <li><a href="#å•çº§è®¤è¯æœºæž„çš„è¯ä¹¦ç­¾ç½²">å•çº§è®¤è¯æœºæž„çš„è¯ä¹¦ç­¾ç½²</a></li>
            <li><a href="#äºŒçº§æˆ–ä»¥ä¸Šè®¤è¯æœºæž„çš„æž„å»º">äºŒçº§ï¼ˆæˆ–ä»¥ä¸Šï¼‰è®¤è¯æœºæž„çš„æž„å»º</a></li>
            <li><a href="#äºŒçº§æˆ–ä»¥ä¸Šè®¤è¯æœºæž„çš„è¯ä¹¦ç­¾ç½²">äºŒçº§ï¼ˆæˆ–ä»¥ä¸Šï¼‰è®¤è¯æœºæž„çš„è¯ä¹¦ç­¾ç½²</a></li>
            <li><a href="#çŽ°å®žä¸­çš„è¯ä¹¦ç­¾ç½²">çŽ°å®žä¸­çš„è¯ä¹¦ç­¾ç½²</a></li>
          </ul>
        </li>
        <li><a href="#æœåŠ¡å™¨çš„é…ç½®">æœåŠ¡å™¨çš„é…ç½®</a></li>
        <li><a href="#å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨çš„èº«ä»½">å®¢æˆ·ç«¯éªŒè¯æœåŠ¡å™¨çš„èº«ä»½</a>
          <ul>
            <li><a href="#å•çº§è®¤è¯æœºæž„çš„éªŒè¯">å•çº§è®¤è¯æœºæž„çš„éªŒè¯</a></li>
            <li><a href="#äºŒçº§æˆ–ä»¥ä¸Šè®¤è¯æœºæž„çš„éªŒè¯">äºŒçº§ï¼ˆæˆ–ä»¥ä¸Šï¼‰è®¤è¯æœºæž„çš„éªŒè¯</a></li>
          </ul>
        </li>
        <li><a href="#åŠ å¯†ä¼ è¾“çš„æ•°æ®">åŠ å¯†ä¼ è¾“çš„æ•°æ®</a>
          <ul>
            <li><a href="#çŽ°å®žä¸­çš„è¯ä¹¦éªŒè¯">çŽ°å®žä¸­çš„è¯ä¹¦éªŒè¯</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#http09">HTTP/0.9</a></li>
    <li><a href="#http1x">HTTP/1.x</a>
      <ul>
        <li><a href="#çŸ­é“¾æŽ¥æ¨¡åž‹">çŸ­é“¾æŽ¥æ¨¡åž‹</a></li>
        <li><a href="#é•¿è¿žæŽ¥æ¨¡åž‹">é•¿è¿žæŽ¥æ¨¡åž‹</a></li>
        <li><a href="#æµæ°´çº¿æ¨¡åž‹ç®¡çº¿åŒ–">æµæ°´çº¿æ¨¡åž‹(ç®¡çº¿åŒ–)</a>
          <ul>
            <li><a href="#é˜Ÿå¤´é˜»å¡ž">é˜Ÿå¤´é˜»å¡ž</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#http2">HTTP/2</a>
      <ul>
        <li><a href="#äºŒè¿›åˆ¶åˆ†å¸§å±‚">äºŒè¿›åˆ¶åˆ†å¸§å±‚</a>
          <ul>
            <li><a href="#æ•°æ®æµæ¶ˆæ¯å’Œå¸§">æ•°æ®æµã€æ¶ˆæ¯å’Œå¸§</a></li>
            <li><a href="#è¯·æ±‚ä¸Žå“åº”å¤ç”¨">è¯·æ±‚ä¸Žå“åº”å¤ç”¨</a></li>
            <li><a href="#æ•°æ®æµä¼˜å…ˆçº§">æ•°æ®æµä¼˜å…ˆçº§</a></li>
            <li><a href="#æµæŽ§åˆ¶">æµæŽ§åˆ¶</a></li>
            <li><a href="#æœåŠ¡å™¨æŽ¨é€">æœåŠ¡å™¨æŽ¨é€</a></li>
            <li><a href="#æ ‡å¤´åŽ‹ç¼©">æ ‡å¤´åŽ‹ç¼©</a></li>
            <li><a href="#å“ˆå¤«æ›¼æ ‘å¦‚ä½•åŽ‹ç¼©">å“ˆå¤«æ›¼æ ‘å¦‚ä½•åŽ‹ç¼©</a></li>
            <li><a href="#ä½“éªŒhttp2">ä½“éªŒHTTP2</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#httpsè¯¦è§£">HTTPSè¯¦è§£</a>
      <ul>
        <li><a href="#ä»€ä¹ˆæ˜¯https">ä»€ä¹ˆæ˜¯HTTPSï¼Ÿ</a></li>
        <li><a href="#httpåè®®å­˜åœ¨çš„é—®é¢˜">HTTPåè®®å­˜åœ¨çš„é—®é¢˜ï¼Ÿ</a></li>
        <li><a href="#httpsçš„ä¼˜åŠ¿">HTTPSçš„ä¼˜åŠ¿ï¼Ÿ</a></li>
        <li><a href="#httpsåè®®">HTTPSåè®®</a></li>
        <li><a href="#æ•°å­—è¯ä¹¦">æ•°å­—è¯ä¹¦</a></li>
        <li><a href="#httpså·¥ä½œæµç¨‹">HTTPSå·¥ä½œæµç¨‹</a></li>
      </ul>
    </li>
    <li><a href="#è™šæ‹ŸipåŽŸç†">è™šæ‹ŸIPåŽŸç†</a></li>
  </ul>

  <ul>
    <li><a href="#tcp">TCPã€°ï¸</a>
      <ul>
        <li>
          <ul>
            <li><a href="#tcpä¸­æµçš„è§£é‡Š">TCPä¸­æµçš„è§£é‡Š</a></li>
            <li><a href="#tcpæŠ¥æ–‡æ ¼å¼">TCPæŠ¥æ–‡æ ¼å¼</a></li>
            <li><a href="#ä¸‰æ¬¡æ¡æ‰‹">ä¸‰æ¬¡æ¡æ‰‹ï¼š</a></li>
            <li><a href="#å››æ¬¡æŒ¥æ‰‹">å››æ¬¡æŒ¥æ‰‹</a></li>
            <li><a href="#tcpçš„4ä¸ªå®šæ—¶å™¨"><strong>TCP</strong>çš„4ä¸ªå®šæ—¶å™¨</a></li>
            <li><a href="#ä¿è¯ä¼ è¾“å¯é ">ä¿è¯ä¼ è¾“å¯é </a></li>
            <li><a href="#æµé‡æŽ§åˆ¶">æµé‡æŽ§åˆ¶</a></li>
            <li><a href="#æŽ§åˆ¶tcpå‘é€æŠ¥æ–‡æ®µçš„æ—¶æœº">æŽ§åˆ¶TCPå‘é€æŠ¥æ–‡æ®µçš„æ—¶æœº</a></li>
            <li><a href="#æ‹¥å¡žæŽ§åˆ¶">æ‹¥å¡žæŽ§åˆ¶</a></li>
          </ul>
        </li>
        <li><a href="#æµé‡æŽ§åˆ¶-1">æµé‡æŽ§åˆ¶</a></li>
        <li><a href="#æ‹¥å¡žæŽ§åˆ¶-1">æ‹¥å¡žæŽ§åˆ¶</a></li>
      </ul>
    </li>
    <li><a href="#udp">UDPðŸ“¦</a>
      <ul>
        <li>
          <ul>
            <li><a href="#heading-1"></a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#æ‹¥å¡žæŽ§åˆ¶ç®—æ³•">æ‹¥å¡žæŽ§åˆ¶ç®—æ³•</a>
      <ul>
        <li><a href="#ç®—æ³•åˆ†ç±»">ç®—æ³•åˆ†ç±»</a></li>
        <li><a href="#å¦‚ä½•æ„ŸçŸ¥æ‹¥å¡ž">å¦‚ä½•æ„ŸçŸ¥æ‹¥å¡ž</a></li>
        <li><a href="#æ‹¥å¡žæŽ§åˆ¶åŸºæœ¬ç­–ç•¥">æ‹¥å¡žæŽ§åˆ¶åŸºæœ¬ç­–ç•¥</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#ä¸ºä»€ä¹ˆéœ€è¦quic">ä¸ºä»€ä¹ˆéœ€è¦QUICï¼Ÿ</a>
          <ul>
            <li><a href="#ç›®æ ‡">ç›®æ ‡</a></li>
          </ul>
        </li>
        <li><a href="#quicè¿žæŽ¥è¿‡ç¨‹">QUICè¿žæŽ¥è¿‡ç¨‹</a></li>
        <li><a href="#quicè¿žæŽ¥è¿ç§»">QUICè¿žæŽ¥è¿ç§»</a></li>
        <li><a href="#quicè§£å†³é˜Ÿå¤´é˜»å¡žé—®é¢˜">QUICè§£å†³é˜Ÿå¤´é˜»å¡žé—®é¢˜</a></li>
        <li><a href="#quicçš„æ‹¥å¡žæŽ§åˆ¶">QUICçš„æ‹¥å¡žæŽ§åˆ¶</a></li>
        <li><a href="#quicå‰å‘çº é”™fec">QUICå‰å‘çº é”™FEC</a></li>
        <li><a href="#quicé‡ä¼ åºåˆ—å·å•è°ƒé€’å¢ž">QUICé‡ä¼ åºåˆ—å·å•è°ƒé€’å¢ž</a></li>
        <li><a href="#ack-delay">ACK Delay</a></li>
        <li><a href="#æ›´å¤šçš„-ack-å—">æ›´å¤šçš„ ACK å—</a></li>
        <li><a href="#quicæµé‡æŽ§åˆ¶">QUICæµé‡æŽ§åˆ¶</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li>
      <ul>
        <li>
          <ul>
            <li><a href="#è¿›ç¨‹çº¿ç¨‹åç¨‹åŒºåˆ«">è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹åŒºåˆ«ðŸ’ </a></li>
            <li><a href="#è¿›ç¨‹çš„å‡ ç§çŠ¶æ€">è¿›ç¨‹çš„å‡ ç§çŠ¶æ€</a></li>
            <li><a href="#æ­»é”æ´»é”å’Œé¥¥é¥¿httpswwwcnblogscomktgup3529143html"><a href="https://www.cnblogs.com/ktgu/p/3529143.html">æ­»é”ï¼Œæ´»é”å’Œé¥¥é¥¿</a>ðŸ”</a></li>
            <li><a href="#ä»€ä¹ˆæ˜¯å®ˆæŠ¤è¿›ç¨‹">ä»€ä¹ˆæ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼Ÿ</a></li>
            <li><a href="#linuxè¿è¡Œå†…å­˜åˆ†åŒº">Linuxè¿è¡Œå†…å­˜åˆ†åŒºðŸš©</a></li>
            <li><a href="#è¿›ç¨‹é—´é€šä¿¡">è¿›ç¨‹é—´é€šä¿¡ðŸ¦…</a></li>
            <li><a href="#çº¿ç¨‹é—´é€šä¿¡">çº¿ç¨‹é—´é€šä¿¡ðŸ‘‚</a></li>
            <li><a href="#ä»€ä¹ˆæ˜¯å­¤å„¿è¿›ç¨‹åƒµå°¸è¿›ç¨‹">ä»€ä¹ˆæ˜¯å­¤å„¿è¿›ç¨‹ã€åƒµå°¸è¿›ç¨‹ï¼Ÿ</a></li>
            <li><a href="#å†…æ ¸æ€å’Œç”¨æˆ·æ€">å†…æ ¸æ€å’Œç”¨æˆ·æ€ðŸ’</a></li>
            <li><a href="#freeå‡½æ•°å¦‚ä½•çŸ¥é“è¦é‡Šæ”¾çš„ç©ºé—´å¤§å°">free()å‡½æ•°å¦‚ä½•çŸ¥é“è¦é‡Šæ”¾çš„ç©ºé—´å¤§å°â“</a></li>
            <li><a href="#ä¸­æ–­å’Œè½®è¯¢çš„ç‰¹ç‚¹">ä¸­æ–­å’Œè½®è¯¢çš„ç‰¹ç‚¹ðŸ¥š</a></li>
            <li><a href="#åˆ†æ®µä¸Žåˆ†é¡µ">åˆ†æ®µä¸Žåˆ†é¡µðŸ‘“</a></li>
            <li><a href="#è¿›ç¨‹è°ƒåº¦ç®—æ³•">è¿›ç¨‹è°ƒåº¦ç®—æ³•ðŸ”Œ</a></li>
            <li><a href="#é¡µé¢ç½®æ¢ç®—æ³•">é¡µé¢ç½®æ¢ç®—æ³•ðŸ’±</a></li>
            <li><a href="#ç£ç›˜è°ƒåº¦ç®—æ³•">ç£ç›˜è°ƒåº¦ç®—æ³•ðŸ’¾</a></li>
            <li><a href="#å†…å­˜åˆ†é…ç®—æ³•">å†…å­˜åˆ†é…ç®—æ³•</a></li>
            <li><a href="#ä¼™ä¼´ç®—æ³•å’Œslabç®—æ³•">ä¼™ä¼´ç®—æ³•å’Œslabç®—æ³•</a></li>
            <li><a href="#mmapå’Œbrkçš„åŒºåˆ«">mmapå’Œbrkçš„åŒºåˆ«</a></li>
            <li><a href="#å¦‚ä½•æŸ¥çœ‹ç«¯å£æ˜¯å¦è¢«å ç”¨">å¦‚ä½•æŸ¥çœ‹ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼Ÿ</a></li>
            <li><a href="#linuxçš„forkå®žçŽ°">Linuxçš„forkå®žçŽ°</a></li>
            <li><a href="#mallocåŽŸç†">MallocåŽŸç†ðŸš´â€â™‚ï¸</a></li>
            <li><a href="#mmap">mmap()</a></li>
            <li><a href="#å†…å­˜ç®¡ç†çš„æœ¬è´¨">å†…å­˜ç®¡ç†çš„æœ¬è´¨</a></li>
            <li><a href="#linuxç¼“å†²åŒº">Linuxç¼“å†²åŒºðŸƒ</a></li>
            <li><a href="#ä»€ä¹ˆæ˜¯rpc">ä»€ä¹ˆæ˜¯RPC</a></li>
            <li><a href="#çº¿ç¨‹åŒæ­¥çš„æ–¹å¼æœ‰å“ªäº›">çº¿ç¨‹åŒæ­¥çš„æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</a></li>
            <li><a href="#ä¸­æ–­å’Œè½®è¯¢çš„ç‰¹ç‚¹-1">ä¸­æ–­å’Œè½®è¯¢çš„ç‰¹ç‚¹?</a></li>
            <li><a href="#è¾“å…¥ä¸Žè¾“å‡º">è¾“å…¥ä¸Žè¾“å‡º</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</section>



</aside>

<script>
  
  
  

  var enableToc = JSON.parse("true");
  var toc = JSON.parse("null");
  var tocPosition = JSON.parse("\"inner\"");
  
  var singleMainElem = document.querySelector('.single__main');
  var singleSideElem = document.querySelector('.single__side');

  enquire.register("screen and (max-width: 769px)", {
    match: function () {
      if ((enableToc || toc) && tocPosition !== "outer") {
        if (singleMainElem && singleSideElem) {
          singleMainElem.classList.remove('main-main');
          singleMainElem.classList.add('main');
          singleSideElem.classList.remove('main-side');
          singleSideElem.classList.add('hide');
        }
      } else if (tocPosition === "outer") {
        if (singleMainElem && !singleMainElem.classList.contains('main-main')) {
          singleMainElem.classList.remove('main-main');
          singleMainElem.classList.add('main');
        }
        if (singleSideElem && !singleSideElem.classList.contains('hide')) {
          singleSideElem.classList.add('hide');
        }
      }
    },
    unmatch: function () {
      if ((enableToc || toc) && tocPosition !== "outer") {
        singleMainElem.classList.remove('main');
        singleMainElem.classList.add('main-main');
        singleSideElem.classList.remove('hide');
        singleSideElem.classList.add('main-side');
      } else if (tocPosition === "outer") {
        if (singleMainElem && !singleMainElem.classList.contains('main-main')) {
          singleMainElem.classList.remove('main-main');
          singleMainElem.classList.add('main');
        }
        if (singleSideElem && !singleSideElem.classList.contains('hide')) {
          singleSideElem.classList.add('hide');
        }
      }

      var navCollapseBtn = document.querySelector('.navbar__burger');
      var navCollapse = document.getElementsByClassName('navbarm__collapse')[0];
      if (navCollapse) {
        navCollapse.setAttribute('data-open', false);
        navCollapse.style.maxHeight = 0;
        navCollapseBtn.classList.remove('is-active');
      }
      document.getElementsByClassName('navbar__menu')[0].classList.remove('is-active');
      document.getElementsByClassName('mobile-search')[0].classList.add('hide');
    },
    setup: function () { },
    deferSetup: true,
    destroy: function () { },
  });
</script>





<script defer src="/js/helper/getParents.min.js"></script>

<script defer src="/js/helper/closest.min.js"></script>

<script defer src="/js/helper/prev.min.js"></script>

<script defer src="/js/helper/prop.min.js"></script>

<script defer src="/js/helper/fadeinout.min.js"></script>

<script defer src="/js/helper/throttle.min.js"></script>



















































<script>
  'use strict';

  window.onload = function() {
    var navbar = document.querySelector('.navbar');
    var singleContentsElem = document.querySelector('.single__contents');

    
    
    
    var enableBusuanzi = JSON.parse("true");
    var busuanziPagePV = JSON.parse("true");
    
    if (enableBusuanzi && busuanziPagePV) {
      var pagePvElem = document.querySelector('#busuanzi_value_page_pv');
      pagePvElem.textContent = pagePvElem.textContent.replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
    }    
    



    
    
    
    
    
    
    var enableToc = JSON.parse("true");
    var toc = JSON.parse("null");
    var hideToc = JSON.parse("false");
    var tocFlexbox = document.querySelector('.toc__flexbox');
    var tocFlexboxOuter = document.querySelector('.toc__flexbox--outer');
    var tocFolding = JSON.parse("true");
    
    if ((enableToc || toc) && document.querySelector('.toc')) {
      var tableOfContentsElem = document.querySelector('.toc').querySelector('#TableOfContents');

      tableOfContentsElem.onmouseenter = function() {
        if (navbar.classList.contains('scrolling')) {
          navbar.classList.remove('scrolling');
        }
      }

      tableOfContentsElem.onmouseleave = function() {
        if (!navbar.classList.contains('scrolling')) {
          navbar.classList.add('scrolling');
        }
      }

      if (false === tocFolding) {

      } else {
        tableOfContentsElem.querySelectorAll('ul') ?
          tableOfContentsElem.querySelectorAll('ul').forEach(function (rootUl) {
            rootUl.querySelectorAll('li').forEach(function (liElem) {
              liElem.querySelectorAll('ul').forEach(function (ulElem) {
                ulElem.style.display = 'none';
              });
            });
          }) : null;
      }

      if (tableOfContentsElem) {
        if (tableOfContentsElem.querySelectorAll('a').length > 0) {
          tableOfContentsElem.querySelectorAll('a').forEach(function (elem) {
            elem.addEventListener('click', function () {
              var id = elem.getAttribute('id');

              if (!navbar.classList.contains('scrolling')) {
                navbar.classList.remove('navbar--show');
                navbar.classList.remove('navbar--hide');
                navbar.classList.add('navbar--hide');
              }
              
              document.querySelector('.toc').querySelectorAll('a').forEach(function (elem) {
                elem.classList.remove('active');
              });
              elem.classList.add('active');

              var curElem = tableOfContentsElem.querySelector('[href="#' + id + '"]');
              if (curElem && curElem.nextElementSibling) {
                curElem.nextElementSibling.style.display = 'block';
              }
              if (curElem) {
                getParents(curElem, 'ul') ?
                  getParents(curElem, 'ul').forEach(function (elem) {
                    elem.style.display = 'block';
                  }) : null;
              }
            });
          });
        } else {
          if (tocFlexbox) {
            tocFlexbox.setAttribute('data-position', '');
            if (!tocFlexbox.classList.contains('hide')) {
              tocFlexbox.classList.add('hide');
            }
          }
          if (tocFlexboxOuter) {
            tocFlexboxOuter.setAttribute('data-position', '');
            if (!tocFlexboxOuter.classList.contains('hide')) {
              tocFlexboxOuter.classList.add('hide');
            }
          }
        }
      }

      
      var toggleTocElem = document.getElementById("toggle-toc");
      var visibleTocElem = document.getElementById('visible-toc');
      var tocElem = document.querySelector('.toc');
      var mainElem = document.querySelector('main');
      var sideElem = document.querySelector('side');
      var tocFlexboxElem = document.querySelector('.toc__flexbox');

      toggleTocElem ? 
      toggleTocElem.addEventListener('change', function(e) {
        if (e.target.checked) {
          if (tocElem) {
            fadeIn(tocElem, 200);
          }
          if (tocFlexboxElem) {
            tocFlexboxElem.setAttribute('data-position', 'fixed');
          }

          if (mainElem) {
            mainElem.classList.remove('main-main');
            mainElem.classList.remove('main');
            mainElem.classList.add('main-main');
          }
          if (sideElem) {
            sideElem.classList.remove('main-side');
          }
        } else {
          if (tocElem) {
            fadeOut(tocElem, 200);
          }
          if (tocFlexboxElem) {
            tocFlexboxElem.setAttribute('data-position', 'absolute');
          }

          if (mainElem) {
            mainElem.classList.remove('main-main');
            mainElem.classList.remove('main');
            mainElem.classList.add('main');
          }
          if (sideElem) {
            sideElem.classList.remove('main-side');
          }
        }
      }) : null;

      visibleTocElem ?
      visibleTocElem.addEventListener('change', function(e) {
        if (e.target.checked) {
          if (tocElem) {
            fadeIn(tocElem, 200);
          }
        } else {
          if (tocElem) {
            fadeOut(tocElem, 200);
          }
        }
      }) : null;
    }
    
    
    
    
    
    var topOffset = 120;
    var botOffset = 70;
    var handleWindowResize = function () {
      if (tocElem) {
        tocElem.style.maxHeight = (window.innerHeight - topOffset - botOffset) + 'px';
      }
    }
    var throttledWindowResize = throttle(handleWindowResize, 300);
    throttledWindowResize()

    
    window.addEventListener('resize', throttledWindowResize);
    



    
    var text, clip = new ClipboardJS('.anchor');
    var headers = singleContentsElem.querySelectorAll("h1, h2, h3, h4");

    
    var languagedir = JSON.parse("\"ltr\"");

    headers ? 
    headers.forEach(function (elem) {
      var size = parseInt(elem.tagName.substr(1), 10) * 2;
      var url = encodeURI(document.location.origin + document.location.pathname);
      var link = url + "#" + elem.getAttribute('id');
      var newElemOuter = document.createElement('span');
      newElemOuter.classList.add('anchor');
      newElemOuter.classList.add('hide');
      newElemOuter.setAttribute('data-clipboard-text', decodeURI(link));
      newElemOuter.style.position = 'relative';

      var newElemInner = document.createElement('span');
      newElemInner.style.position = 'absolute';
      newElemInner.style.top = '50%';
      newElemInner.style.left = '0.75rem';
      newElemInner.style.transform = 'translateY(-50%)';
      newElemInner.innerHTML = `
<svg fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="${32 - size}px" height="${32 - size}px"><path d="M 5.5625 0 C 4.136719 0 2.707031 0.542969 1.625 1.625 C -0.539063 3.789063 -0.539063 7.335938 1.625 9.5 L 5.28125 13.15625 C 5.667969 13.554688 6.304688 13.558594 6.703125 13.171875 C 7.101563 12.785156 7.105469 12.148438 6.71875 11.75 L 3.03125 8.0625 C 1.632813 6.664063 1.632813 4.429688 3.03125 3.03125 C 4.429688 1.632813 6.664063 1.632813 8.0625 3.03125 L 12.96875 7.9375 C 14.367188 9.335938 14.367188 11.570313 12.96875 12.96875 C 12.804688 13.132813 12.621094 13.25 12.4375 13.375 C 11.980469 13.6875 11.859375 14.308594 12.171875 14.765625 C 12.484375 15.222656 13.105469 15.34375 13.5625 15.03125 C 13.847656 14.835938 14.125 14.625 14.375 14.375 C 16.539063 12.210938 16.539063 8.664063 14.375 6.5 L 9.5 1.625 C 8.417969 0.542969 6.988281 0 5.5625 0 Z M 10.78125 8.875 C 10.738281 8.882813 10.695313 8.894531 10.65625 8.90625 C 10.507813 8.9375 10.371094 9 10.25 9.09375 C 10.039063 9.253906 9.820313 9.429688 9.625 9.625 C 7.460938 11.789063 7.460938 15.335938 9.625 17.5 L 14.5 22.375 C 16.664063 24.539063 20.210938 24.539063 22.375 22.375 C 24.539063 20.210938 24.539063 16.664063 22.375 14.5 L 18.71875 10.875 C 18.476563 10.578125 18.089844 10.441406 17.714844 10.527344 C 17.34375 10.613281 17.050781 10.90625 16.964844 11.277344 C 16.878906 11.652344 17.015625 12.039063 17.3125 12.28125 L 20.96875 15.9375 C 22.367188 17.335938 22.367188 19.570313 20.96875 20.96875 C 19.570313 22.367188 17.335938 22.367188 15.9375 20.96875 L 11.03125 16.0625 C 9.632813 14.664063 9.632813 12.429688 11.03125 11.03125 C 11.152344 10.90625 11.300781 10.820313 11.4375 10.71875 C 11.839844 10.472656 12.015625 9.976563 11.855469 9.53125 C 11.699219 9.085938 11.25 8.8125 10.78125 8.875 Z"/></svg>`;

      if (languagedir === "rtl") {
        newElemInner.style.left = '-2rem';
      } else {
        newElemInner.style.right = '-2rem';
      }

      newElemOuter.append(newElemInner);
      elem.append(newElemOuter);

      elem.addEventListener('mouseenter', function() {
        this.querySelector('.anchor').classList.remove('hide');
      });
      elem.addEventListener('mouseleave', function () {
        this.querySelector('.anchor').classList.add('hide');
      });
    }) : null;

    document.querySelectorAll('.anchor').forEach(function(elem) {
      elem.addEventListener('mouseleave', function() {
        elem.setAttribute('aria-label', null);
        elem.classList.remove('tooltipped');
        elem.classList.remove('tooltipped-s');
        elem.classList.remove('tooltipped-w');
      });
    });

    clip.on('success', function (e) {
      e.clearSelection();
      e.trigger.setAttribute('aria-label', 'Link copied to clipboard!');
      e.trigger.classList.add('tooltipped');
      e.trigger.classList.add('tooltipped-s');
    });
    // =================================================================



    
    
    var lib = JSON.parse("null");

    if (lib && lib.includes('mermaid')) {
      
      var themeVariant = localStorage.getItem('theme') || JSON.parse("\"dark\"");

      if (themeVariant === "dark" || themeVariant === "hacker") {
        mermaid.initialize({ theme: 'dark' });
      } else {
        mermaid.initialize({ theme: 'default' });
      }
      
      var mermaids = [];
      [].push.apply(mermaids, document.getElementsByClassName('language-mermaid'));
      mermaids.forEach(function(elem) {
        var elemParentNode = elem.parentNode;

        if (elemParentNode !== document.body) {
          elemParentNode.parentNode.insertBefore(elem, elemParentNode);
          elemParentNode.parentNode.removeChild(elemParentNode);
        }

        var newElemWrapper = document.createElement('div');
        newElemWrapper.classList.add('mermaid');
        newElemWrapper.style.padding = '34px 4px 6px';
        newElemWrapper.innerHTML = elem.innerHTML;
        elem.replaceWith(newElemWrapper);
      });
    }
    

    

    
    if (lib && lib.includes('katex')) {
      var mathElements = document.getElementsByClassName('math');
      var options = {
        delimiters: [
          { left: "$$", right: "$$", display: true },
          { left: "\\[", right: "\\]", display: true },
          { left: "$", right: "$", display: false },
          { left: "\\(", right: "\\)", display: false }
        ],
      };

      renderMathInElement(document.querySelector('.single__contents'), options);
    }
    



    
    if (lib && lib.includes('flowchartjs')) {
      
      var options = JSON.parse("{\"arrow-end\":\"block\",\"element-color\":\"black\",\"fill\":\"white\",\"flowstate\":{\"approved\":{\"fill\":\"#58C4A3\",\"font-size\":12,\"no-text\":\"n/a\",\"yes-text\":\"APPROVED\"},\"current\":{\"fill\":\"yellow\",\"font-color\":\"red\",\"font-weight\":\"bold\"},\"future\":{\"fill\":\"#FFFF99\"},\"invalid\":{\"fill\":\"#444444\"},\"past\":{\"fill\":\"#CCCCCC\",\"font-size\":12},\"rejected\":{\"fill\":\"#C45879\",\"font-size\":12,\"no-text\":\"REJECTED\",\"yes-text\":\"n/a\"},\"request\":{\"fill\":\"blue\"}},\"font-color\":\"black\",\"font-size\":14,\"line-color\":\"black\",\"line-length\":50,\"line-width\":3,\"no-text\":\"no\",\"scale\":1,\"symbols\":{\"end\":{\"class\":\"end-element\"},\"start\":{\"element-color\":\"green\",\"fill\":\"yellow\",\"font-color\":\"red\"}},\"text-margin\":10,\"x\":0,\"y\":0,\"yes-text\":\"yes\"}");
      var jsonContent = null;

      var flowchartPrefix = "language-flowchart";
      var index = 0;
      Array.prototype.forEach.call(document.querySelectorAll("[class^=" + flowchartPrefix + "]"), function(x){
          x.style.display = 'none'
          x.parentNode.style.backgroundColor = "transparent"
          jsonContent = x.innerText;

          var node0 = document.createElement('div');
          node0.id = 'flowchart' + index;
          x.parentNode.insertBefore(node0, x);

          var diagram = flowchart.parse(jsonContent);
          diagram.drawSVG("flowchart"+index, options);

          index +=1;
      });      
    }
    

    

    
    document.querySelectorAll("mjx-container").forEach(function (x) {
      x.parentElement.classList += 'has-jax'
    });
    



    
    if (lib && lib.includes('msc')) {
      
      var options = JSON.parse("{\"theme\":\"hand\"}");
      var jsonContent = null;

      var index = 0;
      var chartPrefix = "language-msc";
      Array.prototype.forEach.call(document.querySelectorAll("[class^=" + chartPrefix + "]"), function (x) {
        x.style.display = 'none'
        x.parentNode.style.backgroundColor = "transparent"
        jsonContent = x.innerText;
        var node0 = document.createElement('div');
        node0.id = 'msc' + index;
        x.parentNode.insertBefore(node0, x);
        var diagram = Diagram.parse(jsonContent);
        diagram.drawSVG("msc" + index, options);
        index += 1;
      });
    }
    



    
    if (lib && lib.includes('chart')) {
      var borderColor = "#666";
      var bgColor = "#ddd";
      var borderWidth = 2;

      Chart.defaults.global.elements.rectangle.borderWidth = borderWidth;
      Chart.defaults.global.elements.rectangle.borderColor = borderColor;
      Chart.defaults.global.elements.rectangle.backgroundColor = bgColor;

      Chart.defaults.global.elements.line.borderWidth = borderWidth;
      Chart.defaults.global.elements.line.borderColor = borderColor;
      Chart.defaults.global.elements.line.backgroundColor = bgColor;

      Chart.defaults.global.elements.point.borderWidth = borderWidth;
      Chart.defaults.global.elements.point.borderColor = borderColor;
      Chart.defaults.global.elements.point.backgroundColor = bgColor;

      var chartPrefix = "language-chart";
      var index = 0;
      var jsonContent = null;

      Array.prototype.forEach.call(document.querySelectorAll("[class^=" + chartPrefix + "]"), function (x) {
        x.style.display = 'none'
        x.parentNode.style.backgroundColor = "transparent"
        jsonContent = x.innerText;
        var node0 = document.createElement('canvas');
        var source = null;
        node0.height = 200;
        node0.style.height = 200;
        node0.id = 'myChart' + index;
        source = JSON.parse(jsonContent);
        x.parentNode.insertBefore(node0, x);
        var ctx = document.getElementById('myChart' + index).getContext('2d');
        var myChart = new Chart(ctx, source);
        index += 1;
      });            
    }
    



    
    if (lib && lib.includes('wavedrom')) {
      var wavePrefix = "language-wave";
      var index = 0;
      var jsonContent = null;
      
      Array.prototype.forEach.call(document.querySelectorAll("[class^=" + wavePrefix + "]"), function (x) {
        x.style.display = 'none'
        x.parentNode.style.backgroundColor = "transparent"
        jsonContent = x.innerText;
        var node0 = document.createElement('div');
        var source = null;
        node0.id = 'WaveDrom_Display_' + index;
        source = JSON.parse(jsonContent);
        x.parentNode.insertBefore(node0, x);
        WaveDrom.RenderWaveForm(index, source, "WaveDrom_Display_");
        index += 1;
      });
    }
    



    
    if (lib && lib.includes('viz')) {
      var vizPrefix = "language-viz-";
      Array.prototype.forEach.call(document.querySelectorAll("[class^=" + vizPrefix + "]"), function (x) {
        x.style.display = 'none'
        x.parentNode.style.backgroundColor = "transparent"
        var engine;
        x.getAttribute("class").split(" ").forEach(function (cls) {
          if (cls.startsWith(vizPrefix)) {
            engine = cls.substr(vizPrefix.length);
          }
        });
        var viz = new Viz();
        viz.renderSVGElement(x.innerText, { engine: engine })
          .then(function (element) {
            element.style.width = "100%";
            x.parentNode.insertBefore(element, x);
          })
      });
    }
    
    
  }
</script>


            
            <footer class="footer">
    
    
<div class="footer__social">
  <div class="social">
    
      
      <a href="https://blog.csdn.net/weixin_41263449" title="csdn" aria-label="csdn">
        <svg fill="#000000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32"><path fill="currentColor" d="M11.705 9.681l-.03.247c-.035.288-.3.484-.585.439-.47-.081-1.135-.151-1.64-.151-.765 0-1.16.267-1.19.56-.035.368.365.389 1.355.681 1.345.378 1.935.913 1.855 1.741C11.38 14.172 10.31 15 8.165 15c-.655 0-1.24-.096-1.675-.222-.24-.066-.395-.293-.37-.545l.035-.288c.045-.232.25-.404.49-.404.035 0 .065.005.095.01.01 0 1.057.237 1.61.202.808-.051 1.26-.247 1.3-.636.03-.353-.3-.404-1.22-.646-1.265-.343-2.075-.878-1.995-1.731C6.53 9.752 7.72 9 9.555 9 10.2 9 10.83 9.035 11.3 9.121 11.56 9.167 11.74 9.414 11.705 9.681zM18.79 9.814c.019-.223.184-.409.404-.45 4.533-.849 4.929.926 4.782 2.502l-.241 2.54c-.024.257-.24.453-.498.453h-.546c-.295 0-.526-.254-.498-.547l.207-2.182c.056-.601.405-1.776-1.281-1.732-.186.005-.343.017-.469.032-.235.027-.414.218-.433.455-.021.255-.05.595-.083.88l-.251 2.642c-.024.257-.24.453-.498.453h-.514c-.296 0-.527-.255-.498-.549l.247-2.501L18.79 9.814zM17.115 9.846c-.615-.5-1.611-.696-2.84-.735-.531-.017-1.087.024-1.265.05-.192.029-.345.19-.385.38-.01.035-.015.07-.015.11l-.43 4.635c-.03.275.17.52.44.545.425.045.91.065 1.41.065 1.205 0 2.005-.18 2.64-.59.695-.44 1.17-1.15 1.265-2.16C18.035 11.056 17.665 10.306 17.115 9.846zM16.435 12.106c-.085.935-.955 1.605-2.185 1.605-.305 0-.46-.025-.58-.05l.3-3.355c.125-.025.36-.025.525-.025C15.795 10.271 16.565 10.746 16.435 12.106zM5.367 14.461c-.021.227-.19.41-.415.448C4.623 14.966 4.163 15 3.595 15c-2.427 0-3.737-1.254-3.583-2.913C.198 10.112 2.139 9 4.264 9c.559 0 .961.034 1.304.093.259.045.437.286.408.547L5.941 9.965c-.031.283-.292.487-.573.439-.326-.055-.724-.093-1.071-.093-1.25 0-2.312.41-2.434 1.707-.109 1.16.637 1.714 2.044 1.714.271 0 .614-.024.922-.064.318-.041.592.222.562.541L5.367 14.461z"/></svg>
      </a>
            
    
            
    
            
    
      
      <a href="mailto:1427298682@qq.com" title="email" aria-label="email">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path fill="currentColor" d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-.4 4.25l-7.07 4.42c-.32.2-.74.2-1.06 0L4.4 8.25c-.25-.16-.4-.43-.4-.72 0-.67.73-1.07 1.3-.72L12 11l6.7-4.19c.57-.35 1.3.05 1.3.72 0 .29-.15.56-.4.72z"/></svg>
      </a>
            
    
            
    
            
    
      
      <a href="https://github.com/redisread/" title="github" aria-label="github">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 24 24" version="1.1">
<g id="surface3680">
<path fill="currentColor" d="M 10.898438 2.101562 C 6.300781 2.601562 2.601562 6.300781 2.101562 10.800781 C 1.601562 15.5 4.300781 19.699219 8.398438 21.300781 C 8.699219 21.398438 9 21.199219 9 20.800781 L 9 19.199219 C 9 19.199219 8.601562 19.300781 8.101562 19.300781 C 6.699219 19.300781 6.101562 18.101562 6 17.398438 C 5.898438 17 5.699219 16.699219 5.398438 16.398438 C 5.101562 16.300781 5 16.300781 5 16.199219 C 5 16 5.300781 16 5.398438 16 C 6 16 6.5 16.699219 6.699219 17 C 7.199219 17.800781 7.800781 18 8.101562 18 C 8.5 18 8.800781 17.898438 9 17.800781 C 9.101562 17.101562 9.398438 16.398438 10 16 C 7.699219 15.5 6 14.199219 6 12 C 6 10.898438 6.5 9.800781 7.199219 9 C 7.101562 8.800781 7 8.300781 7 7.601562 C 7 7.199219 7 6.601562 7.300781 6 C 7.300781 6 8.699219 6 10.101562 7.300781 C 10.601562 7.101562 11.300781 7 12 7 C 12.699219 7 13.398438 7.101562 14 7.300781 C 15.300781 6 16.800781 6 16.800781 6 C 17 6.601562 17 7.199219 17 7.601562 C 17 8.398438 16.898438 8.800781 16.800781 9 C 17.5 9.800781 18 10.800781 18 12 C 18 14.199219 16.300781 15.5 14 16 C 14.601562 16.5 15 17.398438 15 18.300781 L 15 20.898438 C 15 21.199219 15.300781 21.5 15.699219 21.398438 C 19.398438 19.898438 22 16.300781 22 12.101562 C 22 6.101562 16.898438 1.398438 10.898438 2.101562 Z M 10.898438 2.101562 "/>
</g>
</svg>

      </a>
            
    
            
    
            
    
      
      <a href="https://www.instagram.com/jiahong.wu.581/" title="instagram" aria-label="instagram">
        <svg fill="#000000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32" height="32"><path fill="currentColor" d="M 11.46875 5 C 7.917969 5 5 7.914063 5 11.46875 L 5 20.53125 C 5 24.082031 7.914063 27 11.46875 27 L 20.53125 27 C 24.082031 27 27 24.085938 27 20.53125 L 27 11.46875 C 27 7.917969 24.085938 5 20.53125 5 Z M 11.46875 7 L 20.53125 7 C 23.003906 7 25 8.996094 25 11.46875 L 25 20.53125 C 25 23.003906 23.003906 25 20.53125 25 L 11.46875 25 C 8.996094 25 7 23.003906 7 20.53125 L 7 11.46875 C 7 8.996094 8.996094 7 11.46875 7 Z M 21.90625 9.1875 C 21.402344 9.1875 21 9.589844 21 10.09375 C 21 10.597656 21.402344 11 21.90625 11 C 22.410156 11 22.8125 10.597656 22.8125 10.09375 C 22.8125 9.589844 22.410156 9.1875 21.90625 9.1875 Z M 16 10 C 12.699219 10 10 12.699219 10 16 C 10 19.300781 12.699219 22 16 22 C 19.300781 22 22 19.300781 22 16 C 22 12.699219 19.300781 10 16 10 Z M 16 12 C 18.222656 12 20 13.777344 20 16 C 20 18.222656 18.222656 20 16 20 C 13.777344 20 12 18.222656 12 16 C 12 13.777344 13.777344 12 16 12 Z"/></svg>
      </a>
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
            
    
      
      <a href="https://www.weibo.com/2587041797/" title="weibo" aria-label="weibo">
        <svg fill="#000000" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="32" height="32"><path fill="currentColor" d="M 16.28125 3.8125 C 16.054688 3.828125 15.816406 3.859375 15.59375 3.90625 C 15.179688 3.996094 14.910156 4.402344 15 4.8125 C 15.085938 5.226563 15.492188 5.496094 15.90625 5.40625 C 17.179688 5.136719 18.566406 5.53125 19.5 6.5625 C 20.433594 7.597656 20.679688 9.011719 20.28125 10.25 C 20.152344 10.652344 20.378906 11.089844 20.78125 11.21875 C 21.183594 11.347656 21.617188 11.121094 21.75 10.71875 C 22.3125 8.976563 21.96875 7.015625 20.65625 5.5625 C 19.671875 4.46875 18.296875 3.875 16.9375 3.8125 C 16.710938 3.800781 16.507813 3.796875 16.28125 3.8125 Z M 10.0625 6.09375 C 8.667969 6.242188 6.699219 7.332031 4.96875 9.0625 C 3.082031 10.949219 2 12.957031 2 14.6875 C 2 17.996094 6.226563 20 10.375 20 C 15.8125 20 19.4375 16.820313 19.4375 14.3125 C 19.4375 12.796875 18.179688 11.949219 17.03125 11.59375 C 16.75 11.507813 16.539063 11.464844 16.6875 11.09375 C 17.007813 10.289063 17.066406 9.589844 16.71875 9.09375 C 16.070313 8.164063 14.253906 8.210938 12.21875 9.0625 C 12.21875 9.0625 11.585938 9.351563 11.75 8.84375 C 12.0625 7.835938 12.019531 6.988281 11.53125 6.5 C 11.1875 6.152344 10.695313 6.027344 10.0625 6.09375 Z M 16.8125 6.5 C 16.589844 6.488281 16.375 6.515625 16.15625 6.5625 C 15.800781 6.636719 15.578125 7.019531 15.65625 7.375 C 15.734375 7.730469 16.082031 7.953125 16.4375 7.875 C 16.863281 7.785156 17.34375 7.902344 17.65625 8.25 C 17.96875 8.597656 18.042969 9.054688 17.90625 9.46875 C 17.792969 9.816406 17.964844 10.199219 18.3125 10.3125 C 18.660156 10.421875 19.046875 10.253906 19.15625 9.90625 C 19.429688 9.058594 19.265625 8.085938 18.625 7.375 C 18.144531 6.84375 17.476563 6.53125 16.8125 6.5 Z M 10.8125 10.90625 C 13.582031 11.003906 15.8125 12.378906 16 14.28125 C 16.214844 16.457031 13.71875 18.484375 10.40625 18.8125 C 7.09375 19.140625 4.214844 17.640625 4 15.46875 C 3.785156 13.292969 6.316406 11.265625 9.625 10.9375 C 10.039063 10.898438 10.417969 10.890625 10.8125 10.90625 Z M 8.9375 13 C 7.804688 13.101563 6.734375 13.75 6.25 14.6875 C 5.589844 15.964844 6.242188 17.378906 7.75 17.84375 C 9.308594 18.324219 11.140625 17.597656 11.78125 16.21875 C 12.410156 14.871094 11.605469 13.472656 10.0625 13.09375 C 9.691406 13 9.316406 12.964844 8.9375 13 Z M 8.21875 15.0625 C 8.351563 15.066406 8.472656 15.109375 8.59375 15.15625 C 9.082031 15.355469 9.234375 15.878906 8.9375 16.34375 C 8.632813 16.804688 7.988281 17.027344 7.5 16.8125 C 7.019531 16.601563 6.882813 16.074219 7.1875 15.625 C 7.414063 15.289063 7.824219 15.058594 8.21875 15.0625 Z"/></svg>
      </a>
            
    
            
    
            
    
            
    
            
    
    
  
  
    
      <a href="https://hugo.jiahongw.com/en/zh/index.xml" type="application/rss+xml" title="RSS" aria-label="RSS Feed Link">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><circle fill="currentColor" cx="6.18" cy="17.82" r="2.18"/><path fill="currentColor" d="M5.59 10.23c-.84-.14-1.59.55-1.59 1.4 0 .71.53 1.28 1.23 1.4 2.92.51 5.22 2.82 5.74 5.74.12.7.69 1.23 1.4 1.23.85 0 1.54-.75 1.41-1.59-.68-4.2-3.99-7.51-8.19-8.18zm-.03-5.71C4.73 4.43 4 5.1 4 5.93c0 .73.55 1.33 1.27 1.4 6.01.6 10.79 5.38 11.39 11.39.07.73.67 1.28 1.4 1.28.84 0 1.5-.73 1.42-1.56-.73-7.34-6.57-13.19-13.92-13.92z"/></svg>
      </a>
    
  


  </div>
</div>

    
<div id="gtt">
  <div class="gtt">
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M8.12 14.71L12 10.83l3.88 3.88c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L12.7 8.71c-.39-.39-1.02-.39-1.41 0L6.7 13.3c-.39.39-.39 1.02 0 1.41.39.38 1.03.39 1.42 0z"/></svg>
  </div>
</div>

    <hr />

    <div class="basicflex flexwrap">
        
            
        
            
        
    </div>

    <div class="footer__poweredby">
        
  <div class="busuanzi">
    
    
      <div class="busuanzi__item">
        <span class="busuanzi__item--label">
          Total visitors
        </span>
        <span id="busuanzi_value_site_uv" class="busuanzi__item--number">...</span>
      </div>
    

    
      <div class="busuanzi__item">
        <span class="busuanzi__item--label">
          Total views
        </span>
        <span id="busuanzi_value_site_pv" class="busuanzi__item--number">...</span>
      </div>
    

  </div>

                
            <p class="caption">
                
                    Â©2021-2023| VictorHong | <a href="https://beian.miit.gov.cn">ç²¤ICPå¤‡20043735å·</a>
                
            </p>
        

        
            <p class="caption">Powered by <a href="https://gohugo.io/" target="_blank" rel="noreferrer">Hugo</a> and the <a href="https://github.com/zzossig/hugo-theme-zzo" target="_blank" rel="noreferrer">Zzo theme</a></p>
        
        
    </div> 
</footer>
        </div>
        





<div class="wrapper__right hide" data-pad="true" dir="ltr">
  <script>document.querySelector('.wrapper__right').classList.remove('hide')</script>
  
</div>

    </div>
</body>

</html>